/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*
* @overview
*
* Phaser - http://phaser.io
*
* v2.4.6 "Baerlon" - Built: Thu Feb 18 2016 14:39:48
*
* By Richard Davey http://www.photonstorm.com @photonstorm
*
* Phaser is a fun, free and fast 2D game framework for making HTML5 games
* for desktop and mobile web browsers, supporting Canvas and WebGL rendering.
*
* Phaser uses Pixi.js for rendering, created by Mat Groves http://matgroves.com @Doormat23
* Phaser uses p2.js for full-body physics, created by Stefan Hedman https://github.com/schteppe/p2.js @schteppe
* Phaser contains a port of N+ Physics, converted by Richard Davey, original by http://www.metanetsoftware.com
*
* Many thanks to Adam Saltsman (@ADAMATOMIC) for releasing Flixel, from which both Phaser
* and my love of framework development originate.
*
* Follow development at http://phaser.io and on our forum
*
* "If you want your children to be intelligent,  read them fairy tales."
* "If you want them to be more intelligent, read them more fairy tales."
*                                                     -- Albert Einstein
*/

/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 p2.js authors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

/*
        PolyK library
        url: http://polyk.ivank.net
        Released under MIT licence.

        Copyright (c) 2012 Ivan Kuckir

        Permission is hereby granted, free of charge, to any person
        obtaining a copy of this software and associated documentation
        files (the "Software"), to deal in the Software without
        restriction, including without limitation the rights to use,
        copy, modify, merge, publish, distribute, sublicense, and/or sell
        copies of the Software, and to permit persons to whom the
        Software is furnished to do so, subject to the following
        conditions:

        The above copyright notice and this permission notice shall be
        included in all copies or substantial portions of the Software.

        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
        EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
        OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
        NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
        HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
        WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
        FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
        OTHER DEALINGS IN THE SOFTWARE.
    */

/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
 * @author Mat Groves http://matgroves.com/ @Doormat23
 * @copyright Mat Groves, Rovanion Luckey
 */

/**
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Chad Engler <chad@pantherdev.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       Mat Groves http://matgroves.com/ @Doormat23
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Adrien Brault <adrien.brault@gmail.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       Mat Groves http://matgroves.com/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/*
    PolyK library
    url: http://polyk.ivank.net
    Released under MIT licence.

    Copyright (c) 2012 Ivan Kuckir

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

    This is an amazing lib!

    Slightly modified by Mat Groves (matgroves.com);
*/

/*
Copyright (c) 2016, Mapbox

Permission to use, copy, modify, and/or distribute this software for any purpose
with or without fee is hereby granted, provided that the above copyright notice
and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
THIS SOFTWARE.
*/

/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd, Richard Davey
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
 * @author       Timo Hausmann
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2015 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */

/**
* @copyright Â© 2012 Timo Hausmann
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

/**
 * @author       Jeremy Dowell <jeremy@codevinsky.com>
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2015 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */

/**
* @author       Georgios Kaleadis https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/**
* @author       George https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2015 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/

/*
  "Better than skype" a silly game
  Copyright (C) 2016 Swissnetizen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

/*
 RequireJS 2.1.16 Copyright (c) 2010-2015, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
var requirejs,require,define;
(function(ba){function G(b){return"[object Function]"===K.call(b)}function H(b){return"[object Array]"===K.call(b)}function v(b,c){if(b){var d;for(d=0;d<b.length&&(!b[d]||!c(b[d],d,b));d+=1);}}function T(b,c){if(b){var d;for(d=b.length-1;-1<d&&(!b[d]||!c(b[d],d,b));d-=1);}}function t(b,c){return fa.call(b,c)}function m(b,c){return t(b,c)&&b[c]}function B(b,c){for(var d in b)if(t(b,d)&&c(b[d],d))break}function U(b,c,d,e){c&&B(c,function(c,g){if(d||!t(b,g))e&&"object"===typeof c&&c&&!H(c)&&!G(c)&&!(c instanceof
RegExp)?(b[g]||(b[g]={}),U(b[g],c,d,e)):b[g]=c});return b}function u(b,c){return function(){return c.apply(b,arguments)}}function ca(b){throw b;}function da(b){if(!b)return b;var c=ba;v(b.split("."),function(b){c=c[b]});return c}function C(b,c,d,e){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b);c.requireType=b;c.requireModules=e;d&&(c.originalError=d);return c}function ga(b){function c(a,k,b){var f,l,c,d,e,g,i,p,k=k&&k.split("/"),h=j.map,n=h&&h["*"];if(a){a=a.split("/");l=a.length-1;j.nodeIdCompat&&
Q.test(a[l])&&(a[l]=a[l].replace(Q,""));"."===a[0].charAt(0)&&k&&(l=k.slice(0,k.length-1),a=l.concat(a));l=a;for(c=0;c<l.length;c++)if(d=l[c],"."===d)l.splice(c,1),c-=1;else if(".."===d&&!(0===c||1==c&&".."===l[2]||".."===l[c-1])&&0<c)l.splice(c-1,2),c-=2;a=a.join("/")}if(b&&h&&(k||n)){l=a.split("/");c=l.length;a:for(;0<c;c-=1){e=l.slice(0,c).join("/");if(k)for(d=k.length;0<d;d-=1)if(b=m(h,k.slice(0,d).join("/")))if(b=m(b,e)){f=b;g=c;break a}!i&&(n&&m(n,e))&&(i=m(n,e),p=c)}!f&&i&&(f=i,g=p);f&&(l.splice(0,
g,f),a=l.join("/"))}return(f=m(j.pkgs,a))?f:a}function d(a){z&&v(document.getElementsByTagName("script"),function(k){if(k.getAttribute("data-requiremodule")===a&&k.getAttribute("data-requirecontext")===i.contextName)return k.parentNode.removeChild(k),!0})}function e(a){var k=m(j.paths,a);if(k&&H(k)&&1<k.length)return k.shift(),i.require.undef(a),i.makeRequire(null,{skipMap:!0})([a]),!0}function n(a){var k,c=a?a.indexOf("!"):-1;-1<c&&(k=a.substring(0,c),a=a.substring(c+1,a.length));return[k,a]}function p(a,
k,b,f){var l,d,e=null,g=k?k.name:null,j=a,p=!0,h="";a||(p=!1,a="_@r"+(K+=1));a=n(a);e=a[0];a=a[1];e&&(e=c(e,g,f),d=m(r,e));a&&(e?h=d&&d.normalize?d.normalize(a,function(a){return c(a,g,f)}):-1===a.indexOf("!")?c(a,g,f):a:(h=c(a,g,f),a=n(h),e=a[0],h=a[1],b=!0,l=i.nameToUrl(h)));b=e&&!d&&!b?"_unnormalized"+(O+=1):"";return{prefix:e,name:h,parentMap:k,unnormalized:!!b,url:l,originalName:j,isDefine:p,id:(e?e+"!"+h:h)+b}}function s(a){var k=a.id,b=m(h,k);b||(b=h[k]=new i.Module(a));return b}function q(a,
k,b){var f=a.id,c=m(h,f);if(t(r,f)&&(!c||c.defineEmitComplete))"defined"===k&&b(r[f]);else if(c=s(a),c.error&&"error"===k)b(c.error);else c.on(k,b)}function w(a,b){var c=a.requireModules,f=!1;if(b)b(a);else if(v(c,function(b){if(b=m(h,b))b.error=a,b.events.error&&(f=!0,b.emit("error",a))}),!f)g.onError(a)}function x(){R.length&&(ha.apply(A,[A.length,0].concat(R)),R=[])}function y(a){delete h[a];delete V[a]}function F(a,b,c){var f=a.map.id;a.error?a.emit("error",a.error):(b[f]=!0,v(a.depMaps,function(f,
d){var e=f.id,g=m(h,e);g&&(!a.depMatched[d]&&!c[e])&&(m(b,e)?(a.defineDep(d,r[e]),a.check()):F(g,b,c))}),c[f]=!0)}function D(){var a,b,c=(a=1E3*j.waitSeconds)&&i.startTime+a<(new Date).getTime(),f=[],l=[],g=!1,h=!0;if(!W){W=!0;B(V,function(a){var i=a.map,j=i.id;if(a.enabled&&(i.isDefine||l.push(a),!a.error))if(!a.inited&&c)e(j)?g=b=!0:(f.push(j),d(j));else if(!a.inited&&(a.fetched&&i.isDefine)&&(g=!0,!i.prefix))return h=!1});if(c&&f.length)return a=C("timeout","Load timeout for modules: "+f,null,
f),a.contextName=i.contextName,w(a);h&&v(l,function(a){F(a,{},{})});if((!c||b)&&g)if((z||ea)&&!X)X=setTimeout(function(){X=0;D()},50);W=!1}}function E(a){t(r,a[0])||s(p(a[0],null,!0)).init(a[1],a[2])}function I(a){var a=a.currentTarget||a.srcElement,b=i.onScriptLoad;a.detachEvent&&!Y?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=i.onScriptError;(!a.detachEvent||Y)&&a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function J(){var a;
for(x();A.length;){a=A.shift();if(null===a[0])return w(C("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));E(a)}}var W,Z,i,L,X,j={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},h={},V={},$={},A=[],r={},S={},aa={},K=1,O=1;L={require:function(a){return a.require?a.require:a.require=i.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?r[a.map.id]=a.exports:a.exports=r[a.map.id]={}},module:function(a){return a.module?
a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return m(j.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}};Z=function(a){this.events=m($,a.id)||{};this.map=a;this.shim=m(j.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};Z.prototype={init:function(a,b,c,f){f=f||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=u(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=
c;this.inited=!0;this.ignore=f.ignore;f.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;i.startTime=(new Date).getTime();var a=this.map;if(this.shim)i.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=
this.map.url;S[a]||(S[a]=!0,i.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var f=this.exports,l=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(G(l)){if(this.events.error&&this.map.isDefine||g.onError!==ca)try{f=i.execCb(c,l,b,f)}catch(d){a=d}else f=i.execCb(c,l,b,f);this.map.isDefine&&void 0===f&&((b=this.module)?f=b.exports:this.usingExports&&
(f=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",w(this.error=a)}else f=l;this.exports=f;if(this.map.isDefine&&!this.ignore&&(r[c]=f,g.onResourceLoad))g.onResourceLoad(i,this.map,this.depMaps);y(c);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=
this.map,b=a.id,d=p(a.prefix);this.depMaps.push(d);q(d,"defined",u(this,function(f){var l,d;d=m(aa,this.map.id);var e=this.map.name,P=this.map.parentMap?this.map.parentMap.name:null,n=i.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(f.normalize&&(e=f.normalize(e,function(a){return c(a,P,!0)})||""),f=p(a.prefix+"!"+e,this.map.parentMap),q(f,"defined",u(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),d=m(h,f.id)){this.depMaps.push(f);
if(this.events.error)d.on("error",u(this,function(a){this.emit("error",a)}));d.enable()}}else d?(this.map.url=i.nameToUrl(d),this.load()):(l=u(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),l.error=u(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];B(h,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&y(a.map.id)});w(a)}),l.fromText=u(this,function(f,c){var d=a.name,e=p(d),P=M;c&&(f=c);P&&(M=!1);s(e);t(j.config,b)&&(j.config[d]=j.config[b]);try{g.exec(f)}catch(h){return w(C("fromtexteval",
"fromText eval for "+b+" failed: "+h,h,[b]))}P&&(M=!0);this.depMaps.push(e);i.completeLoad(d);n([d],l)}),f.load(a.name,n,l,j))}));i.enable(d,this);this.pluginMaps[d.id]=d},enable:function(){V[this.map.id]=this;this.enabling=this.enabled=!0;v(this.depMaps,u(this,function(a,b){var c,f;if("string"===typeof a){a=p(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=m(L,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;q(a,"defined",u(this,function(a){this.defineDep(b,
a);this.check()}));this.errback?q(a,"error",u(this,this.errback)):this.events.error&&q(a,"error",u(this,function(a){this.emit("error",a)}))}c=a.id;f=h[c];!t(L,c)&&(f&&!f.enabled)&&i.enable(a,this)}));B(this.pluginMaps,u(this,function(a){var b=m(h,a.id);b&&!b.enabled&&i.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){v(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};i={config:j,contextName:b,
registry:h,defined:r,urlFetched:S,defQueue:A,Module:Z,makeModuleMap:p,nextTick:g.nextTick,onError:w,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=j.shim,c={paths:!0,bundles:!0,config:!0,map:!0};B(a,function(a,b){c[b]?(j[b]||(j[b]={}),U(j[b],a,!0,!0)):j[b]=a});a.bundles&&B(a.bundles,function(a,b){v(a,function(a){a!==b&&(aa[a]=b)})});a.shim&&(B(a.shim,function(a,c){H(a)&&(a={deps:a});if((a.exports||a.init)&&!a.exportsFn)a.exportsFn=i.makeShimExports(a);
b[c]=a}),j.shim=b);a.packages&&v(a.packages,function(a){var b,a="string"===typeof a?{name:a}:a;b=a.name;a.location&&(j.paths[b]=a.location);j.pkgs[b]=a.name+"/"+(a.main||"main").replace(ia,"").replace(Q,"")});B(h,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=p(b))});if(a.deps||a.callback)i.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(ba,arguments));return b||a.exports&&da(a.exports)}},makeRequire:function(a,e){function j(c,d,m){var n,
q;e.enableBuildCallback&&(d&&G(d))&&(d.__requireJsBuild=!0);if("string"===typeof c){if(G(d))return w(C("requireargs","Invalid require call"),m);if(a&&t(L,c))return L[c](h[a.id]);if(g.get)return g.get(i,c,a,j);n=p(c,a,!1,!0);n=n.id;return!t(r,n)?w(C("notloaded",'Module name "'+n+'" has not been loaded yet for context: '+b+(a?"":". Use require([])"))):r[n]}J();i.nextTick(function(){J();q=s(p(null,a));q.skipMap=e.skipMap;q.init(c,d,m,{enabled:!0});D()});return j}e=e||{};U(j,{isBrowser:z,toUrl:function(b){var d,
e=b.lastIndexOf("."),k=b.split("/")[0];if(-1!==e&&(!("."===k||".."===k)||1<e))d=b.substring(e,b.length),b=b.substring(0,e);return i.nameToUrl(c(b,a&&a.id,!0),d,!0)},defined:function(b){return t(r,p(b,a,!1,!0).id)},specified:function(b){b=p(b,a,!1,!0).id;return t(r,b)||t(h,b)}});a||(j.undef=function(b){x();var c=p(b,a,!0),e=m(h,b);d(b);delete r[b];delete S[c.url];delete $[b];T(A,function(a,c){a[0]===b&&A.splice(c,1)});e&&(e.events.defined&&($[b]=e.events),y(b))});return j},enable:function(a){m(h,a.id)&&
s(a).enable()},completeLoad:function(a){var b,c,d=m(j.shim,a)||{},g=d.exports;for(x();A.length;){c=A.shift();if(null===c[0]){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);E(c)}c=m(h,a);if(!b&&!t(r,a)&&c&&!c.inited){if(j.enforceDefine&&(!g||!da(g)))return e(a)?void 0:w(C("nodefine","No define call for "+a,null,[a]));E([a,d.deps||[],d.exportsFn])}D()},nameToUrl:function(a,b,c){var d,e,h;(d=m(j.pkgs,a))&&(a=d);if(d=m(aa,a))return i.nameToUrl(d,b,c);if(g.jsExtRegExp.test(a))d=a+(b||"");else{d=j.paths;
a=a.split("/");for(e=a.length;0<e;e-=1)if(h=a.slice(0,e).join("/"),h=m(d,h)){H(h)&&(h=h[0]);a.splice(0,e,h);break}d=a.join("/");d+=b||(/^data\:|\?/.test(d)||c?"":".js");d=("/"===d.charAt(0)||d.match(/^[\w\+\.\-]+:/)?"":j.baseUrl)+d}return j.urlArgs?d+((-1===d.indexOf("?")?"?":"&")+j.urlArgs):d},load:function(a,b){g.load(i,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||ja.test((a.currentTarget||a.srcElement).readyState))N=null,a=I(a),i.completeLoad(a.id)},
onScriptError:function(a){var b=I(a);if(!e(b.id))return w(C("scripterror","Script error for: "+b.id,a,[b.id]))}};i.require=i.makeRequire();return i}var g,x,y,D,I,E,N,J,s,O,ka=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,la=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,Q=/\.js$/,ia=/^\.\//;x=Object.prototype;var K=x.toString,fa=x.hasOwnProperty,ha=Array.prototype.splice,z=!!("undefined"!==typeof window&&"undefined"!==typeof navigator&&window.document),ea=!z&&"undefined"!==typeof importScripts,ja=
z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Y="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),F={},q={},R=[],M=!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(G(requirejs))return;q=requirejs;requirejs=void 0}"undefined"!==typeof require&&!G(require)&&(q=require,require=void 0);g=requirejs=function(b,c,d,e){var n,p="_";!H(b)&&"string"!==typeof b&&(n=b,H(c)?(b=c,c=d,d=e):b=[]);n&&n.context&&(p=n.context);(e=m(F,p))||(e=F[p]=g.s.newContext(p));
n&&e.configure(n);return e.require(b,c,d)};g.config=function(b){return g(b)};g.nextTick="undefined"!==typeof setTimeout?function(b){setTimeout(b,4)}:function(b){b()};require||(require=g);g.version="2.1.16";g.jsExtRegExp=/^\/|:|\?|\.js$/;g.isBrowser=z;x=g.s={contexts:F,newContext:ga};g({});v(["toUrl","undef","defined","specified"],function(b){g[b]=function(){var c=F._;return c.require[b].apply(c,arguments)}});if(z&&(y=x.head=document.getElementsByTagName("head")[0],D=document.getElementsByTagName("base")[0]))y=
x.head=D.parentNode;g.onError=ca;g.createNode=function(b){var c=b.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");c.type=b.scriptType||"text/javascript";c.charset="utf-8";c.async=!0;return c};g.load=function(b,c,d){var e=b&&b.config||{};if(z)return e=g.createNode(e,c,d),e.setAttribute("data-requirecontext",b.contextName),e.setAttribute("data-requiremodule",c),e.attachEvent&&!(e.attachEvent.toString&&0>e.attachEvent.toString().indexOf("[native code"))&&
!Y?(M=!0,e.attachEvent("onreadystatechange",b.onScriptLoad)):(e.addEventListener("load",b.onScriptLoad,!1),e.addEventListener("error",b.onScriptError,!1)),e.src=d,J=e,D?y.insertBefore(e,D):y.appendChild(e),J=null,e;if(ea)try{importScripts(d),b.completeLoad(c)}catch(m){b.onError(C("importscripts","importScripts failed for "+c+" at "+d,m,[c]))}};z&&!q.skipDataMain&&T(document.getElementsByTagName("script"),function(b){y||(y=b.parentNode);if(I=b.getAttribute("data-main"))return s=I,q.baseUrl||(E=s.split("/"),
s=E.pop(),O=E.length?E.join("/")+"/":"./",q.baseUrl=O),s=s.replace(Q,""),g.jsExtRegExp.test(s)&&(s=I),q.deps=q.deps?q.deps.concat(s):[s],!0});define=function(b,c,d){var e,g;"string"!==typeof b&&(d=c,c=b,b=null);H(c)||(d=c,c=null);!c&&G(d)&&(c=[],d.length&&(d.toString().replace(ka,"").replace(la,function(b,d){c.push(d)}),c=(1===d.length?["require"]:["require","exports","module"]).concat(c)));if(M){if(!(e=J))N&&"interactive"===N.readyState||T(document.getElementsByTagName("script"),function(b){if("interactive"===
b.readyState)return N=b}),e=N;e&&(b||(b=e.getAttribute("data-requiremodule")),g=F[e.getAttribute("data-requirecontext")])}(g?g.defQueue:R).push([b,c,d])};define.amd={jQuery:!0};g.exec=function(b){return eval(b)};g(q)}})(this);

!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&!1)define("Phaser",e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.p2=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=t[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){function i(){}var r=e("./Scalar");t.exports=i,i.lineInt=function(e,t,n){n=n||0;var i=[0,0],s,o,u,a,f,l,c;return s=e[1][1]-e[0][1],o=e[0][0]-e[1][0],u=s*e[0][0]+o*e[0][1],a=t[1][1]-t[0][1],f=t[0][0]-t[1][0],l=a*t[0][0]+f*t[0][1],c=s*f-a*o,r.eq(c,0,n)||(i[0]=(f*u-o*l)/c,i[1]=(s*l-a*u)/c),i},i.segmentsIntersect=function(e,t,n,r){var i=t[0]-e[0],s=t[1]-e[1],o=r[0]-n[0],u=r[1]-n[1];if(o*s-u*i==0)return!1;var a=(i*(n[1]-e[1])+s*(e[0]-n[0]))/(o*s-u*i),f=(o*(e[1]-n[1])+u*(n[0]-e[0]))/(u*i-o*s);return a>=0&&a<=1&&f>=0&&f<=1}},{"./Scalar":4}],2:[function(e,t,n){function r(){}t.exports=r,r.area=function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])},r.left=function(e,t,n){return r.area(e,t,n)>0},r.leftOn=function(e,t,n){return r.area(e,t,n)>=0},r.right=function(e,t,n){return r.area(e,t,n)<0},r.rightOn=function(e,t,n){return r.area(e,t,n)<=0};var i=[],s=[];r.collinear=function(e,t,n,o){if(!o)return r.area(e,t,n)==0;var u=i,a=s;u[0]=t[0]-e[0],u[1]=t[1]-e[1],a[0]=n[0]-t[0],a[1]=n[1]-t[1];var f=u[0]*a[0]+u[1]*a[1],l=Math.sqrt(u[0]*u[0]+u[1]*u[1]),c=Math.sqrt(a[0]*a[0]+a[1]*a[1]),h=Math.acos(f/(l*c));return h<o},r.sqdist=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}},{}],3:[function(e,t,n){function o(){this.vertices=[]}function f(e,t,n,r,i){i=i||0;var o=t[1]-e[1],u=e[0]-t[0],a=o*e[0]+u*e[1],f=r[1]-n[1],l=n[0]-r[0],c=f*n[0]+l*n[1],h=o*l-f*u;return s.eq(h,0,i)?[0,0]:[(l*a-u*c)/h,(o*c-f*a)/h]}var r=e("./Line"),i=e("./Point"),s=e("./Scalar");t.exports=o,o.prototype.at=function(e){var t=this.vertices,n=t.length;return t[e<0?e%n+n:e%n]},o.prototype.first=function(){return this.vertices[0]},o.prototype.last=function(){return this.vertices[this.vertices.length-1]},o.prototype.clear=function(){this.vertices.length=0},o.prototype.append=function(e,t,n){if(typeof t=="undefined")throw new Error("From is not given!");if(typeof n=="undefined")throw new Error("To is not given!");if(n-1<t)throw new Error("lol1");if(n>e.vertices.length)throw new Error("lol2");if(t<0)throw new Error("lol3");for(var r=t;r<n;r++)this.vertices.push(e.vertices[r])},o.prototype.makeCCW=function(){var e=0,t=this.vertices;for(var n=1;n<this.vertices.length;++n)if(t[n][1]<t[e][1]||t[n][1]==t[e][1]&&t[n][0]>t[e][0])e=n;i.left(this.at(e-1),this.at(e),this.at(e+1))||this.reverse()},o.prototype.reverse=function(){var e=[];for(var t=0,n=this.vertices.length;t!==n;t++)e.push(this.vertices.pop());this.vertices=e},o.prototype.isReflex=function(e){return i.right(this.at(e-1),this.at(e),this.at(e+1))};var u=[],a=[];o.prototype.canSee=function(e,t){var n,s,o=u,f=a;if(i.leftOn(this.at(e+1),this.at(e),this.at(t))&&i.rightOn(this.at(e-1),this.at(e),this.at(t)))return!1;s=i.sqdist(this.at(e),this.at(t));for(var l=0;l!==this.vertices.length;++l){if((l+1)%this.vertices.length===e||l===e)continue;if(i.leftOn(this.at(e),this.at(t),this.at(l+1))&&i.rightOn(this.at(e),this.at(t),this.at(l))){o[0]=this.at(e),o[1]=this.at(t),f[0]=this.at(l),f[1]=this.at(l+1),n=r.lineInt(o,f);if(i.sqdist(this.at(e),n)<s)return!1}}return!0},o.prototype.copy=function(e,t,n){var r=n||new o;r.clear();if(e<t)for(var i=e;i<=t;i++)r.vertices.push(this.vertices[i]);else{for(var i=0;i<=t;i++)r.vertices.push(this.vertices[i]);for(var i=e;i<this.vertices.length;i++)r.vertices.push(this.vertices[i])}return r},o.prototype.getCutEdges=function(){var e=[],t=[],n=[],r=new o,i=Number.MAX_VALUE;for(var s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var u=0;u<this.vertices.length;++u)if(this.canSee(s,u)){t=this.copy(s,u,r).getCutEdges(),n=this.copy(u,s,r).getCutEdges();for(var a=0;a<n.length;a++)t.push(n[a]);t.length<i&&(e=t,i=t.length,e.push([this.at(s),this.at(u)]))}return e},o.prototype.decomp=function(){var e=this.getCutEdges();return e.length>0?this.slice(e):[this]},o.prototype.slice=function(e){if(e.length==0)return[this];if(e instanceof Array&&e.length&&e[0]instanceof Array&&e[0].length==2&&e[0][0]instanceof Array){var t=[this];for(var n=0;n<e.length;n++){var r=e[n];for(var i=0;i<t.length;i++){var s=t[i],o=s.slice(r);if(o){t.splice(i,1),t.push(o[0],o[1]);break}}}return t}var r=e,n=this.vertices.indexOf(r[0]),i=this.vertices.indexOf(r[1]);return n!=-1&&i!=-1?[this.copy(n,i),this.copy(i,n)]:!1},o.prototype.isSimple=function(){var e=this.vertices;for(var t=0;t<e.length-1;t++)for(var n=0;n<t-1;n++)if(r.segmentsIntersect(e[t],e[t+1],e[n],e[n+1]))return!1;for(var t=1;t<e.length-2;t++)if(r.segmentsIntersect(e[0],e[e.length-1],e[t],e[t+1]))return!1;return!0},o.prototype.quickDecomp=function(e,t,n,r,s,u){s=s||100,u=u||0,r=r||25,e=typeof e!="undefined"?e:[],t=t||[],n=n||[];var a=[0,0],l=[0,0],c=[0,0],h=0,p=0,d=0,v=0,m=0,g=0,y=0,b=new o,w=new o,E=this,S=this.vertices;if(S.length<3)return e;u++;if(u>s)return console.warn("quickDecomp: max level ("+s+") reached."),e;for(var x=0;x<this.vertices.length;++x)if(E.isReflex(x)){t.push(E.vertices[x]),h=p=Number.MAX_VALUE;for(var T=0;T<this.vertices.length;++T)i.left(E.at(x-1),E.at(x),E.at(T))&&i.rightOn(E.at(x-1),E.at(x),E.at(T-1))&&(c=f(E.at(x-1),E.at(x),E.at(T),E.at(T-1)),i.right(E.at(x+1),E.at(x),c)&&(d=i.sqdist(E.vertices[x],c),d<p&&(p=d,l=c,g=T))),i.left(E.at(x+1),E.at(x),E.at(T+1))&&i.rightOn(E.at(x+1),E.at(x),E.at(T))&&(c=f(E.at(x+1),E.at(x),E.at(T),E.at(T+1)),i.left(E.at(x-1),E.at(x),c)&&(d=i.sqdist(E.vertices[x],c),d<h&&(h=d,a=c,m=T)));if(g==(m+1)%this.vertices.length)c[0]=(l[0]+a[0])/2,c[1]=(l[1]+a[1])/2,n.push(c),x<m?(b.append(E,x,m+1),b.vertices.push(c),w.vertices.push(c),g!=0&&w.append(E,g,E.vertices.length),w.append(E,0,x+1)):(x!=0&&b.append(E,x,E.vertices.length),b.append(E,0,m+1),b.vertices.push(c),w.vertices.push(c),w.append(E,g,x+1));else{g>m&&(m+=this.vertices.length),v=Number.MAX_VALUE;if(m<g)return e;for(var T=g;T<=m;++T)i.leftOn(E.at(x-1),E.at(x),E.at(T))&&i.rightOn(E.at(x+1),E.at(x),E.at(T))&&(d=i.sqdist(E.at(x),E.at(T)),d<v&&(v=d,y=T%this.vertices.length));x<y?(b.append(E,x,y+1),y!=0&&w.append(E,y,S.length),w.append(E,0,x+1)):(x!=0&&b.append(E,x,S.length),b.append(E,0,y+1),w.append(E,y,x+1))}return b.vertices.length<w.vertices.length?(b.quickDecomp(e,t,n,r,s,u),w.quickDecomp(e,t,n,r,s,u)):(w.quickDecomp(e,t,n,r,s,u),b.quickDecomp(e,t,n,r,s,u)),e}return e.push(this),e},o.prototype.removeCollinearPoints=function(e){var t=0;for(var n=this.vertices.length-1;this.vertices.length>3&&n>=0;--n)i.collinear(this.at(n-1),this.at(n),this.at(n+1),e)&&(this.vertices.splice(n%this.vertices.length,1),n--,t++);return t}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(e,t,n){function r(){}t.exports=r,r.eq=function(e,t,n){return n=n||0,Math.abs(e-t)<n}},{}],5:[function(e,t,n){t.exports={Polygon:e("./Polygon"),Point:e("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(e,t,n){t.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(e,t,n){function s(e){this.lowerBound=r.create(),e&&e.lowerBound&&r.copy(this.lowerBound,e.lowerBound),this.upperBound=r.create(),e&&e.upperBound&&r.copy(this.upperBound,e.upperBound)}var r=e("../math/vec2"),i=e("../utils/Utils");t.exports=s;var o=r.create();s.prototype.setFromPoints=function(e,t,n,i){var s=this.lowerBound,u=this.upperBound;typeof n!="number"&&(n=0),n!==0?r.rotate(s,e[0],n):r.copy(s,e[0]),r.copy(u,s);var a=Math.cos(n),f=Math.sin(n);for(var l=1;l<e.length;l++){var c=e[l];if(n!==0){var h=c[0],p=c[1];o[0]=a*h-f*p,o[1]=f*h+a*p,c=o}for(var d=0;d<2;d++)c[d]>u[d]&&(u[d]=c[d]),c[d]<s[d]&&(s[d]=c[d])}t&&(r.add(this.lowerBound,this.lowerBound,t),r.add(this.upperBound,this.upperBound,t)),i&&(this.lowerBound[0]-=i,this.lowerBound[1]-=i,this.upperBound[0]+=i,this.upperBound[1]+=i)},s.prototype.copy=function(e){r.copy(this.lowerBound,e.lowerBound),r.copy(this.upperBound,e.upperBound)},s.prototype.extend=function(e){var t=2;while(t--){var n=e.lowerBound[t];this.lowerBound[t]>n&&(this.lowerBound[t]=n);var r=e.upperBound[t];this.upperBound[t]<r&&(this.upperBound[t]=r)}},s.prototype.overlaps=function(e){var t=this.lowerBound,n=this.upperBound,r=e.lowerBound,i=e.upperBound;return(r[0]<=n[0]&&n[0]<=i[0]||t[0]<=i[0]&&i[0]<=n[0])&&(r[1]<=n[1]&&n[1]<=i[1]||t[1]<=i[1]&&i[1]<=n[1])},s.prototype.containsPoint=function(e){var t=this.lowerBound,n=this.upperBound;return t[0]<=e[0]&&e[0]<=n[0]&&t[1]<=e[1]&&e[1]<=n[1]},s.prototype.overlapsRay=function(e){var t=0,n=1/e.direction[0],r=1/e.direction[1],i=(this.lowerBound[0]-e.from[0])*n,s=(this.upperBound[0]-e.from[0])*n,o=(this.lowerBound[1]-e.from[1])*r,u=(this.upperBound[1]-e.from[1])*r,a=Math.max(Math.max(Math.min(i,s),Math.min(o,u))),f=Math.min(Math.min(Math.max(i,s),Math.max(o,u)));return f<0?-1:a>f?-1:a}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(e,t,n){function s(e){this.type=e,this.result=[],this.world=null,this.boundingVolumeType=s.AABB}var r=e("../math/vec2"),i=e("../objects/Body");t.exports=s,s.AABB=1,s.BOUNDING_CIRCLE=2,s.prototype.setWorld=function(e){this.world=e},s.prototype.getCollisionPairs=function(e){};var o=r.create();s.boundingRadiusCheck=function(e,t){r.sub(o,e.position,t.position);var n=r.squaredLength(o),i=e.boundingRadius+t.boundingRadius;return n<=i*i},s.aabbCheck=function(e,t){return e.getAABB().overlaps(t.getAABB())},s.prototype.boundingVolumeCheck=function(e,t){var n;switch(this.boundingVolumeType){case s.BOUNDING_CIRCLE:n=s.boundingRadiusCheck(e,t);break;case s.AABB:n=s.aabbCheck(e,t);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return n},s.canCollide=function(e,t){var n=i.KINEMATIC,r=i.STATIC;return e.type===r&&t.type===r?!1:e.type===n&&t.type===r||e.type===r&&t.type===n?!1:e.type===n&&t.type===n?!1:e.sleepState===i.SLEEPING&&t.sleepState===i.SLEEPING?!1:e.sleepState===i.SLEEPING&&t.type===r||t.sleepState===i.SLEEPING&&e.type===r?!1:!0},s.NAIVE=1,s.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(e,t,n){function f(){u.call(this,u.NAIVE)}var r=e("../shapes/Circle"),i=e("../shapes/Plane"),s=e("../shapes/Shape"),o=e("../shapes/Particle"),u=e("../collision/Broadphase"),a=e("../math/vec2");t.exports=f,f.prototype=new u,f.prototype.constructor=f,f.prototype.getCollisionPairs=function(e){var t=e.bodies,n=this.result;n.length=0;for(var r=0,i=t.length;r!==i;r++){var s=t[r];for(var o=0;o<r;o++){var a=t[o];u.canCollide(s,a)&&this.boundingVolumeCheck(s,a)&&n.push(s,a)}}return n},f.prototype.aabbQuery=function(e,t,n){n=n||[];var r=e.bodies;for(var i=0;i<r.length;i++){var s=r[i];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(t)&&n.push(s)}return n}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(e,t,n){function I(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new a({size:32}),this.frictionEquationPool=new f({size:64}),this.restitution=0,this.stiffness=c.DEFAULT_STIFFNESS,this.relaxation=c.DEFAULT_RELAXATION,this.frictionStiffness=c.DEFAULT_STIFFNESS,this.frictionRelaxation=c.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new l,this.contactSkinSize=.01}function U(e,t){r.set(e.vertices[0],-t.length*.5,-t.radius),r.set(e.vertices[1],t.length*.5,-t.radius),r.set(e.vertices[2],t.length*.5,t.radius),r.set(e.vertices[3],-t.length*.5,t.radius)}function Y(e,t,n,o){var u=J,a=K,f=Q,l=G,c=e,h=t.vertices,p=null;for(var d=0;d!==h.length+1;d++){var v=h[d%h.length],m=h[(d+1)%h.length];r.rotate(u,v,o),r.rotate(a,m,o),s(u,u,n),s(a,a,n),i(f,u,c),i(l,a,c);var g=r.crossLength(f,l);p===null&&(p=g);if(g*p<=0)return!1;p=g}return!0}var r=e("../math/vec2"),i=r.sub,s=r.add,o=r.dot,u=e("../utils/Utils"),a=e("../utils/ContactEquationPool"),f=e("../utils/FrictionEquationPool"),l=e("../utils/TupleDictionary"),c=e("../equations/Equation"),h=e("../equations/ContactEquation"),p=e("../equations/FrictionEquation"),d=e("../shapes/Circle"),v=e("../shapes/Convex"),m=e("../shapes/Shape"),g=e("../objects/Body"),y=e("../shapes/Box");t.exports=I;var b=r.fromValues(0,1),w=r.fromValues(0,0),E=r.fromValues(0,0),S=r.fromValues(0,0),x=r.fromValues(0,0),T=r.fromValues(0,0),N=r.fromValues(0,0),C=r.fromValues(0,0),k=r.fromValues(0,0),L=r.fromValues(0,0),A=r.fromValues(0,0),O=r.fromValues(0,0),M=r.fromValues(0,0),_=r.fromValues(0,0),D=r.fromValues(0,0),P=r.fromValues(0,0),H=r.fromValues(0,0),B=r.fromValues(0,0),j=r.fromValues(0,0),F=[],q=r.create(),R=r.create();I.prototype.bodiesOverlap=function(e,t){var n=q,r=R;for(var i=0,s=e.shapes.length;i!==s;i++){var o=e.shapes[i];e.toWorldFrame(n,o.position);for(var u=0,a=t.shapes.length;u!==a;u++){var f=t.shapes[u];t.toWorldFrame(r,f.position);if(this[o.type|f.type](e,o,n,o.angle+e.angle,t,f,r,f.angle+t.angle,!0))return!0}}return!1},I.prototype.collidedLastStep=function(e,t){var n=e.id|0,r=t.id|0;return!!this.collidingBodiesLastStep.get(n,r)},I.prototype.reset=function(){this.collidingBodiesLastStep.reset();var e=this.contactEquations,t=e.length;while(t--){var n=e[t],r=n.bodyA.id,i=n.bodyB.id;this.collidingBodiesLastStep.set(r,i,!0)}var s=this.contactEquations,o=this.frictionEquations;for(var u=0;u<s.length;u++)this.contactEquationPool.release(s[u]);for(var u=0;u<o.length;u++)this.frictionEquationPool.release(o[u]);this.contactEquations.length=this.frictionEquations.length=0},I.prototype.createContactEquation=function(e,t,n,r){var i=this.contactEquationPool.get();return i.bodyA=e,i.bodyB=t,i.shapeA=n,i.shapeB=r,i.restitution=this.restitution,i.firstImpact=!this.collidedLastStep(e,t),i.stiffness=this.stiffness,i.relaxation=this.relaxation,i.needsUpdate=!0,i.enabled=this.enabledEquations,i.offset=this.contactSkinSize,i},I.prototype.createFrictionEquation=function(e,t,n,r){var i=this.frictionEquationPool.get();return i.bodyA=e,i.bodyB=t,i.shapeA=n,i.shapeB=r,i.setSlipForce(this.slipForce),i.frictionCoefficient=this.frictionCoefficient,i.relativeVelocity=this.surfaceVelocity,i.enabled=this.enabledEquations,i.needsUpdate=!0,i.stiffness=this.frictionStiffness,i.relaxation=this.frictionRelaxation,i.contactEquations.length=0,i},I.prototype.createFrictionFromContact=function(e){var t=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB);return r.copy(t.contactPointA,e.contactPointA),r.copy(t.contactPointB,e.contactPointB),r.rotate90cw(t.t,e.normalA),t.contactEquations.push(e),t},I.prototype.createFrictionFromAverage=function(e){var t=this.contactEquations[this.contactEquations.length-1],n=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB),i=t.bodyA,s=t.bodyB;r.set(n.contactPointA,0,0),r.set(n.contactPointB,0,0),r.set(n.t,0,0);for(var o=0;o!==e;o++)t=this.contactEquations[this.contactEquations.length-1-o],t.bodyA===i?(r.add(n.t,n.t,t.normalA),r.add(n.contactPointA,n.contactPointA,t.contactPointA),r.add(n.contactPointB,n.contactPointB,t.contactPointB)):(r.sub(n.t,n.t,t.normalA),r.add(n.contactPointA,n.contactPointA,t.contactPointB),r.add(n.contactPointB,n.contactPointB,t.contactPointA)),n.contactEquations.push(t);var u=1/e;return r.scale(n.contactPointA,n.contactPointA,u),r.scale(n.contactPointB,n.contactPointB,u),r.normalize(n.t,n.t),r.rotate90cw(n.t,n.t),n},I.prototype[m.LINE|m.CONVEX]=I.prototype.convexLine=function(e,t,n,r,i,s,o,u,a){return a?!1:0},I.prototype[m.LINE|m.BOX]=I.prototype.lineBox=function(e,t,n,r,i,s,o,u,a){return a?!1:0};var z=new y({width:1,height:1}),W=r.create();I.prototype[m.CAPSULE|m.CONVEX]=I.prototype[m.CAPSULE|m.BOX]=I.prototype.convexCapsule=function(e,t,n,i,s,o,u,a,f){var l=W;r.set(l,o.length/2,0),r.rotate(l,l,a),r.add(l,l,u);var c=this.circleConvex(s,o,l,a,e,t,n,i,f,o.radius);r.set(l,-o.length/2,0),r.rotate(l,l,a),r.add(l,l,u);var h=this.circleConvex(s,o,l,a,e,t,n,i,f,o.radius);if(f&&(c||h))return!0;var p=z;U(p,o);var d=this.convexConvex(e,t,n,i,s,p,u,a,f);return d+c+h},I.prototype[m.CAPSULE|m.LINE]=I.prototype.lineCapsule=function(e,t,n,r,i,s,o,u,a){return a?!1:0};var X=r.create(),V=r.create(),$=new y({width:1,height:1});I.prototype[m.CAPSULE|m.CAPSULE]=I.prototype.capsuleCapsule=function(e,t,n,i,s,o,u,a,f){var l,c=X,h=V,p=0;for(var d=0;d<2;d++){r.set(c,(d===0?-1:1)*t.length/2,0),r.rotate(c,c,i),r.add(c,c,n);for(var v=0;v<2;v++){r.set(h,(v===0?-1:1)*o.length/2,0),r.rotate(h,h,a),r.add(h,h,u),this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var m=this.circleCircle(e,t,c,i,s,o,h,a,f,t.radius,o.radius);this.enableFrictionReduction&&(this.enableFriction=l);if(f&&m)return!0;p+=m}}this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var g=$;U(g,t);var y=this.convexCapsule(e,g,n,i,s,o,u,a,f);this.enableFrictionReduction&&(this.enableFriction=l);if(f&&y)return!0;p+=y;if(this.enableFrictionReduction){var l=this.enableFriction;this.enableFriction=!1}U(g,o);var b=this.convexCapsule(s,g,u,a,e,t,n,i,f);return this.enableFrictionReduction&&(this.enableFriction=l),f&&b?!0:(p+=b,this.enableFrictionReduction&&p&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(p)),p)},I.prototype[m.LINE|m.LINE]=I.prototype.lineLine=function(e,t,n,r,i,s,o,u,a){return a?!1:0},I.prototype[m.PLANE|m.LINE]=I.prototype.planeLine=function(e,t,n,u,a,f,l,c,h){var p=w,d=E,v=S,m=x,g=T,y=N,A=C,O=k,M=L,_=F,D=0;r.set(p,-f.length/2,0),r.set(d,f.length/2,0),r.rotate(v,p,c),r.rotate(m,d,c),s(v,v,l),s(m,m,l),r.copy(p,v),r.copy(d,m),i(g,d,p),r.normalize(y,g),r.rotate90cw(M,y),r.rotate(O,b,u),_[0]=p,_[1]=d;for(var P=0;P<_.length;P++){var H=_[P];i(A,H,n);var B=o(A,O);if(B<0){if(h)return!0;var j=this.createContactEquation(e,a,t,f);D++,r.copy(j.normalA,O),r.normalize(j.normalA,j.normalA),r.scale(A,O,B),i(j.contactPointA,H,A),i(j.contactPointA,j.contactPointA,e.position),i(j.contactPointB,H,l),s(j.contactPointB,j.contactPointB,l),i(j.contactPointB,j.contactPointB,a.position),this.contactEquations.push(j),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j))}}return h?!1:(this.enableFrictionReduction||D&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(D)),D)},I.prototype[m.PARTICLE|m.CAPSULE]=I.prototype.particleCapsule=function(e,t,n,r,i,s,o,u,a){return this.circleLine(e,t,n,r,i,s,o,u,a,s.radius,0)},I.prototype[m.CIRCLE|m.LINE]=I.prototype.circleLine=function(e,t,n,u,a,f,l,c,h,p,d){var p=p||0,d=typeof d!="undefined"?d:t.radius,v=w,m=E,g=S,y=x,b=T,P=N,H=C,B=k,j=L,I=A,q=O,R=M,U=_,z=D,W=F;r.set(B,-f.length/2,0),r.set(j,f.length/2,0),r.rotate(I,B,c),r.rotate(q,j,c),s(I,I,l),s(q,q,l),r.copy(B,I),r.copy(j,q),i(P,j,B),r.normalize(H,P),r.rotate90cw(b,H),i(R,n,B);var X=o(R,b);i(y,B,l),i(U,n,l);var V=d+p;if(Math.abs(X)<V){r.scale(v,b,X),i(g,n,v),r.scale(m,b,o(b,U)),r.normalize(m,m),r.scale(m,m,p),s(g,g,m);var $=o(H,g),J=o(H,B),K=o(H,j);if($>J&&$<K){if(h)return!0;var Q=this.createContactEquation(e,a,t,f);return r.scale(Q.normalA,v,-1),r.normalize(Q.normalA,Q.normalA),r.scale(Q.contactPointA,Q.normalA,d),s(Q.contactPointA,Q.contactPointA,n),i(Q.contactPointA,Q.contactPointA,e.position),i(Q.contactPointB,g,l),s(Q.contactPointB,Q.contactPointB,l),i(Q.contactPointB,Q.contactPointB,a.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),1}}W[0]=B,W[1]=j;for(var G=0;G<W.length;G++){var Y=W[G];i(R,Y,n);if(r.squaredLength(R)<Math.pow(V,2)){if(h)return!0;var Q=this.createContactEquation(e,a,t,f);return r.copy(Q.normalA,R),r.normalize(Q.normalA,Q.normalA),r.scale(Q.contactPointA,Q.normalA,d),s(Q.contactPointA,Q.contactPointA,n),i(Q.contactPointA,Q.contactPointA,e.position),i(Q.contactPointB,Y,l),r.scale(z,Q.normalA,-p),s(Q.contactPointB,Q.contactPointB,z),s(Q.contactPointB,Q.contactPointB,l),i(Q.contactPointB,Q.contactPointB,a.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),1}}return 0},I.prototype[m.CIRCLE|m.CAPSULE]=I.prototype.circleCapsule=function(e,t,n,r,i,s,o,u,a){return this.circleLine(e,t,n,r,i,s,o,u,a,s.radius)},I.prototype[m.CIRCLE|m.CONVEX]=I.prototype[m.CIRCLE|m.BOX]=I.prototype.circleConvex=function(e,t,n,o,u,a,f,l,c,h){var h=typeof h=="number"?h:t.radius,p=w,d=E,v=S,m=x,g=T,y=N,b=C,B=k,j=L,F=A,I=O,q=-1,R=null,U=M,z=_,W=D,X=P,V=H,$=!1,J=Number.MAX_VALUE,K=0,Q=a.vertices;for(var G=0;G!==Q.length+1;G++){var Z=Q[G%Q.length],et=Q[(G+1)%Q.length];r.rotate(p,Z,l),r.rotate(d,et,l),s(p,p,f),s(d,d,f),i(v,d,p),r.normalize(m,v),r.rotate90cw(g,m),r.scale(W,g,-t.radius),s(W,W,n);if(Y(W,a,f,l)){r.sub(X,p,W);var tt=Math.abs(r.dot(X,g));tt<J&&(r.copy(V,W),J=tt,r.scale(z,g,tt),r.add(z,z,W),$=!0)}}if($){if(c)return!0;var nt=this.createContactEquation(e,u,t,a);return r.sub(nt.normalA,V,n),r.normalize(nt.normalA,nt.normalA),r.scale(nt.contactPointA,nt.normalA,h),s(nt.contactPointA,nt.contactPointA,n),i(nt.contactPointA,nt.contactPointA,e.position),i(nt.contactPointB,z,f),s(nt.contactPointB,nt.contactPointB,f),i(nt.contactPointB,nt.contactPointB,u.position),this.contactEquations.push(nt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(nt)),1}if(h>0)for(var G=0;G<Q.length;G++){var rt=Q[G];r.rotate(I,rt,l),s(I,I,f),i(F,I,n);if(r.squaredLength(F)<Math.pow(h,2)){if(c)return!0;var nt=this.createContactEquation(e,u,t,a);return r.copy(nt.normalA,F),r.normalize(nt.normalA,nt.normalA),r.scale(nt.contactPointA,nt.normalA,h),s(nt.contactPointA,nt.contactPointA,n),i(nt.contactPointA,nt.contactPointA,e.position),i(nt.contactPointB,I,f),s(nt.contactPointB,nt.contactPointB,f),i(nt.contactPointB,nt.contactPointB,u.position),this.contactEquations.push(nt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(nt)),1}}return 0};var J=r.create(),K=r.create(),Q=r.create(),G=r.create();I.prototype[m.PARTICLE|m.CONVEX]=I.prototype[m.PARTICLE|m.BOX]=I.prototype.particleConvex=function(e,t,n,u,a,f,l,c,h){var p=w,d=E,v=S,m=x,g=T,y=N,b=C,F=k,I=L,q=A,R=O,U=-1,z=null,W=M,X=_,V=D,$=P,J=H,K=B,Q=j,G=Number.MAX_VALUE,Z=0,et=!1,tt=f.vertices;if(!Y(n,f,l,c))return 0;if(h)return!0;var nt=null;for(var rt=0;rt!==tt.length+1;rt++){var it=tt[rt%tt.length],st=tt[(rt+1)%tt.length];r.rotate(p,it,c),r.rotate(d,st,c),s(p,p,l),s(d,d,l),i(v,d,p),r.normalize(m,v),r.rotate90cw(g,m),i(q,n,p);var ot=o(q,g);i(y,p,l),i(b,n,l),r.sub(K,p,n);var ut=Math.abs(r.dot(K,g));ut<G&&(G=ut,r.scale(X,g,ut),r.add(X,X,n),r.copy(Q,g),et=!0)}if(et){var at=this.createContactEquation(e,a,t,f);return r.scale(at.normalA,Q,-1),r.normalize(at.normalA,at.normalA),r.set(at.contactPointA,0,0),s(at.contactPointA,at.contactPointA,n),i(at.contactPointA,at.contactPointA,e.position),i(at.contactPointB,X,l),s(at.contactPointB,at.contactPointB,l),i(at.contactPointB,at.contactPointB,a.position),this.contactEquations.push(at),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(at)),1}return 0},I.prototype[m.CIRCLE]=I.prototype.circleCircle=function(e,t,n,o,u,a,f,l,c,h,p){var d=w,h=h||t.radius,p=p||a.radius;i(d,n,f);var v=h+p;if(r.squaredLength(d)>Math.pow(v,2))return 0;if(c)return!0;var m=this.createContactEquation(e,u,t,a);return i(m.normalA,f,n),r.normalize(m.normalA,m.normalA),r.scale(m.contactPointA,m.normalA,h),r.scale(m.contactPointB,m.normalA,-p),s(m.contactPointA,m.contactPointA,n),i(m.contactPointA,m.contactPointA,e.position),s(m.contactPointB,m.contactPointB,f),i(m.contactPointB,m.contactPointB,u.position),this.contactEquations.push(m),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(m)),1},I.prototype[m.PLANE|m.CONVEX]=I.prototype[m.PLANE|m.BOX]=I.prototype.planeConvex=function(e,t,n,u,a,f,l,c,h){var p=w,d=E,v=S,m=0;r.rotate(d,b,u);for(var g=0;g!==f.vertices.length;g++){var y=f.vertices[g];r.rotate(p,y,c),s(p,p,l),i(v,p,n);if(o(v,d)<=0){if(h)return!0;m++;var x=this.createContactEquation(e,a,t,f);i(v,p,n),r.copy(x.normalA,d);var T=o(v,x.normalA);r.scale(v,x.normalA,T),i(x.contactPointB,p,a.position),i(x.contactPointA,p,v),i(x.contactPointA,x.contactPointA,e.position),this.contactEquations.push(x),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}}return this.enableFrictionReduction&&this.enableFriction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m},I.prototype[m.PARTICLE|m.PLANE]=I.prototype.particlePlane=function(e,t,n,s,u,a,f,l,c){var h=w,p=E;l=l||0,i(h,n,f),r.rotate(p,b,l);var d=o(h,p);if(d>0)return 0;if(c)return!0;var v=this.createContactEquation(u,e,a,t);return r.copy(v.normalA,p),r.scale(h,v.normalA,d),i(v.contactPointA,n,h),i(v.contactPointA,v.contactPointA,u.position),i(v.contactPointB,n,e.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},I.prototype[m.CIRCLE|m.PARTICLE]=I.prototype.circleParticle=function(e,t,n,o,u,a,f,l,c){var h=w;i(h,f,n);if(r.squaredLength(h)>Math.pow(t.radius,2))return 0;if(c)return!0;var p=this.createContactEquation(e,u,t,a);return r.copy(p.normalA,h),r.normalize(p.normalA,p.normalA),r.scale(p.contactPointA,p.normalA,t.radius),s(p.contactPointA,p.contactPointA,n),i(p.contactPointA,p.contactPointA,e.position),i(p.contactPointB,f,u.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1};var Z=new d({radius:1}),et=r.create(),tt=r.create(),nt=r.create();I.prototype[m.PLANE|m.CAPSULE]=I.prototype.planeCapsule=function(e,t,n,i,o,u,a,f,l){var c=et,h=tt,p=Z,d=nt;r.set(c,-u.length/2,0),r.rotate(c,c,f),s(c,c,a),r.set(h,u.length/2,0),r.rotate(h,h,f),s(h,h,a),p.radius=u.radius;var v;this.enableFrictionReduction&&(v=this.enableFriction,this.enableFriction=!1);var m=this.circlePlane(o,p,c,0,e,t,n,i,l),g=this.circlePlane(o,p,h,0,e,t,n,i,l);this.enableFrictionReduction&&(this.enableFriction=v);if(l)return m||g;var y=m+g;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},I.prototype[m.CIRCLE|m.PLANE]=I.prototype.circlePlane=function(e,t,n,u,a,f,l,c,h){var p=e,d=t,v=n,m=a,g=f,y=l,x=c;x=x||0;var T=w,N=E,C=S;i(T,v,y),r.rotate(N,b,x);var k=o(N,T);if(k>d.radius)return 0;if(h)return!0;var L=this.createContactEquation(m,p,f,t);return r.copy(L.normalA,N),r.scale(L.contactPointB,L.normalA,-d.radius),s(L.contactPointB,L.contactPointB,v),i(L.contactPointB,L.contactPointB,p.position),r.scale(C,L.normalA,k),i(L.contactPointA,T,C),s(L.contactPointA,L.contactPointA,y),i(L.contactPointA,L.contactPointA,m.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L)),1},I.prototype[m.CONVEX]=I.prototype[m.CONVEX|m.BOX]=I.prototype[m.BOX]=I.prototype.convexConvex=function(e,t,n,u,a,f,l,c,h,p){var d=w,v=E,m=S,g=x,y=T,b=N,A=C,O=k,M=L,_=0,p=typeof p=="number"?p:0,D=I.findSeparatingAxis(t,n,u,f,l,c,d);if(!D)return 0;i(O,l,n),o(d,O)>0&&r.scale(d,d,-1);var P=I.getClosestEdge(t,u,d,!0),H=I.getClosestEdge(f,c,d);if(P===-1||H===-1)return 0;for(var B=0;B<2;B++){var j=P,F=H,q=t,R=f,U=n,z=l,W=u,X=c,V=e,$=a;if(B===0){var J;J=j,j=F,F=J,J=q,q=R,R=J,J=U,U=z,z=J,J=W,W=X,X=J,J=V,V=$,$=J}for(var K=F;K<F+2;K++){var Q=R.vertices[(K+R.vertices.length)%R.vertices.length];r.rotate(v,Q,X),s(v,v,z);var G=0;for(var Y=j-1;Y<j+2;Y++){var Z=q.vertices[(Y+q.vertices.length)%q.vertices.length],et=q.vertices[(Y+1+q.vertices.length)%q.vertices.length];r.rotate(m,Z,W),r.rotate(g,et,W),s(m,m,U),s(g,g,U),i(y,g,m),r.rotate90cw(M,y),r.normalize(M,M),i(O,v,m);var tt=o(M,O);(Y===j&&tt<=p||Y!==j&&tt<=0)&&G++}if(G>=3){if(h)return!0;var nt=this.createContactEquation(V,$,q,R);_++;var Z=q.vertices[j%q.vertices.length],et=q.vertices[(j+1)%q.vertices.length];r.rotate(m,Z,W),r.rotate(g,et,W),s(m,m,U),s(g,g,U),i(y,g,m),r.rotate90cw(nt.normalA,y),r.normalize(nt.normalA,nt.normalA),i(O,v,m);var tt=o(nt.normalA,O);r.scale(A,nt.normalA,tt),i(nt.contactPointA,v,U),i(nt.contactPointA,nt.contactPointA,A),s(nt.contactPointA,nt.contactPointA,U),i(nt.contactPointA,nt.contactPointA,V.position),i(nt.contactPointB,v,z),s(nt.contactPointB,nt.contactPointB,z),i(nt.contactPointB,nt.contactPointB,$.position),this.contactEquations.push(nt),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(nt))}}}return this.enableFrictionReduction&&this.enableFriction&&_&&this.frictionEquations.push(this.createFrictionFromAverage(_)),_};var rt=r.fromValues(0,0);I.projectConvexOntoAxis=function(e,t,n,i,s){var u=null,a=null,f,l,c=rt;r.rotate(c,i,-n);for(var h=0;h<e.vertices.length;h++){f=e.vertices[h],l=o(f,c);if(u===null||l>u)u=l;if(a===null||l<a)a=l}if(a>u){var p=a;a=u,u=p}var d=o(t,i);r.set(s,a+d,u+d)};var it=r.fromValues(0,0),st=r.fromValues(0,0),ot=r.fromValues(0,0),ut=r.fromValues(0,0),at=r.fromValues(0,0),ft=r.fromValues(0,0);I.findSeparatingAxis=function(e,t,n,s,o,u,a){var f=null,l=!1,c=!1,h=it,p=st,d=ot,v=ut,m=at,g=ft;if(e instanceof y&&s instanceof y)for(var b=0;b!==2;b++){var w=e,E=n;b===1&&(w=s,E=u);for(var S=0;S!==2;S++){S===0?r.set(v,0,1):S===1&&r.set(v,1,0),E!==0&&r.rotate(v,v,E),I.projectConvexOntoAxis(e,t,n,v,m),I.projectConvexOntoAxis(s,o,u,v,g);var x=m,T=g,N=!1;m[0]>g[0]&&(T=m,x=g,N=!0);var C=T[0]-x[1];l=C<=0;if(f===null||C>f)r.copy(a,v),f=C,c=l}}else for(var b=0;b!==2;b++){var w=e,E=n;b===1&&(w=s,E=u);for(var S=0;S!==w.vertices.length;S++){r.rotate(p,w.vertices[S],E),r.rotate(d,w.vertices[(S+1)%w.vertices.length],E),i(h,d,p),r.rotate90cw(v,h),r.normalize(v,v),I.projectConvexOntoAxis(e,t,n,v,m),I.projectConvexOntoAxis(s,o,u,v,g);var x=m,T=g,N=!1;m[0]>g[0]&&(T=m,x=g,N=!0);var C=T[0]-x[1];l=C<=0;if(f===null||C>f)r.copy(a,v),f=C,c=l}}return c};var lt=r.fromValues(0,0),ct=r.fromValues(0,0),ht=r.fromValues(0,0);I.getClosestEdge=function(e,t,n,s){var u=lt,a=ct,f=ht;r.rotate(u,n,-t),s&&r.scale(u,u,-1);var l=-1,c=e.vertices.length,h=-1;for(var p=0;p!==c;p++){i(a,e.vertices[(p+1)%c],e.vertices[p%c]),r.rotate90cw(f,a),r.normalize(f,f);var d=o(f,u);if(l===-1||d>h)l=p%c,h=d}return l};var pt=r.create(),dt=r.create(),vt=r.create(),mt=r.create(),gt=r.create(),yt=r.create(),bt=r.create();I.prototype[m.CIRCLE|m.HEIGHTFIELD]=I.prototype.circleHeightfield=function(e,t,n,o,u,a,f,l,c,h){var p=a.heights,h=h||t.radius,d=a.elementWidth,v=dt,m=pt,g=gt,y=bt,b=yt,w=vt,E=mt,S=Math.floor((n[0]-h-f[0])/d),x=Math.ceil((n[0]+h-f[0])/d);S<0&&(S=0),x>=p.length&&(x=p.length-1);var T=p[S],N=p[x];for(var C=S;C<x;C++)p[C]<N&&(N=p[C]),p[C]>T&&(T=p[C]);if(n[1]-h>T)return c?!1:0;var k=!1;for(var C=S;C<x;C++){r.set(w,C*d,p[C]),r.set(E,(C+1)*d,p[C+1]),r.add(w,w,f),r.add(E,E,f),r.sub(b,E,w),r.rotate(b,b,Math.PI/2),r.normalize(b,b),r.scale(m,b,-h),r.add(m,m,n),r.sub(v,m,w);var L=r.dot(v,b);if(m[0]>=w[0]&&m[0]<E[0]&&L<=0){if(c)return!0;k=!0,r.scale(v,b,-L),r.add(g,m,v),r.copy(y,b);var A=this.createContactEquation(u,e,a,t);r.copy(A.normalA,y),r.scale(A.contactPointB,A.normalA,-h),s(A.contactPointB,A.contactPointB,n),i(A.contactPointB,A.contactPointB,e.position),r.copy(A.contactPointA,g),r.sub(A.contactPointA,A.contactPointA,u.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}}k=!1;if(h>0)for(var C=S;C<=x;C++){r.set(w,C*d,p[C]),r.add(w,w,f),r.sub(v,n,w);if(r.squaredLength(v)<Math.pow(h,2)){if(c)return!0;k=!0;var A=this.createContactEquation(u,e,a,t);r.copy(A.normalA,v),r.normalize(A.normalA,A.normalA),r.scale(A.contactPointB,A.normalA,-h),s(A.contactPointB,A.contactPointB,n),i(A.contactPointB,A.contactPointB,e.position),i(A.contactPointA,w,f),s(A.contactPointA,A.contactPointA,f),i(A.contactPointA,A.contactPointA,u.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}}return k?1:0};var wt=r.create(),Et=r.create(),St=r.create(),xt=new v({vertices:[r.create(),r.create(),r.create(),r.create()]});I.prototype[m.BOX|m.HEIGHTFIELD]=I.prototype[m.CONVEX|m.HEIGHTFIELD]=I.prototype.convexHeightfield=function(e,t,n,i,s,o,u,a,f){var l=o.heights,c=o.elementWidth,h=wt,p=Et,d=St,v=xt,m=Math.floor((e.aabb.lowerBound[0]-u[0])/c),g=Math.ceil((e.aabb.upperBound[0]-u[0])/c);m<0&&(m=0),g>=l.length&&(g=l.length-1);var y=l[m],b=l[g];for(var w=m;w<g;w++)l[w]<b&&(b=l[w]),l[w]>y&&(y=l[w]);if(e.aabb.lowerBound[1]>y)return f?!1:0;var E=!1,S=0;for(var w=m;w<g;w++){r.set(h,w*c,l[w]),r.set(p,(w+1)*c,l[w+1]),r.add(h,h,u),r.add(p,p,u);var x=100;r.set(d,(p[0]+h[0])*.5,(p[1]+h[1]-x)*.5),r.sub(v.vertices[0],p,d),r.sub(v.vertices[1],h,d),r.copy(v.vertices[2],v.vertices[1]),r.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=x,v.vertices[3][1]-=x,S+=this.convexConvex(e,t,n,i,s,v,d,0,f)}return S}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(e,t,n){function u(e){e=e||{},this.from=e.from?r.fromValues(e.from[0],e.from[1]):r.create(),this.to=e.to?r.fromValues(e.to[0],e.to[1]):r.create(),this.checkCollisionResponse=e.checkCollisionResponse!==undefined?e.checkCollisionResponse:!0,this.skipBackfaces=!!e.skipBackfaces,this.collisionMask=e.collisionMask!==undefined?e.collisionMask:-1,this.collisionGroup=e.collisionGroup!==undefined?e.collisionGroup:-1,this.mode=e.mode!==undefined?e.mode:u.ANY,this.callback=e.callback||function(e){},this.direction=r.create(),this.length=1,this.update()}function h(e,t,n){r.sub(l,n,e);var i=r.dot(l,t);return r.scale(c,t,i),r.add(c,c,e),r.squaredDistance(n,c)}t.exports=u;var r=e("../math/vec2"),i=e("../collision/RaycastResult"),s=e("../shapes/Shape"),o=e("../collision/AABB");u.prototype.constructor=u,u.CLOSEST=1,u.ANY=2,u.ALL=4,u.prototype.update=function(){var e=this.direction;r.sub(e,this.to,this.from),this.length=r.length(e),r.normalize(e,e)},u.prototype.intersectBodies=function(e,t){for(var n=0,r=t.length;!e.shouldStop(this)&&n<r;n++){var i=t[n],s=i.getAABB();(s.overlapsRay(this)>=0||s.containsPoint(this.from))&&this.intersectBody(e,i)}};var a=r.create();u.prototype.intersectBody=function(e,t){var n=this.checkCollisionResponse;if(n&&!t.collisionResponse)return;var i=a;for(var s=0,o=t.shapes.length;s<o;s++){var u=t.shapes[s];if(n&&!u.collisionResponse)continue;if((this.collisionGroup&u.collisionMask)===0||(u.collisionGroup&this.collisionMask)===0)continue;r.rotate(i,u.position,t.angle),r.add(i,i,t.position);var f=u.angle+t.angle;this.intersectShape(e,u,f,i,t);if(e.shouldStop(this))break}},u.prototype.intersectShape=function(e,t,n,r,i){var s=this.from,o=h(s,this.direction,r);if(o>t.boundingRadius*t.boundingRadius)return;this._currentBody=i,this._currentShape=t,t.raycast(e,this,r,n),this._currentBody=this._currentShape=null},u.prototype.getAABB=function(e){var t=this.to,n=this.from;r.set(e.lowerBound,Math.min(t[0],n[0]),Math.min(t[1],n[1])),r.set(e.upperBound,Math.max(t[0],n[0]),Math.max(t[1],n[1]))};var f=r.create();u.prototype.reportIntersection=function(e,t,n,i){var s=this.from,o=this.to,a=this._currentShape,f=this._currentBody;if(this.skipBackfaces&&r.dot(n,this.direction)>0)return;switch(this.mode){case u.ALL:e.set(n,a,f,t,i),this.callback(e);break;case u.CLOSEST:(t<e.fraction||!e.hasHit())&&e.set(n,a,f,t,i);break;case u.ANY:e.set(n,a,f,t,i)}};var l=r.create(),c=r.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(e,t,n){function s(){this.normal=r.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var r=e("../math/vec2"),i=e("../collision/Ray");t.exports=s,s.prototype.reset=function(){r.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},s.prototype.getHitDistance=function(e){return r.distance(e.from,e.to)*this.fraction},s.prototype.hasHit=function(){return this.fraction!==-1},s.prototype.getHitPoint=function(e,t){r.lerp(e,t.from,t.to,this.fraction)},s.prototype.stop=function(){this.isStopped=!0},s.prototype.shouldStop=function(e){return this.isStopped||this.fraction!==-1&&e.mode===i.ANY},s.prototype.set=function(e,t,n,i,s){r.copy(this.normal,e),this.shape=t,this.body=n,this.fraction=i,this.faceIndex=s}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(e,t,n){function s(){i.call(this,i.SAP),this.axisList=[],this.axisIndex=0;var e=this;this._addBodyHandler=function(t){e.axisList.push(t.body)},this._removeBodyHandler=function(t){var n=e.axisList.indexOf(t.body);n!==-1&&e.axisList.splice(n,1)}}var r=e("../utils/Utils"),i=e("../collision/Broadphase");t.exports=s,s.prototype=new i,s.prototype.constructor=s,s.prototype.setWorld=function(e){this.axisList.length=0,r.appendArray(this.axisList,e.bodies),e.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),e.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=e},s.sortAxisList=function(e,t){t|=0;for(var n=1,r=e.length;n<r;n++){var i=e[n];for(var s=n-1;s>=0;s--){if(e[s].aabb.lowerBound[t]<=i.aabb.lowerBound[t])break;e[s+1]=e[s]}e[s+1]=i}return e},s.prototype.sortList=function(){var e=this.axisList,t=this.axisIndex;s.sortAxisList(e,t)},s.prototype.getCollisionPairs=function(e){var t=this.axisList,n=this.result,r=this.axisIndex;n.length=0;var s=t.length;while(s--){var o=t[s];o.aabbNeedsUpdate&&o.updateAABB()}this.sortList();for(var u=0,a=t.length|0;u!==a;u++){var f=t[u];for(var l=u+1;l<a;l++){var c=t[l],h=c.aabb.lowerBound[r]<=f.aabb.upperBound[r];if(!h)break;i.canCollide(f,c)&&this.boundingVolumeCheck(f,c)&&n.push(f,c)}}return n},s.prototype.aabbQuery=function(e,t,n){n=n||[],this.sortList();var r=this.axisIndex,i="x";r===1&&(i="y"),r===2&&(i="z");var s=this.axisList,o=t.lowerBound[i],u=t.upperBound[i];for(var a=0;a<s.length;a++){var f=s[a];f.aabbNeedsUpdate&&f.updateAABB(),f.aabb.overlaps(t)&&n.push(f)}return n}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(e,t,n){function i(e,t,n,i){this.type=n,i=r.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}t.exports=i;var r=e("../utils/Utils");i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.DISTANCE=1,i.GEAR=2,i.LOCK=3,i.PRISMATIC=4,i.REVOLUTE=5,i.prototype.setStiffness=function(e){var t=this.equations;for(var n=0;n!==t.length;n++){var r=t[n];r.stiffness=e,r.needsUpdate=!0}},i.prototype.setRelaxation=function(e){var t=this.equations;for(var n=0;n!==t.length;n++){var r=t[n];r.relaxation=e,r.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(e,t,n){function u(e,t,n){n=o.defaults(n,{localAnchorA:[0,0],localAnchorB:[0,0]}),r.call(this,e,t,r.DISTANCE,n),this.localAnchorA=s.fromValues(n.localAnchorA[0],n.localAnchorA[1]),this.localAnchorB=s.fromValues(n.localAnchorB[0],n.localAnchorB[1]);var u=this.localAnchorA,a=this.localAnchorB;this.distance=0;if(typeof n.distance=="number")this.distance=n.distance;else{var f=s.create(),l=s.create(),c=s.create();s.rotate(f,u,e.angle),s.rotate(l,a,t.angle),s.add(c,t.position,l),s.sub(c,c,f),s.sub(c,c,e.position),this.distance=s.length(c)}var h;typeof n.maxForce=="undefined"?h=Number.MAX_VALUE:h=n.maxForce;var p=new i(e,t,-h,h);this.equations=[p],this.maxForce=h;var c=s.create(),d=s.create(),v=s.create(),m=this;p.computeGq=function(){var e=this.bodyA,t=this.bodyB,n=e.position,r=t.position;return s.rotate(d,u,e.angle),s.rotate(v,a,t.angle),s.add(c,r,v),s.sub(c,c,d),s.sub(c,c,n),s.length(c)-m.distance},this.setMaxForce(h),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var r=e("./Constraint"),i=e("../equations/Equation"),s=e("../math/vec2"),o=e("../utils/Utils");t.exports=u,u.prototype=new r,u.prototype.constructor=u;var a=s.create(),f=s.create(),l=s.create();u.prototype.update=function(){var e=this.equations[0],t=this.bodyA,n=this.bodyB,r=this.distance,i=t.position,o=n.position,u=this.equations[0],c=e.G;s.rotate(f,this.localAnchorA,t.angle),s.rotate(l,this.localAnchorB,n.angle),s.add(a,o,l),s.sub(a,a,f),s.sub(a,a,i),this.position=s.length(a);var h=!1;this.upperLimitEnabled&&this.position>this.upperLimit&&(u.maxForce=0,u.minForce=-this.maxForce,this.distance=this.upperLimit,h=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(u.maxForce=this.maxForce,u.minForce=0,this.distance=this.lowerLimit,h=!0);if((this.lowerLimitEnabled||this.upperLimitEnabled)&&!h){u.enabled=!1;return}u.enabled=!0,s.normalize(a,a);var p=s.crossLength(f,a),d=s.crossLength(l,a);c[0]=-a[0],c[1]=-a[1],c[2]=-p,c[3]=a[0],c[4]=a[1],c[5]=d},u.prototype.setMaxForce=function(e){var t=this.equations[0];t.minForce=-e,t.maxForce=e},u.prototype.getMaxForce=function(){var e=this.equations[0];return e.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(e,t,n){function u(e,t,n){n=n||{},r.call(this,e,t,r.GEAR,n),this.ratio=n.ratio!==undefined?n.ratio:1,this.angle=n.angle!==undefined?n.angle:t.angle-this.ratio*e.angle,n.angle=this.angle,n.ratio=this.ratio,this.equations=[new s(e,t,n)],n.maxTorque!==undefined&&this.setMaxTorque(n.maxTorque)}var r=e("./Constraint"),i=e("../equations/Equation"),s=e("../equations/AngleLockEquation"),o=e("../math/vec2");t.exports=u,u.prototype=new r,u.prototype.constructor=u,u.prototype.update=function(){var e=this.equations[0];e.ratio!==this.ratio&&e.setRatio(this.ratio),e.angle=this.angle},u.prototype.setMaxTorque=function(e){this.equations[0].setMaxTorque(e)},u.prototype.getMaxTorque=function(e){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(e,t,n){function o(e,t,n){n=n||{},r.call(this,e,t,r.LOCK,n);var o=typeof n.maxForce=="undefined"?Number.MAX_VALUE:n.maxForce,u=n.localAngleB||0,a=new s(e,t,-o,o),f=new s(e,t,-o,o),l=new s(e,t,-o,o),c=i.create(),h=i.create(),p=this;a.computeGq=function(){return i.rotate(c,p.localOffsetB,e.angle),i.sub(h,t.position,e.position),i.sub(h,h,c),h[0]},f.computeGq=function(){return i.rotate(c,p.localOffsetB,e.angle),i.sub(h,t.position,e.position),i.sub(h,h,c),h[1]};var d=i.create(),v=i.create();l.computeGq=function(){return i.rotate(d,p.localOffsetB,t.angle-p.localAngleB),i.scale(d,d,-1),i.sub(h,e.position,t.position),i.add(h,h,d),i.rotate(v,d,-Math.PI/2),i.normalize(v,v),i.dot(h,v)},this.localOffsetB=i.create(),n.localOffsetB?i.copy(this.localOffsetB,n.localOffsetB):(i.sub(this.localOffsetB,t.position,e.position),i.rotate(this.localOffsetB,this.localOffsetB,-e.angle)),this.localAngleB=0,typeof n.localAngleB=="number"?this.localAngleB=n.localAngleB:this.localAngleB=t.angle-e.angle,this.equations.push(a,f,l),this.setMaxForce(o)}var r=e("./Constraint"),i=e("../math/vec2"),s=e("../equations/Equation");t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.setMaxForce=function(e){var t=this.equations;for(var n=0;n<this.equations.length;n++)t[n].maxForce=e,t[n].minForce=-e},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var u=i.create(),a=i.create(),f=i.create(),l=i.fromValues(1,0),c=i.fromValues(0,1);o.prototype.update=function(){var e=this.equations[0],t=this.equations[1],n=this.equations[2],r=this.bodyA,s=this.bodyB;i.rotate(u,this.localOffsetB,r.angle),i.rotate(a,this.localOffsetB,s.angle-this.localAngleB),i.scale(a,a,-1),i.rotate(f,a,Math.PI/2),i.normalize(f,f),e.G[0]=-1,e.G[1]=0,e.G[2]=-i.crossLength(u,l),e.G[3]=1,t.G[0]=0,t.G[1]=-1,t.G[2]=-i.crossLength(u,c),t.G[4]=1,n.G[0]=-f[0],n.G[1]=-f[1],n.G[3]=f[0],n.G[4]=f[1],n.G[5]=i.crossLength(a,f)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(e,t,n){function a(e,t,n){n=n||{},r.call(this,e,t,r.PRISMATIC,n);var a=o.fromValues(0,0),f=o.fromValues(1,0),l=o.fromValues(0,0);n.localAnchorA&&o.copy(a,n.localAnchorA),n.localAxisA&&o.copy(f,n.localAxisA),n.localAnchorB&&o.copy(l,n.localAnchorB),this.localAnchorA=a,this.localAnchorB=l,this.localAxisA=f;var c=this.maxForce=typeof n.maxForce!="undefined"?n.maxForce:Number.MAX_VALUE,h=new s(e,t,-c,c),p=new o.create,d=new o.create,v=new o.create,m=new o.create;h.computeGq=function(){return o.dot(v,m)},h.updateJacobian=function(){var n=this.G,r=e.position,i=t.position;o.rotate(p,a,e.angle),o.rotate(d,l,t.angle),o.add(v,i,d),o.sub(v,v,r),o.sub(v,v,p),o.rotate(m,f,e.angle+Math.PI/2),n[0]=-m[0],n[1]=-m[1],n[2]=-o.crossLength(p,m)+o.crossLength(m,v),n[3]=m[0],n[4]=m[1],n[5]=o.crossLength(d,m)},this.equations.push(h);if(!n.disableRotationalLock){var g=new u(e,t,-c,c);this.equations.push(g)}this.position=0,this.velocity=0,this.lowerLimitEnabled=typeof n.lowerLimit!="undefined"?!0:!1,this.upperLimitEnabled=typeof n.upperLimit!="undefined"?!0:!1,this.lowerLimit=typeof n.lowerLimit!="undefined"?n.lowerLimit:0,this.upperLimit=typeof n.upperLimit!="undefined"?n.upperLimit:1,this.upperLimitEquation=new i(e,t),this.lowerLimitEquation=new i(e,t),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=c,this.motorEquation=new s(e,t),this.motorEnabled=!1,this.motorSpeed=0;var y=this,b=this.motorEquation,w=b.computeGW;b.computeGq=function(){return 0},b.computeGW=function(){var e=this.G,t=this.bodyA,n=this.bodyB,r=t.velocity,i=n.velocity,s=t.angularVelocity,o=n.angularVelocity;return this.gmult(e,r,s,i,o)+y.motorSpeed}}var r=e("./Constraint"),i=e("../equations/ContactEquation"),s=e("../equations/Equation"),o=e("../math/vec2"),u=e("../equations/RotationalLockEquation");t.exports=a,a.prototype=new r,a.prototype.constructor=a;var f=o.create(),l=o.create(),c=o.create(),h=o.create(),p=o.create(),d=o.create();a.prototype.update=function(){var e=this.equations,t=e[0],n=this.upperLimit,r=this.lowerLimit,i=this.upperLimitEquation,s=this.lowerLimitEquation,u=this.bodyA,a=this.bodyB,v=this.localAxisA,m=this.localAnchorA,g=this.localAnchorB;t.updateJacobian(),o.rotate(f,v,u.angle),o.rotate(h,m,u.angle),o.add(l,h,u.position),o.rotate(p,g,a.angle),o.add(c,p,a.position);var y=this.position=o.dot(c,f)-o.dot(l,f);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=f[0],b[1]=f[1],b[2]=o.crossLength(f,p),b[3]=-f[0],b[4]=-f[1],b[5]=-o.crossLength(f,h)}if(this.upperLimitEnabled&&y>n)o.scale(i.normalA,f,-1),o.sub(i.contactPointA,l,u.position),o.sub(i.contactPointB,c,a.position),o.scale(d,f,n),o.add(i.contactPointA,i.contactPointA,d),e.indexOf(i)===-1&&e.push(i);else{var w=e.indexOf(i);w!==-1&&e.splice(w,1)}if(this.lowerLimitEnabled&&y<r)o.scale(s.normalA,f,1),o.sub(s.contactPointA,l,u.position),o.sub(s.contactPointB,c,a.position),o.scale(d,f,r),o.sub(s.contactPointB,s.contactPointB,d),e.indexOf(s)===-1&&e.push(s);else{var w=e.indexOf(s);w!==-1&&e.splice(w,1)}},a.prototype.enableMotor=function(){if(this.motorEnabled)return;this.equations.push(this.motorEquation),this.motorEnabled=!0},a.prototype.disableMotor=function(){if(!this.motorEnabled)return;var e=this.equations.indexOf(this.motorEquation);this.equations.splice(e,1),this.motorEnabled=!1},a.prototype.setLimits=function(e,t){typeof e=="number"?(this.lowerLimit=e,this.lowerLimitEnabled=!0):(this.lowerLimit=e,this.lowerLimitEnabled=!1),typeof t=="number"?(this.upperLimit=t,this.upperLimitEnabled=!0):(this.upperLimit=t,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(e,t,n){function p(e,t,n){n=n||{},r.call(this,e,t,r.REVOLUTE,n);var p=this.maxForce=typeof n.maxForce!="undefined"?n.maxForce:Number.MAX_VALUE;this.pivotA=u.create(),this.pivotB=u.create(),n.worldPivot?(u.sub(this.pivotA,n.worldPivot,e.position),u.sub(this.pivotB,n.worldPivot,t.position),u.rotate(this.pivotA,this.pivotA,-e.angle),u.rotate(this.pivotB,this.pivotB,-t.angle)):(u.copy(this.pivotA,n.localPivotA),u.copy(this.pivotB,n.localPivotB));var d=this.equations=[new i(e,t,-p,p),new i(e,t,-p,p)],v=d[0],m=d[1],y=this;v.computeGq=function(){return u.rotate(a,y.pivotA,e.angle),u.rotate(f,y.pivotB,t.angle),u.add(h,t.position,f),u.sub(h,h,e.position),u.sub(h,h,a),u.dot(h,l)},m.computeGq=function(){return u.rotate(a,y.pivotA,e.angle),u.rotate(f,y.pivotB,t.angle),u.add(h,t.position,f),u.sub(h,h,e.position),u.sub(h,h,a),u.dot(h,c)},m.minForce=v.minForce=-p,m.maxForce=v.maxForce=p,this.motorEquation=new s(e,t),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new o(e,t),this.lowerLimitEquation=new o(e,t),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var r=e("./Constraint"),i=e("../equations/Equation"),s=e("../equations/RotationalVelocityEquation"),o=e("../equations/RotationalLockEquation"),u=e("../math/vec2");t.exports=p;var a=u.create(),f=u.create(),l=u.fromValues(1,0),c=u.fromValues(0,1),h=u.create();p.prototype=new r,p.prototype.constructor=p,p.prototype.setLimits=function(e,t){typeof e=="number"?(this.lowerLimit=e,this.lowerLimitEnabled=!0):(this.lowerLimit=e,this.lowerLimitEnabled=!1),typeof t=="number"?(this.upperLimit=t,this.upperLimitEnabled=!0):(this.upperLimit=t,this.upperLimitEnabled=!1)},p.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=this.pivotA,r=this.pivotB,i=this.equations,s=i[0],o=i[1],h=i[0],p=i[1],d=this.upperLimit,v=this.lowerLimit,m=this.upperLimitEquation,g=this.lowerLimitEquation,y=this.angle=t.angle-e.angle;if(this.upperLimitEnabled&&y>d)m.angle=d,i.indexOf(m)===-1&&i.push(m);else{var b=i.indexOf(m);b!==-1&&i.splice(b,1)}if(this.lowerLimitEnabled&&y<v)g.angle=v,i.indexOf(g)===-1&&i.push(g);else{var b=i.indexOf(g);b!==-1&&i.splice(b,1)}u.rotate(a,n,e.angle),u.rotate(f,r,t.angle),h.G[0]=-1,h.G[1]=0,h.G[2]=-u.crossLength(a,l),h.G[3]=1,h.G[4]=0,h.G[5]=u.crossLength(f,l),p.G[0]=0,p.G[1]=-1,p.G[2]=-u.crossLength(a,c),p.G[3]=0,p.G[4]=1,p.G[5]=u.crossLength(f,c)},p.prototype.enableMotor=function(){if(this.motorEnabled)return;this.equations.push(this.motorEquation),this.motorEnabled=!0},p.prototype.disableMotor=function(){if(!this.motorEnabled)return;var e=this.equations.indexOf(this.motorEquation);this.equations.splice(e,1),this.motorEnabled=!1},p.prototype.motorIsEnabled=function(){return!!this.motorEnabled},p.prototype.setMotorSpeed=function(e){if(!this.motorEnabled)return;var t=this.equations.indexOf(this.motorEquation);this.equations[t].relativeVelocity=e},p.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(e,t,n){function s(e,t,n){n=n||{},r.call(this,e,t,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0,this.ratio=typeof n.ratio=="number"?n.ratio:1,this.setRatio(this.ratio)}var r=e("./Equation"),i=e("../math/vec2");t.exports=s,s.prototype=new r,s.prototype.constructor=s,s.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},s.prototype.setRatio=function(e){var t=this.G;t[2]=e,t[5]=-1,this.ratio=e},s.prototype.setMaxTorque=function(e){this.maxForce=e,this.minForce=-e}},{"../math/vec2":30,"./Equation":22}],21:[function(e,t,n){function s(e,t){r.call(this,e,t,0,Number.MAX_VALUE),this.contactPointA=i.create(),this.penetrationVec=i.create(),this.contactPointB=i.create(),this.normalA=i.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var r=e("./Equation"),i=e("../math/vec2");t.exports=s,s.prototype=new r,s.prototype.constructor=s,s.prototype.computeB=function(e,t,n){var r=this.bodyA,s=this.bodyB,o=this.contactPointA,u=this.contactPointB,a=r.position,f=s.position,l=this.penetrationVec,c=this.normalA,h=this.G,p=i.crossLength(o,c),d=i.crossLength(u,c);h[0]=-c[0],h[1]=-c[1],h[2]=-p,h[3]=c[0],h[4]=c[1],h[5]=d,i.add(l,f,u),i.sub(l,l,a),i.sub(l,l,o);var v,m;this.firstImpact&&this.restitution!==0?(m=0,v=1/t*(1+this.restitution)*this.computeGW()):(m=i.dot(c,l)+this.offset,v=this.computeGW());var g=this.computeGiMf(),y=-m*e-v*t-n*g;return y}},{"../math/vec2":30,"./Equation":22}],22:[function(e,t,n){function o(e,t,n,r){this.minForce=typeof n=="undefined"?-Number.MAX_VALUE:n,this.maxForce=typeof r=="undefined"?Number.MAX_VALUE:r,this.bodyA=e,this.bodyB=t,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new i.ARRAY_TYPE(6);for(var s=0;s<6;s++)this.G[s]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}t.exports=o;var r=e("../math/vec2"),i=e("../utils/Utils"),s=e("../objects/Body");o.prototype.constructor=o,o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4,o.prototype.update=function(){var e=this.stiffness,t=this.relaxation,n=this.timeStep;this.a=4/(n*(1+4*t)),this.b=4*t/(1+4*t),this.epsilon=4/(n*n*e*(1+4*t)),this.needsUpdate=!1},o.prototype.gmult=function(e,t,n,r,i){return e[0]*t[0]+e[1]*t[1]+e[2]*n+e[3]*r[0]+e[4]*r[1]+e[5]*i},o.prototype.computeB=function(e,t,n){var r=this.computeGW(),i=this.computeGq(),s=this.computeGiMf();return-i*e-r*t-s*n};var u=r.create(),a=r.create();o.prototype.computeGq=function(){var e=this.G,t=this.bodyA,n=this.bodyB,r=t.position,i=n.position,s=t.angle,o=n.angle;return this.gmult(e,u,s,a,o)+this.offset},o.prototype.computeGW=function(){var e=this.G,t=this.bodyA,n=this.bodyB,r=t.velocity,i=n.velocity,s=t.angularVelocity,o=n.angularVelocity;return this.gmult(e,r,s,i,o)+this.relativeVelocity},o.prototype.computeGWlambda=function(){var e=this.G,t=this.bodyA,n=this.bodyB,r=t.vlambda,i=n.vlambda,s=t.wlambda,o=n.wlambda;return this.gmult(e,r,s,i,o)};var f=r.create(),l=r.create();o.prototype.computeGiMf=function(){var e=this.bodyA,t=this.bodyB,n=e.force,i=e.angularForce,s=t.force,o=t.angularForce,u=e.invMassSolve,a=t.invMassSolve,c=e.invInertiaSolve,h=t.invInertiaSolve,p=this.G;return r.scale(f,n,u),r.multiply(f,e.massMultiplier,f),r.scale(l,s,a),r.multiply(l,t.massMultiplier,l),this.gmult(p,f,i*c,l,o*h)},o.prototype.computeGiMGt=function(){var e=this.bodyA,t=this.bodyB,n=e.invMassSolve,r=t.invMassSolve,i=e.invInertiaSolve,s=t.invInertiaSolve,o=this.G;return o[0]*o[0]*n*e.massMultiplier[0]+o[1]*o[1]*n*e.massMultiplier[1]+o[2]*o[2]*i+o[3]*o[3]*r*t.massMultiplier[0]+o[4]*o[4]*r*t.massMultiplier[1]+o[5]*o[5]*s};var c=r.create(),h=r.create(),p=r.create(),d=r.create(),v=r.create(),m=r.create();o.prototype.addToWlambda=function(e){var t=this.bodyA,n=this.bodyB,i=c,s=h,o=p,u=d,a=v,f=t.invMassSolve,l=n.invMassSolve,g=t.invInertiaSolve,y=n.invInertiaSolve,b=m,w=this.G;s[0]=w[0],s[1]=w[1],o[0]=w[3],o[1]=w[4],r.scale(i,s,f*e),r.multiply(i,i,t.massMultiplier),r.add(t.vlambda,t.vlambda,i),t.wlambda+=g*w[2]*e,r.scale(i,o,l*e),r.multiply(i,i,n.massMultiplier),r.add(n.vlambda,n.vlambda,i),n.wlambda+=y*w[5]*e},o.prototype.computeInvC=function(e){return 1/(this.computeGiMGt()+e)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(e,t,n){function o(e,t,n){i.call(this,e,t,-n,n),this.contactPointA=r.create(),this.contactPointB=r.create(),this.t=r.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var r=e("../math/vec2"),i=e("./Equation"),s=e("../utils/Utils");t.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.setSlipForce=function(e){this.maxForce=e,this.minForce=-e},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(e,t,n){var i=this.bodyA,s=this.bodyB,o=this.contactPointA,u=this.contactPointB,a=this.t,f=this.G;f[0]=-a[0],f[1]=-a[1],f[2]=-r.crossLength(o,a),f[3]=a[0],f[4]=a[1],f[5]=r.crossLength(u,a);var l=this.computeGW(),c=this.computeGiMf(),h=-l*t-n*c;return h}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(e,t,n){function s(e,t,n){n=n||{},r.call(this,e,t,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0;var i=this.G;i[2]=1,i[5]=-1}var r=e("./Equation"),i=e("../math/vec2");t.exports=s,s.prototype=new r,s.prototype.constructor=s;var o=i.create(),u=i.create(),a=i.fromValues(1,0),f=i.fromValues(0,1);s.prototype.computeGq=function(){return i.rotate(o,a,this.bodyA.angle+this.angle),i.rotate(u,f,this.bodyB.angle),i.dot(o,u)}},{"../math/vec2":30,"./Equation":22}],25:[function(e,t,n){function s(e,t){r.call(this,e,t,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var r=e("./Equation"),i=e("../math/vec2");t.exports=s,s.prototype=new r,s.prototype.constructor=s,s.prototype.computeB=function(e,t,n){var r=this.G;r[2]=-1,r[5]=this.ratio;var i=this.computeGiMf(),s=this.computeGW(),o=-s*t-n*i;return o}},{"../math/vec2":30,"./Equation":22}],26:[function(e,t,n){var r=function(){};t.exports=r,r.prototype={constructor:r,on:function(e,t,n){t.context=n||this,this._listeners===undefined&&(this._listeners={});var r=this._listeners;return r[e]===undefined&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t),this},has:function(e,t){if(this._listeners===undefined)return!1;var n=this._listeners;if(t){if(n[e]!==undefined&&n[e].indexOf(t)!==-1)return!0}else if(n[e]!==undefined)return!0;return!1},off:function(e,t){if(this._listeners===undefined)return this;var n=this._listeners,r=n[e].indexOf(t);return r!==-1&&n[e].splice(r,1),this},emit:function(e){if(this._listeners===undefined)return this;var t=this._listeners,n=t[e.type];if(n!==undefined){e.target=this;for(var r=0,i=n.length;r<i;r++){var s=n[r];s.call(s.context,e)}}return this}}},{}],27:[function(e,t,n){function s(e,t,n){n=n||{};if(!(e instanceof r&&t instanceof r))throw new Error("First two arguments must be Material instances.");this.id=s.idCounter++,this.materialA=e,this.materialB=t,this.friction=typeof n.friction!="undefined"?Number(n.friction):.3,this.restitution=typeof n.restitution!="undefined"?Number(n.restitution):0,this.stiffness=typeof n.stiffness!="undefined"?Number(n.stiffness):i.DEFAULT_STIFFNESS,this.relaxation=typeof n.relaxation!="undefined"?Number(n.relaxation):i.DEFAULT_RELAXATION,this.frictionStiffness=typeof n.frictionStiffness!="undefined"?Number(n.frictionStiffness):i.DEFAULT_STIFFNESS,this.frictionRelaxation=typeof n.frictionRelaxation!="undefined"?Number(n.frictionRelaxation):i.DEFAULT_RELAXATION,this.surfaceVelocity=typeof n.surfaceVelocity!="undefined"?Number(n.surfaceVelocity):0,this.contactSkinSize=.005}var r=e("./Material"),i=e("../equations/Equation");t.exports=s,s.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(e,t,n){function r(e){this.id=e||r.idCounter++}t.exports=r,r.idCounter=0},{}],29:[function(e,t,n){var r={};r.GetArea=function(e){if(e.length<6)return 0;var t=e.length-2,n=0;for(var r=0;r<t;r+=2)n+=(e[r+2]-e[r])*(e[r+1]+e[r+3]);return n+=(e[0]-e[t])*(e[t+1]+e[1]),-n*.5},r.Triangulate=function(e){var t=e.length>>1;if(t<3)return[];var n=[],i=[];for(var s=0;s<t;s++)i.push(s);var s=0,o=t;while(o>3){var u=i[(s+0)%o],a=i[(s+1)%o],f=i[(s+2)%o],l=e[2*u],c=e[2*u+1],h=e[2*a],p=e[2*a+1],d=e[2*f],v=e[2*f+1],m=!1;if(r._convex(l,c,h,p,d,v)){m=!0;for(var g=0;g<o;g++){var y=i[g];if(y==u||y==a||y==f)continue;if(r._PointInTriangle(e[2*y],e[2*y+1],l,c,h,p,d,v)){m=!1;break}}}if(m)n.push(u,a,f),i.splice((s+1)%o,1),o--,s=0;else if(s++>3*o)break}return n.push(i[0],i[1],i[2]),n},r._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&w+E<1},r._convex=function(e,t,n,r,i,s){return(t-r)*(i-n)+(n-e)*(s-r)>=0},t.exports=r},{}],30:[function(e,t,n){var r=t.exports={},i=e("../utils/Utils");r.crossLength=function(e,t){return e[0]*t[1]-e[1]*t[0]},r.crossVZ=function(e,t,n){return r.rotate(e,t,-Math.PI/2),r.scale(e,e,n),e},r.crossZV=function(e,t,n){return r.rotate(e,n,Math.PI/2),r.scale(e,e,t),e},r.rotate=function(e,t,n){if(n!==0){var r=Math.cos(n),i=Math.sin(n),s=t[0],o=t[1];e[0]=r*s-i*o,e[1]=i*s+r*o}else e[0]=t[0],e[1]=t[1]},r.rotate90cw=function(e,t){var n=t[0],r=t[1];e[0]=r,e[1]=-n},r.toLocalFrame=function(e,t,n,i){r.copy(e,t),r.sub(e,e,n),r.rotate(e,e,-i)},r.toGlobalFrame=function(e,t,n,i){r.copy(e,t),r.rotate(e,e,i),r.add(e,e,n)},r.vectorToLocalFrame=function(e,t,n){r.rotate(e,t,-n)},r.vectorToGlobalFrame=function(e,t,n){r.rotate(e,t,n)},r.centroid=function(e,t,n,i){return r.add(e,t,n),r.add(e,e,i),r.scale(e,e,1/3),e},r.create=function(){var e=new i.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},r.clone=function(e){var t=new i.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},r.fromValues=function(e,t){var n=new i.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},r.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},r.set=function(e,t,n){return e[0]=t,e[1]=n,e},r.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},r.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},r.sub=r.subtract,r.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},r.mul=r.multiply,r.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},r.div=r.divide,r.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},r.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},r.dist=r.distance,r.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},r.sqrDist=r.squaredDistance,r.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},r.len=r.length,r.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},r.sqrLen=r.squaredLength,r.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},r.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},r.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},r.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},r.lerp=function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},r.reflect=function(e,t,n){var r=t[0]*n[0]+t[1]*n[1];e[0]=t[0]-2*n[0]*r,e[1]=t[1]-2*n[1]*r},r.getLineSegmentsIntersection=function(e,t,n,i,s){var o=r.getLineSegmentsIntersectionFraction(t,n,i,s);return o<0?!1:(e[0]=t[0]+o*(n[0]-t[0]),e[1]=t[1]+o*(n[1]-t[1]),!0)},r.getLineSegmentsIntersectionFraction=function(e,t,n,r){var i=t[0]-e[0],s=t[1]-e[1],o=r[0]-n[0],u=r[1]-n[1],a,f;return a=(-s*(e[0]-n[0])+i*(e[1]-n[1]))/(-o*s+i*u),f=(o*(e[1]-n[1])-u*(e[0]-n[0]))/(-o*s+i*u),a>=0&&a<=1&&f>=0&&f<=1?f:-1}},{"../utils/Utils":57}],31:[function(e,t,n){function l(e){e=e||{},f.call(this),this.id=e.id||++l._idCounter,this.world=null,this.shapes=[],this.mass=e.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!e.fixedRotation,this.fixedX=!!e.fixedX,this.fixedY=!!e.fixedY,this.massMultiplier=r.create(),this.position=r.fromValues(0,0),e.position&&r.copy(this.position,e.position),this.interpolatedPosition=r.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=r.fromValues(0,0),this.previousAngle=0,this.velocity=r.fromValues(0,0),e.velocity&&r.copy(this.velocity,e.velocity),this.vlambda=r.fromValues(0,0),this.wlambda=0,this.angle=e.angle||0,this.angularVelocity=e.angularVelocity||0,this.force=r.create(),e.force&&r.copy(this.force,e.force),this.angularForce=e.angularForce||0,this.damping=typeof e.damping=="number"?e.damping:.1,this.angularDamping=typeof e.angularDamping=="number"?e.angularDamping:.1,this.type=l.STATIC,typeof e.type!="undefined"?this.type=e.type:e.mass?this.type=l.DYNAMIC:this.type=l.STATIC,this.boundingRadius=0,this.aabb=new a,this.aabbNeedsUpdate=!0,this.allowSleep=e.allowSleep!==undefined?e.allowSleep:!0,this.wantsToSleep=!1,this.sleepState=l.AWAKE,this.sleepSpeedLimit=e.sleepSpeedLimit!==undefined?e.sleepSpeedLimit:.2,this.sleepTimeLimit=e.sleepTimeLimit!==undefined?e.sleepTimeLimit:1,this.gravityScale=e.gravityScale!==undefined?e.gravityScale:1,this.collisionResponse=e.collisionResponse!==undefined?e.collisionResponse:!0,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=e.ccdSpeedThreshold!==undefined?e.ccdSpeedThreshold:-1,this.ccdIterations=e.ccdIterations!==undefined?e.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var r=e("../math/vec2"),i=e("poly-decomp"),s=e("../shapes/Convex"),o=e("../collision/RaycastResult"),u=e("../collision/Ray"),a=e("../collision/AABB"),f=e("../events/EventEmitter");t.exports=l,l.prototype=new f,l.prototype.constructor=l,l._idCounter=0,l.prototype.updateSolveMassProperties=function(){this.sleepState===l.SLEEPING||this.type===l.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},l.prototype.setDensity=function(e){var t=this.getArea();this.mass=t*e,this.updateMassProperties()},l.prototype.getArea=function(){var e=0;for(var t=0;t<this.shapes.length;t++)e+=this.shapes[t].area;return e},l.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var c=new a,h=r.create();l.prototype.updateAABB=function(){var e=this.shapes,t=e.length,n=h,i=this.angle;for(var s=0;s!==t;s++){var o=e[s],u=o.angle+i;r.rotate(n,o.position,i),r.add(n,n,this.position),o.computeAABB(c,n,u),s===0?this.aabb.copy(c):this.aabb.extend(c)}this.aabbNeedsUpdate=!1},l.prototype.updateBoundingRadius=function(){var e=this.shapes,t=e.length,n=0;for(var i=0;i!==t;i++){var s=e[i],o=r.length(s.position),u=s.boundingRadius;o+u>n&&(n=o+u)}this.boundingRadius=n},l.prototype.addShape=function(e,t,n){if(e.body)throw new Error("A shape can only be added to one body.");e.body=this,t?r.copy(e.position,t):r.set(e.position,0,0),e.angle=n||0,this.shapes.push(e),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},l.prototype.removeShape=function(e){var t=this.shapes.indexOf(e);return t!==-1?(this.shapes.splice(t,1),this.aabbNeedsUpdate=!0,e.body=null,!0):!1},l.prototype.updateMassProperties=function(){if(this.type===l.STATIC||this.type===l.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var e=this.shapes,t=e.length,n=this.mass/t,i=0;if(!this.fixedRotation){for(var s=0;s<t;s++){var o=e[s],u=r.squaredLength(o.position),a=o.computeMomentOfInertia(n);i+=a+n*u}this.inertia=i,this.invInertia=i>0?1/i:0}else this.inertia=Number.MAX_VALUE,this.invInertia=0;this.invMass=1/this.mass,r.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};var p=r.create();l.prototype.applyForce=function(e,t){r.add(this.force,this.force,e);if(t){var n=r.crossLength(t,e);this.angularForce+=n}};var d=r.create(),v=r.create(),m=r.create();l.prototype.applyForceLocal=function(e,t){t=t||m;var n=d,r=v;this.vectorToWorldFrame(n,e),this.vectorToWorldFrame(r,t),this.applyForce(n,r)};var g=r.create();l.prototype.applyImpulse=function(e,t){if(this.type!==l.DYNAMIC)return;var n=g;r.scale(n,e,this.invMass),r.multiply(n,this.massMultiplier,n),r.add(this.velocity,n,this.velocity);if(t){var i=r.crossLength(t,e);i*=this.invInertia,this.angularVelocity+=i}};var y=r.create(),b=r.create(),w=r.create();l.prototype.applyImpulseLocal=function(e,t){t=t||w;var n=y,r=b;this.vectorToWorldFrame(n,e),this.vectorToWorldFrame(r,t),this.applyImpulse(n,r)},l.prototype.toLocalFrame=function(e,t){r.toLocalFrame(e,t,this.position,this.angle)},l.prototype.toWorldFrame=function(e,t){r.toGlobalFrame(e,t,this.position,this.angle)},l.prototype.vectorToLocalFrame=function(e,t){r.vectorToLocalFrame(e,t,this.angle)},l.prototype.vectorToWorldFrame=function(e,t){r.vectorToGlobalFrame(e,t,this.angle)},l.prototype.fromPolygon=function(e,t){t=t||{};for(var n=this.shapes.length;n>=0;--n)this.removeShape(this.shapes[n]);var o=new i.Polygon;o.vertices=e,o.makeCCW(),typeof t.removeCollinearPoints=="number"&&o.removeCollinearPoints(t.removeCollinearPoints);if(typeof t.skipSimpleCheck=="undefined"&&!o.isSimple())return!1;this.concavePath=o.vertices.slice(0);for(var n=0;n<this.concavePath.length;n++){var u=[0,0];r.copy(u,this.concavePath[n]),this.concavePath[n]=u}var a;t.optimalDecomp?a=o.decomp():a=o.quickDecomp();var f=r.create();for(var n=0;n!==a.length;n++){var l=new s({vertices:a[n].vertices});for(var c=0;c!==l.vertices.length;c++){var u=l.vertices[c];r.sub(u,u,l.centerOfMass)}r.scale(f,l.centerOfMass,1),l.updateTriangles(),l.updateCenterOfMass(),l.updateBoundingRadius(),this.addShape(l,f)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var E=r.fromValues(0,0),S=r.fromValues(0,0),x=r.fromValues(0,0),T=r.fromValues(0,0);l.prototype.adjustCenterOfMass=function(){var e=S,t=x,n=T,i=0;r.set(t,0,0);for(var s=0;s!==this.shapes.length;s++){var o=this.shapes[s];r.scale(e,o.position,o.area),r.add(t,t,e),i+=o.area}r.scale(n,t,1/i);for(var s=0;s!==this.shapes.length;s++){var o=this.shapes[s];r.sub(o.position,o.position,n)}r.add(this.position,this.position,n);for(var s=0;this.concavePath&&s<this.concavePath.length;s++)r.sub(this.concavePath[s],this.concavePath[s],n);this.updateMassProperties(),this.updateBoundingRadius()},l.prototype.setZeroForce=function(){r.set(this.force,0,0),this.angularForce=0},l.prototype.resetConstraintVelocity=function(){var e=this,t=e.vlambda;r.set(t,0,0),e.wlambda=0},l.prototype.addConstraintVelocity=function(){var e=this,t=e.velocity;r.add(t,t,e.vlambda),e.angularVelocity+=e.wlambda},l.prototype.applyDamping=function(e){if(this.type===l.DYNAMIC){var t=this.velocity;r.scale(t,t,Math.pow(1-this.damping,e)),this.angularVelocity*=Math.pow(1-this.angularDamping,e)}},l.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=l.AWAKE,this.idleTime=0,e!==l.AWAKE&&this.emit(l.wakeUpEvent)},l.prototype.sleep=function(){this.sleepState=l.SLEEPING,this.angularVelocity=0,this.angularForce=0,r.set(this.velocity,0,0),r.set(this.force,0,0),this.emit(l.sleepEvent)},l.prototype.sleepTick=function(e,t,n){if(!this.allowSleep||this.type===l.SLEEPING)return;this.wantsToSleep=!1;var i=this.sleepState,s=r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),o=Math.pow(this.sleepSpeedLimit,2);s>=o?(this.idleTime=0,this.sleepState=l.AWAKE):(this.idleTime+=n,this.sleepState=l.SLEEPY),this.idleTime>this.sleepTimeLimit&&(t?this.wantsToSleep=!0:this.sleep())},l.prototype.overlaps=function(e){return this.world.overlapKeeper.bodiesAreOverlapping(this,e)};var N=r.create(),C=r.create();l.prototype.integrate=function(e){var t=this.invMass,n=this.force,i=this.position,s=this.velocity;r.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*e),r.scale(N,n,e*t),r.multiply(N,this.massMultiplier,N),r.add(s,N,s),this.integrateToTimeOfImpact(e)||(r.scale(C,s,e),r.add(i,i,C),this.fixedRotation||(this.angle+=this.angularVelocity*e)),this.aabbNeedsUpdate=!0};var k=new o,L=new u({mode:u.ALL}),A=r.create(),O=r.create(),M=r.create(),_=r.create();l.prototype.integrateToTimeOfImpact=function(e){if(this.ccdSpeedThreshold<0||r.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;r.normalize(A,this.velocity),r.scale(O,this.velocity,e),r.add(O,O,this.position),r.sub(M,O,this.position);var t=this.angularVelocity*e,n=r.length(M),i=1,s,o=this;k.reset(),L.callback=function(e){if(e.body===o)return;s=e.body,e.getHitPoint(O,L),r.sub(M,O,o.position),i=r.length(M)/n,e.stop()},r.copy(L.from,this.position),r.copy(L.to,O),L.update(),this.world.raycast(k,L);if(!s)return!1;var u=this.angle;r.copy(_,this.position);var a=0,f=0,l=0,c=i;while(c>=f&&a<this.ccdIterations){a++,l=(c-f)/2,r.scale(C,M,i),r.add(this.position,_,C),this.angle=u+t*i,this.updateAABB();var h=this.aabb.overlaps(s.aabb)&&this.world.narrowphase.bodiesOverlap(this,s);h?f=l:c=l}return i=l,r.copy(this.position,_),this.angle=u,r.scale(C,M,i),r.add(this.position,this.position,C),this.fixedRotation||(this.angle+=t*i),!0},l.prototype.getVelocityAtPoint=function(e,t){return r.crossVZ(e,t,this.angularVelocity),r.subtract(e,this.velocity,e),e},l.sleepyEvent={type:"sleepy"},l.sleepEvent={type:"sleep"},l.wakeUpEvent={type:"wakeup"},l.DYNAMIC=1,l.STATIC=2,l.KINEMATIC=4,l.AWAKE=0,l.SLEEPY=1,l.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(e,t,n){function o(e,t,n){n=n||{},i.call(this,e,t,n),this.localAnchorA=r.fromValues(0,0),this.localAnchorB=r.fromValues(0,0),n.localAnchorA&&r.copy(this.localAnchorA,n.localAnchorA),n.localAnchorB&&r.copy(this.localAnchorB,n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB);var s=r.create(),o=r.create();this.getWorldAnchorA(s),this.getWorldAnchorB(o);var u=r.distance(s,o);this.restLength=typeof n.restLength=="number"?n.restLength:u}var r=e("../math/vec2"),i=e("./Spring"),s=e("../utils/Utils");t.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.setWorldAnchorA=function(e){this.bodyA.toLocalFrame(this.localAnchorA,e)},o.prototype.setWorldAnchorB=function(e){this.bodyB.toLocalFrame(this.localAnchorB,e)},o.prototype.getWorldAnchorA=function(e){this.bodyA.toWorldFrame(e,this.localAnchorA)},o.prototype.getWorldAnchorB=function(e){this.bodyB.toWorldFrame(e,this.localAnchorB)};var u=r.create(),a=r.create(),f=r.create(),l=r.create(),c=r.create(),h=r.create(),p=r.create(),d=r.create(),v=r.create();o.prototype.applyForce=function(){var e=this.stiffness,t=this.damping,n=this.restLength,i=this.bodyA,s=this.bodyB,o=u,m=a,g=f,y=l,b=v,w=c,E=h,S=p,x=d;this.getWorldAnchorA(w),this.getWorldAnchorB(E),r.sub(S,w,i.position),r.sub(x,E,s.position),r.sub(o,E,w);var T=r.len(o);r.normalize(m,o),r.sub(g,s.velocity,i.velocity),r.crossZV(b,s.angularVelocity,x),r.add(g,g,b),r.crossZV(b,i.angularVelocity,S),r.sub(g,g,b),r.scale(y,m,-e*(T-n)-t*r.dot(g,m)),r.sub(i.force,i.force,y),r.add(s.force,s.force,y);var N=r.crossLength(S,y),C=r.crossLength(x,y);i.angularForce-=N,s.angularForce+=C}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(e,t,n){function s(e,t,n){n=n||{},i.call(this,e,t,n),this.restAngle=typeof n.restAngle=="number"?n.restAngle:t.angle-e.angle}var r=e("../math/vec2"),i=e("./Spring");t.exports=s,s.prototype=new i,s.prototype.constructor=s,s.prototype.applyForce=function(){var e=this.stiffness,t=this.damping,n=this.restAngle,r=this.bodyA,i=this.bodyB,s=i.angle-r.angle,o=i.angularVelocity-r.angularVelocity,u=-e*(s-n)-t*o*0;r.angularForce-=u,i.angularForce+=u}},{"../math/vec2":30,"./Spring":34}],34:[function(e,t,n){function s(e,t,n){n=i.defaults(n,{stiffness:100,damping:1}),this.stiffness=n.stiffness,this.damping=n.damping,this.bodyA=e,this.bodyB=t}var r=e("../math/vec2"),i=e("../utils/Utils");t.exports=s,s.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(e,t,n){function a(e,t){t=t||{},this.chassisBody=e,this.wheels=[],this.groundBody=new u({mass:0}),this.world=null;var n=this;this.preStepCallback=function(){n.update()}}function f(e,t){t=t||{},this.vehicle=e,this.forwardEquation=new o(e.chassisBody,e.groundBody),this.sideEquation=new o(e.chassisBody,e.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(t.sideFriction!==undefined?t.sideFriction:5),this.localForwardVector=r.fromValues(0,1),t.localForwardVector&&r.copy(this.localForwardVector,t.localForwardVector),this.localPosition=r.fromValues(0,0),t.localPosition&&r.copy(this.localPosition,t.localPosition),s.apply(this,e.chassisBody,e.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var r=e("../math/vec2"),i=e("../utils/Utils"),s=e("../constraints/Constraint"),o=e("../equations/FrictionEquation"),u=e("../objects/Body");t.exports=a,a.prototype.addToWorld=function(e){this.world=e,e.addBody(this.groundBody),e.on("preStep",this.preStepCallback);for(var t=0;t<this.wheels.length;t++){var n=this.wheels[t];e.addConstraint(n)}},a.prototype.removeFromWorld=function(){var e=this.world;e.removeBody(this.groundBody),e.off("preStep",this.preStepCallback);for(var t=0;t<this.wheels.length;t++){var n=this.wheels[t];e.removeConstraint(n)}this.world=null},a.prototype.addWheel=function(e){var t=new f(this,e);return this.wheels.push(t),t},a.prototype.update=function(){for(var e=0;e<this.wheels.length;e++)this.wheels[e].update()},f.prototype=new s,f.prototype.setBrakeForce=function(e){this.forwardEquation.setSlipForce(e)},f.prototype.setSideFriction=function(e){this.sideEquation.setSlipForce(e)};var l=r.create(),c=r.create();f.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(c,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(l,c),r.dot(l,c)};var h=r.create();f.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),r.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),r.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),r.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),r.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),r.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),r.normalize(h,this.forwardEquation.t),r.scale(h,h,this.engineForce),this.vehicle.chassisBody.applyForce(h,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(e,t,n){var r=t.exports={AABB:e("./collision/AABB"),AngleLockEquation:e("./equations/AngleLockEquation"),Body:e("./objects/Body"),Broadphase:e("./collision/Broadphase"),Capsule:e("./shapes/Capsule"),Circle:e("./shapes/Circle"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),ContactEquationPool:e("./utils/ContactEquationPool"),ContactMaterial:e("./material/ContactMaterial"),Convex:e("./shapes/Convex"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventEmitter:e("./events/EventEmitter"),FrictionEquation:e("./equations/FrictionEquation"),FrictionEquationPool:e("./utils/FrictionEquationPool"),GearConstraint:e("./constraints/GearConstraint"),GSSolver:e("./solver/GSSolver"),Heightfield:e("./shapes/Heightfield"),Line:e("./shapes/Line"),LockConstraint:e("./constraints/LockConstraint"),Material:e("./material/Material"),Narrowphase:e("./collision/Narrowphase"),NaiveBroadphase:e("./collision/NaiveBroadphase"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),Pool:e("./utils/Pool"),RevoluteConstraint:e("./constraints/RevoluteConstraint"),PrismaticConstraint:e("./constraints/PrismaticConstraint"),Ray:e("./collision/Ray"),RaycastResult:e("./collision/RaycastResult"),Box:e("./shapes/Box"),RotationalVelocityEquation:e("./equations/RotationalVelocityEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),Spring:e("./objects/Spring"),TopDownVehicle:e("./objects/TopDownVehicle"),LinearSpring:e("./objects/LinearSpring"),RotationalSpring:e("./objects/RotationalSpring"),Utils:e("./utils/Utils"),World:e("./world/World"),vec2:e("./math/vec2"),version:e("../package.json").version};Object.defineProperty(r,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(e,t,n){function o(e){typeof arguments[0]=="number"&&typeof arguments[1]=="number"&&(e={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),e=e||{};var t=this.width=e.width||1,n=this.height=e.height||1,o=[r.fromValues(-t/2,-n/2),r.fromValues(t/2,-n/2),r.fromValues(t/2,n/2),r.fromValues(-t/2,n/2)],u=[r.fromValues(1,0),r.fromValues(0,1)];e.vertices=o,e.axes=u,e.type=i.BOX,s.call(this,e)}var r=e("../math/vec2"),i=e("./Shape"),s=e("./Convex");t.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(e){var t=this.width,n=this.height;return e*(n*n+t*t)/12},o.prototype.updateBoundingRadius=function(){var e=this.width,t=this.height;this.boundingRadius=Math.sqrt(e*e+t*t)/2};var u=r.create(),a=r.create(),f=r.create(),l=r.create();o.prototype.computeAABB=function(e,t,n){e.setFromPoints(this.vertices,t,n,0)},o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(e,t,n){function s(e){typeof arguments[0]=="number"&&typeof arguments[1]=="number"&&(e={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),e=e||{},this.length=e.length||1,this.radius=e.radius||1,e.type=r.CAPSULE,r.call(this,e)}var r=e("./Shape"),i=e("../math/vec2");t.exports=s,s.prototype=new r,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(e){var t=this.radius,n=this.length+t,r=t*2;return e*(r*r+n*n)/12},s.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},s.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var o=i.create();s.prototype.computeAABB=function(e,t,n){var r=this.radius;i.set(o,this.length/2,0),n!==0&&i.rotate(o,o,n),i.set(e.upperBound,Math.max(o[0]+r,-o[0]+r),Math.max(o[1]+r,-o[1]+r)),i.set(e.lowerBound,Math.min(o[0]-r,-o[0]-r),Math.min(o[1]-r,-o[1]-r)),i.add(e.lowerBound,e.lowerBound,t),i.add(e.upperBound,e.upperBound,t)};var u=i.create(),a=i.create(),f=i.create(),l=i.create(),c=i.fromValues(0,1);s.prototype.raycast=function(e,t,n,r){var s=t.from,o=t.to,h=t.direction,p=u,d=a,v=f,m=l,g=this.length/2;for(var y=0;y<2;y++){var b=this.radius*(y*2-1);i.set(v,-g,b),i.set(m,g,b),i.toGlobalFrame(v,v,n,r),i.toGlobalFrame(m,m,n,r);var w=i.getLineSegmentsIntersectionFraction(s,o,v,m);if(w>=0){i.rotate(d,c,r),i.scale(d,d,y*2-1),t.reportIntersection(e,w,d,-1);if(e.shouldStop(t))return}}var E=Math.pow(this.radius,2)+Math.pow(g,2);for(var y=0;y<2;y++){i.set(v,g*(y*2-1),0),i.toGlobalFrame(v,v,n,r);var S=Math.pow(o[0]-s[0],2)+Math.pow(o[1]-s[1],2),x=2*((o[0]-s[0])*(s[0]-v[0])+(o[1]-s[1])*(s[1]-v[1])),T=Math.pow(s[0]-v[0],2)+Math.pow(s[1]-v[1],2)-Math.pow(this.radius,2),w=Math.pow(x,2)-4*S*T;if(w<0)continue;if(w===0){i.lerp(p,s,o,w);if(i.squaredDistance(p,n)>E){i.sub(d,p,v),i.normalize(d,d),t.reportIntersection(e,w,d,-1);if(e.shouldStop(t))return}}else{var N=Math.sqrt(w),C=1/(2*S),k=(-x-N)*C,L=(-x+N)*C;if(k>=0&&k<=1){i.lerp(p,s,o,k);if(i.squaredDistance(p,n)>E){i.sub(d,p,v),i.normalize(d,d),t.reportIntersection(e,k,d,-1);if(e.shouldStop(t))return}}if(L>=0&&L<=1){i.lerp(p,s,o,L);if(i.squaredDistance(p,n)>E){i.sub(d,p,v),i.normalize(d,d),t.reportIntersection(e,L,d,-1);if(e.shouldStop(t))return}}}}}},{"../math/vec2":30,"./Shape":45}],39:[function(e,t,n){function s(e){typeof arguments[0]=="number"&&(e={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),e=e||{},this.radius=e.radius||1,e.type=r.CIRCLE,r.call(this,e)}var r=e("./Shape"),i=e("../math/vec2");t.exports=s,s.prototype=new r,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(e){var t=this.radius;return e*t*t/2},s.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},s.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},s.prototype.computeAABB=function(e,t,n){var r=this.radius;i.set(e.upperBound,r,r),i.set(e.lowerBound,-r,-r),t&&(i.add(e.lowerBound,e.lowerBound,t),i.add(e.upperBound,e.upperBound,t))};var o=i.create(),u=i.create();s.prototype.raycast=function(e,t,n,r){var s=t.from,a=t.to,f=this.radius,l=Math.pow(a[0]-s[0],2)+Math.pow(a[1]-s[1],2),c=2*((a[0]-s[0])*(s[0]-n[0])+(a[1]-s[1])*(s[1]-n[1])),h=Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2)-Math.pow(f,2),p=Math.pow(c,2)-4*l*h,d=o,v=u;if(p<0)return;if(p===0)i.lerp(d,s,a,p),i.sub(v,d,n),i.normalize(v,v),t.reportIntersection(e,p,v,-1);else{var m=Math.sqrt(p),g=1/(2*l),y=(-c-m)*g,b=(-c+m)*g;if(y>=0&&y<=1){i.lerp(d,s,a,y),i.sub(v,d,n),i.normalize(v,v),t.reportIntersection(e,y,v,-1);if(e.shouldStop(t))return}b>=0&&b<=1&&(i.lerp(d,s,a,b),i.sub(v,d,n),i.normalize(v,v),t.reportIntersection(e,b,v,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(e,t,n){function u(e){Array.isArray(arguments[0])&&(e={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),e=e||{},this.vertices=[];var t=e.vertices!==undefined?e.vertices:[];for(var n=0;n<t.length;n++){var s=i.create();i.copy(s,t[n]),this.vertices.push(s)}this.axes=[];if(e.axes)for(var n=0;n<e.axes.length;n++){var o=i.create();i.copy(o,e.axes[n]),this.axes.push(o)}else for(var n=0;n<this.vertices.length;n++){var u=this.vertices[n],a=this.vertices[(n+1)%this.vertices.length],f=i.create();i.sub(f,a,u),i.rotate90cw(f,f),i.normalize(f,f),this.axes.push(f)}this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,e.type=r.CONVEX,r.call(this,e),this.updateBoundingRadius(),this.updateArea();if(this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var r=e("./Shape"),i=e("../math/vec2"),s=e("../math/polyk"),o=e("poly-decomp");t.exports=u,u.prototype=new r,u.prototype.constructor=u;var a=i.create(),f=i.create();u.prototype.projectOntoLocalAxis=function(e,t){var n=null,r=null,s,o,e=a;for(var u=0;u<this.vertices.length;u++){s=this.vertices[u],o=i.dot(s,e);if(n===null||o>n)n=o;if(r===null||o<r)r=o}if(r>n){var f=r;r=n,n=f}i.set(t,r,n)},u.prototype.projectOntoWorldAxis=function(e,t,n,r){var s=f;this.projectOntoLocalAxis(e,r),n!==0?i.rotate(s,e,n):s=e;var o=i.dot(t,s);i.set(r,r[0]+o,r[1]+o)},u.prototype.updateTriangles=function(){this.triangles.length=0;var e=[];for(var t=0;t<this.vertices.length;t++){var n=this.vertices[t];e.push(n[0],n[1])}var r=s.Triangulate(e);for(var t=0;t<r.length;t+=3){var i=r[t],o=r[t+1],u=r[t+2];this.triangles.push([i,o,u])}};var l=i.create(),c=i.create(),h=i.create(),p=i.create(),d=i.create(),v=i.create(),m=i.create(),g=i.create(),y=i.create();u.prototype.updateCenterOfMass=function(){var e=this.triangles,t=this.vertices,n=this.centerOfMass,r=l,s=y,o=h,a=p,f=d,b=v,w=m,E=g,S=c;i.set(n,0,0);var x=0;for(var T=0;T!==e.length;T++){var N=e[T],o=t[N[0]],a=t[N[1]],f=t[N[2]];i.centroid(r,o,a,f);var C=u.triangleArea(o,a,f);x+=C,i.scale(S,r,C),i.add(n,n,S)}i.scale(n,n,1/x)},u.prototype.computeMomentOfInertia=function(e){var t=0,n=0,r=this.vertices.length;for(var s=r-1,o=0;o<r;s=o,o++){var u=this.vertices[s],a=this.vertices[o],f=Math.abs(i.crossLength(u,a)),l=i.dot(a,a)+i.dot(a,u)+i.dot(u,u);t+=f*l,n+=f}return e/6*(t/n)},u.prototype.updateBoundingRadius=function(){var e=this.vertices,t=0;for(var n=0;n!==e.length;n++){var r=i.squaredLength(e[n]);r>t&&(t=r)}this.boundingRadius=Math.sqrt(t)},u.triangleArea=function(e,t,n){return((t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1]))*.5},u.prototype.updateArea=function(){this.updateTriangles(),this.area=0;var e=this.triangles,t=this.vertices;for(var n=0;n!==e.length;n++){var r=e[n],i=t[r[0]],s=t[r[1]],o=t[r[2]],a=u.triangleArea(i,s,o);this.area+=a}},u.prototype.computeAABB=function(e,t,n){e.setFromPoints(this.vertices,t,n,0)};var b=i.create(),w=i.create(),E=i.create();u.prototype.raycast=function(e,t,n,r){var s=b,o=w,u=E,a=this.vertices;i.toLocalFrame(s,t.from,n,r),i.toLocalFrame(o,t.to,n,r);var f=a.length;for(var l=0;l<f&&!e.shouldStop(t);l++){var c=a[l],h=a[(l+1)%f],p=i.getLineSegmentsIntersectionFraction(s,o,c,h);p>=0&&(i.sub(u,h,c),i.rotate(u,u,-Math.PI/2+r),i.normalize(u,u),t.reportIntersection(e,p,u,l))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(e,t,n){function o(e){if(Array.isArray(arguments[0])){e={heights:arguments[0]};if(typeof arguments[1]=="object")for(var t in arguments[1])e[t]=arguments[1][t];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}e=e||{},this.heights=e.heights?e.heights.slice(0):[],this.maxValue=e.maxValue||null,this.minValue=e.minValue||null,this.elementWidth=e.elementWidth||.1,(e.maxValue===undefined||e.minValue===undefined)&&this.updateMaxMinValues(),e.type=r.HEIGHTFIELD,r.call(this,e)}function v(e,t,n,r,i){var s,o,u,a;s=n[0]-t[0],o=n[1]-t[1],u=i[0]-r[0],a=i[1]-r[1];var f,l;f=(-o*(t[0]-r[0])+s*(t[1]-r[1]))/(-u*o+s*a),l=(u*(t[1]-r[1])-a*(t[0]-r[0]))/(-u*o+s*a);if(f>=0&&f<=1&&l>=0&&l<=1){var c=t[0]+l*s,h=t[1]+l*o;return e[0]=c,e[1]=h,l}return-1}var r=e("./Shape"),i=e("../math/vec2"),s=e("../utils/Utils");t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.updateMaxMinValues=function(){var e=this.heights,t=e[0],n=e[0];for(var r=0;r!==e.length;r++){var i=e[r];i>t&&(t=i),i<n&&(n=i)}this.maxValue=t,this.minValue=n},o.prototype.computeMomentOfInertia=function(e){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){var e=this.heights,t=0;for(var n=0;n<e.length-1;n++)t+=(e[n]+e[n+1])/2*this.elementWidth;this.area=t};var u=[i.create(),i.create(),i.create(),i.create()];o.prototype.computeAABB=function(e,t,n){i.set(u[0],0,this.maxValue),i.set(u[1],this.elementWidth*this.heights.length,this.maxValue),i.set(u[2],this.elementWidth*this.heights.length,this.minValue),i.set(u[3],0,this.minValue),e.setFromPoints(u,t,n)},o.prototype.getLineSegment=function(e,t,n){var r=this.heights,s=this.elementWidth;i.set(e,n*s,r[n]),i.set(t,(n+1)*s,r[n+1])},o.prototype.getSegmentIndex=function(e){return Math.floor(e[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(e){var t=this.getSegmentIndex(e);return t=Math.min(this.heights.length,Math.max(t,0)),t};var a=i.create(),f=i.create(),l=i.create(),c=i.create(),h=i.create(),p=i.create(),d=i.fromValues(0,1);o.prototype.raycast=function(e,t,n,r){var s=t.from,o=t.to,u=t.direction,d=a,v=f,m=l,g=c,y=h,b=p;i.toLocalFrame(y,s,n,r),i.toLocalFrame(b,o,n,r);var w=this.getClampedSegmentIndex(y),E=this.getClampedSegmentIndex(b);if(w>E){var S=w;w=E,E=S}for(var x=0;x<this.heights.length-1;x++){this.getLineSegment(m,g,x);var T=i.getLineSegmentsIntersectionFraction(y,b,m,g);if(T>=0){i.sub(v,g,m),i.rotate(v,v,r+Math.PI/2),i.normalize(v,v),t.reportIntersection(e,T,v,-1);if(e.shouldStop(t))return}}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(e,t,n){function s(e){typeof arguments[0]=="number"&&(e={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),e=e||{},this.length=e.length||1,e.type=r.LINE,r.call(this,e)}var r=e("./Shape"),i=e("../math/vec2");t.exports=s,s.prototype=new r,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(e){return e*Math.pow(this.length,2)/12},s.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var o=[i.create(),i.create()];s.prototype.computeAABB=function(e,t,n){var r=this.length/2;i.set(o[0],-r,0),i.set(o[1],r,0),e.setFromPoints(o,t,n,0)};var u=i.create(),a=i.create(),f=i.create(),l=i.create(),c=i.fromValues(0,1);s.prototype.raycast=function(e,t,n,r){var s=t.from,o=t.to,u=f,h=l,p=this.length/2;i.set(u,-p,0),i.set(h,p,0),i.toGlobalFrame(u,u,n,r),i.toGlobalFrame(h,h,n,r);var d=i.getLineSegmentsIntersectionFraction(u,h,s,o);if(d>=0){var v=a;i.rotate(v,c,r),t.reportIntersection(e,d,v,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(e,t,n){function s(e){e=e||{},e.type=r.PARTICLE,r.call(this,e)}var r=e("./Shape"),i=e("../math/vec2");t.exports=s,s.prototype=new r,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(e){return 0},s.prototype.updateBoundingRadius=function(){this.boundingRadius=0},s.prototype.computeAABB=function(e,t,n){i.copy(e.lowerBound,t),i.copy(e.upperBound,t)}},{"../math/vec2":30,"./Shape":45}],44:[function(e,t,n){function o(e){e=e||{},e.type=r.PLANE,r.call(this,e)}var r=e("./Shape"),i=e("../math/vec2"),s=e("../utils/Utils");t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(e){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(e,t,n){var r=n%(2*Math.PI),s=i.set,o=Number.MAX_VALUE,u=e.lowerBound,a=e.upperBound;r===0?(s(u,-o,-o),s(a,o,0)):r===Math.PI/2?(s(u,0,-o),s(a,o,o)):r===Math.PI?(s(u,-o,0),s(a,o,o)):r===3*Math.PI/2?(s(u,-o,-o),s(a,0,o)):(s(u,-o,-o),s(a,o,o)),i.add(u,u,t),i.add(a,a,t)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var u=i.create(),a=i.create(),f=i.create(),l=i.create(),c=i.create();o.prototype.raycast=function(e,t,n,r){var s=t.from,o=t.to,h=t.direction,p=u,d=a,v=f,m=l,g=c;i.set(m,0,1),i.rotate(m,m,r),i.sub(g,s,n);var y=i.dot(g,m);i.sub(g,o,n);var b=i.dot(g,m);if(y*b>0)return;if(i.squaredDistance(s,o)<y*y)return;var w=i.dot(m,h);i.sub(p,s,n);var E=-i.dot(m,p)/w/t.length;t.reportIntersection(e,E,m,-1)}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(e,t,n){function i(e){e=e||{},this.body=null,this.position=r.fromValues(0,0),e.position&&r.copy(this.position,e.position),this.angle=e.angle||0,this.type=e.type||0,this.id=i.idCounter++,this.boundingRadius=0,this.collisionGroup=e.collisionGroup!==undefined?e.collisionGroup:1,this.collisionResponse=e.collisionResponse!==undefined?e.collisionResponse:!0,this.collisionMask=e.collisionMask!==undefined?e.collisionMask:1,this.material=e.material||null,this.area=0,this.sensor=e.sensor!==undefined?e.sensor:!1,this.type&&this.updateBoundingRadius(),this.updateArea()}t.exports=i;var r=e("../math/vec2");i.idCounter=0,i.CIRCLE=1,i.PARTICLE=2,i.PLANE=4,i.CONVEX=8,i.LINE=16,i.BOX=32,Object.defineProperty(i,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),i.BOX}}),i.CAPSULE=64,i.HEIGHTFIELD=128,i.prototype.computeMomentOfInertia=function(e){},i.prototype.updateBoundingRadius=function(){},i.prototype.updateArea=function(){},i.prototype.computeAABB=function(e,t,n){},i.prototype.raycast=function(e,t,n,r){}},{"../math/vec2":30}],46:[function(e,t,n){function u(e){i.call(this,e,i.GS),e=e||{},this.iterations=e.iterations||10,this.tolerance=e.tolerance||1e-7,this.arrayStep=30,this.lambda=new s.ARRAY_TYPE(this.arrayStep),this.Bs=new s.ARRAY_TYPE(this.arrayStep),this.invCs=new s.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function a(e){var t=e.length;while(t--)e[t]=0}var r=e("../math/vec2"),i=e("./Solver"),s=e("../utils/Utils"),o=e("../equations/FrictionEquation");t.exports=u,u.prototype=new i,u.prototype.constructor=u,u.prototype.solve=function(e,t){this.sortEquations();var n=0,i=this.iterations,f=this.frictionIterations,l=this.equations,c=l.length,h=Math.pow(this.tolerance*c,2),p=t.bodies,d=t.bodies.length,v=r.add,m=r.set,g=this.useZeroRHS,y=this.lambda;this.usedIterations=0;if(c)for(var b=0;b!==d;b++){var w=p[b];w.updateSolveMassProperties()}y.length<c&&(y=this.lambda=new s.ARRAY_TYPE(c+this.arrayStep),this.Bs=new s.ARRAY_TYPE(c+this.arrayStep),this.invCs=new s.ARRAY_TYPE(c+this.arrayStep)),a(y);var E=this.invCs,S=this.Bs,y=this.lambda;for(var b=0;b!==l.length;b++){var x=l[b];if(x.timeStep!==e||x.needsUpdate)x.timeStep=e,x.update();S[b]=x.computeB(x.a,x.b,e),E[b]=x.computeInvC(x.epsilon)}var T,N,x,C,b,k;if(c!==0){for(b=0;b!==d;b++){var w=p[b];w.resetConstraintVelocity()}if(f){for(n=0;n!==f;n++){C=0;for(k=0;k!==c;k++){x=l[k];var L=u.iterateEquation(k,x,x.epsilon,S,E,y,g,e,n);C+=Math.abs(L)}this.usedIterations++;if(C*C<=h)break}u.updateMultipliers(l,y,1/e);for(k=0;k!==c;k++){var A=l[k];if(A instanceof o){var O=0;for(var M=0;M!==A.contactEquations.length;M++)O+=A.contactEquations[M].multiplier;O*=A.frictionCoefficient/A.contactEquations.length,A.maxForce=O,A.minForce=-O}}}for(n=0;n!==i;n++){C=0;for(k=0;k!==c;k++){x=l[k];var L=u.iterateEquation(k,x,x.epsilon,S,E,y,g,e,n);C+=Math.abs(L)}this.usedIterations++;if(C*C<=h)break}for(b=0;b!==d;b++)p[b].addConstraintVelocity();u.updateMultipliers(l,y,1/e)}},u.updateMultipliers=function(e,t,n){var r=e.length;while(r--)e[r].multiplier=t[r]*n},u.iterateEquation=function(e,t,n,r,i,s,o,u,a){var f=r[e],l=i[e],c=s[e],h=t.computeGWlambda(),p=t.maxForce,d=t.minForce;o&&(f=0);var v=l*(f-h-n*c),m=c+v;return m<d*u?v=d*u-c:m>p*u&&(v=p*u-c),s[e]+=v,t.addToWlambda(v),v}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(e,t,n){function s(e,t){e=e||{},i.call(this),this.type=t,this.equations=[],this.equationSortFunction=e.equationSortFunction||!1}var r=e("../utils/Utils"),i=e("../events/EventEmitter");t.exports=s,s.prototype=new i,s.prototype.constructor=s,s.prototype.solve=function(e,t){throw new Error("Solver.solve should be implemented by subclasses!")};var o={bodies:[]};s.prototype.solveIsland=function(e,t){this.removeAllEquations(),t.equations.length&&(this.addEquations(t.equations),o.bodies.length=0,t.getBodies(o.bodies),o.bodies.length&&this.solve(e,o))},s.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},s.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},s.prototype.addEquations=function(e){for(var t=0,n=e.length;t!==n;t++){var r=e[t];r.enabled&&this.equations.push(r)}},s.prototype.removeEquation=function(e){var t=this.equations.indexOf(e);t!==-1&&this.equations.splice(t,1)},s.prototype.removeAllEquations=function(){this.equations.length=0},s.GS=1,s.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(e,t,n){function s(){i.apply(this,arguments)}var r=e("../equations/ContactEquation"),i=e("./Pool");t.exports=s,s.prototype=new i,s.prototype.constructor=s,s.prototype.create=function(){return new r},s.prototype.destroy=function(e){return e.bodyA=e.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(e,t,n){function s(){i.apply(this,arguments)}var r=e("../equations/FrictionEquation"),i=e("./Pool");t.exports=s,s.prototype=new i,s.prototype.constructor=s,s.prototype.create=function(){return new r},s.prototype.destroy=function(e){return e.bodyA=e.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(e,t,n){function s(){i.apply(this,arguments)}var r=e("../world/IslandNode"),i=e("./Pool");t.exports=s,s.prototype=new i,s.prototype.constructor=s,s.prototype.create=function(){return new r},s.prototype.destroy=function(e){return e.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(e,t,n){function s(){i.apply(this,arguments)}var r=e("../world/Island"),i=e("./Pool");t.exports=s,s.prototype=new i,s.prototype.constructor=s,s.prototype.create=function(){return new r},s.prototype.destroy=function(e){return e.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(e,t,n){function u(){this.overlappingShapesLastState=new r,this.overlappingShapesCurrentState=new r,this.recordPool=new s({size:16}),this.tmpDict=new r,this.tmpArray1=[]}var r=e("./TupleDictionary"),i=e("./OverlapKeeperRecord"),s=e("./OverlapKeeperRecordPool"),o=e("./Utils");t.exports=u,u.prototype.tick=function(){var e=this.overlappingShapesLastState,t=this.overlappingShapesCurrentState,n=e.keys.length;while(n--){var r=e.keys[n],i=e.getByKey(r),s=t.getByKey(r);i&&this.recordPool.release(i)}e.reset(),e.copy(t),t.reset()},u.prototype.setOverlapping=function(e,t,n,r){var i=this.overlappingShapesLastState,s=this.overlappingShapesCurrentState;if(!s.get(t.id,r.id)){var o=this.recordPool.get();o.set(e,t,n,r),s.set(t.id,r.id,o)}},u.prototype.getNewOverlaps=function(e){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,e)},u.prototype.getEndOverlaps=function(e){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,e)},u.prototype.bodiesAreOverlapping=function(e,t){var n=this.overlappingShapesCurrentState,r=n.keys.length;while(r--){var i=n.keys[r],s=n.data[i];if(s.bodyA===e&&s.bodyB===t||s.bodyA===t&&s.bodyB===e)return!0}return!1},u.prototype.getDiff=function(e,t,n){var n=n||[],r=e,i=t;n.length=0;var s=i.keys.length;while(s--){var o=i.keys[s],u=i.data[o];if(!u)throw new Error("Key "+o+" had no data!");var a=r.data[o];a||n.push(u)}return n},u.prototype.isNewOverlap=function(e,t){var n=e.id|0,r=t.id|0,i=this.overlappingShapesLastState,s=this.overlappingShapesCurrentState;return!i.get(n,r)&&!!s.get(n,r)},u.prototype.getNewBodyOverlaps=function(e){this.tmpArray1.length=0;var t=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(t,e)},u.prototype.getEndBodyOverlaps=function(e){this.tmpArray1.length=0;var t=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(t,e)},u.prototype.getBodyDiff=function(e,t){t=t||[];var n=this.tmpDict,r=e.length;while(r--){var i=e[r];n.set(i.bodyA.id|0,i.bodyB.id|0,i)}r=n.keys.length;while(r--){var i=n.getByKey(n.keys[r]);i&&t.push(i.bodyA,i.bodyB)}return n.reset(),t}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(e,t,n){function r(e,t,n,r){this.shapeA=t,this.shapeB=r,this.bodyA=e,this.bodyB=n}t.exports=r,r.prototype.set=function(e,t,n,i){r.call(this,e,t,n,i)}},{}],54:[function(e,t,n){function s(){i.apply(this,arguments)}var r=e("./OverlapKeeperRecord"),i=e("./Pool");t.exports=s,s.prototype=new i,s.prototype.constructor=s,s.prototype.create=function(){return new r},s.prototype.destroy=function(e){return e.bodyA=e.bodyB=e.shapeA=e.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(e,t,n){function r(e){e=e||{},this.objects=[],e.size!==undefined&&this.resize(e.size)}t.exports=r,r.prototype.resize=function(e){var t=this.objects;while(t.length>e)t.pop();while(t.length<e)t.push(this.create());return this},r.prototype.get=function(){var e=this.objects;return e.length?e.pop():this.create()},r.prototype.release=function(e){return this.destroy(e),this.objects.push(e),this}},{}],56:[function(e,t,n){function i(){this.data={},this.keys=[]}var r=e("./Utils");t.exports=i,i.prototype.getKey=function(e,t){return e|=0,t|=0,(e|0)===(t|0)?-1:((e|0)>(t|0)?e<<16|t&65535:t<<16|e&65535)|0},i.prototype.getByKey=function(e){return e|=0,this.data[e]},i.prototype.get=function(e,t){return this.data[this.getKey(e,t)]},i.prototype.set=function(e,t,n){if(!n)throw new Error("No data!");var r=this.getKey(e,t);return this.data[r]||this.keys.push(r),this.data[r]=n,r},i.prototype.reset=function(){var e=this.data,t=this.keys,n=t.length;while(n--)delete e[t[n]];t.length=0},i.prototype.copy=function(e){this.reset(),r.appendArray(this.keys,e.keys);var t=e.keys.length;while(t--){var n=e.keys[t];this.data[n]=e.data[n]}}},{"./Utils":57}],57:[function(e,t,n){function r(){}t.exports=r,r.appendArray=function(e,t){if(t.length<15e4)e.push.apply(e,t);else for(var n=0,r=t.length;n!==r;++n)e.push(t[n])},r.splice=function(e,t,n){n=n||1;for(var r=t,i=e.length-n;r<i;r++)e[r]=e[r+n];e.length=i},typeof P2_ARRAY_TYPE!="undefined"?r.ARRAY_TYPE=P2_ARRAY_TYPE:typeof Float32Array!="undefined"?r.ARRAY_TYPE=Float32Array:r.ARRAY_TYPE=Array,r.extend=function(e,t){for(var n in t)e[n]=t[n]},r.defaults=function(e,t){e=e||{};for(var n in t)n in e||(e[n]=t[n]);return e}},{}],58:[function(e,t,n){function i(){this.equations=[],this.bodies=[]}var r=e("../objects/Body");t.exports=i,i.prototype.reset=function(){this.equations.length=this.bodies.length=0};var s=[];i.prototype.getBodies=function(e){var t=e||[],n=this.equations;s.length=0;for(var r=0;r!==n.length;r++){var i=n[r];s.indexOf(i.bodyA.id)===-1&&(t.push(i.bodyA),s.push(i.bodyA.id)),s.indexOf(i.bodyB.id)===-1&&(t.push(i.bodyB),s.push(i.bodyB.id))}return t},i.prototype.wantsToSleep=function(){for(var e=0;e<this.bodies.length;e++){var t=this.bodies[e];if(t.type===r.DYNAMIC&&!t.wantsToSleep)return!1}return!0},i.prototype.sleep=function(){for(var e=0;e<this.bodies.length;e++){var t=this.bodies[e];t.sleep()}return!0}},{"../objects/Body":31}],59:[function(e,t,n){function f(e){this.nodePool=new o({size:16}),this.islandPool=new u({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var r=e("../math/vec2"),i=e("./Island"),s=e("./IslandNode"),o=e("./../utils/IslandNodePool"),u=e("./../utils/IslandPool"),a=e("../objects/Body");t.exports=f,f.getUnvisitedNode=function(e){var t=e.length;for(var n=0;n!==t;n++){var r=e[n];if(!r.visited&&r.body.type===a.DYNAMIC)return r}return!1},f.prototype.visit=function(e,t,n){t.push(e.body);var r=e.equations.length;for(var i=0;i!==r;i++){var s=e.equations[i];n.indexOf(s)===-1&&n.push(s)}},f.prototype.bfs=function(e,t,n){var r=this.queue;r.length=0,r.push(e),e.visited=!0,this.visit(e,t,n);while(r.length){var i=r.pop(),s;while(s=f.getUnvisitedNode(i.neighbors))s.visited=!0,this.visit(s,t,n),s.body.type===a.DYNAMIC&&r.push(s)}},f.prototype.split=function(e){var t=e.bodies,n=this.nodes,r=this.equations;while(n.length)this.nodePool.release(n.pop());for(var i=0;i!==t.length;i++){var s=this.nodePool.get();s.body=t[i],n.push(s)}for(var o=0;o!==r.length;o++){var u=r[o],i=t.indexOf(u.bodyA),a=t.indexOf(u.bodyB),l=n[i],c=n[a];l.neighbors.push(c),c.neighbors.push(l),l.equations.push(u),c.equations.push(u)}var h=this.islands;for(var i=0;i<h.length;i++)this.islandPool.release(h[i]);h.length=0;var p;while(p=f.getUnvisitedNode(n)){var d=this.islandPool.get();this.bfs(p,d.bodies,d.equations),h.push(d)}return h}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(e,t,n){function r(e){this.body=e,this.neighbors=[],this.equations=[],this.visited=!1}t.exports=r,r.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(e,t,n){function P(e){p.apply(this),e=e||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=e.solver||new r,this.narrowphase=new A(this),this.islandManager=new _,this.gravity=o.fromValues(0,-9.78),e.gravity&&o.copy(this.gravity,e.gravity),this.frictionGravity=o.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=e.broadphase||new L,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new g,this.defaultContactMaterial=new y(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=typeof e.islandSplit!="undefined"?!!e.islandSplit:!0,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=P.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new M}var r=e("../solver/GSSolver"),i=e("../solver/Solver"),s=e("../collision/Ray"),o=e("../math/vec2"),u=e("../shapes/Circle"),a=e("../shapes/Convex"),f=e("../shapes/Line"),l=e("../shapes/Plane"),c=e("../shapes/Capsule"),h=e("../shapes/Particle"),p=e("../events/EventEmitter"),d=e("../objects/Body"),v=e("../shapes/Shape"),m=e("../objects/LinearSpring"),g=e("../material/Material"),y=e("../material/ContactMaterial"),b=e("../constraints/DistanceConstraint"),w=e("../constraints/Constraint"),E=e("../constraints/LockConstraint"),S=e("../constraints/RevoluteConstraint"),x=e("../constraints/PrismaticConstraint"),T=e("../constraints/GearConstraint"),N=e("../../package.json"),C=e("../collision/Broadphase"),k=e("../collision/AABB"),L=e("../collision/SAPBroadphase"),A=e("../collision/Narrowphase"),O=e("../utils/Utils"),M=e("../utils/OverlapKeeper"),_=e("./IslandManager"),D=e("../objects/RotationalSpring");t.exports=P,P.prototype=new Object(p.prototype),P.prototype.constructor=P,P.NO_SLEEPING=1,P.BODY_SLEEPING=2,P.ISLAND_SLEEPING=4,P.prototype.addConstraint=function(e){this.constraints.push(e)},P.prototype.addContactMaterial=function(e){this.contactMaterials.push(e)},P.prototype.removeContactMaterial=function(e){var t=this.contactMaterials.indexOf(e);t!==-1&&O.splice(this.contactMaterials,t,1)},P.prototype.getContactMaterial=function(e,t){var n=this.contactMaterials;for(var r=0,i=n.length;r!==i;r++){var s=n[r];if(s.materialA.id===e.id&&s.materialB.id===t.id||s.materialA.id===t.id&&s.materialB.id===e.id)return s}return!1},P.prototype.removeConstraint=function(e){var t=this.constraints.indexOf(e);t!==-1&&O.splice(this.constraints,t,1)};var H=o.create(),B=o.create(),j=o.create(),F=o.create(),I=o.create(),q=o.create(),R=o.create(),U=o.fromValues(0,0),z=o.fromValues(0,0),W=o.fromValues(0,0),X=o.fromValues(0,0);P.prototype.step=function(e,t,n){n=n||10,t=t||0;if(t===0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;var r=0;while(this.accumulator>=e&&r<n)this.internalStep(e),this.time+=e,this.accumulator-=e,r++;var i=this.accumulator%e/e;for(var s=0;s!==this.bodies.length;s++){var u=this.bodies[s];o.lerp(u.interpolatedPosition,u.previousPosition,u.position,i),u.interpolatedAngle=u.previousAngle+i*(u.angle-u.previousAngle)}}};var V=[];P.prototype.internalStep=function(e){this.stepping=!0;var t=this,n=this.springs.length,r=this.springs,i=this.bodies,s=this.gravity,u=this.solver,a=this.bodies.length,f=this.broadphase,l=this.narrowphase,c=this.constraints,h,p,v=I,m=q,g=R,y=o.scale,b=o.add,w=o.rotate,E=this.islandManager;this.overlapKeeper.tick(),this.lastTimeStep=e;if(this.useWorldGravityAsFrictionGravity){var S=o.length(this.gravity);if(S!==0||!this.useFrictionGravityOnZeroGravity)this.frictionGravity=S}if(this.applyGravity)for(var x=0;x!==a;x++){var T=i[x],N=T.force;if(T.type!==d.DYNAMIC||T.sleepState===d.SLEEPING)continue;o.scale(g,s,T.mass*T.gravityScale),b(N,N,g)}if(this.applySpringForces)for(var x=0;x!==n;x++){var C=r[x];C.applyForce()}if(this.applyDamping)for(var x=0;x!==a;x++){var T=i[x];T.type===d.DYNAMIC&&T.applyDamping(e)}var k=f.getCollisionPairs(this),L=this.disabledBodyCollisionPairs;for(var x=L.length-2;x>=0;x-=2)for(var A=k.length-2;A>=0;A-=2)(L[x]===k[A]&&L[x+1]===k[A+1]||L[x+1]===k[A]&&L[x]===k[A+1])&&k.splice(A,2);var M=c.length;for(x=0;x!==M;x++){var _=c[x];if(!_.collideConnected)for(var A=k.length-2;A>=0;A-=2)(_.bodyA===k[A]&&_.bodyB===k[A+1]||_.bodyB===k[A]&&_.bodyA===k[A+1])&&k.splice(A,2)}this.postBroadphaseEvent.pairs=k,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,l.reset(this);for(var x=0,D=k.length;x!==D;x+=2){var H=k[x],B=k[x+1];for(var j=0,F=H.shapes.length;j!==F;j++){var U=H.shapes[j],z=U.position,W=U.angle;for(var X=0,$=B.shapes.length;X!==$;X++){var J=B.shapes[X],K=J.position,Q=J.angle,G=this.defaultContactMaterial;if(U.material&&J.material){var Y=this.getContactMaterial(U.material,J.material);Y&&(G=Y)}this.runNarrowphase(l,H,U,z,W,B,J,K,Q,G,this.frictionGravity)}}}for(var x=0;x!==a;x++){var Z=i[x];Z._wakeUpAfterNarrowphase&&(Z.wakeUp(),Z._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(V);var et=this.endContactEvent,X=V.length;while(X--){var tt=V[X];et.shapeA=tt.shapeA,et.shapeB=tt.shapeB,et.bodyA=tt.bodyA,et.bodyB=tt.bodyB,this.emit(et)}V.length=0}var nt=this.preSolveEvent;nt.contactEquations=l.contactEquations,nt.frictionEquations=l.frictionEquations,this.emit(nt),nt.contactEquations=nt.frictionEquations=null;var M=c.length;for(x=0;x!==M;x++)c[x].update();if(l.contactEquations.length||l.frictionEquations.length||M)if(this.islandSplit){E.equations.length=0,O.appendArray(E.equations,l.contactEquations),O.appendArray(E.equations,l.frictionEquations);for(x=0;x!==M;x++)O.appendArray(E.equations,c[x].equations);E.split(this);for(var x=0;x!==E.islands.length;x++){var rt=E.islands[x];rt.equations.length&&u.solveIsland(e,rt)}}else{u.addEquations(l.contactEquations),u.addEquations(l.frictionEquations);for(x=0;x!==M;x++)u.addEquations(c[x].equations);this.solveConstraints&&u.solve(e,this),u.removeAllEquations()}for(var x=0;x!==a;x++){var Z=i[x];Z.integrate(e)}for(var x=0;x!==a;x++)i[x].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var it=this.impactEvent;for(var x=0;x!==l.contactEquations.length;x++){var st=l.contactEquations[x];st.firstImpact&&(it.bodyA=st.bodyA,it.bodyB=st.bodyB,it.shapeA=st.shapeA,it.shapeB=st.shapeB,it.contactEquation=st,this.emit(it))}}if(this.sleepMode===P.BODY_SLEEPING)for(x=0;x!==a;x++)i[x].sleepTick(this.time,!1,e);else if(this.sleepMode===P.ISLAND_SLEEPING&&this.islandSplit){for(x=0;x!==a;x++)i[x].sleepTick(this.time,!0,e);for(var x=0;x<this.islandManager.islands.length;x++){var rt=this.islandManager.islands[x];rt.wantsToSleep()&&rt.sleep()}}this.stepping=!1;var ot=this.bodiesToBeRemoved;for(var x=0;x!==ot.length;x++)this.removeBody(ot[x]);ot.length=0,this.emit(this.postStepEvent)},P.prototype.runNarrowphase=function(e,t,n,r,i,s,u,a,f,l,c){if((n.collisionGroup&u.collisionMask)===0||(u.collisionGroup&n.collisionMask)===0)return;o.rotate(U,r,t.angle),o.rotate(z,a,s.angle),o.add(U,U,t.position),o.add(z,z,s.position);var h=i+t.angle,p=f+s.angle;e.enableFriction=l.friction>0,e.frictionCoefficient=l.friction;var v;t.type===d.STATIC||t.type===d.KINEMATIC?v=s.mass:s.type===d.STATIC||s.type===d.KINEMATIC?v=t.mass:v=t.mass*s.mass/(t.mass+s.mass),e.slipForce=l.friction*c*v,e.restitution=l.restitution,e.surfaceVelocity=l.surfaceVelocity,e.frictionStiffness=l.frictionStiffness,e.frictionRelaxation=l.frictionRelaxation,e.stiffness=l.stiffness,e.relaxation=l.relaxation,e.contactSkinSize=l.contactSkinSize,e.enabledEquations=t.collisionResponse&&s.collisionResponse&&n.collisionResponse&&u.collisionResponse;var m=e[n.type|u.type],g=0;if(m){var y=n.sensor||u.sensor,b=e.frictionEquations.length;n.type<u.type?g=m.call(e,t,n,U,h,s,u,z,p,y):g=m.call(e,s,u,z,p,t,n,U,h,y);var w=e.frictionEquations.length-b;if(g){if(t.allowSleep&&t.type===d.DYNAMIC&&t.sleepState===d.SLEEPING&&s.sleepState===d.AWAKE&&s.type!==d.STATIC){var E=o.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2),S=Math.pow(s.sleepSpeedLimit,2);E>=S*2&&(t._wakeUpAfterNarrowphase=!0)}if(s.allowSleep&&s.type===d.DYNAMIC&&s.sleepState===d.SLEEPING&&t.sleepState===d.AWAKE&&t.type!==d.STATIC){var x=o.squaredLength(t.velocity)+Math.pow(t.angularVelocity,2),T=Math.pow(t.sleepSpeedLimit,2);x>=T*2&&(s._wakeUpAfterNarrowphase=!0)}this.overlapKeeper.setOverlapping(t,n,s,u);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(n,u)){var N=this.beginContactEvent;N.shapeA=n,N.shapeB=u,N.bodyA=t,N.bodyB=s,N.contactEquations.length=0;if(typeof g=="number")for(var C=e.contactEquations.length-g;C<e.contactEquations.length;C++)N.contactEquations.push(e.contactEquations[C]);this.emit(N)}if(typeof g=="number"&&w>1)for(var C=e.frictionEquations.length-w;C<e.frictionEquations.length;C++){var k=e.frictionEquations[C];k.setSlipForce(k.getSlipForce()/w)}}}},P.prototype.addSpring=function(e){this.springs.push(e);var t=this.addSpringEvent;t.spring=e,this.emit(t),t.spring=null},P.prototype.removeSpring=function(e){var t=this.springs.indexOf(e);t!==-1&&O.splice(this.springs,t,1)},P.prototype.addBody=function(e){if(this.bodies.indexOf(e)===-1){this.bodies.push(e),e.world=this;var t=this.addBodyEvent;t.body=e,this.emit(t),t.body=null}},P.prototype.removeBody=function(e){if(this.stepping)this.bodiesToBeRemoved.push(e);else{e.world=null;var t=this.bodies.indexOf(e);t!==-1&&(O.splice(this.bodies,t,1),this.removeBodyEvent.body=e,e.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},P.prototype.getBodyById=function(e){var t=this.bodies;for(var n=0;n<t.length;n++){var r=t[n];if(r.id===e)return r}return!1},P.prototype.disableBodyCollision=function(e,t){this.disabledBodyCollisionPairs.push(e,t)},P.prototype.enableBodyCollision=function(e,t){var n=this.disabledBodyCollisionPairs;for(var r=0;r<n.length;r+=2)if(n[r]===e&&n[r+1]===t||n[r+1]===e&&n[r]===t){n.splice(r,2);return}},P.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();var e=this.constraints;for(var t=e.length-1;t>=0;t--)this.removeConstraint(e[t]);var n=this.bodies;for(var t=n.length-1;t>=0;t--)this.removeBody(n[t]);var r=this.springs;for(var t=r.length-1;t>=0;t--)this.removeSpring(r[t]);var i=this.contactMaterials;for(var t=i.length-1;t>=0;t--)this.removeContactMaterial(i[t]);P.apply(this)};var $=o.create(),J=o.fromValues(0,0),K=o.fromValues(0,0);P.prototype.hitTest=function(e,t,n){n=n||0;var r=new d({position:e}),i=new h,s=e,f=0,p=$,v=J,m=K;r.addShape(i);var g=this.narrowphase,y=[];for(var b=0,w=t.length;b!==w;b++){var E=t[b];for(var S=0,x=E.shapes.length;S!==x;S++){var T=E.shapes[S];o.rotate(p,T.position,E.angle),o.add(p,p,E.position);var N=T.angle+E.angle;(T instanceof u&&g.circleParticle(E,T,p,N,r,i,s,f,!0)||T instanceof a&&g.particleConvex(r,i,s,f,E,T,p,N,!0)||T instanceof l&&g.particlePlane(r,i,s,f,E,T,p,N,!0)||T instanceof c&&g.particleCapsule(r,i,s,f,E,T,p,N,!0)||T instanceof h&&o.squaredLength(o.sub(m,p,e))<n*n)&&y.push(E)}}return y},P.prototype.setGlobalStiffness=function(e){var t=this.constraints;for(var n=0;n!==t.length;n++){var r=t[n];for(var i=0;i!==r.equations.length;i++){var s=r.equations[i];s.stiffness=e,s.needsUpdate=!0}}var o=this.contactMaterials;for(var n=0;n!==o.length;n++){var r=o[n];r.stiffness=r.frictionStiffness=e}var r=this.defaultContactMaterial;r.stiffness=r.frictionStiffness=e},P.prototype.setGlobalRelaxation=function(e){for(var t=0;t!==this.constraints.length;t++){var n=this.constraints[t];for(var r=0;r!==n.equations.length;r++){var i=n.equations[r];i.relaxation=e,i.needsUpdate=!0}}for(var t=0;t!==this.contactMaterials.length;t++){var n=this.contactMaterials[t];n.relaxation=n.frictionRelaxation=e}var n=this.defaultContactMaterial;n.relaxation=n.frictionRelaxation=e};var Q=new k,G=[];P.prototype.raycast=function(e,t){return t.getAABB(Q),this.broadphase.aabbQuery(this,Q,G),t.intersectBodies(e,G),G.length=0,e.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)}),function(){var e=this,t=t||{};return t.game=null,t.WEBGL_RENDERER=0,t.CANVAS_RENDERER=1,t.VERSION="v2.2.9",t._UID=0,typeof Float32Array!="undefined"?(t.Float32Array=Float32Array,t.Uint16Array=Uint16Array,t.Uint32Array=Uint32Array,t.ArrayBuffer=ArrayBuffer):(t.Float32Array=Array,t.Uint16Array=Array),t.PI_2=Math.PI*2,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.RETINA_PREFIX="@2x",t.DisplayObject=function(){this.position=new t.Point(0,0),this.scale=new t.Point(1,1),this.pivot=new t.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this.worldTransform=new t.Matrix,this.worldPosition=new t.Point(0,0),this.worldScale=new t.Point(1,1),this.worldRotation=0,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new t.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},t.DisplayObject.prototype.constructor=t.DisplayObject,t.DisplayObject.prototype.destroy=function(){if(this.children){var e=this.children.length;while(e--)this.children[e].destroy();this.children=[]}this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.renderable=!1,this._destroyCachedSprite()},Object.defineProperty(t.DisplayObject.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask&&(this._mask.isMask=!1),this._mask=e,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(e){if(e){var n=[];for(var r=0;r<e.length;r++){var i=e[r].passes;for(var s=0;s<i.length;s++)n.push(i[s])}this._filterBlock={target:this,filterPasses:n}}this._filters=e,this.blendMode&&this.blendMode===t.blendModes.MULTIPLY&&(this.blendMode=t.blendModes.NORMAL)}}),Object.defineProperty(t.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){if(this._cacheAsBitmap===e)return;e?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=e}}),t.DisplayObject.prototype.updateTransform=function(e){if(!e&&!this.parent&&!this.game)return;var n=this.parent;e?n=e:this.parent||(n=this.game.world);var r=n.worldTransform,i=this.worldTransform,s,o,u,a,f,l;if(this.rotation%t.PI_2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),s=this._cr*this.scale.x,o=this._sr*this.scale.x,u=-this._sr*this.scale.y,a=this._cr*this.scale.y,f=this.position.x,l=this.position.y;if(this.pivot.x||this.pivot.y)f-=this.pivot.x*s+this.pivot.y*u,l-=this.pivot.x*o+this.pivot.y*a;i.a=s*r.a+o*r.c,i.b=s*r.b+o*r.d,i.c=u*r.a+a*r.c,i.d=u*r.b+a*r.d,i.tx=f*r.a+l*r.c+r.tx,i.ty=f*r.b+l*r.d+r.ty}else s=this.scale.x,a=this.scale.y,f=this.position.x-this.pivot.x*s,l=this.position.y-this.pivot.y*a,i.a=s*r.a,i.b=s*r.b,i.c=a*r.c,i.d=a*r.d,i.tx=f*r.a+l*r.c+r.tx,i.ty=f*r.b+l*r.d+r.ty;this.worldAlpha=this.alpha*n.worldAlpha,this.worldPosition.set(i.tx,i.ty),this.worldScale.set(Math.sqrt(i.a*i.a+i.b*i.b),Math.sqrt(i.c*i.c+i.d*i.d)),this.worldRotation=Math.atan2(-i.c,i.d),this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,i,r)},t.DisplayObject.prototype.displayObjectUpdateTransform=t.DisplayObject.prototype.updateTransform,t.DisplayObject.prototype.getBounds=function(e){return e=e,t.EmptyRectangle},t.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(t.identityMatrix)},t.DisplayObject.prototype.setStageReference=function(e){this.stage=e},t.DisplayObject.prototype.preUpdate=function(){},t.DisplayObject.prototype.generateTexture=function(e,n,r){var i=this.getLocalBounds(),s=new t.RenderTexture(i.width|0,i.height|0,r,n,e);return t.DisplayObject._tempMatrix.tx=-i.x,t.DisplayObject._tempMatrix.ty=-i.y,s.render(this,t.DisplayObject._tempMatrix),s},t.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},t.DisplayObject.prototype.toGlobal=function(e){return this.displayObjectUpdateTransform(),this.worldTransform.apply(e)},t.DisplayObject.prototype.toLocal=function(e,t){return t&&(e=t.toGlobal(e)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(e)},t.DisplayObject.prototype._renderCachedSprite=function(e){this._cachedSprite.worldAlpha=this.worldAlpha,e.gl?t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e):t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e)},t.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var e=this.getLocalBounds();e.width=Math.max(1,Math.ceil(e.width)),e.height=Math.max(1,Math.ceil(e.height)),this.updateTransform();if(!this._cachedSprite){var n=new t.RenderTexture(e.width,e.height);this._cachedSprite=new t.Sprite(n),this._cachedSprite.worldTransform=this.worldTransform}else this._cachedSprite.texture.resize(e.width,e.height);var r=this._filters;this._filters=null,this._cachedSprite.filters=r,t.DisplayObject._tempMatrix.tx=-e.x,t.DisplayObject._tempMatrix.ty=-e.y,this._cachedSprite.texture.render(this,t.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._filters=r,this._cacheAsBitmap=!0},t.DisplayObject.prototype._destroyCachedSprite=function(){if(!this._cachedSprite)return;this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.DisplayObject.prototype._renderWebGL=function(e){e=e},t.DisplayObject.prototype._renderCanvas=function(e){e=e},Object.defineProperty(t.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(t.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),t.DisplayObjectContainer=function(){t.DisplayObject.call(this),this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,Object.defineProperty(t.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}}),Object.defineProperty(t.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}}),t.DisplayObjectContainer.prototype.addChild=function(e){return this.addChildAt(e,this.children.length)},t.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(t>=0&&t<=this.children.length)return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),this.stage&&e.setStageReference(this.stage),e;throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length)},t.DisplayObjectContainer.prototype.swapChildren=function(e,t){if(e===t)return;var n=this.getChildIndex(e),r=this.getChildIndex(t);if(n<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[n]=t,this.children[r]=e},t.DisplayObjectContainer.prototype.getChildIndex=function(e){var t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t},t.DisplayObjectContainer.prototype.setChildIndex=function(e,t){if(t<0||t>=this.children.length)throw new Error("The supplied index is out of bounds");var n=this.getChildIndex(e);this.children.splice(n,1),this.children.splice(t,0,e)},t.DisplayObjectContainer.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Supplied index "+e+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[e]},t.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(t===-1)return;return this.removeChildAt(t)},t.DisplayObjectContainer.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return this.stage&&t.removeStageReference(),t.parent=undefined,this.children.splice(e,1),t},t.DisplayObjectContainer.prototype.removeChildren=function(e,t){var n=e||0,r=typeof t=="number"?t:this.children.length,i=r-n;if(i>0&&i<=r){var s=this.children.splice(n,i);for(var o=0;o<s.length;o++){var u=s[o];this.stage&&u.removeStageReference(),u.parent=undefined}return s}if(i===0&&this.children.length===0)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},t.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible)return;this.displayObjectUpdateTransform();if(this._cacheAsBitmap)return;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform()},t.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=t.DisplayObjectContainer.prototype.updateTransform,t.DisplayObjectContainer.prototype.getBounds=function(){if(this.children.length===0)return t.EmptyRectangle;var e=Infinity,n=Infinity,r=-Infinity,i=-Infinity,s,o,u,a=!1;for(var f=0,l=this.children.length;f<l;f++){var c=this.children[f];if(!c.visible)continue;a=!0,s=this.children[f].getBounds(),e=e<s.x?e:s.x,n=n<s.y?n:s.y,o=s.width+s.x,u=s.height+s.y,r=r>o?r:o,i=i>u?i:u}if(!a)return t.EmptyRectangle;var h=this._bounds;return h.x=e,h.y=n,h.width=r-e,h.height=i-n,h},t.DisplayObjectContainer.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=t.identityMatrix;for(var n=0,r=this.children.length;n<r;n++)this.children[n].updateTransform();var i=this.getBounds();return this.worldTransform=e,i},t.DisplayObjectContainer.prototype.setStageReference=function(e){this.stage=e;for(var t=0;t<this.children.length;t++)this.children[t].setStageReference(e)},t.DisplayObjectContainer.prototype.removeStageReference=function(){for(var e=0;e<this.children.length;e++)this.children[e].removeStageReference();this.stage=null},t.DisplayObjectContainer.prototype._renderWebGL=function(e){if(!this.visible||this.alpha<=0)return;if(this._cacheAsBitmap){this._renderCachedSprite(e);return}var t;if(this._mask||this._filters){this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start());for(t=0;t<this.children.length;t++)this.children[t]._renderWebGL(e);e.spriteBatch.stop(),this._mask&&e.maskManager.popMask(this._mask,e),this._filters&&e.filterManager.popFilter(),e.spriteBatch.start()}else for(t=0;t<this.children.length;t++)this.children[t]._renderWebGL(e)},t.DisplayObjectContainer.prototype._renderCanvas=function(e){if(this.visible===!1||this.alpha===0)return;if(this._cacheAsBitmap){this._renderCachedSprite(e);return}this._mask&&e.maskManager.pushMask(this._mask,e);for(var t=0;t<this.children.length;t++)this.children[t]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)},t.Sprite=function(e){t.DisplayObjectContainer.call(this),this.anchor=new t.Point,this.texture=e||t.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.cachedTint=-1,this.tintedTexture=null,this.blendMode=t.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Sprite.prototype.setTexture=function(e,t){t!==undefined&&this.texture.baseTexture.destroy(),this.texture.baseTexture.skipRender=!1,this.texture=e,this.texture.valid=!0},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},t.Sprite.prototype.getBounds=function(e){var t=this.texture.frame.width,n=this.texture.frame.height,r=t*(1-this.anchor.x),i=t*-this.anchor.x,s=n*(1-this.anchor.y),o=n*-this.anchor.y,u=e||this.worldTransform,a=u.a,f=u.b,l=u.c,c=u.d,h=u.tx,p=u.ty,d=-Infinity,v=-Infinity,m=Infinity,g=Infinity;if(f===0&&l===0){if(a<0){a*=-1;var y=r;r=-i,i=-y}if(c<0){c*=-1;var y=s;s=-o,o=-y}m=a*i+h,d=a*r+h,g=c*o+p,v=c*s+p}else{var b=a*i+l*o+h,w=c*o+f*i+p,E=a*r+l*o+h,S=c*o+f*r+p,x=a*r+l*s+h,T=c*s+f*r+p,N=a*i+l*s+h,C=c*s+f*i+p;m=b<m?b:m,m=E<m?E:m,m=x<m?x:m,m=N<m?N:m,g=w<g?w:g,g=S<g?S:g,g=T<g?T:g,g=C<g?C:g,d=b>d?b:d,d=E>d?E:d,d=x>d?x:d,d=N>d?N:d,v=w>v?w:v,v=S>v?S:v,v=T>v?T:v,v=C>v?C:v}var k=this._bounds;return k.x=m,k.width=d-m,k.y=g,k.height=v-g,this._currentBounds=k,k},t.Sprite.prototype._renderWebGL=function(e,t){if(!this.visible||this.alpha<=0||!this.renderable)return;var n=this.worldTransform;t&&(n=t);if(this._mask||this._filters){var r=e.spriteBatch;this._filters&&(r.flush(),e.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),e.maskManager.pushMask(this.mask,e),r.start()),r.render(this);for(var i=0;i<this.children.length;i++)this.children[i]._renderWebGL(e);r.stop(),this._mask&&e.maskManager.popMask(this._mask,e),this._filters&&e.filterManager.popFilter(),r.start()}else{e.spriteBatch.render(this);for(var i=0;i<this.children.length;i++)this.children[i]._renderWebGL(e,n)}},t.Sprite.prototype._renderCanvas=function(e,n){if(!this.visible||this.alpha===0||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)return;var r=this.worldTransform;n&&(r=n),this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,e.context.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e);if(this.texture.valid){var i=this.texture.baseTexture.resolution/e.resolution;e.context.globalAlpha=this.worldAlpha,e.smoothProperty&&e.scaleMode!==this.texture.baseTexture.scaleMode&&(e.scaleMode=this.texture.baseTexture.scaleMode,e.context[e.smoothProperty]=e.scaleMode===t.scaleModes.LINEAR);var s=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,o=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;e.roundPixels?(e.context.setTransform(r.a,r.b,r.c,r.d,r.tx*e.resolution|0,r.ty*e.resolution|0),s|=0,o|=0):e.context.setTransform(r.a,r.b,r.c,r.d,r.tx*e.resolution,r.ty*e.resolution);var u=this.texture.crop.width,a=this.texture.crop.height;s/=i,o/=i;if(this.tint!==16777215){if(this.texture.requiresReTint||this.cachedTint!==this.tint)this.tintedTexture=t.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint;e.context.drawImage(this.tintedTexture,0,0,u,a,s,o,u/i,a/i)}else{var f=this.texture.crop.x,l=this.texture.crop.y;e.context.drawImage(this.texture.baseTexture.source,f,l,u,a,s,o,u/i,a/i)}}for(var c=0;c<this.children.length;c++)this.children[c]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)},t.Sprite.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new t.Sprite(n)},t.Sprite.fromImage=function(e,n,r){var i=t.Texture.fromImage(e,n,r);return new t.Sprite(i)},t.SpriteBatch=function(e){t.DisplayObjectContainer.call(this),this.textureThing=e,this.ready=!1},t.SpriteBatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.SpriteBatch.prototype.constructor=t.SpriteBatch,t.SpriteBatch.prototype.initWebGL=function(e){this.fastSpriteBatch=new t.WebGLFastSpriteBatch(e),this.ready=!0},t.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},t.SpriteBatch.prototype._renderWebGL=function(e){if(!this.visible||this.alpha<=0||!this.children.length)return;this.ready||this.initWebGL(e.gl),this.fastSpriteBatch.gl!==e.gl&&this.fastSpriteBatch.setContext(e.gl),e.spriteBatch.stop(),e.shaderManager.setShader(e.shaderManager.fastShader),this.fastSpriteBatch.begin(this,e),this.fastSpriteBatch.render(this),e.spriteBatch.start()},t.SpriteBatch.prototype._renderCanvas=function(e){if(!this.visible||this.alpha<=0||!this.children.length)return;var t=e.context;t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();var n=this.worldTransform,r=!0;for(var i=0;i<this.children.length;i++){var s=this.children[i];if(!s.visible)continue;var o=s.texture,u=o.frame;t.globalAlpha=this.worldAlpha*s.alpha;if(s.rotation%(Math.PI*2)===0)r&&(t.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),r=!1),t.drawImage(o.baseTexture.source,u.x,u.y,u.width,u.height,s.anchor.x*-u.width*s.scale.x+s.position.x+.5|0,s.anchor.y*-u.height*s.scale.y+s.position.y+.5|0,u.width*s.scale.x,u.height*s.scale.y);else{r||(r=!0),s.displayObjectUpdateTransform();var a=s.worldTransform;e.roundPixels?t.setTransform(a.a,a.b,a.c,a.d,a.tx|0,a.ty|0):t.setTransform(a.a,a.b,a.c,a.d,a.tx,a.ty),t.drawImage(o.baseTexture.source,u.x,u.y,u.width,u.height,s.anchor.x*-u.width+.5|0,s.anchor.y*-u.height+.5|0,u.width,u.height)}}},t.hex2rgb=function(e){return[(e>>16&255)/255,(e>>8&255)/255,(e&255)/255]},t.rgb2hex=function(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255},t.canUseNewCanvasBlendModes=function(){if(document===undefined)return!1;var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",n="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",r=new Image;r.src=e+"AP804Oa6"+n;var i=new Image;i.src=e+"/wCKxvRF"+n;var s=t.CanvasPool.create(this,6,1),o=s.getContext("2d");o.globalCompositeOperation="multiply",o.drawImage(r,0,0),o.drawImage(i,2,0);if(!o.getImageData(2,0,1,1))return!1;var u=o.getImageData(2,0,1,1).data;return t.CanvasPool.remove(this),u[0]===255&&u[1]===0&&u[2]===0},t.getNextPowerOfTwo=function(e){if(e>0&&(e&e-1)===0)return e;var t=1;while(t<e)t<<=1;return t},t.isPowerOfTwo=function(e,t){return e>0&&(e&e-1)===0&&t>0&&(t&t-1)===0},t.CanvasPool={create:function(e,n,r){var i=t.CanvasPool.getFirst(),s;if(i===-1){var o={parent:e,canvas:document.createElement("canvas")};t.CanvasPool.pool.push(o),s=o.canvas}else t.CanvasPool.pool[i].parent=e,s=t.CanvasPool.pool[i].canvas;return n!==undefined&&(s.width=n,s.height=r),s},getFirst:function(){var e=t.CanvasPool.pool;for(var n=0;n<e.length;n++)if(e[n].parent===null)return n;return-1},remove:function(e){var n=t.CanvasPool.pool;for(var r=0;r<n.length;r++)n[r].parent===e&&(n[r].parent=null)},removeByCanvas:function(e){var n=t.CanvasPool.pool;for(var r=0;r<n.length;r++)n[r].canvas===e&&(n[r].parent=null)},getTotal:function(){var e=t.CanvasPool.pool,n=0;for(var r=0;r<e.length;r++)e[r].parent!==null&&n++;return n},getFree:function(){var e=t.CanvasPool.pool,n=0;for(var r=0;r<e.length;r++)e[r].parent===null&&n++;return n}},t.CanvasPool.pool=[],t.initDefaultShaders=function(){},t.CompileVertexShader=function(e,n){return t._CompileShader(e,n,e.VERTEX_SHADER)},t.CompileFragmentShader=function(e,n){return t._CompileShader(e,n,e.FRAGMENT_SHADER)},t._CompileShader=function(e,t,n){var r=t;Array.isArray(t)&&(r=t.join("\n"));var i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(window.console.log(e.getShaderInfoLog(i)),null)},t.compileProgram=function(e,n,r){var i=t.CompileFragmentShader(e,r),s=t.CompileVertexShader(e,n),o=e.createProgram();return e.attachShader(o,s),e.attachShader(o,i),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),o},t.PixiShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},t.PixiShader.prototype.constructor=t.PixiShader,t.PixiShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.colorAttribute===-1&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=e.getUniformLocation(n,r);this.initUniforms(),this.program=n},t.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var e=this.gl,t;for(var n in this.uniforms){t=this.uniforms[n];var r=t.type;r==="sampler2D"?(t._init=!1,t.value!==null&&this.initSampler2D(t)):r==="mat2"||r==="mat3"||r==="mat4"?(t.glMatrix=!0,t.glValueLength=1,r==="mat2"?t.glFunc=e.uniformMatrix2fv:r==="mat3"?t.glFunc=e.uniformMatrix3fv:r==="mat4"&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+r],r==="2f"||r==="2i"?t.glValueLength=2:r==="3f"||r==="3i"?t.glValueLength=3:r==="4f"||r==="4i"?t.glValueLength=4:t.glValueLength=1)}},t.PixiShader.prototype.initSampler2D=function(e){if(!e.value||!e.value.baseTexture||!e.value.baseTexture.hasLoaded)return;var t=this.gl;t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,e.value.baseTexture._glTextures[t.id]);if(e.textureData){var n=e.textureData,r=n.magFilter?n.magFilter:t.LINEAR,i=n.minFilter?n.minFilter:t.LINEAR,s=n.wrapS?n.wrapS:t.CLAMP_TO_EDGE,o=n.wrapT?n.wrapT:t.CLAMP_TO_EDGE,u=n.luminance?t.LUMINANCE:t.RGBA;n.repeat&&(s=t.REPEAT,o=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!n.flipY);if(n.width){var a=n.width?n.width:512,f=n.height?n.height:2,l=n.border?n.border:0;t.texImage2D(t.TEXTURE_2D,0,u,a,f,l,u,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,u,t.RGBA,t.UNSIGNED_BYTE,e.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o)}t.uniform1i(e.uniformLocation,this.textureCount),e._init=!0,this.textureCount++},t.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var e,n=this.gl;for(var r in this.uniforms)e=this.uniforms[r],e.glValueLength===1?e.glMatrix===!0?e.glFunc.call(n,e.uniformLocation,e.transpose,e.value):e.glFunc.call(n,e.uniformLocation,e.value):e.glValueLength===2?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y):e.glValueLength===3?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z):e.glValueLength===4?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):e.type==="sampler2D"&&(e._init?(n.activeTexture(n["TEXTURE"+this.textureCount]),e.value.baseTexture._dirty[n.id]?t.instances[n.id].updateTexture(e.value.baseTexture):n.bindTexture(n.TEXTURE_2D,e.value.baseTexture._glTextures[n.id]),n.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},t.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],t.PixiFastShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},t.PixiFastShader.prototype.constructor=t.PixiFastShader,t.PixiFastShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.uMatrix=e.getUniformLocation(n,"uMatrix"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aPositionCoord=e.getAttribLocation(n,"aPositionCoord"),this.aScale=e.getAttribLocation(n,"aScale"),this.aRotation=e.getAttribLocation(n,"aRotation"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.colorAttribute===-1&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=n},t.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.StripShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},t.StripShader.prototype.constructor=t.StripShader,t.StripShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.PrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},t.PrimitiveShader.prototype.constructor=t.PrimitiveShader,t.PrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.flipY=e.getUniformLocation(n,"flipY"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.ComplexPrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},t.ComplexPrimitiveShader.prototype.constructor=t.ComplexPrimitiveShader,t.ComplexPrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.color=e.getUniformLocation(n,"color"),this.flipY=e.getUniformLocation(n,"flipY"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.glContexts=[],t.instances=[],t.WebGLRenderer=function(e){this.game=e,t.defaultRenderer||(t.defaultRenderer=this),this.type=t.WEBGL_RENDERER,this.resolution=e.resolution,this.transparent=e.transparent,this.autoResize=!1,this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.clearBeforeRender=e.clearBeforeRender,this.width=e.width,this.height=e.height,this.view=e.canvas,this._contextOptions={alpha:this.transparent,antialias:e.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer},this.projection=new t.Point,this.offset=new t.Point,this.shaderManager=new t.WebGLShaderManager,this.spriteBatch=new t.WebGLSpriteBatch,this.maskManager=new t.WebGLMaskManager,this.filterManager=new t.WebGLFilterManager,this.stencilManager=new t.WebGLStencilManager,this.blendModeManager=new t.WebGLBlendModeManager,this.renderSession={},this.renderSession.game=this.game,this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.prototype.initContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=e;if(!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=e.id=t.WebGLRenderer.glContextId++,t.glContexts[this.glContextId]=e,t.instances[this.glContextId]=this,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.shaderManager.setContext(e),this.spriteBatch.setContext(e),this.maskManager.setContext(e),this.filterManager.setContext(e),this.blendModeManager.setContext(e),this.stencilManager.setContext(e),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},t.WebGLRenderer.prototype.render=function(e){if(this.contextLost)return;e.updateTransform();var t=this.gl;t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),this.game.clearBeforeRender&&(t.clearColor(e._bgColor.r,e._bgColor.g,e._bgColor.b,e._bgColor.a),t.clear(t.COLOR_BUFFER_BIT)),this.renderDisplayObject(e,this.projection)},t.WebGLRenderer.prototype.renderDisplayObject=function(e,n,r,i){this.renderSession.blendModeManager.setBlendMode(t.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=r?-1:1,this.renderSession.projection=n,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,r),e._renderWebGL(this.renderSession,i),this.spriteBatch.end()},t.WebGLRenderer.prototype.resize=function(e,t){this.width=e*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},t.WebGLRenderer.prototype.updateTexture=function(e){if(!e.hasLoaded)return!1;var n=this.gl;return e._glTextures[n.id]||(e._glTextures[n.id]=n.createTexture()),n.bindTexture(n.TEXTURE_2D,e._glTextures[n.id]),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e.source),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e.mipmap&&t.isPowerOfTwo(e.width,e.height)?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST),n.generateMipmap(n.TEXTURE_2D)):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e._powerOf2?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),e._dirty[n.id]=!1,!0},t.WebGLRenderer.prototype.destroy=function(){t.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,t.CanvasPool.remove(this),t.instances[this.glContextId]=null,t.WebGLRenderer.glContextId--},t.WebGLRenderer.prototype.mapBlendModes=function(){var e=this.gl;if(!t.blendModesWebGL){var n=[],r=t.blendModes;n[r.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.ADD]=[e.SRC_ALPHA,e.DST_ALPHA],n[r.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],n[r.SCREEN]=[e.SRC_ALPHA,e.ONE],n[r.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],n[r.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL=n}},t.WebGLRenderer.glContextId=0,t.WebGLBlendModeManager=function(){this.currentBlendMode=99999},t.WebGLBlendModeManager.prototype.constructor=t.WebGLBlendModeManager,t.WebGLBlendModeManager.prototype.setContext=function(e){this.gl=e},t.WebGLBlendModeManager.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var n=t.blendModesWebGL[this.currentBlendMode];return n&&this.gl.blendFunc(n[0],n[1]),!0},t.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},t.WebGLMaskManager=function(){},t.WebGLMaskManager.prototype.constructor=t.WebGLMaskManager,t.WebGLMaskManager.prototype.setContext=function(e){this.gl=e},t.WebGLMaskManager.prototype.pushMask=function(e,n){var r=n.gl;e.dirty&&t.WebGLGraphics.updateGraphics(e,r);if(e._webGL[r.id]===undefined||e._webGL[r.id].data===undefined||e._webGL[r.id].data.length===0)return;n.stencilManager.pushStencil(e,e._webGL[r.id].data[0],n)},t.WebGLMaskManager.prototype.popMask=function(e,t){var n=this.gl;if(e._webGL[n.id]===undefined||e._webGL[n.id].data===undefined||e._webGL[n.id].data.length===0)return;t.stencilManager.popStencil(e,e._webGL[n.id].data[0],t)},t.WebGLMaskManager.prototype.destroy=function(){this.gl=null},t.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},t.WebGLStencilManager.prototype.setContext=function(e){this.gl=e},t.WebGLStencilManager.prototype.pushStencil=function(e,t,n){var r=this.gl;this.bindGraphics(e,t,n),this.stencilStack.length===0&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t);var i=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),t.mode===1?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-i,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,i,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),this.reverse?r.stencilFunc(r.EQUAL,255-(i+1),255):r.stencilFunc(r.EQUAL,i+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,i,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-i,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i+1,255):r.stencilFunc(r.EQUAL,255-(i+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},t.WebGLStencilManager.prototype.bindGraphics=function(e,n,r){this._currentGraphics=e;var i=this.gl,s=r.projection,o=r.offset,u;n.mode===1?(u=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(u),i.uniform1f(u.flipY,r.flipY),i.uniformMatrix3fv(u.translationMatrix,!1,e.worldTransform.toArray(!0)),i.uniform2f(u.projectionVector,s.x,-s.y),i.uniform2f(u.offsetVector,-o.x,-o.y),i.uniform3fv(u.tintColor,t.hex2rgb(e.tint)),i.uniform3fv(u.color,n.color),i.uniform1f(u.alpha,e.worldAlpha*n.alpha),i.bindBuffer(i.ARRAY_BUFFER,n.buffer),i.vertexAttribPointer(u.aVertexPosition,2,i.FLOAT,!1,8,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.indexBuffer)):(u=r.shaderManager.primitiveShader,r.shaderManager.setShader(u),i.uniformMatrix3fv(u.translationMatrix,!1,e.worldTransform.toArray(!0)),i.uniform1f(u.flipY,r.flipY),i.uniform2f(u.projectionVector,s.x,-s.y),i.uniform2f(u.offsetVector,-o.x,-o.y),i.uniform3fv(u.tintColor,t.hex2rgb(e.tint)),i.uniform1f(u.alpha,e.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,n.buffer),i.vertexAttribPointer(u.aVertexPosition,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(u.colorAttribute,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.indexBuffer))},t.WebGLStencilManager.prototype.popStencil=function(e,t,n){var r=this.gl;this.stencilStack.pop(),this.count--;if(this.stencilStack.length===0)r.disable(r.STENCIL_TEST);else{var i=this.count;this.bindGraphics(e,t,n),r.colorMask(!1,!1,!1,!1),t.mode===1?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(i+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,i+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i,255):r.stencilFunc(r.EQUAL,255-i,255)):(this.reverse?(r.stencilFunc(r.EQUAL,i+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(i+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i,255):r.stencilFunc(r.EQUAL,255-i,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},t.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},t.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var e=0;e<this.maxAttibs;e++)this.attribState[e]=!1;this.stack=[]},t.WebGLShaderManager.prototype.constructor=t.WebGLShaderManager,t.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.complexPrimitiveShader=new t.ComplexPrimitiveShader(e),this.defaultShader=new t.PixiShader(e),this.fastShader=new t.PixiFastShader(e),this.stripShader=new t.StripShader(e),this.setShader(this.defaultShader)},t.WebGLShaderManager.prototype.setAttribs=function(e){var t;for(t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<e.length;t++){var n=e[t];this.tempAttribState[n]=!0}var r=this.gl;for(t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?r.enableVertexAttribArray(t):r.disableVertexAttribArray(t))},t.WebGLShaderManager.prototype.setShader=function(e){return this._currentId===e._UID?!1:(this._currentId=e._UID,this.currentShader=e,this.gl.useProgram(e.program),this.setAttribs(e.attributes),!0)},t.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},t.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var e=this.size*4*4*this.vertSize,n=this.size*6;this.vertices=new t.ArrayBuffer(e),this.positions=new t.Float32Array(this.vertices),this.colors=new t.Uint32Array(this.vertices),this.indices=new t.Uint16Array(n),this.lastIndexCount=0;for(var r=0,i=0;r<n;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new t.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},t.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999;var n=new t.PixiShader(e);n.fragmentSrc=this.defaultShader.fragmentSrc,n.uniforms={},n.init(),this.defaultShader.shaders[e.id]=n},t.WebGLSpriteBatch.prototype.begin=function(e){this.renderSession=e,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},t.WebGLSpriteBatch.prototype.end=function(){this.flush()},t.WebGLSpriteBatch.prototype.render=function(e,t){var n=e.texture,r=e.worldTransform;t&&(r=t),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=n.baseTexture);var i=n._uvs;if(!i)return;var s=e.anchor.x,o=e.anchor.y,u,a,f,l;if(n.trim){var c=n.trim;a=c.x-s*c.width,u=a+n.crop.width,l=c.y-o*c.height,f=l+n.crop.height}else u=n.frame.width*(1-s),a=n.frame.width*-s,f=n.frame.height*(1-o),l=n.frame.height*-o;var h=this.currentBatchSize*4*this.vertSize,p=n.baseTexture.resolution,d=r.a/p,v=r.b/p,m=r.c/p,g=r.d/p,y=r.tx,b=r.ty,w=this.colors,E=this.positions;this.renderSession.roundPixels?(E[h]=d*a+m*l+y|0,E[h+1]=g*l+v*a+b|0,E[h+5]=d*u+m*l+y|0,E[h+6]=g*l+v*u+b|0,E[h+10]=d*u+m*f+y|0,E[h+11]=g*f+v*u+b|0,E[h+15]=d*a+m*f+y|0,E[h+16]=g*f+v*a+b|0):(E[h]=d*a+m*l+y,E[h+1]=g*l+v*a+b,E[h+5]=d*u+m*l+y,E[h+6]=g*l+v*u+b,E[h+10]=d*u+m*f+y,E[h+11]=g*f+v*u+b,E[h+15]=d*a+m*f+y,E[h+16]=g*f+v*a+b),E[h+2]=i.x0,E[h+3]=i.y0,E[h+7]=i.x1,E[h+8]=i.y1,E[h+12]=i.x2,E[h+13]=i.y2,E[h+17]=i.x3,E[h+18]=i.y3;var S=e.tint;w[h+4]=w[h+9]=w[h+14]=w[h+19]=(S>>16)+(S&65280)+((S&255)<<16)+(e.worldAlpha*255<<24),this.sprites[this.currentBatchSize++]=e},t.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var n=e.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=n.baseTexture),e._uvs||(e._uvs=new t.TextureUvs);var r=e._uvs,i=n.baseTexture.width,s=n.baseTexture.height;e.tilePosition.x%=i*e.tileScaleOffset.x,e.tilePosition.y%=s*e.tileScaleOffset.y;var o=e.tilePosition.x/(i*e.tileScaleOffset.x),u=e.tilePosition.y/(s*e.tileScaleOffset.y),a=e.width/i/(e.tileScale.x*e.tileScaleOffset.x),f=e.height/s/(e.tileScale.y*e.tileScaleOffset.y);r.x0=0-o,r.y0=0-u,r.x1=1*a-o,r.y1=0-u,r.x2=1*a-o,r.y2=1*f-u,r.x3=0-o,r.y3=1*f-u;var l=e.tint,c=(l>>16)+(l&65280)+((l&255)<<16)+(e.worldAlpha*255<<24),h=this.positions,p=this.colors,d=e.width,v=e.height,m=e.anchor.x,g=e.anchor.y,y=d*(1-m),b=d*-m,w=v*(1-g),E=v*-g,S=this.currentBatchSize*4*this.vertSize,x=n.baseTexture.resolution,T=e.worldTransform,N=T.a/x,C=T.b/x,k=T.c/x,L=T.d/x,A=T.tx,O=T.ty;h[S++]=N*b+k*E+A,h[S++]=L*E+C*b+O,h[S++]=r.x0,h[S++]=r.y0,p[S++]=c,h[S++]=N*y+k*E+A,h[S++]=L*E+C*y+O,h[S++]=r.x1,h[S++]=r.y1,p[S++]=c,h[S++]=N*y+k*w+A,h[S++]=L*w+C*y+O,h[S++]=r.x2,h[S++]=r.y2,p[S++]=c,h[S++]=N*b+k*w+A,h[S++]=L*w+C*b+O,h[S++]=r.x3,h[S++]=r.y3,p[S++]=c,this.sprites[this.currentBatchSize++]=e},t.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var e=this.gl,n;if(this.dirty){this.dirty=!1,e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n=this.defaultShader.shaders[e.id];var r=this.vertSize*4;e.vertexAttribPointer(n.aVertexPosition,2,e.FLOAT,!1,r,0),e.vertexAttribPointer(n.aTextureCoord,2,e.FLOAT,!1,r,8),e.vertexAttribPointer(n.colorAttribute,4,e.UNSIGNED_BYTE,!0,r,16)}if(this.currentBatchSize>this.size*.5)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var i=this.positions.subarray(0,this.currentBatchSize*4*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,i)}var s,o,u,a=0,f=0,l=null,c=this.renderSession.blendModeManager.currentBlendMode,h=null,p=!1,d=!1,v;for(var m=0,g=this.currentBatchSize;m<g;m++){v=this.sprites[m],v.tilingTexture?s=v.tilingTexture.baseTexture:s=v.texture.baseTexture,o=v.blendMode,u=v.shader||this.defaultShader,p=c!==o,d=h!==u;var y=s.skipRender;y&&v.children.length>0&&(y=!1);if(l!==s&&!y||p||d){this.renderBatch(l,a,f),f=m,a=0,l=s,p&&(c=o,this.renderSession.blendModeManager.setBlendMode(c));if(d){h=u,n=h.shaders[e.id],n||(n=new t.PixiShader(e),n.fragmentSrc=h.fragmentSrc,n.uniforms=h.uniforms,n.init(),h.shaders[e.id]=n),this.renderSession.shaderManager.setShader(n),n.dirty&&n.syncUniforms();var b=this.renderSession.projection;e.uniform2f(n.projectionVector,b.x,b.y);var w=this.renderSession.offset;e.uniform2f(n.offsetVector,w.x,w.y)}}a++}this.renderBatch(l,a,f),this.currentBatchSize=0},t.WebGLSpriteBatch.prototype.renderBatch=function(e,t,n){if(t===0)return;var r=this.gl;if(e._dirty[r.id]){if(!this.renderSession.renderer.updateTexture(e))return}else r.bindTexture(r.TEXTURE_2D,e._glTextures[r.id]);r.drawElements(r.TRIANGLES,t*6,r.UNSIGNED_SHORT,n*6*2),this.renderSession.drawCount++},t.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},t.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},t.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},t.WebGLFastSpriteBatch=function(e){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var n=this.size*4*this.vertSize,r=this.maxSize*6;this.vertices=new t.Float32Array(n),this.indices=new t.Uint16Array(r),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var i=0,s=0;i<r;i+=6,s+=4)this.indices[i+0]=s+0,this.indices[i+1]=s+1,this.indices[i+2]=s+2,this.indices[i+3]=s+0,this.indices[i+4]=s+2,this.indices[i+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(e)},t.WebGLFastSpriteBatch.prototype.constructor=t.WebGLFastSpriteBatch,t.WebGLFastSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW)},t.WebGLFastSpriteBatch.prototype.begin=function(e,t){this.renderSession=t,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=e.worldTransform.toArray(!0),this.start()},t.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.render=function(e){var t=e.children,n=t[0];if(!n.texture._uvs)return;this.currentBaseTexture=n.texture.baseTexture,n.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(n.blendMode));for(var r=0,i=t.length;r<i;r++)this.renderSprite(t[r]);this.flush()},t.WebGLFastSpriteBatch.prototype.renderSprite=function(e){if(!e.visible)return;if(e.texture.baseTexture!==this.currentBaseTexture&&!e.texture.baseTexture.skipRender){this.flush(),this.currentBaseTexture=e.texture.baseTexture;if(!e.texture._uvs)return}var t,n=this.vertices,r,i,s,o,u,a,f;t=e.texture._uvs,r=e.texture.frame.width,i=e.texture.frame.height;if(e.texture.trim){var l=e.texture.trim;o=l.x-e.anchor.x*l.width,s=o+e.texture.crop.width,a=l.y-e.anchor.y*l.height,u=a+e.texture.crop.height}else s=e.texture.frame.width*(1-e.anchor.x),o=e.texture.frame.width*-e.anchor.x,u=e.texture.frame.height*(1-e.anchor.y),a=e.texture.frame.height*-e.anchor.y;f=this.currentBatchSize*4*this.vertSize,n[f++]=o,n[f++]=a,n[f++]=e.position.x,n[f++]=e.position.y,n[f++]=e.scale.x,n[f++]=e.scale.y,n[f++]=e.rotation,n[f++]=t.x0,n[f++]=t.y1,n[f++]=e.alpha,n[f++]=s,n[f++]=a,n[f++]=e.position.x,n[f++]=e.position.y,n[f++]=e.scale.x,n[f++]=e.scale.y,n[f++]=e.rotation,n[f++]=t.x1,n[f++]=t.y1,n[f++]=e.alpha,n[f++]=s,n[f++]=u,n[f++]=e.position.x,n[f++]=e.position.y,n[f++]=e.scale.x,n[f++]=e.scale.y,n[f++]=e.rotation,n[f++]=t.x2,n[f++]=t.y2,n[f++]=e.alpha,n[f++]=o,n[f++]=u,n[f++]=e.position.x,n[f++]=e.position.y,n[f++]=e.scale.x,n[f++]=e.scale.y,n[f++]=e.rotation,n[f++]=t.x3,n[f++]=t.y3,n[f++]=e.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()},t.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var e=this.gl;this.currentBaseTexture._glTextures[e.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,e),e.bindTexture(e.TEXTURE_2D,this.currentBaseTexture._glTextures[e.id]);if(this.currentBatchSize>this.size*.5)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var t=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,this.currentBatchSize*6,e.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++},t.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,t.x,t.y),e.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var n=this.vertSize*4;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,!1,n,0),e.vertexAttribPointer(this.shader.aPositionCoord,2,e.FLOAT,!1,n,8),e.vertexAttribPointer(this.shader.aScale,2,e.FLOAT,!1,n,16),e.vertexAttribPointer(this.shader.aRotation,1,e.FLOAT,!1,n,24),e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,!1,n,28),e.vertexAttribPointer(this.shader.colorAttribute,1,e.FLOAT,!1,n,36)},t.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},t.WebGLFilterManager.prototype.constructor=t.WebGLFilterManager,t.WebGLFilterManager.prototype.setContext=function(e){this.gl=e,this.texturePool=[],this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(e,t){this.renderSession=e,this.defaultShader=e.shaderManager.defaultShader;var n=this.renderSession.projection;this.width=n.x*2,this.height=-n.y*2,this.buffer=t},t.WebGLFilterManager.prototype.pushFilter=function(e){var n=this.gl,r=this.renderSession.projection,i=this.renderSession.offset;e._filterArea=e.target.filterArea||e.target.getBounds(),e._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new t.WebGLStencilManager,this.renderSession.stencilManager.setContext(n),n.disable(n.STENCIL_TEST),this.filterStack.push(e);var s=e.filterPasses[0];this.offsetX+=e._filterArea.x,this.offsetY+=e._filterArea.y;var o=this.texturePool.pop();o?o.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):o=new t.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),n.bindTexture(n.TEXTURE_2D,o.texture);var u=e._filterArea,a=s.padding;u.x-=a,u.y-=a,u.width+=a*2,u.height+=a*2,u.x<0&&(u.x=0),u.width>this.width&&(u.width=this.width),u.y<0&&(u.y=0),u.height>this.height&&(u.height=this.height),n.bindFramebuffer(n.FRAMEBUFFER,o.frameBuffer),n.viewport(0,0,u.width*this.renderSession.resolution,u.height*this.renderSession.resolution),r.x=u.width/2,r.y=-u.height/2,i.x=-u.x,i.y=-u.y,n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),e._glFilterTexture=o},t.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,n=this.filterStack.pop(),r=n._filterArea,i=n._glFilterTexture,s=this.renderSession.projection,o=this.renderSession.offset;if(n.filterPasses.length>1){e.viewport(0,0,r.width*this.renderSession.resolution,r.height*this.renderSession.resolution),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=r.height,this.vertexArray[2]=r.width,this.vertexArray[3]=r.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=r.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var u=i,a=this.texturePool.pop();a||(a=new t.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)),a.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var f=0;f<n.filterPasses.length-1;f++){var l=n.filterPasses[f];e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.texture),this.applyFilterPass(l,r,r.width,r.height);var c=u;u=a,a=c}e.enable(e.BLEND),i=u,this.texturePool.push(a)}var h=n.filterPasses[n.filterPasses.length-1];this.offsetX-=r.x,this.offsetY-=r.y;var p=this.width,d=this.height,v=0,m=0,g=this.buffer;if(this.filterStack.length===0)e.colorMask(!0,!0,!0,!0);else{var y=this.filterStack[this.filterStack.length-1];r=y._filterArea,p=r.width,d=r.height,v=r.x,m=r.y,g=y._glFilterTexture.frameBuffer}s.x=p/2,s.y=-d/2,o.x=v,o.y=m,r=n._filterArea;var b=r.x-v,w=r.y-m;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=b,this.vertexArray[1]=w+r.height,this.vertexArray[2]=b+r.width,this.vertexArray[3]=w+r.height,this.vertexArray[4]=b,this.vertexArray[5]=w,this.vertexArray[6]=b+r.width,this.vertexArray[7]=w,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,p*this.renderSession.resolution,d*this.renderSession.resolution),e.bindFramebuffer(e.FRAMEBUFFER,g),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=n._previous_stencil_mgr,n._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.applyFilterPass(h,r,p,d),this.texturePool.push(i),n._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(e,n,r,i){var s=this.gl,o=e.shaders[s.id];o||(o=new t.PixiShader(s),o.fragmentSrc=e.fragmentSrc,o.uniforms=e.uniforms,o.init(),e.shaders[s.id]=o),this.renderSession.shaderManager.setShader(o),s.uniform2f(o.projectionVector,r/2,-i/2),s.uniform2f(o.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),o.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(o.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(o.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderSession.drawCount++},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new t.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},t.WebGLFilterManager.prototype.destroy=function(){var e=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null,e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.uvBuffer),e.deleteBuffer(this.colorBuffer),e.deleteBuffer(this.indexBuffer)},t.FilterTexture=function(e,n,r,i){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),i=i||t.scaleModes.DEFAULT,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),this.resize(n,r)},t.FilterTexture.prototype.constructor=t.FilterTexture,t.FilterTexture.prototype.clear=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},t.FilterTexture.prototype.resize=function(e,t){if(this.width===e&&this.height===t)return;this.width=e,this.height=t;var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindRenderbuffer(n.RENDERBUFFER,this.renderBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,t)},t.FilterTexture.prototype.destroy=function(){var e=this.gl;e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},t.CanvasBuffer=function(e,n){this.width=e,this.height=n,this.canvas=t.CanvasPool.create(this,this.width,this.height),this.context=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=n},t.CanvasBuffer.prototype.constructor=t.CanvasBuffer,t.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},t.CanvasBuffer.prototype.resize=function(e,t){this.width=this.canvas.width=e,this.height=this.canvas.height=t},t.CanvasBuffer.prototype.destroy=function(){t.CanvasPool.remove(this)},t.CanvasMaskManager=function(){},t.CanvasMaskManager.prototype.constructor=t.CanvasMaskManager,t.CanvasMaskManager.prototype.pushMask=function(e,n){var r=n.context;r.save();var i=e.alpha,s=e.worldTransform,o=n.resolution;r.setTransform(s.a*o,s.b*o,s.c*o,s.d*o,s.tx*o,s.ty*o),t.CanvasGraphics.renderGraphicsMask(e,r),r.clip(),e.worldAlpha=i},t.CanvasMaskManager.prototype.popMask=function(e){e.context.restore()},t.CanvasTinter=function(){},t.CanvasTinter.getTintedTexture=function(e,n){var r=e.tintedTexture||t.CanvasPool.create(this);return t.CanvasTinter.tintMethod(e.texture,n,r),r},t.CanvasTinter.tintWithMultiply=function(e,t,n){var r=n.getContext("2d"),i=e.crop;if(n.width!==i.width||n.height!==i.height)n.width=i.width,n.height=i.height;r.clearRect(0,0,i.width,i.height),r.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},t.CanvasTinter.tintWithPerPixel=function(e,n,r){var i=r.getContext("2d"),s=e.crop;r.width=s.width,r.height=s.height,i.globalCompositeOperation="copy",i.drawImage(e.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);var o=t.hex2rgb(n),u=o[0],a=o[1],f=o[2],l=i.getImageData(0,0,s.width,s.height),c=l.data;for(var h=0;h<c.length;h+=4){c[h+0]*=u,c[h+1]*=a,c[h+2]*=f;if(!t.CanvasTinter.canHandleAlpha){var p=c[h+3];c[h+0]/=255/p,c[h+1]/=255/p,c[h+2]/=255/p}}i.putImageData(l,0,0)},t.CanvasTinter.checkInverseAlpha=function(){var e=new t.CanvasBuffer(2,1);e.context.fillStyle="rgba(10, 20, 30, 0.5)",e.context.fillRect(0,0,1,1);var n=e.context.getImageData(0,0,1,1);if(n===null)return!1;e.context.putImageData(n,1,0);var r=e.context.getImageData(1,0,1,1);return r.data[0]===n.data[0]&&r.data[1]===n.data[1]&&r.data[2]===n.data[2]&&r.data[3]===n.data[3]},t.CanvasTinter.canHandleAlpha=t.CanvasTinter.checkInverseAlpha(),t.CanvasTinter.canUseMultiply=t.canUseNewCanvasBlendModes(),t.CanvasTinter.tintMethod=t.CanvasTinter.canUseMultiply?t.CanvasTinter.tintWithMultiply:t.CanvasTinter.tintWithPerPixel,t.CanvasRenderer=function(e){this.game=e,t.defaultRenderer||(t.defaultRenderer=this),this.type=t.CANVAS_RENDERER,this.resolution=e.resolution,this.clearBeforeRender=e.clearBeforeRender,this.transparent=e.transparent,this.autoResize=!1,this.width=e.width*this.resolution,this.height=e.height*this.resolution,this.view=e.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.count=0,this.maskManager=new t.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:!1},this.mapBlendModes(),this.resize(this.width,this.height)},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(e){e.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=0,this.context.globalCompositeOperation="source-over",navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=e._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(e)},t.CanvasRenderer.prototype.destroy=function(e){e===undefined&&(e=!0),e&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},t.CanvasRenderer.prototype.resize=function(e,t){this.width=e*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},t.CanvasRenderer.prototype.renderDisplayObject=function(e,t,n){this.renderSession.context=t||this.context,this.renderSession.resolution=this.resolution,e._renderCanvas(this.renderSession,n)},t.CanvasRenderer.prototype.mapBlendModes=function(){if(!t.blendModesCanvas){var e=[],n=t.blendModes,r=t.canUseNewCanvasBlendModes();e[n.NORMAL]="source-over",e[n.ADD]="lighter",e[n.MULTIPLY]=r?"multiply":"source-over",e[n.SCREEN]=r?"screen":"source-over",e[n.OVERLAY]=r?"overlay":"source-over",e[n.DARKEN]=r?"darken":"source-over",e[n.LIGHTEN]=r?"lighten":"source-over",e[n.COLOR_DODGE]=r?"color-dodge":"source-over",e[n.COLOR_BURN]=r?"color-burn":"source-over",e[n.HARD_LIGHT]=r?"hard-light":"source-over",e[n.SOFT_LIGHT]=r?"soft-light":"source-over",e[n.DIFFERENCE]=r?"difference":"source-over",e[n.EXCLUSION]=r?"exclusion":"source-over",e[n.HUE]=r?"hue":"source-over",e[n.SATURATION]=r?"saturation":"source-over",e[n.COLOR]=r?"color":"source-over",e[n.LUMINOSITY]=r?"luminosity":"source-over",t.blendModesCanvas=e}},t.BaseTextureCache={},t.BaseTextureCacheIdGenerator=0,t.BaseTexture=function(e,n){this.resolution=1,this.width=100,this.height=100,this.scaleMode=n||t.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=e,this._UID=t._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0];if(!e)return;(this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this.imageUrl=null,this._powerOf2=!1},t.BaseTexture.prototype.constructor=t.BaseTexture,t.BaseTexture.prototype.forceLoaded=function(e,t){this.hasLoaded=!0,this.width=e,this.height=t,this.dirty()},t.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete t.BaseTextureCache[this.imageUrl],delete t.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&(t.CanvasPool.removeByCanvas(this.source),this.source._pixiId&&delete t.BaseTextureCache[this.source._pixiId]),this.source=null,this.unloadFromGPU()},t.BaseTexture.prototype.updateSourceImage=function(e){this.hasLoaded=!1,this.source.src=null,this.source.src=e},t.BaseTexture.prototype.dirty=function(){for(var e=0;e<this._glTextures.length;e++)this._dirty[e]=!0},t.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var e=this._glTextures.length-1;e>=0;e--){var n=this._glTextures[e],r=t.glContexts[e];r&&n&&r.deleteTexture(n)}this._glTextures.length=0,this.dirty()},t.BaseTexture.fromImage=function(e,n,r){var i=t.BaseTextureCache[e];n===undefined&&e.indexOf("data:")===-1&&(n=!0);if(!i){var s=new Image;n&&(s.crossOrigin=""),s.src=e,i=new t.BaseTexture(s,r),i.imageUrl=e,t.BaseTextureCache[e]=i,e.indexOf(t.RETINA_PREFIX+".")!==-1&&(i.resolution=2)}return i},t.BaseTexture.fromCanvas=function(e,n){e._pixiId||(e._pixiId="canvas_"+t.TextureCacheIdGenerator++),e.width===0&&(e.width=1),e.height===0&&(e.height=1);var r=t.BaseTextureCache[e._pixiId];return r||(r=new t.BaseTexture(e,n),t.BaseTextureCache[e._pixiId]=r),r},t.TextureCache={},t.FrameCache={},t.TextureSilentFail=!1,t.TextureCacheIdGenerator=0,t.Texture=function(e,n,r,i){this.noFrame=!1,n||(this.noFrame=!0,n=new t.Rectangle(0,0,1,1)),e instanceof t.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=n,this.trim=i,this.valid=!1,this.isTiling=!1,this.requiresUpdate=!1,this.requiresReTint=!1,this._uvs=null,this.width=0,this.height=0,this.crop=r||new t.Rectangle(0,0,1,1),e.hasLoaded&&(this.noFrame&&(n=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(n))},t.Texture.prototype.constructor=t.Texture,t.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;this.noFrame&&(this.frame=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame)},t.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy(),this.valid=!1},t.Texture.prototype.setFrame=function(e){this.noFrame=!1,this.frame=e,this.width=e.width,this.height=e.height,this.crop.x=e.x,this.crop.y=e.y,this.crop.width=e.width,this.crop.height=e.height;if(!this.trim&&(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)){if(!t.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1;return}this.valid=e&&e.width&&e.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},t.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new t.TextureUvs);var e=this.crop,n=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=e.x/n,this._uvs.y0=e.y/r,this._uvs.x1=(e.x+e.width)/n,this._uvs.y1=e.y/r,this._uvs.x2=(e.x+e.width)/n,this._uvs.y2=(e.y+e.height)/r,this._uvs.x3=e.x/n,this._uvs.y3=(e.y+e.height)/r},t.Texture.fromImage=function(e,n,r){var i=t.TextureCache[e];return i||(i=new t.Texture(t.BaseTexture.fromImage(e,n,r)),t.TextureCache[e]=i),i},t.Texture.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache ');return n},t.Texture.fromCanvas=function(e,n){var r=t.BaseTexture.fromCanvas(e,n);return new t.Texture(r)},t.Texture.addTextureToCache=function(e,n){t.TextureCache[n]=e},t.Texture.removeTextureFromCache=function(e){var n=t.TextureCache[e];return delete t.TextureCache[e],delete t.BaseTextureCache[e],n},t.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},t.RenderTexture=function(e,n,r,i,s){this.width=e||100,this.height=n||100,this.resolution=s||1,this.frame=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new t.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=i||t.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,t.Texture.call(this,this.baseTexture,new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=r||t.defaultRenderer;if(this.renderer.type===t.WEBGL_RENDERER){var o=this.renderer.gl;this.baseTexture._dirty[o.id]=!1,this.textureBuffer=new t.FilterTexture(o,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[o.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new t.Point(this.width*.5,-this.height*.5)}else this.render=this.renderCanvas,this.textureBuffer=new t.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this.tempMatrix=new Phaser.Matrix,this._updateUvs()},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.resize=function(e,n,r){if(e===this.width&&n===this.height)return;this.valid=e>0&&n>0,this.width=e,this.height=n,this.frame.width=this.crop.width=e*this.resolution,this.frame.height=this.crop.height=n*this.resolution,r&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===t.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2);if(!this.valid)return;this.textureBuffer.resize(this.width,this.height)},t.RenderTexture.prototype.clear=function(){if(!this.valid)return;this.renderer.type===t.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear()},t.RenderTexture.prototype.renderWebGL=function(e,t,n){if(!this.valid||e.alpha===0)return;var r=e.worldTransform;r.identity(),r.translate(0,this.projection.y*2),t&&r.append(t),r.scale(1,-1);for(var i=0;i<e.children.length;i++)e.children[i].updateTransform();var s=this.renderer.gl;s.viewport(0,0,this.width*this.resolution,this.height*this.resolution),s.bindFramebuffer(s.FRAMEBUFFER,this.textureBuffer.frameBuffer),n&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(e,this.projection,this.textureBuffer.frameBuffer,t),this.renderer.spriteBatch.dirty=!0},t.RenderTexture.prototype.renderCanvas=function(e,t,n){if(!this.valid||e.alpha===0)return;var r=e.worldTransform;r.identity(),t&&r.append(t);for(var i=0;i<e.children.length;i++)e.children[i].updateTransform();n&&this.textureBuffer.clear();var s=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(e,this.textureBuffer.context,t),this.renderer.resolution=s},t.RenderTexture.prototype.getImage=function(){var e=new Image;return e.src=this.getBase64(),e},t.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},t.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===t.WEBGL_RENDERER){var e=this.renderer.gl,n=this.textureBuffer.width,r=this.textureBuffer.height,i=new Uint8Array(4*n*r);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,n,r,e.RGBA,e.UNSIGNED_BYTE,i),e.bindFramebuffer(e.FRAMEBUFFER,null);var s=new t.CanvasBuffer(n,r),o=s.context.getImageData(0,0,n,r);return o.data.set(i),s.context.putImageData(o,0,0),s.canvas}return this.textureBuffer.canvas},t.AbstractFilter=function(e,t){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=t||{},this.fragmentSrc=e||[]},t.AbstractFilter.prototype.constructor=t.AbstractFilter,t.AbstractFilter.prototype.syncUniforms=function(){for(var e=0,t=this.shaders.length;e<t;e++)this.shaders[e].dirty=!0},t.Strip=function(e){t.DisplayObjectContainer.call(this),this.texture=e,this.uvs=new t.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new t.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new t.Float32Array([1,1,1,1]),this.indices=new t.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=t.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=t.Strip.DrawModes.TRIANGLE_STRIP},t.Strip.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype._renderWebGL=function(e){if(!this.visible||this.alpha<=0)return;e.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(e),e.shaderManager.setShader(e.shaderManager.stripShader),this._renderStrip(e),e.spriteBatch.start()},t.Strip.prototype._initWebGL=function(e){var t=e.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},t.Strip.prototype._renderStrip=function(e){var n=e.gl,r=e.projection,i=e.offset,s=e.shaderManager.stripShader,o=this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?n.TRIANGLE_STRIP:n.TRIANGLES;e.blendModeManager.setBlendMode(this.blendMode),n.uniformMatrix3fv(s.translationMatrix,!1,this.worldTransform.toArray(!0)),n.uniform2f(s.projectionVector,r.x,-r.y),n.uniform2f(s.offsetVector,-i.x,-i.y),n.uniform1f(s.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertices,n.STATIC_DRAW),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._uvBuffer),n.bufferData(n.ARRAY_BUFFER,this.uvs,n.STATIC_DRAW),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),this.texture.baseTexture._dirty[n.id]?e.renderer.updateTexture(this.texture.baseTexture):n.bindTexture(n.TEXTURE_2D,this.texture.baseTexture._glTextures[n.id]),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._uvBuffer),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),this.texture.baseTexture._dirty[n.id]?e.renderer.updateTexture(this.texture.baseTexture):n.bindTexture(n.TEXTURE_2D,this.texture.baseTexture._glTextures[n.id]),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),n.drawElements(o,this.indices.length,n.UNSIGNED_SHORT,0)},t.Strip.prototype._renderCanvas=function(e){var n=e.context,r=this.worldTransform;e.roundPixels?n.setTransform(r.a,r.b,r.c,r.d,r.tx|0,r.ty|0):n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(n):this._renderCanvasTriangles(n)},t.Strip.prototype._renderCanvasTriangleStrip=function(e){var t=this.vertices,n=this.uvs,r=t.length/2;this.count++;for(var i=0;i<r-2;i++){var s=i*2;this._renderCanvasDrawTriangle(e,t,n,s,s+2,s+4)}},t.Strip.prototype._renderCanvasTriangles=function(e){var t=this.vertices,n=this.uvs,r=this.indices,i=r.length;this.count++;for(var s=0;s<i;s+=3){var o=r[s]*2,u=r[s+1]*2,a=r[s+2]*2;this._renderCanvasDrawTriangle(e,t,n,o,u,a)}},t.Strip.prototype._renderCanvasDrawTriangle=function(e,t,n,r,i,s){var o=this.texture.baseTexture.source,u=this.texture.width,a=this.texture.height,f=t[r],l=t[i],c=t[s],h=t[r+1],p=t[i+1],d=t[s+1],v=n[r]*u,m=n[i]*u,g=n[s]*u,y=n[r+1]*a,b=n[i+1]*a,w=n[s+1]*a;if(this.canvasPadding>0){var E=this.canvasPadding/this.worldTransform.a,S=this.canvasPadding/this.worldTransform.d,x=(f+l+c)/3,T=(h+p+d)/3,N=f-x,C=h-T,k=Math.sqrt(N*N+C*C);f=x+N/k*(k+E),h=T+C/k*(k+S),N=l-x,C=p-T,k=Math.sqrt(N*N+C*C),l=x+N/k*(k+E),p=T+C/k*(k+S),N=c-x,C=d-T,k=Math.sqrt(N*N+C*C),c=x+N/k*(k+E),d=T+C/k*(k+S)}e.save(),e.beginPath(),e.moveTo(f,h),e.lineTo(l,p),e.lineTo(c,d),e.closePath(),e.clip();var L=v*b+y*g+m*w-b*g-y*m-v*w,A=f*b+y*c+l*w-b*c-y*l-f*w,O=v*l+f*g+m*c-l*g-f*m-v*c,M=v*b*c+y*l*g+f*m*w-f*b*g-y*m*c-v*l*w,_=h*b+y*d+p*w-b*d-y*p-h*w,D=v*p+h*g+m*d-p*g-h*m-v*d,P=v*b*d+y*p*g+h*m*w-h*b*g-y*m*d-v*p*w;e.transform(A/L,_/L,O/L,D/L,M/L,P/L),e.drawImage(o,0,0),e.restore()},t.Strip.prototype.renderStripFlat=function(e){var t=this.context,n=e.vertices,r=n.length/2;this.count++,t.beginPath();for(var i=1;i<r-2;i++){var s=i*2,o=n[s],u=n[s+2],a=n[s+4],f=n[s+1],l=n[s+3],c=n[s+5];t.moveTo(o,f),t.lineTo(u,l),t.lineTo(a,c)}t.fillStyle="#FF0000",t.fill(),t.closePath()},t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Strip.prototype.getBounds=function(e){var n=e||this.worldTransform,r=n.a,i=n.b,s=n.c,o=n.d,u=n.tx,a=n.ty,f=-Infinity,l=-Infinity,c=Infinity,h=Infinity,p=this.vertices;for(var d=0,v=p.length;d<v;d+=2){var m=p[d],g=p[d+1],y=r*m+s*g+u,b=o*g+i*m+a;c=y<c?y:c,h=b<h?b:h,f=y>f?y:f,l=b>l?b:l}if(c===-Infinity||l===Infinity)return t.EmptyRectangle;var w=this._bounds;return w.x=c,w.width=f-c,w.y=h,w.height=l-h,this._currentBounds=w,w},t.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},t.Rope=function(e,n){t.Strip.call(this,e),this.points=n,this.vertices=new t.Float32Array(n.length*4),this.uvs=new t.Float32Array(n.length*4),this.colors=new t.Float32Array(n.length*2),this.indices=new t.Uint16Array(n.length*2),this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var e=this.points;if(e.length<1)return;var t=this.uvs,n=e[0],r=this.indices,i=this.colors;this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,i[0]=1,i[1]=1,r[0]=0,r[1]=1;var s=e.length,o,u,a;for(var f=1;f<s;f++)o=e[f],u=f*4,a=f/(s-1),f%2?(t[u]=a,t[u+1]=0,t[u+2]=a,t[u+3]=1):(t[u]=a,t[u+1]=0,t[u+2]=a,t[u+3]=1),u=f*2,i[u]=1,i[u+1]=1,u=f*2,r[u]=u,r[u+1]=u+1,n=o},t.Rope.prototype.updateTransform=function(){var e=this.points;if(e.length<1)return;var n=e[0],r,i={x:0,y:0};this.count-=.2;var s=this.vertices,o=e.length,u,a,f,l,c;for(var h=0;h<o;h++)u=e[h],a=h*4,h<e.length-1?r=e[h+1]:r=u,i.y=-(r.x-n.x),i.x=r.y-n.y,f=(1-h/(o-1))*10,f>1&&(f=1),l=Math.sqrt(i.x*i.x+i.y*i.y),c=this.texture.height/2,i.x/=l,i.y/=l,i.x*=c,i.y*=c,s[a]=u.x+i.x,s[a+1]=u.y+i.y,s[a+2]=u.x-i.x,s[a+3]=u.y-i.y,n=u;t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.Rope.prototype.setTexture=function(e){this.texture=e},t.TilingSprite=function(e,n,r){t.Sprite.call(this,e),this._width=n||128,this._height=r||128,this.tileScale=new t.Point(1,1),this.tileScaleOffset=new t.Point(1,1),this.tilePosition=new t.Point,this.renderable=!0,this.tint=16777215,this.textureDebug=!1,this.blendMode=t.blendModes.NORMAL,this.canvasBuffer=null,this.tilingTexture=null,this.tilePattern=null,this.refreshTexture=!0,this.frameWidth=0,this.frameHeight=0},t.TilingSprite.prototype=Object.create(t.Sprite.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,t.TilingSprite.prototype.setTexture=function(e){this.texture!==e&&(this.texture=e,this.refreshTexture=!0,this.cachedTint=16777215)},t.TilingSprite.prototype._renderWebGL=function(e){if(!this.visible||!this.renderable||this.alpha===0)return;this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock));if(this.refreshTexture){this.generateTilingTexture(!0,e);if(!this.tilingTexture)return;this.tilingTexture.needsUpdate&&(e.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)}e.spriteBatch.renderTilingSprite(this);for(var t=0;t<this.children.length;t++)this.children[t]._renderWebGL(e);e.spriteBatch.stop(),this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this._mask,e),e.spriteBatch.start()},t.TilingSprite.prototype._renderCanvas=function(e){if(!this.visible||!this.renderable||this.alpha===0)return;var n=e.context;this._mask&&e.maskManager.pushMask(this._mask,e),n.globalAlpha=this.worldAlpha;var r=this.worldTransform,i=e.resolution;n.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*i,r.ty*i);if(this.refreshTexture){this.generateTilingTexture(!1,e);if(!this.tilingTexture)return;this.tilePattern=n.createPattern(this.tilingTexture.baseTexture.source,"repeat")}var s=e.currentBlendMode;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]);var o=this.tilePosition,u=this.tileScale;o.x%=this.tilingTexture.baseTexture.width,o.y%=this.tilingTexture.baseTexture.height,n.scale(u.x,u.y),n.translate(o.x+this.anchor.x*-this._width,o.y+this.anchor.y*-this._height),n.fillStyle=this.tilePattern;var a=-o.x,f=-o.y,l=this._width/u.x,c=this._height/u.y;e.roundPixels&&(a|=0,f|=0,l|=0,c|=0),n.fillRect(a,f,l,c),n.scale(1/u.x,1/u.y),n.translate(-o.x+this.anchor.x*this._width,-o.y+this.anchor.y*this._height),this._mask&&e.maskManager.popMask(e);for(var h=0;h<this.children.length;h++)this.children[h]._renderCanvas(e);s!==this.blendMode&&(e.currentBlendMode=s,n.globalCompositeOperation=t.blendModesCanvas[s])},t.TilingSprite.prototype.onTextureUpdate=function(){},t.TilingSprite.prototype.generateTilingTexture=function(e,n){if(!this.texture.baseTexture.hasLoaded)return;var r=this.texture,i=r.frame;console.log("generateTilingTexture",r,i);var s=this._frame.sourceSizeW,o=this._frame.sourceSizeH,u=0,a=0;this._frame.trimmed&&(u=this._frame.spriteSourceSizeX,a=this._frame.spriteSourceSizeY),e&&(s=t.getNextPowerOfTwo(s),o=t.getNextPowerOfTwo(o)),this.canvasBuffer?(this.canvasBuffer.resize(s,o),this.tilingTexture.baseTexture.width=s,this.tilingTexture.baseTexture.height=o,this.tilingTexture.needsUpdate=!0):(this.canvasBuffer=new t.CanvasBuffer(s,o),this.tilingTexture=t.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0,this.tilingTexture.needsUpdate=!0),this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,s,o));var f=r.crop.width,l=r.crop.height;if(f!==s||l!==o)f=s,l=o;this.canvasBuffer.context.drawImage(r.baseTexture.source,r.crop.x,r.crop.y,r.crop.width,r.crop.height,u,a,f,l),this.tileScaleOffset.x=i.width/s,this.tileScaleOffset.y=i.height/o,this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0},t.TilingSprite.prototype.getBounds=function(){var e=this._width,t=this._height,n=e*(1-this.anchor.x),r=e*-this.anchor.x,i=t*(1-this.anchor.y),s=t*-this.anchor.y,o=this.worldTransform,u=o.a,a=o.b,f=o.c,l=o.d,c=o.tx,h=o.ty,p=u*r+f*s+c,d=l*s+a*r+h,v=u*n+f*s+c,m=l*s+a*n+h,g=u*n+f*i+c,y=l*i+a*n+h,b=u*r+f*i+c,w=l*i+a*r+h,E=-Infinity,S=-Infinity,x=Infinity,T=Infinity;x=p<x?p:x,x=v<x?v:x,x=g<x?g:x,x=b<x?b:x,T=d<T?d:T,T=m<T?m:T,T=y<T?y:T,T=w<T?w:T,E=p>E?p:E,E=v>E?v:E,E=g>E?g:E,E=b>E?b:E,S=d>S?d:S,S=m>S?m:S,S=y>S?y:S,S=w>S?w:S;var N=this._bounds;return N.x=x,N.width=E-x,N.y=T,N.height=S-T,this._currentBounds=N,N},t.TilingSprite.prototype.destroy=function(){t.Sprite.prototype.destroy.call(this),this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},Object.defineProperty(t.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e}}),Object.defineProperty(t.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=t),exports.PIXI=t):typeof define!="undefined"&&define.amd?define("PIXI",function(){return e.PIXI=t}()):e.PIXI=t,t}.call(this),function(){function r(e,t){this._scaleFactor=e,this._deltaMode=t,this.originalEvent=null}var e=this,t=t||{VERSION:"2.4.6",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{}};Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Function.prototype.bind||(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function i(){var s=r.concat(e.call(arguments));n.apply(this instanceof i?this:t,s)}var n=this,r=e.call(arguments,1);if(typeof n!="function")throw new TypeError;return i.prototype=function s(e){e&&(s.prototype=e);if(!(this instanceof s))return new s}(n.prototype),i}}()),Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)=="[object Array]"}),Array.prototype.forEach||(Array.prototype.forEach=function(e){if(this===void 0||this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<n;i++)i in t&&e.call(r,t[i],i,t)});if(typeof window.Uint32Array!="function"&&typeof window.Uint32Array!="object"){var n=function(e){var t=new Array;window[e]=function(e){if(typeof e=="number"){Array.call(this,e),this.length=e;for(var t=0;t<this.length;t++)this[t]=0}else{Array.call(this,e.length),this.length=e.length;for(var t=0;t<this.length;t++)this[t]=e[t]}},window[e].prototype=t,window[e].constructor=window[e]};n("Uint32Array"),n("Int16Array")}window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),t.Utils={getProperty:function(e,t){var n=t.split("."),r=n.pop(),i=n.length,s=1,o=n[0];while(s<i&&(e=e[o]))o=n[s],s++;return e?e[r]:null},setProperty:function(e,t,n){var r=t.split("."),i=r.pop(),s=r.length,o=1,u=r[0];while(o<s&&(e=e[u]))u=r[o],o++;return e&&(e[i]=n),e},chanceRoll:function(e){return e===undefined&&(e=50),e>0&&Math.random()*100<=e},randomChoice:function(e,t){return Math.random()<.5?e:t},parseDimension:function(e,t){var n=0,r=0;return typeof e=="string"?e.substr(-1)==="%"?(n=parseInt(e,10)/100,t===0?r=window.innerWidth*n:r=window.innerHeight*n):r=parseInt(e,10):r=e,r},pad:function(e,t,n,r){if(t===undefined)var t=0;if(n===undefined)var n=" ";if(r===undefined)var r=3;var i=0;if(t+1>=e.length)switch(r){case 1:e=(new Array(t+1-e.length)).join(n)+e;break;case 3:var s=Math.ceil((i=t-e.length)/2),o=i-s;e=(new Array(o+1)).join(n)+e+(new Array(s+1)).join(n);break;default:e+=(new Array(t+1-e.length)).join(n)}return e},isPlainObject:function(e){if(typeof e!="object"||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!{}.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(t.Utils.isPlainObject(i)||(s=Array.isArray(i)))?(s?(s=!1,o=r&&Array.isArray(r)?r:[]):o=r&&t.Utils.isPlainObject(r)?r:{},u[n]=t.Utils.extend(l,o,i)):i!==undefined&&(u[n]=i)}return u},mixinPrototype:function(e,t,n){n===undefined&&(n=!1);var r=Object.keys(t);for(var i=0;i<r.length;i++){var s=r[i],o=t[s];if(!n&&s in e)continue;!o||typeof o.get!="function"&&typeof o.set!="function"?e[s]=o:typeof o.clone=="function"?e[s]=o.clone():Object.defineProperty(e,s,o)}},mixin:function(e,n){if(!e||typeof e!="object")return n;for(var r in e){var i=e[r];if(i.childNodes||i.cloneNode)continue;var s=typeof e[r];!e[r]||s!=="object"?n[r]=e[r]:typeof n[r]===s?n[r]=t.Utils.mixin(e[r],n[r]):n[r]=t.Utils.mixin(e[r],new i.constructor)}return n}},t.Circle=function(e,n,r){e=e||0,n=n||0,r=r||0,this.x=e,this.y=n,this._diameter=r,this._radius=0,r>0&&(this._radius=r*.5),this.type=t.CIRCLE},t.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},random:function(e){e===undefined&&(e=new t.Point);var n=2*Math.PI*Math.random(),r=Math.random()+Math.random(),i=r>1?2-r:r,s=i*Math.cos(n),o=i*Math.sin(n);return e.x=this.x+s*this.radius,e.y=this.y+o*this.radius,e},getBounds:function(){return new t.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(e,t,n){return this.x=e,this.y=t,this._diameter=n,this._radius=n*.5,this},copyFrom:function(e){return this.setTo(e.x,e.y,e.diameter)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.diameter=this._diameter,e},distance:function(e,n){var r=t.Math.distance(this.x,this.y,e.x,e.y);return n?Math.round(r):r},clone:function(e){return e===undefined||e===null?e=new t.Circle(this.x,this.y,this.diameter):e.setTo(this.x,this.y,this.diameter),e},contains:function(e,n){return t.Circle.contains(this,e,n)},circumferencePoint:function(e,n,r){return t.Circle.circumferencePoint(this,e,n,r)},offset:function(e,t){return this.x+=e,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},t.Circle.prototype.constructor=t.Circle,Object.defineProperty(t.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(e){e>0&&(this._diameter=e,this._radius=e*.5)}}),Object.defineProperty(t.Circle.prototype,"radius",{get:function(){return this._radius},set:function(e){e>0&&(this._radius=e,this._diameter=e*2)}}),Object.defineProperty(t.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(e){e>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-e}}),Object.defineProperty(t.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(e){e<this.x?(this._radius=0,this._diameter=0):this.radius=e-this.x}}),Object.defineProperty(t.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(e){e>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-e}}),Object.defineProperty(t.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(e){e<this.y?(this._radius=0,this._diameter=0):this.radius=e-this.y}}),Object.defineProperty(t.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(t.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(e){e===!0&&this.setTo(0,0,0)}}),t.Circle.contains=function(e,t,n){if(e.radius>0&&t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom){var r=(e.x-t)*(e.x-t),i=(e.y-n)*(e.y-n);return r+i<=e.radius*e.radius}return!1},t.Circle.equals=function(e,t){return e.x==t.x&&e.y==t.y&&e.diameter==t.diameter},t.Circle.intersects=function(e,n){return t.Math.distance(e.x,e.y,n.x,n.y)<=e.radius+n.radius},t.Circle.circumferencePoint=function(e,n,r,i){return r===undefined&&(r=!1),i===undefined&&(i=new t.Point),r===!0&&(n=t.Math.degToRad(n)),i.x=e.x+e.radius*Math.cos(n),i.y=e.y+e.radius*Math.sin(n),i},t.Circle.intersectsRectangle=function(e,t){var n=Math.abs(e.x-t.x-t.halfWidth),r=t.halfWidth+e.radius;if(n>r)return!1;var i=Math.abs(e.y-t.y-t.halfHeight),s=t.halfHeight+e.radius;if(i>s)return!1;if(n<=t.halfWidth||i<=t.halfHeight)return!0;var o=n-t.halfWidth,u=i-t.halfHeight,a=o*o,f=u*u,l=e.radius*e.radius;return a+f<=l},PIXI.Circle=t.Circle,t.Ellipse=function(e,n,r,i){e=e||0,n=n||0,r=r||0,i=i||0,this.x=e,this.y=n,this.width=r,this.height=i,this.type=t.ELLIPSE},t.Ellipse.prototype={setTo:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},getBounds:function(){return new t.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},clone:function(e){return e===undefined||e===null?e=new t.Ellipse(this.x,this.y,this.width,this.height):e.setTo(this.x,this.y,this.width,this.height),e},contains:function(e,n){return t.Ellipse.contains(this,e,n)},random:function(e){e===undefined&&(e=new t.Point);var n=Math.random()*Math.PI*2,r=Math.random();return e.x=Math.sqrt(r)*Math.cos(n),e.y=Math.sqrt(r)*Math.sin(n),e.x=this.x+e.x*this.width/2,e.y=this.y+e.y*this.height/2,e},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},t.Ellipse.prototype.constructor=t.Ellipse,Object.defineProperty(t.Ellipse.prototype,"left",{get:function(){return this.x},set:function(e){this.x=e}}),Object.defineProperty(t.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(e){e<this.x?this.width=0:this.width=e-this.x}}),Object.defineProperty(t.Ellipse.prototype,"top",{get:function(){return this.y},set:function(e){this.y=e}}),Object.defineProperty(t.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){e<this.y?this.height=0:this.height=e-this.y}}),Object.defineProperty(t.Ellipse.prototype,"empty",{get:function(){return this.width===0||this.height===0},set:function(e){e===!0&&this.setTo(0,0,0,0)}}),t.Ellipse.contains=function(e,t,n){if(e.width<=0||e.height<=0)return!1;var r=(t-e.x)/e.width-.5,i=(n-e.y)/e.height-.5;return r*=r,i*=i,r+i<.25},PIXI.Ellipse=t.Ellipse,t.Line=function(e,n,r,i){e=e||0,n=n||0,r=r||0,i=i||0,this.start=new t.Point(e,n),this.end=new t.Point(r,i),this.type=t.LINE},t.Line.prototype={setTo:function(e,t,n,r){return this.start.setTo(e,t),this.end.setTo(n,r),this},fromSprite:function(e,t,n){return n===undefined&&(n=!1),n?this.setTo(e.center.x,e.center.y,t.center.x,t.center.y):this.setTo(e.x,e.y,t.x,t.y)},fromAngle:function(e,t,n,r){return this.start.setTo(e,t),this.end.setTo(e+Math.cos(n)*r,t+Math.sin(n)*r),this},rotate:function(e,t){var n=(this.start.x+this.end.x)/2,r=(this.start.y+this.end.y)/2;return this.start.rotate(n,r,e,t),this.end.rotate(n,r,e,t),this},rotateAround:function(e,t,n,r){return this.start.rotate(e,t,n,r),this.end.rotate(e,t,n,r),this},intersects:function(e,n,r){return t.Line.intersectsPoints(this.start,this.end,e.start,e.end,n,r)},reflect:function(e){return t.Line.reflect(this,e)},midPoint:function(e){return e===undefined&&(e=new t.Point),e.x=(this.start.x+this.end.x)/2,e.y=(this.start.y+this.end.y)/2,e},centerOn:function(e,t){var n=(this.start.x+this.end.x)/2,r=(this.start.y+this.end.y)/2,i=e-n,s=t-r;this.start.add(i,s),this.end.add(i,s)},pointOnLine:function(e,t){return(e-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(t-this.start.y)},pointOnSegment:function(e,t){var n=Math.min(this.start.x,this.end.x),r=Math.max(this.start.x,this.end.x),i=Math.min(this.start.y,this.end.y),s=Math.max(this.start.y,this.end.y);return this.pointOnLine(e,t)&&e>=n&&e<=r&&t>=i&&t<=s},random:function(e){e===undefined&&(e=new t.Point);var n=Math.random();return e.x=this.start.x+n*(this.end.x-this.start.x),e.y=this.start.y+n*(this.end.y-this.start.y),e},coordinatesOnLine:function(e,t){e===undefined&&(e=1),t===undefined&&(t=[]);var n=Math.round(this.start.x),r=Math.round(this.start.y),i=Math.round(this.end.x),s=Math.round(this.end.y),o=Math.abs(i-n),u=Math.abs(s-r),a=n<i?1:-1,f=r<s?1:-1,l=o-u;t.push([n,r]);var c=1;while(n!=i||r!=s){var h=l<<1;h>-u&&(l-=u,n+=a),h<o&&(l+=o,r+=f),c%e===0&&t.push([n,r]),c++}return t},clone:function(e){return e===undefined||e===null?e=new t.Line(this.start.x,this.start.y,this.end.x,this.end.y):e.setTo(this.start.x,this.start.y,this.end.x,this.end.y),e}},Object.defineProperty(t.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(t.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(t.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(t.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}}),Object.defineProperty(t.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(t.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(t.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(t.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(t.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(t.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(t.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(t.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),Object.defineProperty(t.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}}),Object.defineProperty(t.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}}),Object.defineProperty(t.Line.prototype,"normalAngle",{get:function(){return t.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}}),t.Line.intersectsPoints=function(e,n,r,i,s,o){s===undefined&&(s=!0),o===undefined&&(o=new t.Point);var u=n.y-e.y,a=i.y-r.y,f=e.x-n.x,l=r.x-i.x,c=n.x*e.y-e.x*n.y,h=i.x*r.y-r.x*i.y,p=u*l-a*f;if(p===0)return null;o.x=(f*h-l*c)/p,o.y=(a*c-u*h)/p;if(s){var d=(i.y-r.y)*(n.x-e.x)-(i.x-r.x)*(n.y-e.y),v=((i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x))/d,m=((n.x-e.x)*(e.y-r.y)-(n.y-e.y)*(e.x-r.x))/d;return v>=0&&v<=1&&m>=0&&m<=1?o:null}return o},t.Line.intersects=function(e,n,r,i){return t.Line.intersectsPoints(e.start,e.end,n.start,n.end,r,i)},t.Line.reflect=function(e,t){return 2*t.normalAngle-3.141592653589793-e.angle},t.Matrix=function(e,n,r,i,s,o){e=e||1,n=n||0,r=r||0,i=i||1,s=s||0,o=o||0,this.a=e,this.b=n,this.c=r,this.d=i,this.tx=s,this.ty=o,this.type=t.MATRIX},t.Matrix.prototype={fromArray:function(e){return this.setTo(e[0],e[1],e[3],e[4],e[2],e[5])},setTo:function(e,t,n,r,i,s){return this.a=e,this.b=t,this.c=n,this.d=r,this.tx=i,this.ty=s,this},clone:function(e){return e===undefined||e===null?e=new t.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty),e},copyTo:function(e){return e.copyFrom(this),e},copyFrom:function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},toArray:function(e,t){return t===undefined&&(t=new PIXI.Float32Array(9)),e?(t[0]=this.a,t[1]=this.b,t[2]=0,t[3]=this.c,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.c,t[2]=this.tx,t[3]=this.b,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t},apply:function(e,n){return n===undefined&&(n=new t.Point),n.x=this.a*e.x+this.c*e.y+this.tx,n.y=this.b*e.x+this.d*e.y+this.ty,n},applyInverse:function(e,n){n===undefined&&(n=new t.Point);var r=1/(this.a*this.d+this.c*-this.b),i=e.x,s=e.y;return n.x=this.d*r*i+ -this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,n.y=this.a*r*s+ -this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,n},translate:function(e,t){return this.tx+=e,this.ty+=t,this},scale:function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.a,i=this.c,s=this.tx;return this.a=r*t-this.b*n,this.b=r*n+this.b*t,this.c=i*t-this.d*n,this.d=i*n+this.d*t,this.tx=s*t-this.ty*n,this.ty=s*n+this.ty*t,this},append:function(e){var t=this.a,n=this.b,r=this.c,i=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*n+e.b*i,this.c=e.c*t+e.d*r,this.d=e.c*n+e.d*i,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*n+e.ty*i+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}},t.identityMatrix=new t.Matrix,PIXI.Matrix=t.Matrix,PIXI.identityMatrix=t.identityMatrix,t.Point=function(e,n){e=e||0,n=n||0,this.x=e,this.y=n,this.type=t.POINT},t.Point.prototype={copyFrom:function(e){return this.setTo(e.x,e.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(e,t){return this.x=e||0,this.y=t||(t!==0?this.x:0),this},set:function(e,t){return this.x=e||0,this.y=t||(t!==0?this.x:0),this},add:function(e,t){return this.x+=e,this.y+=t,this},subtract:function(e,t){return this.x-=e,this.y-=t,this},multiply:function(e,t){return this.x*=e,this.y*=t,this},divide:function(e,t){return this.x/=e,this.y/=t,this},clampX:function(e,n){return this.x=t.Math.clamp(this.x,e,n),this},clampY:function(e,n){return this.y=t.Math.clamp(this.y,e,n),this},clamp:function(e,n){return this.x=t.Math.clamp(this.x,e,n),this.y=t.Math.clamp(this.y,e,n),this},clone:function(e){return e===undefined||e===null?e=new t.Point(this.x,this.y):e.setTo(this.x,this.y),e},copyTo:function(e){return e.x=this.x,e.y=this.y,e},distance:function(e,n){return t.Point.distance(this,e,n)},equals:function(e){return e.x===this.x&&e.y===this.y},angle:function(e,n){return n===undefined&&(n=!1),n?t.Math.radToDeg(Math.atan2(e.y-this.y,e.x-this.x)):Math.atan2(e.y-this.y,e.x-this.x)},rotate:function(e,n,r,i,s){return t.Point.rotate(this,e,n,r,i,s)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(e){return this.normalize().multiply(e,e)},normalize:function(){if(!this.isZero()){var e=this.getMagnitude();this.x/=e,this.y/=e}return this},isZero:function(){return this.x===0&&this.y===0},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},t.Point.prototype.constructor=t.Point,t.Point.add=function(e,n,r){return r===undefined&&(r=new t.Point),r.x=e.x+n.x,r.y=e.y+n.y,r},t.Point.subtract=function(e,n,r){return r===undefined&&(r=new t.Point),r.x=e.x-n.x,r.y=e.y-n.y,r},t.Point.multiply=function(e,n,r){return r===undefined&&(r=new t.Point),r.x=e.x*n.x,r.y=e.y*n.y,r},t.Point.divide=function(e,n,r){return r===undefined&&(r=new t.Point),r.x=e.x/n.x,r.y=e.y/n.y,r},t.Point.equals=function(e,t){return e.x===t.x&&e.y===t.y},t.Point.angle=function(e,t){return Math.atan2(e.y-t.y,e.x-t.x)},t.Point.negative=function(e,n){return n===undefined&&(n=new t.Point),n.setTo(-e.x,-e.y)},t.Point.multiplyAdd=function(e,n,r,i){return i===undefined&&(i=new t.Point),i.setTo(e.x+n.x*r,e.y+n.y*r)},t.Point.interpolate=function(e,n,r,i){return i===undefined&&(i=new t.Point),i.setTo(e.x+(n.x-e.x)*r,e.y+(n.y-e.y)*r)},t.Point.perp=function(e,n){return n===undefined&&(n=new t.Point),n.setTo(-e.y,e.x)},t.Point.rperp=function(e,n){return n===undefined&&(n=new t.Point),n.setTo(e.y,-e.x)},t.Point.distance=function(e,n,r){var i=t.Math.distance(e.x,e.y,n.x,n.y);return r?Math.round(i):i},t.Point.project=function(e,n,r){r===undefined&&(r=new t.Point);var i=e.dot(n)/n.getMagnitudeSq();return i!==0&&r.setTo(i*n.x,i*n.y),r},t.Point.projectUnit=function(e,n,r){r===undefined&&(r=new t.Point);var i=e.dot(n);return i!==0&&r.setTo(i*n.x,i*n.y),r},t.Point.normalRightHand=function(e,n){return n===undefined&&(n=new t.Point),n.setTo(e.y*-1,e.x)},t.Point.normalize=function(e,n){n===undefined&&(n=new t.Point);var r=e.getMagnitude();return r!==0&&n.setTo(e.x/r,e.y/r),n},t.Point.rotate=function(e,n,r,i,s,o){s&&(i=t.Math.degToRad(i));if(o===undefined){e.subtract(n,r);var u=Math.sin(i),a=Math.cos(i),f=a*e.x-u*e.y,l=u*e.x+a*e.y;e.x=f+n,e.y=l+r}else{var c=i+Math.atan2(e.y-r,e.x-n);e.x=n+o*Math.cos(c),e.y=r+o*Math.sin(c)}return e},t.Point.centroid=function(e,n){n===undefined&&(n=new t.Point);if(Object.prototype.toString.call(e)!=="[object Array]")throw new Error("Phaser.Point. Parameter 'points' must be an array");var r=e.length;if(r<1)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(r===1)return n.copyFrom(e[0]),n;for(var i=0;i<r;i++)t.Point.add(n,e[i],n);return n.divide(r,r),n},t.Point.parse=function(e,n,r){n=n||"x",r=r||"y";var i=new t.Point;return e[n]&&(i.x=parseInt(e[n],10)),e[r]&&(i.y=parseInt(e[r],10)),i},PIXI.Point=t.Point,t.Polygon=function(){this.area=0,this._points=[],arguments.length>0&&this.setTo.apply(this,arguments),this.closed=!0,this.type=t.POLYGON},t.Polygon.prototype={toNumberArray:function(e){e===undefined&&(e=[]);for(var t=0;t<this._points.length;t++)typeof this._points[t]=="number"?(e.push(this._points[t]),e.push(this._points[t+1]),t++):(e.push(this._points[t].x),e.push(this._points[t].y));return e},flatten:function(){return this._points=this.toNumberArray(),this},clone:function(e){var n=this._points.slice();return e===undefined||e===null?e=new t.Polygon(n):e.setTo(n),e},contains:function(e,t){var n=this._points.length,r=!1;for(var i=-1,s=n-1;++i<n;s=i){var o=this._points[i].x,u=this._points[i].y,a=this._points[s].x,f=this._points[s].y;(u<=t&&t<f||f<=t&&t<u)&&e<(a-o)*(t-u)/(f-u)+o&&(r=!r)}return r},setTo:function(e){this.area=0,this._points=[];if(arguments.length>0){Array.isArray(e)||(e=Array.prototype.slice.call(arguments));var t=Number.MAX_VALUE;for(var n=0,r=e.length;n<r;n++){if(typeof e[n]=="number"){var i=new PIXI.Point(e[n],e[n+1]);n++}else var i=new PIXI.Point(e[n].x,e[n].y);this._points.push(i),i.y<t&&(t=i.y)}this.calculateArea(t)}return this},calculateArea:function(e){var t,n,r,i;for(var s=0,o=this._points.length;s<o;s++)t=this._points[s],s===o-1?n=this._points[0]:n=this._points[s+1],r=(t.y-e+(n.y-e))/2,i=t.x-n.x,this.area+=r*i;return this.area}},t.Polygon.prototype.constructor=t.Polygon,Object.defineProperty(t.Polygon.prototype,"points",{get:function(){return this._points},set:function(e){e!=null?this.setTo(e):this.setTo()}}),PIXI.Polygon=t.Polygon,t.Rectangle=function(e,n,r,i){e=e||0,n=n||0,r=r||0,i=i||0,this.x=e,this.y=n,this.width=r,this.height=i,this.type=t.RECTANGLE},t.Rectangle.prototype={offset:function(e,t){return this.x+=e,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},setTo:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},scale:function(e,t){return t===undefined&&(t=e),this.width*=e,this.height*=t,this},centerOn:function(e,t){return this.centerX=e,this.centerY=t,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},inflate:function(e,n){return t.Rectangle.inflate(this,e,n)},size:function(e){return t.Rectangle.size(this,e)},resize:function(e,t){return this.width=e,this.height=t,this},clone:function(e){return t.Rectangle.clone(this,e)},contains:function(e,n){return t.Rectangle.contains(this,e,n)},containsRect:function(e){return t.Rectangle.containsRect(e,this)},equals:function(e){return t.Rectangle.equals(this,e)},intersection:function(e,n){return t.Rectangle.intersection(this,e,n)},intersects:function(e){return t.Rectangle.intersects(this,e)},intersectsRaw:function(e,n,r,i,s){return t.Rectangle.intersectsRaw(this,e,n,r,i,s)},union:function(e,n){return t.Rectangle.union(this,e,n)},random:function(e){return e===undefined&&(e=new t.Point),e.x=this.randomX,e.y=this.randomY,e},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(t.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(t.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(t.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){e<=this.y?this.height=0:this.height=e-this.y}}),Object.defineProperty(t.Rectangle.prototype,"bottomLeft",{get:function(){return new t.Point(this.x,this.bottom)},set:function(e){this.x=e.x,this.bottom=e.y}}),Object.defineProperty(t.Rectangle.prototype,"bottomRight",{get:function(){return new t.Point(this.right,this.bottom)},set:function(e){this.right=e.x,this.bottom=e.y}}),Object.defineProperty(t.Rectangle.prototype,"left",{get:function(){return this.x},set:function(e){e>=this.right?this.width=0:this.width=this.right-e,this.x=e}}),Object.defineProperty(t.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(e){e<=this.x?this.width=0:this.width=e-this.x}}),Object.defineProperty(t.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(t.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}}),Object.defineProperty(t.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(e){this.x=e-this.halfWidth}}),Object.defineProperty(t.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(e){this.y=e-this.halfHeight}}),Object.defineProperty(t.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(t.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(t.Rectangle.prototype,"top",{get:function(){return this.y},set:function(e){e>=this.bottom?(this.height=0,this.y=e):this.height=this.bottom-e}}),Object.defineProperty(t.Rectangle.prototype,"topLeft",{get:function(){return new t.Point(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}}),Object.defineProperty(t.Rectangle.prototype,"topRight",{get:function(){return new t.Point(this.x+this.width,this.y)},set:function(e){this.right=e.x,this.y=e.y}}),Object.defineProperty(t.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(e){e===!0&&this.setTo(0,0,0,0)}}),t.Rectangle.prototype.constructor=t.Rectangle,t.Rectangle.inflate=function(e,t,n){return e.x-=t,e.width+=2*t,e.y-=n,e.height+=2*n,e},t.Rectangle.inflatePoint=function(e,n){return t.Rectangle.inflate(e,n.x,n.y)},t.Rectangle.size=function(e,n){return n===undefined||n===null?n=new t.Point(e.width,e.height):n.setTo(e.width,e.height),n},t.Rectangle.clone=function(e,n){return n===undefined||n===null?n=new t.Rectangle(e.x,e.y,e.width,e.height):n.setTo(e.x,e.y,e.width,e.height),n},t.Rectangle.contains=function(e,t,n){return e.width<=0||e.height<=0?!1:t>=e.x&&t<e.right&&n>=e.y&&n<e.bottom},t.Rectangle.containsRaw=function(e,t,n,r,i,s){return i>=e&&i<e+n&&s>=t&&s<t+r},t.Rectangle.containsPoint=function(e,n){return t.Rectangle.contains(e,n.x,n.y)},t.Rectangle.containsRect=function(e,t){return e.volume>t.volume?!1:e.x>=t.x&&e.y>=t.y&&e.right<t.right&&e.bottom<t.bottom},t.Rectangle.equals=function(e,t){return e.x==t.x&&e.y==t.y&&e.width==t.width&&e.height==t.height},t.Rectangle.sameDimensions=function(e,t){return e.width===t.width&&e.height===t.height},t.Rectangle.intersection=function(e,n,r){return r===undefined&&(r=new t.Rectangle),t.Rectangle.intersects(e,n)&&(r.x=Math.max(e.x,n.x),r.y=Math.max(e.y,n.y),r.width=Math.min(e.right,n.right)-r.x,r.height=Math.min(e.bottom,n.bottom)-r.y),r},t.Rectangle.intersects=function(e,t){return e.width<=0||e.height<=0||t.width<=0||t.height<=0?!1:!(e.right<t.x||e.bottom<t.y||e.x>t.right||e.y>t.bottom)},t.Rectangle.intersectsRaw=function(e,t,n,r,i,s){return s===undefined&&(s=0),!(t>e.right+s||n<e.left-s||r>e.bottom+s||i<e.top-s)},t.Rectangle.union=function(e,n,r){return r===undefined&&(r=new t.Rectangle),r.setTo(Math.min(e.x,n.x),Math.min(e.y,n.y),Math.max(e.right,n.right)-Math.min(e.left,n.left),Math.max(e.bottom,n.bottom)-Math.min(e.top,n.top))},t.Rectangle.aabb=function(e,n){n===undefined&&(n=new t.Rectangle);var r=Number.MIN_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MAX_VALUE;return e.forEach(function(e){e.x>r&&(r=e.x),e.x<i&&(i=e.x),e.y>s&&(s=e.y),e.y<o&&(o=e.y)}),n.setTo(i,o,r-i,s-o),n},PIXI.Rectangle=t.Rectangle,PIXI.EmptyRectangle=new t.Rectangle(0,0,0,0),t.RoundedRectangle=function(e,n,r,i,s){e===undefined&&(e=0),n===undefined&&(n=0),r===undefined&&(r=0),i===undefined&&(i=0),s===undefined&&(s=20),this.x=e,this.y=n,this.width=r,this.height=i,this.radius=s||20,this.type=t.ROUNDEDRECTANGLE},t.RoundedRectangle.prototype={clone:function(){return new t.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1}},t.RoundedRectangle.prototype.constructor=t.RoundedRectangle,PIXI.RoundedRectangle=t.RoundedRectangle,t.Camera=function(e,n,r,i,s,o){this.game=e,this.world=e.world,this.id=0,this.view=new t.Rectangle(r,i,s,o),this.bounds=new t.Rectangle(r,i,s,o),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this.displayObject=null,this.scale=null,this.totalInView=0,this._targetPosition=new t.Point,this._edge=0,this._position=new t.Point},t.Camera.FOLLOW_LOCKON=0,t.Camera.FOLLOW_PLATFORMER=1,t.Camera.FOLLOW_TOPDOWN=2,t.Camera.FOLLOW_TOPDOWN_TIGHT=3,t.Camera.prototype={preUpdate:function(){this.totalInView=0},follow:function(e,n){n===undefined&&(n=t.Camera.FOLLOW_LOCKON),this.target=e;var r;switch(n){case t.Camera.FOLLOW_PLATFORMER:var i=this.width/8,s=this.height/3;this.deadzone=new t.Rectangle((this.width-i)/2,(this.height-s)/2-s*.25,i,s);break;case t.Camera.FOLLOW_TOPDOWN:r=Math.max(this.width,this.height)/4,this.deadzone=new t.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case t.Camera.FOLLOW_TOPDOWN_TIGHT:r=Math.max(this.width,this.height)/8,this.deadzone=new t.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case t.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(e){this.setPosition(Math.round(e.x-this.view.halfWidth),Math.round(e.y-this.view.halfHeight))},focusOnXY:function(e,t){this.setPosition(Math.round(e-this.view.halfWidth),Math.round(t-this.view.halfHeight))},update:function(){this.target&&this.updateTarget(),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target),this.target.parent&&this._targetPosition.multiply(this.target.parent.worldTransform.a,this.target.parent.worldTransform.d),this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this._targetPosition.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this._targetPosition.x-this.deadzone.right),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this._targetPosition.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this._targetPosition.y-this.deadzone.bottom)):(this.view.x=this._targetPosition.x-this.view.halfWidth,this.view.y=this._targetPosition.y-this.view.halfHeight)},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1,this.view.x<=this.bounds.x*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x),this.view.right>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width),this.view.y<=this.bounds.top*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y),this.view.bottom>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height)},setPosition:function(e,t){this.view.x=e,this.view.y=t,this.bounds&&this.checkBounds()},setSize:function(e,t){this.view.width=e,this.view.height=t},reset:function(){this.target=null,this.view.x=0,this.view.y=0}},t.Camera.prototype.constructor=t.Camera,Object.defineProperty(t.Camera.prototype,"x",{get:function(){return this.view.x},set:function(e){this.view.x=e,this.bounds&&this.checkBounds()}}),Object.defineProperty(t.Camera.prototype,"y",{get:function(){return this.view.y},set:function(e){this.view.y=e,this.bounds&&this.checkBounds()}}),Object.defineProperty(t.Camera.prototype,"position",{get:function(){return this._position.set(this.view.centerX,this.view.centerY),this._position},set:function(e){typeof e.x!="undefined"&&(this.view.x=e.x),typeof e.y!="undefined"&&(this.view.y=e.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(t.Camera.prototype,"width",{get:function(){return this.view.width},set:function(e){this.view.width=e}}),Object.defineProperty(t.Camera.prototype,"height",{get:function(){return this.view.height},set:function(e){this.view.height=e}}),t.State=function(){this.game=null,this.key="",this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},t.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}},t.State.prototype.constructor=t.State,t.StateManager=function(e,n){this.game=e,this.states={},this._pendingState=null,typeof n!="undefined"&&n!==null&&(this._pendingState=n),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onStateChange=new t.Signal,this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},t.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),this._pendingState!==null&&typeof this._pendingState!="string"&&this.add("default",this._pendingState,!0)},add:function(e,n,r){r===undefined&&(r=!1);var i;return n instanceof t.State?i=n:typeof n=="object"?(i=n,i.game=this.game):typeof n=="function"&&(i=new n(this.game)),this.states[e]=i,r&&(this.game.isBooted?this.start(e):this._pendingState=e),i},remove:function(e){this.current===e&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[e]},start:function(e,t,n){t===undefined&&(t=!0),n===undefined&&(n=!1),this.checkState(e)&&(this._pendingState=e,this._clearWorld=t,this._clearCache=n,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(e,t){e===undefined&&(e=!0),t===undefined&&(t=!1),this._pendingState=this.current,this._clearWorld=e,this._clearCache=t,arguments.length>2&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var e=this.current;this.clearCurrentState(),this.setCurrentState(this._pendingState),this.onStateChange.dispatch(this.current,e);if(this.current!==this._pendingState)return;this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(e){return this.states[e]?this.states[e].preload||this.states[e].create||this.states[e].update||this.states[e].render?!0:(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):(console.warn("Phaser.StateManager - No state found with the key: "+e),!1)},link:function(e){this.states[e].game=this.game,this.states[e].add=this.game.add,this.states[e].make=this.game.make,this.states[e].camera=this.game.camera,this.states[e].cache=this.game.cache,this.states[e].input=this.game.input,this.states[e].load=this.game.load,this.states[e].math=this.game.math,this.states[e].sound=this.game.sound,this.states[e].scale=this.game.scale,this.states[e].state=this,this.states[e].stage=this.game.stage,this.states[e].time=this.game.time,this.states[e].tweens=this.game.tweens,this.states[e].world=this.game.world,this.states[e].particles=this.game.particles,this.states[e].rnd=this.game.rnd,this.states[e].physics=this.game.physics,this.states[e].key=e},unlink:function(e){this.states[e]&&(this.states[e].game=null,this.states[e].add=null,this.states[e].make=null,this.states[e].camera=null,this.states[e].cache=null,this.states[e].input=null,this.states[e].load=null,this.states[e].math=null,this.states[e].sound=null,this.states[e].scale=null,this.states[e].state=null,this.states[e].stage=null,this.states[e].time=null,this.states[e].tweens=null,this.states[e].world=null,this.states[e].particles=null,this.states[e].rnd=null,this.states[e].physics=null)},setCurrentState:function(e){this.callbackContext=this.states[e],this.link(e),this.onInitCallback=this.states[e].init||this.dummy,this.onPreloadCallback=this.states[e].preload||null,this.onLoadRenderCallback=this.states[e].loadRender||null,this.onLoadUpdateCallback=this.states[e].loadUpdate||null,this.onCreateCallback=this.states[e].create||null,this.onUpdateCallback=this.states[e].update||null,this.onPreRenderCallback=this.states[e].preRender||null,this.onRenderCallback=this.states[e].render||null,this.onResizeCallback=this.states[e].resize||null,this.onPausedCallback=this.states[e].paused||null,this.onResumedCallback=this.states[e].resumed||null,this.onPauseUpdateCallback=this.states[e].pauseUpdate||null,this.onShutDownCallback=this.states[e].shutdown||this.dummy,this.current!==""&&this.game.physics.reset(),this.current=e,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),e===this._pendingState&&(this._args=[]),this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game),this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(e){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,e)},resize:function(e,t){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,e,t)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===t.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearWorld=!0,this._clearCache=!0,this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null,this.current=""}},t.StateManager.prototype.constructor=t.StateManager,Object.defineProperty(t.StateManager.prototype,"created",{get:function(){return this._created}}),t.Signal=function(){},t.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(e,t){if(typeof e!="function")throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(e,n,r,i,s){var o=this._indexOfListener(e,r),u;if(o!==-1){u=this._bindings[o];if(u.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else u=new t.SignalBinding(this,e,n,r,i,s),this._addBinding(u);return this.memorize&&this._prevParams&&u.execute(this._prevParams),u},_addBinding:function(e){this._bindings||(this._bindings=[]);var t=this._bindings.length;do t--;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){if(!this._bindings)return-1;t===undefined&&(t=null);var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,n){this.validateListener(e,"add");var r=[];if(arguments.length>3)for(var i=3;i<arguments.length;i++)r.push(arguments[i]);return this._registerListener(e,!1,t,n,r)},addOnce:function(e,t,n){this.validateListener(e,"addOnce");var r=[];if(arguments.length>3)for(var i=3;i<arguments.length;i++)r.push(arguments[i]);return this._registerListener(e,!0,t,n,r)},remove:function(e,t){this.validateListener(e,"remove");var n=this._indexOfListener(e,t);return n!==-1&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(e){e===undefined&&(e=null);if(!this._bindings)return;var t=this._bindings.length;while(t--)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(!this.active||!this._bindings)return;var e=Array.prototype.slice.call(arguments),t=this._bindings.length,n;this.memorize&&(this._prevParams=e);if(!t)return;n=this._bindings.slice(),this._shouldPropagate=!0;do t--;while(n[t]&&this._shouldPropagate&&n[t].execute(e)!==!1)},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(t.Signal.prototype,"boundDispatch",{get:function(){var e=this;return this._boundDispatch||(this._boundDispatch=function(){return e.dispatch.apply(e,arguments)})}}),t.Signal.prototype.constructor=t.Signal,t.SignalBinding=function(e,t,n,r,i,s){this._listener=t,n&&(this._isOnce=!0),r!=null&&(this.context=r),this._signal=e,i&&(this._priority=i),s&&s.length&&(this._args=s)},t.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,this._args&&(n=n.concat(this._args)),t=this._listener.apply(this.context,n),this.callCount++,this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},t.SignalBinding.prototype.constructor=t.SignalBinding,t.Filter=function(e,n,r){this.game=e,this.type=t.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new t.Point;var i=new Date;this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours()*60*60+i.getMinutes()*60+i.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}};if(n)for(var s in n)this.uniforms[s]=n[s];this.fragmentSrc=r||""},t.Filter.prototype={init:function(){},setResolution:function(e,t){this.uniforms.resolution.value.x=e,this.uniforms.resolution.value.y=t},update:function(e){if(typeof e!="undefined"){var t=e.x/this.game.width,n=1-e.y/this.game.height;if(t!==this.prevPoint.x||n!==this.prevPoint.y)this.uniforms.mouse.value.x=t.toFixed(2),this.uniforms.mouse.value.y=n.toFixed(2),this.prevPoint.set(t,n)}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(e,t,n,r,i,s){i===undefined&&(i=0),s===undefined&&(s=0),n!==undefined&&n!==null?this.width=n:n=this.width,r!==undefined&&r!==null?this.height=r:r=this.height;var o=this.game.add.image(e,t,"__default");return o.width=n,o.height=r,o.anchor.set(i,s),o.filters=[this],o},destroy:function(){this.game=null}},t.Filter.prototype.constructor=t.Filter,Object.defineProperty(t.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(e){this.uniforms.resolution.value.x=e}}),Object.defineProperty(t.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(e){this.uniforms.resolution.value.y=e}}),t.Plugin=function(e,t){t===undefined&&(t=null),this.game=e,this.parent=t,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},t.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},t.Plugin.prototype.constructor=t.Plugin,t.PluginManager=function(e){this.game=e,this.plugins=[],this._len=0,this._i=0},t.PluginManager.prototype={add:function(e){var t=Array.prototype.slice.call(arguments,1),n=!1;typeof e=="function"?e=new e(this.game,this):(e.game=this.game,e.parent=this),typeof e["preUpdate"]=="function"&&(e.hasPreUpdate=!0,n=!0),typeof e["update"]=="function"&&(e.hasUpdate=!0,n=!0),typeof e["postUpdate"]=="function"&&(e.hasPostUpdate=!0,n=!0),typeof e["render"]=="function"&&(e.hasRender=!0,n=!0),typeof e["postRender"]=="function"&&(e.hasPostRender=!0,n=!0);if(n){if(e.hasPreUpdate||e.hasUpdate||e.hasPostUpdate)e.active=!0;if(e.hasRender||e.hasPostRender)e.visible=!0;return this._len=this.plugins.push(e),typeof e["init"]=="function"&&e.init.apply(e,t),e}return null},remove:function(e){this._i=this._len;while(this._i--)if(this.plugins[this._i]===e){e.destroy(),this.plugins.splice(this._i,1),this._len--;return}},removeAll:function(){this._i=this._len;while(this._i--)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){this._i=this._len;while(this._i--)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){this._i=this._len;while(this._i--)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){this._i=this._len;while(this._i--)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){this._i=this._len;while(this._i--)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){this._i=this._len;while(this._i--)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},t.PluginManager.prototype.constructor=t.PluginManager,t.Stage=function(e){this.game=e,PIXI.DisplayObjectContainer.call(this),this.name="_stage_root",this.disableVisibilityChange=!1,this.exists=!0,this.worldTransform=new PIXI.Matrix,this.stage=this,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._onChange=null,this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"},this.game.transparent||(this._bgColor.a=1),e.config&&this.parseConfig(e.config)},t.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.parseConfig=function(e){e.disableVisibilityChange&&(this.disableVisibilityChange=e.disableVisibilityChange),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor)},t.Stage.prototype.boot=function(){t.DOM.getOffset(this.game.canvas,this.offset),t.Canvas.setUserSelect(this.game.canvas,"none"),t.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},t.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var e=0;e<this.children.length;e++)this.children[e].preUpdate()},t.Stage.prototype.update=function(){var e=this.children.length;while(e--)this.children[e].update()},t.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate(),this.game.world.camera.update();var e=this.children.length;while(e--)this.children[e]!==this.game.world.camera.target&&this.children[e].postUpdate()}else{this.game.world.camera.update();var e=this.children.length;while(e--)this.children[e].postUpdate()}},t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform()},t.Stage.prototype.checkVisibility=function(){document.webkitHidden!==undefined?this._hiddenVar="webkitvisibilitychange":document.mozHidden!==undefined?this._hiddenVar="mozvisibilitychange":document.msHidden!==undefined?this._hiddenVar="msvisibilitychange":document.hidden!==undefined?this._hiddenVar="visibilitychange":this._hiddenVar=null;var e=this;this._onChange=function(t){return e.visibilityChange(t)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){t.Stage.prototype.visibilityChange.call(e,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){t.Stage.prototype.visibilityChange.call(e,{type:"resume"})}))},t.Stage.prototype.visibilityChange=function(e){if(e.type==="pagehide"||e.type==="blur"||e.type==="pageshow"||e.type==="focus"){e.type==="pagehide"||e.type==="blur"?this.game.focusLoss(e):(e.type==="pageshow"||e.type==="focus")&&this.game.focusGain(e);return}if(this.disableVisibilityChange)return;document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||e.type==="pause"?this.game.gamePaused(e):this.game.gameResumed(e)},t.Stage.prototype.setBackgroundColor=function(e){if(this.game.transparent)return;t.Color.valueToColor(e,this._bgColor),t.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1},t.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null},Object.defineProperty(t.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(e){this.setBackgroundColor(e)}}),Object.defineProperty(t.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(e){e?PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR:PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST}}),t.Group=function(e,n,r,i,s,o){i===undefined&&(i=!1),s===undefined&&(s=!1),o===undefined&&(o=t.Physics.ARCADE),this.game=e,n===undefined&&(n=e.world),this.name=r||"group",this.z=0,PIXI.DisplayObjectContainer.call(this),i?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):n&&(n.addChild(this),this.z=n.children.length),this.type=t.GROUP,this.physicsType=t.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.pendingDestroy=!1,this.classType=t.Sprite,this.cursor=null,this.enableBody=s,this.enableBodyDebug=!1,this.physicsBodyType=o,this.physicsSortDirection=null,this.onDestroy=new t.Signal,this.cursorIndex=0,this.fixedToCamera=!1,this.cameraOffset=new t.Point,this.hash=[],this._sortProperty="z"},t.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),t.Group.prototype.constructor=t.Group,t.Group.RETURN_NONE=0,t.Group.RETURN_TOTAL=1,t.Group.RETURN_CHILD=2,t.Group.SORT_ASCENDING=-1,t.Group.SORT_DESCENDING=1,t.Group.prototype.add=function(e,t){return t===undefined&&(t=!1),e.parent!==this&&(e.body&&e.parent&&e.parent.removeFromHash(e),e.z=this.children.length,this.addChild(e),this.enableBody&&e.body===null?this.game.physics.enable(e,this.physicsBodyType):e.body&&this.addToHash(e),!t&&e.events&&e.events.onAddedToGroup$dispatch(e,this),this.cursor===null&&(this.cursor=e)),e},t.Group.prototype.addToHash=function(e){if(e.parent===this){var t=this.hash.indexOf(e);if(t===-1)return this.hash.push(e),!0}return!1},t.Group.prototype.removeFromHash=function(e){if(e){var t=this.hash.indexOf(e);if(t!==-1)return this.hash.splice(t,1),!0}return!1},t.Group.prototype.addMultiple=function(e,n){if(e instanceof t.Group)e.moveAll(this,n);else if(Array.isArray(e))for(var r=0;r<e.length;r++)this.add(e[r],n);return e},t.Group.prototype.addAt=function(e,t,n){return n===undefined&&(n=!1),e.parent!==this&&(e.body&&e.parent&&e.parent.removeFromHash(e),this.addChildAt(e,t),this.updateZ(),this.enableBody&&e.body===null?this.game.physics.enable(e,this.physicsBodyType):e.body&&this.addToHash(e),!n&&e.events&&e.events.onAddedToGroup$dispatch(e,this),this.cursor===null&&(this.cursor=e)),e},t.Group.prototype.getAt=function(e){return e<0||e>=this.children.length?-1:this.getChildAt(e)},t.Group.prototype.create=function(e,t,n,r,i){i===undefined&&(i=!0);var s=new this.classType(this.game,e,t,n,r);return s.exists=i,s.visible=i,s.alive=i,s.z=this.children.length,this.addChild(s),this.enableBody&&this.game.physics.enable(s,this.physicsBodyType,this.enableBodyDebug),s.events&&s.events.onAddedToGroup$dispatch(s,this),this.cursor===null&&(this.cursor=s),s},t.Group.prototype.createMultiple=function(e,t,n,r){r===undefined&&(r=!1);for(var i=0;i<e;i++)this.create(0,0,t,n,r)},t.Group.prototype.updateZ=function(){var e=this.children.length;while(e--)this.children[e].z=e},t.Group.prototype.resetCursor=function(e){e===undefined&&(e=0),e>this.children.length-1&&(e=0);if(this.cursor)return this.cursorIndex=e,this.cursor=this.children[this.cursorIndex],this.cursor},t.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor},t.Group.prototype.previous=function(){if(this.cursor)return this.cursorIndex===0?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor},t.Group.prototype.swap=function(e,t){this.swapChildren(e,t),this.updateZ()},t.Group.prototype.bringToTop=function(e){return e.parent===this&&this.getIndex(e)<this.children.length&&(this.remove(e,!1,!0),this.add(e,!0)),e},t.Group.prototype.sendToBack=function(e){return e.parent===this&&this.getIndex(e)>0&&(this.remove(e,!1,!0),this.addAt(e,0,!0)),e},t.Group.prototype.moveUp=function(e){if(e.parent===this&&this.getIndex(e)<this.children.length-1){var t=this.getIndex(e),n=this.getAt(t+1);n&&this.swap(e,n)}return e},t.Group.prototype.moveDown=function(e){if(e.parent===this&&this.getIndex(e)>0){var t=this.getIndex(e),n=this.getAt(t-1);n&&this.swap(e,n)}return e},t.Group.prototype.xy=function(e,t,n){if(e<0||e>this.children.length)return-1;this.getChildAt(e).x=t,this.getChildAt(e).y=n},t.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},t.Group.prototype.getIndex=function(e){return this.children.indexOf(e)},t.Group.prototype.replace=function(e,n){var r=this.getIndex(e);if(r!==-1)return n.parent&&(n.parent instanceof t.Group?n.parent.remove(n):n.parent.removeChild(n)),this.remove(e),this.addAt(n,r),e},t.Group.prototype.hasProperty=function(e,t){var n=t.length;return n===1&&t[0]in e?!0:n===2&&t[0]in e&&t[1]in e[t[0]]?!0:n===3&&t[0]in e&&t[1]in e[t[0]]&&t[2]in e[t[0]][t[1]]?!0:n===4&&t[0]in e&&t[1]in e[t[0]]&&t[2]in e[t[0]][t[1]]&&t[3]in e[t[0]][t[1]][t[2]]?!0:!1},t.Group.prototype.setProperty=function(e,t,n,r,i){i===undefined&&(i=!1),r=r||0;if(!this.hasProperty(e,t)&&(!i||r>0))return!1;var s=t.length;return s===1?r===0?e[t[0]]=n:r==1?e[t[0]]+=n:r==2?e[t[0]]-=n:r==3?e[t[0]]*=n:r==4&&(e[t[0]]/=n):s===2?r===0?e[t[0]][t[1]]=n:r==1?e[t[0]][t[1]]+=n:r==2?e[t[0]][t[1]]-=n:r==3?e[t[0]][t[1]]*=n:r==4&&(e[t[0]][t[1]]/=n):s===3?r===0?e[t[0]][t[1]][t[2]]=n:r==1?e[t[0]][t[1]][t[2]]+=n:r==2?e[t[0]][t[1]][t[2]]-=n:r==3?e[t[0]][t[1]][t[2]]*=n:r==4&&(e[t[0]][t[1]][t[2]]/=n):s===4&&(r===0?e[t[0]][t[1]][t[2]][t[3]]=n:r==1?e[t[0]][t[1]][t[2]][t[3]]+=n:r==2?e[t[0]][t[1]][t[2]][t[3]]-=n:r==3?e[t[0]][t[1]][t[2]][t[3]]*=n:r==4&&(e[t[0]][t[1]][t[2]][t[3]]/=n)),!0},t.Group.prototype.checkProperty=function(e,n,r,i){return i===undefined&&(i=!1),!t.Utils.getProperty(e,n)&&i?!1:t.Utils.getProperty(e,n)!==r?!1:!0},t.Group.prototype.set=function(e,t,n,r,i,s,o){o===undefined&&(o=!1),t=t.split("."),r===undefined&&(r=!1),i===undefined&&(i=!1);if((r===!1||r&&e.alive)&&(i===!1||i&&e.visible))return this.setProperty(e,t,n,s,o)},t.Group.prototype.setAll=function(e,t,n,r,i,s){n===undefined&&(n=!1),r===undefined&&(r=!1),s===undefined&&(s=!1),e=e.split("."),i=i||0;for(var o=0;o<this.children.length;o++)(!n||n&&this.children[o].alive)&&(!r||r&&this.children[o].visible)&&this.setProperty(this.children[o],e,t,i,s)},t.Group.prototype.setAllChildren=function(e,n,r,i,s,o){r===undefined&&(r=!1),i===undefined&&(i=!1),o===undefined&&(o=!1),s=s||0;for(var u=0;u<this.children.length;u++)(!r||r&&this.children[u].alive)&&(!i||i&&this.children[u].visible)&&(this.children[u]instanceof t.Group?this.children[u].setAllChildren(e,n,r,i,s,o):this.setProperty(this.children[u],e.split("."),n,s,o))},t.Group.prototype.checkAll=function(e,t,n,r,i){n===undefined&&(n=!1),r===undefined&&(r=!1),i===undefined&&(i=!1);for(var s=0;s<this.children.length;s++)if((!n||n&&this.children[s].alive)&&(!r||r&&this.children[s].visible)&&!this.checkProperty(this.children[s],e,t,i))return!1;return!0},t.Group.prototype.addAll=function(e,t,n,r){this.setAll(e,t,n,r,1)},t.Group.prototype.subAll=function(e,t,n,r){this.setAll(e,t,n,r,2)},t.Group.prototype.multiplyAll=function(e,t,n,r){this.setAll(e,t,n,r,3)},t.Group.prototype.divideAll=function(e,t,n,r){this.setAll(e,t,n,r,4)},t.Group.prototype.callAllExists=function(e,t){var n;if(arguments.length>2){n=[];for(var r=2;r<arguments.length;r++)n.push(arguments[r])}for(var r=0;r<this.children.length;r++)this.children[r].exists===t&&this.children[r][e]&&this.children[r][e].apply(this.children[r],n)},t.Group.prototype.callbackFromArray=function(e,t,n){if(n==1){if(e[t[0]])return e[t[0]]}else if(n==2){if(e[t[0]][t[1]])return e[t[0]][t[1]]}else if(n==3){if(e[t[0]][t[1]][t[2]])return e[t[0]][t[1]][t[2]]}else if(n==4){if(e[t[0]][t[1]][t[2]][t[3]])return e[t[0]][t[1]][t[2]][t[3]]}else if(e[t])return e[t];return!1},t.Group.prototype.callAll=function(e,t){if(e===undefined)return;e=e.split(".");var n=e.length;if(t===undefined||t===null||t==="")t=null;else if(typeof t=="string"){t=t.split(".");var r=t.length}var i;if(arguments.length>2){i=[];for(var s=2;s<arguments.length;s++)i.push(arguments[s])}var o=null,u=null;for(var s=0;s<this.children.length;s++)o=this.callbackFromArray(this.children[s],e,n),t&&o?(u=this.callbackFromArray(this.children[s],t,r),o&&o.apply(u,i)):o&&o.apply(this.children[s],i)},t.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;var e=this.children.length;while(e--)this.children[e].preUpdate();return!0},t.Group.prototype.update=function(){var e=this.children.length;while(e--)this.children[e].update()},t.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var e=this.children.length;while(e--)this.children[e].postUpdate()},t.Group.prototype.filter=function(e,n){var r=-1,i=this.children.length,s=[];while(++r<i){var o=this.children[r];(!n||n&&o.exists)&&e(o,r,this.children)&&s.push(o)}return new t.ArraySet(s)},t.Group.prototype.forEach=function(e,t,n){n===undefined&&(n=!1);if(arguments.length<=3)for(var r=0;r<this.children.length;r++)(!n||n&&this.children[r].exists)&&e.call(t,this.children[r]);else{var i=[null];for(var r=3;r<arguments.length;r++)i.push(arguments[r]);for(var r=0;r<this.children.length;r++)if(!n||n&&this.children[r].exists)i[0]=this.children[r],e.apply(t,i)}},t.Group.prototype.forEachExists=function(e,n){var r;if(arguments.length>2){r=[null];for(var i=2;i<arguments.length;i++)r.push(arguments[i])}this.iterate("exists",!0,t.Group.RETURN_TOTAL,e,n,r)},t.Group.prototype.forEachAlive=function(e,n){var r;if(arguments.length>2){r=[null];for(var i=2;i<arguments.length;i++)r.push(arguments[i])}this.iterate("alive",!0,t.Group.RETURN_TOTAL,e,n,r)},t.Group.prototype.forEachDead=function(e,n){var r;if(arguments.length>2){r=[null];for(var i=2;i<arguments.length;i++)r.push(arguments[i])}this.iterate("alive",!1,t.Group.RETURN_TOTAL,e,n,r)},t.Group.prototype.sort=function(e,n){if(this.children.length<2)return;e===undefined&&(e="z"),n===undefined&&(n=t.Group.SORT_ASCENDING),this._sortProperty=e,n===t.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ()},t.Group.prototype.customSort=function(e,t){if(this.children.length<2)return;this.children.sort(e.bind(t)),this.updateZ()},t.Group.prototype.ascendingSortHandler=function(e,t){return e[this._sortProperty]<t[this._sortProperty]?-1:e[this._sortProperty]>t[this._sortProperty]?1:e.z<t.z?-1:1},t.Group.prototype.descendingSortHandler=function(e,t){return e[this._sortProperty]<t[this._sortProperty]?1:e[this._sortProperty]>t[this._sortProperty]?-1:0},t.Group.prototype.iterate=function(e,n,r,i,s,o){if(r===t.Group.RETURN_TOTAL&&this.children.length===0)return 0;var u=0;for(var a=0;a<this.children.length;a++)if(this.children[a][e]===n){u++,i&&(o?(o[0]=this.children[a],i.apply(s,o)):i.call(s,this.children[a]));if(r===t.Group.RETURN_CHILD)return this.children[a]}return r===t.Group.RETURN_TOTAL?u:null},t.Group.prototype.getFirstExists=function(e,n,r,i,s,o){n===undefined&&(n=!1),typeof e!="boolean"&&(e=!0);var u=this.iterate("exists",e,t.Group.RETURN_CHILD);return u===null&&n?this.create(r,i,s,o):this.resetChild(u,r,i,s,o)},t.Group.prototype.getFirstAlive=function(e,n,r,i,s){e===undefined&&(e=!1);var o=this.iterate("alive",!0,t.Group.RETURN_CHILD);return o===null&&e?this.create(n,r,i,s):this.resetChild(o,n,r,i,s)},t.Group.prototype.getFirstDead=function(e,n,r,i,s){e===undefined&&(e=!1);var o=this.iterate("alive",!1,t.Group.RETURN_CHILD);return o===null&&e?this.create(n,r,i,s):this.resetChild(o,n,r,i,s)},t.Group.prototype.resetChild=function(e,t,n,r,i){return e===null?null:(t===undefined&&(t=null),n===undefined&&(n=null),t!==null&&n!==null&&e.reset(t,n),r!==undefined&&e.loadTexture(r,i),e)},t.Group.prototype.getTop=function(){if(this.children.length>0)return this.children[this.children.length-1]},t.Group.prototype.getBottom=function(){if(this.children.length>0)return this.children[0]},t.Group.prototype.countLiving=function(){return this.iterate("alive",!0,t.Group.RETURN_TOTAL)},t.Group.prototype.countDead=function(){return this.iterate("alive",!1,t.Group.RETURN_TOTAL)},t.Group.prototype.getRandom=function(e,n){return this.children.length===0?null:(e=e||0,n=n||this.children.length,t.ArrayUtils.getRandomItem(this.children,e,n))},t.Group.prototype.remove=function(e,t,n){t===undefined&&(t=!1),n===undefined&&(n=!1);if(this.children.length===0||this.children.indexOf(e)===-1)return!1;!n&&e.events&&!e.destroyPhase&&e.events.onRemovedFromGroup$dispatch(e,this);var r=this.removeChild(e);return this.removeFromHash(e),this.updateZ(),this.cursor===e&&this.next(),t&&r&&r.destroy(!0),!0},t.Group.prototype.moveAll=function(e,n){n===undefined&&(n=!1);if(this.children.length>0&&e instanceof t.Group){do e.add(this.children[0],n);while(this.children.length>0);this.hash=[],this.cursor=null}return e},t.Group.prototype.removeAll=function(e,t){e===undefined&&(e=!1),t===undefined&&(t=!1);if(this.children.length===0)return;do{!t&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var n=this.removeChild(this.children[0]);this.removeFromHash(n),e&&n&&n.destroy(!0)}while(this.children.length>0);this.hash=[],this.cursor=null},t.Group.prototype.removeBetween=function(e,t,n,r){t===undefined&&(t=this.children.length-1),n===undefined&&(n=!1),r===undefined&&(r=!1);if(this.children.length===0)return;if(e>t||e<0||t>this.children.length)return!1;var i=t;while(i>=e){!r&&this.children[i].events&&this.children[i].events.onRemovedFromGroup$dispatch(this.children[i],this);var s=this.removeChild(this.children[i]);this.removeFromHash(s),n&&s&&s.destroy(!0),this.cursor===this.children[i]&&(this.cursor=null),i--}this.updateZ()},t.Group.prototype.destroy=function(e,t){if(this.game===null||this.ignoreDestroy)return;e===undefined&&(e=!0),t===undefined&&(t=!1),this.onDestroy.dispatch(this,e,t),this.removeAll(e),this.cursor=null,this.filters=null,this.pendingDestroy=!1,t||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1)},Object.defineProperty(t.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,t.Group.RETURN_TOTAL)}}),Object.defineProperty(t.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(t.Group.prototype,"angle",{get:function(){return t.Math.radToDeg(this.rotation)},set:function(e){this.rotation=t.Math.degToRad(e)}}),t.World=function(e){t.Group.call(this,e,null,"__world",!1),this.bounds=new t.Rectangle(0,0,e.width,e.height),this.camera=null,this._definedSize=!1,this._width=e.width,this._height=e.height,this.game.state.onStateChange.add(this.stateChange,this)},t.World.prototype=Object.create(t.Group.prototype),t.World.prototype.constructor=t.World,t.World.prototype.boot=function(){this.camera=new t.Camera(this.game,0,0,0,this.game.width,this.game.height),this.camera.displayObject=this,this.camera.scale=this.scale,this.game.camera=this.camera,this.game.stage.addChild(this)},t.World.prototype.stateChange=function(){this.x=0,this.y=0,this.camera.reset()},t.World.prototype.setBounds=function(e,t,n,r){this._definedSize=!0,this._width=n,this._height=r,this.bounds.setTo(e,t,n,r),this.x=e,this.y=t,this.camera.bounds&&this.camera.bounds.setTo(e,t,Math.max(n,this.game.width),Math.max(r,this.game.height)),this.game.physics.setBoundsToWorld()},t.World.prototype.resize=function(e,t){this._definedSize&&(e<this._width&&(e=this._width),t<this._height&&(t=this._height)),this.bounds.width=e,this.bounds.height=t,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},t.World.prototype.shutdown=function(){this.destroy(!0,!0)},t.World.prototype.wrap=function(e,t,n,r,i){t===undefined&&(t=0),n===undefined&&(n=!1),r===undefined&&(r=!0),i===undefined&&(i=!0),n?(e.getBounds(),r&&(e.x+e._currentBounds.width<this.bounds.x?e.x=this.bounds.right:e.x>this.bounds.right&&(e.x=this.bounds.left)),i&&(e.y+e._currentBounds.height<this.bounds.top?e.y=this.bounds.bottom:e.y>this.bounds.bottom&&(e.y=this.bounds.top))):(r&&e.x+t<this.bounds.x?e.x=this.bounds.right+t:r&&e.x-t>this.bounds.right&&(e.x=this.bounds.left-t),i&&e.y+t<this.bounds.top?e.y=this.bounds.bottom+t:i&&e.y-t>this.bounds.bottom&&(e.y=this.bounds.top-t))},Object.defineProperty(t.World.prototype,"width",{get:function(){return this.bounds.width},set:function(e){e<this.game.width&&(e=this.game.width),this.bounds.width=e,this._width=e,this._definedSize=!0}}),Object.defineProperty(t.World.prototype,"height",{get:function(){return this.bounds.height},set:function(e){e<this.game.height&&(e=this.game.height),this.bounds.height=e,this._height=e,this._definedSize=!0}}),Object.defineProperty(t.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}}),Object.defineProperty(t.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}}),Object.defineProperty(t.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}}),Object.defineProperty(t.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}}),t.Game=function(e,n,r,i,s,o,u,a){return this.id=t.GAMES.push(this)-1,this.config=null,this.physicsConfig=a,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=t.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=t.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new t.Signal,this.forceSingleUpdate=!1,this._nextFpsNotification=0,arguments.length===1&&typeof arguments[0]=="object"?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},typeof e!="undefined"&&(this._width=e),typeof n!="undefined"&&(this._height=n),typeof r!="undefined"&&(this.renderType=r),typeof i!="undefined"&&(this.parent=i),typeof o!="undefined"&&(this.transparent=o),typeof u!="undefined"&&(this.antialias=u),this.rnd=new t.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new t.StateManager(this,s)),this.device.whenReady(this.boot,this),this},t.Game.prototype={parseConfig:function(e){this.config=e,e.enableDebug===undefined&&(this.config.enableDebug=!0),e.width&&(this._width=e.width),e.height&&(this._height=e.height),e.renderer&&(this.renderType=e.renderer),e.parent&&(this.parent=e.parent),e.transparent!==undefined&&(this.transparent=e.transparent),e.antialias!==undefined&&(this.antialias=e.antialias),e.resolution&&(this.resolution=e.resolution),e.preserveDrawingBuffer!==undefined&&(this.preserveDrawingBuffer=e.preserveDrawingBuffer),e.physicsConfig&&(this.physicsConfig=e.physicsConfig);var n=[(Date.now()*Math.random()).toString()];e.seed&&(n=e.seed),this.rnd=new t.RandomDataGenerator(n);var r=null;e.state&&(r=e.state),this.state=new t.StateManager(this,r)},boot:function(){if(this.isBooted)return;this.onPause=new t.Signal,this.onResume=new t.Signal,this.onBlur=new t.Signal,this.onFocus=new t.Signal,this.isBooted=!0,PIXI.game=this,this.math=t.Math,this.scale=new t.ScaleManager(this,this._width,this._height),this.stage=new t.Stage(this),this.setUpRenderer(),this.world=new t.World(this),this.add=new t.GameObjectFactory(this),this.make=new t.GameObjectCreator(this),this.cache=new t.Cache(this),this.load=new t.Loader(this),this.time=new t.Time(this),this.tweens=new t.TweenManager(this),this.input=new t.Input(this),this.sound=new t.SoundManager(this),this.physics=new t.Physics(this,this.physicsConfig),this.particles=new t.Particles(this),this.create=new t.Create(this),this.plugins=new t.PluginManager(this),this.net=new t.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new t.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=!0,this.config&&this.config.forceSetTimeOut?this.raf=new t.RequestAnimationFrame(this,this.config.forceSetTimeOut):this.raf=new t.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.raf.start()},showDebugHeader:function(){if(window.PhaserGlobal&&window.PhaserGlobal.hideBanner)return;var e=t.VERSION,n="Canvas",r="HTML Audio",i=1;this.renderType===t.WEBGL?(n="WebGL",i++):this.renderType==t.HEADLESS&&(n="Headless"),this.device.webAudio&&(r="WebAudio",i++);if(this.device.chrome){var s=["%c %c %c Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+n+" | "+r+"  %c %c "+"%c http://phaser.io %câ¥%câ¥%câ¥","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff"];for(var o=0;o<3;o++)o<i?s.push("color: #ff2424; background: #fff"):s.push("color: #959595; background: #fff");console.log.apply(console,s)}else window.console&&console.log("Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+n+" | "+r+" | http://phaser.io")},setUpRenderer:function(){this.canvas=t.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%";if(this.renderType===t.HEADLESS||this.renderType===t.CANVAS||this.renderType===t.AUTO&&!this.device.webGL){if(!this.device.canvas)throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.");this.renderType=t.CANVAS,this.renderer=new PIXI.CanvasRenderer(this),this.context=this.renderer.context}else this.renderType=t.WEBGL,this.renderer=new PIXI.WebGLRenderer(this),this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1);this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===t.CANVAS?!0:!1),this.renderType!==t.HEADLESS&&(this.stage.smoothed=this.antialias,t.Canvas.addToDOM(this.canvas,this.parent,!1),t.Canvas.setTouchAction(this.canvas))},contextLost:function(e){e.preventDefault(),this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext(),this.cache.clearGLTextures(),this.renderer.contextLost=!1},update:function(e){this.time.update(e);if(this._kickstart){this.updateLogic(this.time.desiredFpsMult),this.stage.updateTransform(),this.updateRender(this.time.slowMotion*this.time.desiredFps),this._kickstart=!1;return}if(this._spiraling>1&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{var t=this.time.slowMotion*1e3/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(t*3,this.time.elapsed),0);var n=0;this.updatesThisFrame=Math.floor(this._deltaTime/t),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame));while(this._deltaTime>=t){this._deltaTime-=t,this.currentUpdateID=n,this.updateLogic(this.time.desiredFpsMult),this.stage.updateTransform(),n++;if(this.forceSingleUpdate&&n===1)break;this.time.refresh()}n>this._lastCount?this._spiraling++:n<this._lastCount&&(this._spiraling=0),this._lastCount=n,this.updateRender(this._deltaTime/t)}},updateLogic:function(e){!this._paused&&!this.pendingStep?(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.debug.preUpdate(),this.world.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(e),this.plugins.preUpdate(e),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()):(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate())},updateRender:function(e){if(this.lockRender)return;this.state.preRender(e),this.renderer.render(this.stage),this.plugins.render(e),this.state.render(e),this.plugins.postRender(e)},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.state=null,this.cache=null,this.input=null,this.load=null,this.sound=null,this.stage=null,this.time=null,this.world=null,this.isBooted=!1,this.renderer.destroy(!1),t.Canvas.removeFromDOM(this.canvas),t.GAMES[this.id]=null},gamePaused:function(e){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(e),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(e){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(e),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(e){this.onBlur.dispatch(e),this.stage.disableVisibilityChange||this.gamePaused(e)},focusGain:function(e){this.onFocus.dispatch(e),this.stage.disableVisibilityChange||this.gameResumed(e)}},t.Game.prototype.constructor=t.Game,Object.defineProperty(t.Game.prototype,"paused",{get:function(){return this._paused},set:function(e){e===!0?(this._paused===!1&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),t.Input=function(e){this.game=e,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.pollRate=0,this.enabled=!0,this.multiInputOverride=t.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=-1,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.pointers=[],this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new t.ArraySet,this._localPoint=new t.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},t.Input.MOUSE_OVERRIDES_TOUCH=0,t.Input.TOUCH_OVERRIDES_MOUSE=1,t.Input.MOUSE_TOUCH_COMBINE=2,t.Input.MAX_POINTERS=10,t.Input.prototype={boot:function(){this.mousePointer=new t.Pointer(this.game,0,t.PointerMode.CURSOR),this.addPointer(),this.addPointer(),this.mouse=new t.Mouse(this.game),this.touch=new t.Touch(this.game),this.mspointer=new t.MSPointer(this.game),t.Keyboard&&(this.keyboard=new t.Keyboard(this.game)),t.Gamepad&&(this.gamepad=new t.Gamepad(this.game)),this.onDown=new t.Signal,this.onUp=new t.Signal,this.onTap=new t.Signal,this.onHold=new t.Signal,this.scale=new t.Point(1,1),this.speed=new t.Point,this.position=new t.Point,this._oldPosition=new t.Point,this.circle=new t.Circle(0,0,44),this.activePointer=this.mousePointer,this.hitCanvas=PIXI.CanvasPool.create(this,1,1),this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0,this.keyboard&&this.keyboard.start();var e=this;this._onClickTrampoline=function(t){e.onClickTrampoline(t)},this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop(),this.touch.stop(),this.mspointer.stop(),this.keyboard&&this.keyboard.stop(),this.gamepad&&this.gamepad.stop(),this.moveCallbacks=[],PIXI.CanvasPool.remove(this),this.game.canvas.removeEventListener("click",this._onClickTrampoline)},addMoveCallback:function(e,t){this.moveCallbacks.push({callback:e,context:t})},deleteMoveCallback:function(e,t){var n=this.moveCallbacks.length;while(n--)if(this.moveCallbacks[n].callback===e&&this.moveCallbacks[n].context===t){this.moveCallbacks.splice(n,1);return}},addPointer:function(){if(this.pointers.length>=t.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: Maximum limit of "+t.Input.MAX_POINTERS+" pointers reached."),null;var e=this.pointers.length+1,n=new t.Pointer(this.game,e,t.PointerMode.TOUCH);return this.pointers.push(n),this["pointer"+e]=n,n},update:function(){this.keyboard&&this.keyboard.update();if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var e=0;e<this.pointers.length;e++)this.pointers[e].update();this._pollCounter=0},reset:function(e){if(!this.game.isBooted||this.resetLocked)return;e===undefined&&(e=!1),this.mousePointer.reset(),this.keyboard&&this.keyboard.reset(e),this.gamepad&&this.gamepad.reset();for(var n=0;n<this.pointers.length;n++)this.pointers[n].reset();this.game.canvas.style.cursor!=="none"&&(this.game.canvas.style.cursor="inherit"),e&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new t.Signal,this.onUp=new t.Signal,this.onTap=new t.Signal,this.onHold=new t.Signal,this.moveCallbacks=[]),this._pollCounter=0},resetSpeed:function(e,t){this._oldPosition.setTo(e,t),this.speed.setTo(0,0)},startPointer:function(e){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(e);if(!this.pointer2.active)return this.pointer2.start(e);for(var t=2;t<this.pointers.length;t++){var n=this.pointers[t];if(!n.active)return n.start(e)}return null},updatePointer:function(e){if(this.pointer1.active&&this.pointer1.identifier===e.identifier)return this.pointer1.move(e);if(this.pointer2.active&&this.pointer2.identifier===e.identifier)return this.pointer2.move(e);for(var t=2;t<this.pointers.length;t++){var n=this.pointers[t];if(n.active&&n.identifier===e.identifier)return n.move(e)}return null},stopPointer:function(e){if(this.pointer1.active&&this.pointer1.identifier===e.identifier)return this.pointer1.stop(e);if(this.pointer2.active&&this.pointer2.identifier===e.identifier)return this.pointer2.stop(e);for(var t=2;t<this.pointers.length;t++){var n=this.pointers[t];if(n.active&&n.identifier===e.identifier)return n.stop(e)}return null},countActivePointers:function(e){e===undefined&&(e=this.pointers.length);var t=e;for(var n=0;n<this.pointers.length&&t>0;n++){var r=this.pointers[n];r.active&&t--}return e-t},getPointer:function(e){e===undefined&&(e=!1);for(var t=0;t<this.pointers.length;t++){var n=this.pointers[t];if(n.active===e)return n}return null},getPointerFromIdentifier:function(e){for(var t=0;t<this.pointers.length;t++){var n=this.pointers[t];if(n.identifier===e)return n}return null},getPointerFromId:function(e){for(var t=0;t<this.pointers.length;t++){var n=this.pointers[t];if(n.pointerId===e)return n}return null},getLocalPosition:function(e,n,r){r===undefined&&(r=new t.Point);var i=e.worldTransform,s=1/(i.a*i.d+i.c*-i.b);return r.setTo(i.d*s*n.x+ -i.c*s*n.y+(i.ty*i.c-i.tx*i.d)*s,i.a*s*n.y+ -i.b*s*n.x+(-i.ty*i.a+i.tx*i.b)*s)},hitTest:function(e,n,r){if(!e.worldVisible)return!1;this.getLocalPosition(e,n,this._localPoint),r.copyFrom(this._localPoint);if(e.hitArea&&e.hitArea.contains)return e.hitArea.contains(this._localPoint.x,this._localPoint.y);if(e instanceof t.TileSprite){var i=e.width,s=e.height,o=-i*e.anchor.x;if(this._localPoint.x>=o&&this._localPoint.x<o+i){var u=-s*e.anchor.y;if(this._localPoint.y>=u&&this._localPoint.y<u+s)return!0}}else if(e instanceof PIXI.Sprite){var i=e.texture.frame.width,s=e.texture.frame.height,o=-i*e.anchor.x;if(this._localPoint.x>=o&&this._localPoint.x<o+i){var u=-s*e.anchor.y;if(this._localPoint.y>=u&&this._localPoint.y<u+s)return!0}}else if(e instanceof t.Graphics)for(var a=0;a<e.graphicsData.length;a++){var f=e.graphicsData[a];if(!f.fill)continue;if(f.shape&&f.shape.contains(this._localPoint.x,this._localPoint.y))return!0}for(var a=0,l=e.children.length;a<l;a++)if(this.hitTest(e.children[a],n,r))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}},t.Input.prototype.constructor=t.Input,Object.defineProperty(t.Input.prototype,"x",{get:function(){return this._x},set:function(e){this._x=Math.floor(e)}}),Object.defineProperty(t.Input.prototype,"y",{get:function(){return this._y},set:function(e){this._y=Math.floor(e)}}),Object.defineProperty(t.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(t.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(t.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(t.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(t.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),t.Mouse=function(e){this.game=e,this.input=e.input,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.enabled=!0,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new t.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null,this._wheelEvent=null},t.Mouse.NO_BUTTON=-1,t.Mouse.LEFT_BUTTON=0,t.Mouse.MIDDLE_BUTTON=1,t.Mouse.RIGHT_BUTTON=2,t.Mouse.BACK_BUTTON=3,t.Mouse.FORWARD_BUTTON=4,t.Mouse.WHEEL_UP=1,t.Mouse.WHEEL_DOWN=-1,t.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===!1)return;if(this._onMouseDown!==null)return;var e=this;this._onMouseDown=function(t){return e.onMouseDown(t)},this._onMouseMove=function(t){return e.onMouseMove(t)},this._onMouseUp=function(t){return e.onMouseUp(t)},this._onMouseUpGlobal=function(t){return e.onMouseUpGlobal(t)},this._onMouseOutGlobal=function(t){return e.onMouseOutGlobal(t)},this._onMouseOut=function(t){return e.onMouseOut(t)},this._onMouseOver=function(t){return e.onMouseOver(t)},this._onMouseWheel=function(t){return e.onMouseWheel(t)};var t=this.game.canvas;t.addEventListener("mousedown",this._onMouseDown,!0),t.addEventListener("mousemove",this._onMouseMove,!0),t.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),t.addEventListener("mouseover",this._onMouseOver,!0),t.addEventListener("mouseout",this._onMouseOut,!0));var n=this.game.device.wheelEvent;n&&(t.addEventListener(n,this._onMouseWheel,!0),n==="mousewheel"?this._wheelEvent=new r(-1/40,1):n==="DOMMouseScroll"&&(this._wheelEvent=new r(1,1)))},onMouseDown:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,e);if(!this.input.enabled||!this.enabled)return;e.identifier=0,this.input.mousePointer.start(e)},onMouseMove:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,e);if(!this.input.enabled||!this.enabled)return;e.identifier=0,this.input.mousePointer.move(e)},onMouseUp:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,e);if(!this.input.enabled||!this.enabled)return;e.identifier=0,this.input.mousePointer.stop(e)},onMouseUpGlobal:function(e){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,e),e.identifier=0,this.input.mousePointer.stop(e))},onMouseOutGlobal:function(e){this.event=e,this.capture&&e.preventDefault(),this.input.mousePointer.withinGame=!1;if(!this.input.enabled||!this.enabled)return;this.input.mousePointer.stop(e),this.input.mousePointer.leftButton.stop(e),this.input.mousePointer.rightButton.stop(e)},onMouseOut:function(e){this.event=e,this.capture&&e.preventDefault(),this.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,e);if(!this.input.enabled||!this.enabled)return;this.stopOnGameOut&&(e.identifier=0,this.input.mousePointer.stop(e))},onMouseOver:function(e){this.event=e,this.capture&&e.preventDefault(),this.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,e)},onMouseWheel:function(e){this._wheelEvent&&(e=this._wheelEvent.bindEvent(e)),this.event=e,this.capture&&e.preventDefault(),this.wheelDelta=t.Math.clamp(-e.deltaY,-1,1),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,e)},requestPointerLock:function(){if(this.game.device.pointerLock){var e=this.game.canvas;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock();var t=this;this._pointerLockChange=function(e){return t.pointerLockChange(e)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(e){var t=this.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?(this.locked=!0,this.pointerLock.dispatch(!0,e)):(this.locked=!1,this.pointerLock.dispatch(!1,e))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){var e=this.game.canvas;e.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("mousemove",this._onMouseMove,!0),e.removeEventListener("mouseup",this._onMouseUp,!0),e.removeEventListener("mouseover",this._onMouseOver,!0),e.removeEventListener("mouseout",this._onMouseOut,!0);var t=this.game.device.wheelEvent;t&&e.removeEventListener(t,this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},t.Mouse.prototype.constructor=t.Mouse,r.prototype={},r.prototype.constructor=r,r.prototype.bindEvent=function(e){if(!r._stubsGenerated&&e){var t=function(e){return function(){var t=this.originalEvent[e];return typeof t!="function"?t:t.bind(this.originalEvent)}};for(var n in e)n in r.prototype||Object.defineProperty(r.prototype,n,{get:t(n)});r._stubsGenerated=!0}return this.originalEvent=e,this},Object.defineProperties(r.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}}),t.MSPointer=function(e){this.game=e,this.input=e.input,this.callbackContext=this.game,this.pointerDownCallback=null,this.pointerMoveCallback=null,this.pointerUpCallback=null,this.capture=!0,this.button=-1,this.event=null,this.enabled=!0,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null,this._onMSPointerUpGlobal=null,this._onMSPointerOut=null,this._onMSPointerOver=null},t.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null)return;var e=this;if(this.game.device.mspointer){this._onMSPointerDown=function(t){return e.onPointerDown(t)},this._onMSPointerMove=function(t){return e.onPointerMove(t)},this._onMSPointerUp=function(t){return e.onPointerUp(t)},this._onMSPointerUpGlobal=function(t){return e.onPointerUpGlobal(t)},this._onMSPointerOut=function(t){return e.onPointerOut(t)},this._onMSPointerOver=function(t){return e.onPointerOver(t)};var t=this.game.canvas;t.addEventListener("MSPointerDown",this._onMSPointerDown,!1),t.addEventListener("MSPointerMove",this._onMSPointerMove,!1),t.addEventListener("MSPointerUp",this._onMSPointerUp,!1),t.addEventListener("pointerdown",this._onMSPointerDown,!1),t.addEventListener("pointermove",this._onMSPointerMove,!1),t.addEventListener("pointerup",this._onMSPointerUp,!1),t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),t.addEventListener("MSPointerOver",this._onMSPointerOver,!0),t.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),t.addEventListener("pointerover",this._onMSPointerOver,!0),t.addEventListener("pointerout",this._onMSPointerOut,!0))}},onPointerDown:function(e){this.event=e,this.capture&&e.preventDefault(),this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,e);if(!this.input.enabled||!this.enabled)return;e.identifier=e.pointerId,e.pointerType==="mouse"||e.pointerType===4?this.input.mousePointer.start(e):this.input.startPointer(e)},onPointerMove:function(e){this.event=e,this.capture&&e.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,e);if(!this.input.enabled||!this.enabled)return;e.identifier=e.pointerId,e.pointerType==="mouse"||e.pointerType===4?this.input.mousePointer.move(e):this.input.updatePointer(e)},onPointerUp:function(e){this.event=e,this.capture&&e.preventDefault(),this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,e);if(!this.input.enabled||!this.enabled)return;e.identifier=e.pointerId,e.pointerType==="mouse"||e.pointerType===4?this.input.mousePointer.stop(e):this.input.stopPointer(e)},onPointerUpGlobal:function(e){if(e.pointerType!=="mouse"&&e.pointerType!==4||!!this.input.mousePointer.withinGame){var t=this.input.getPointerFromIdentifier(e.identifier);t&&t.withinGame&&this.onPointerUp(e)}else this.onPointerUp(e)},onPointerOut:function(e){this.event=e,this.capture&&e.preventDefault();if(e.pointerType==="mouse"||e.pointerType===4)this.input.mousePointer.withinGame=!1;else{var t=this.input.getPointerFromIdentifier(e.identifier);t&&(t.withinGame=!1)}this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,e);if(!this.input.enabled||!this.enabled)return;this.input.mouse.stopOnGameOut&&(e.identifier=0,t?t.stop(e):this.input.mousePointer.stop(e))},onPointerOver:function(e){this.event=e,this.capture&&e.preventDefault();if(e.pointerType==="mouse"||e.pointerType===4)this.input.mousePointer.withinGame=!0;else{var t=this.input.getPointerFromIdentifier(e.identifier);t&&(t.withinGame=!0)}this.input.mouse.mouseOverCallback&&this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,e)},stop:function(){var e=this.game.canvas;e.removeEventListener("MSPointerDown",this._onMSPointerDown,!1),e.removeEventListener("MSPointerMove",this._onMSPointerMove,!1),e.removeEventListener("MSPointerUp",this._onMSPointerUp,!1),e.removeEventListener("pointerdown",this._onMSPointerDown,!1),e.removeEventListener("pointermove",this._onMSPointerMove,!1),e.removeEventListener("pointerup",this._onMSPointerUp,!1),window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),e.removeEventListener("MSPointerOver",this._onMSPointerOver,!0),e.removeEventListener("MSPointerOut",this._onMSPointerOut,!0),window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0),e.removeEventListener("pointerover",this._onMSPointerOver,!0),e.removeEventListener("pointerout",this._onMSPointerOut,!0)}},t.MSPointer.prototype.constructor=t.MSPointer,t.DeviceButton=function(e,n){this.parent=e,this.game=e.game,this.event=null,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1,this.value=0,this.buttonCode=n,this.onDown=new t.Signal,this.onUp=new t.Signal,this.onFloat=new t.Signal},t.DeviceButton.prototype={start:function(e,t){if(this.isDown)return;this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=e,this.value=t,e&&(this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.ctrlKey=e.ctrlKey),this.onDown.dispatch(this,t)},stop:function(e,t){if(this.isUp)return;this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=e,this.value=t,e&&(this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.ctrlKey=e.ctrlKey),this.onUp.dispatch(this,t)},padFloat:function(e){this.value=e,this.onFloat.dispatch(this,e)},justPressed:function(e){return e=e||250,this.isDown&&this.timeDown+e>this.game.time.time},justReleased:function(e){return e=e||250,this.isUp&&this.timeUp+e>this.game.time.time},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.time,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.parent=null,this.game=null}},t.DeviceButton.prototype.constructor=t.DeviceButton,Object.defineProperty(t.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),t.Pointer=function(e,n,r){this.game=e,this.id=n,this.type=t.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.pointerMode=r||t.PointerMode.CURSOR|t.PointerMode.CONTACT,this.target=null,this.button=null,this.leftButton=new t.DeviceButton(this,t.Pointer.LEFT_BUTTON),this.middleButton=new t.DeviceButton(this,t.Pointer.MIDDLE_BUTTON),this.rightButton=new t.DeviceButton(this,t.Pointer.RIGHT_BUTTON),this.backButton=new t.DeviceButton(this,t.Pointer.BACK_BUTTON),this.forwardButton=new t.DeviceButton(this,t.Pointer.FORWARD_BUTTON),this.eraserButton=new t.DeviceButton(this,t.Pointer.ERASER_BUTTON),this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=n===0,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.active=!1,this.dirty=!1,this.position=new t.Point,this.positionDown=new t.Point,this.positionUp=new t.Point,this.circle=new t.Circle(0,0,44),this._clickTrampolines=null,this._trampolineTargetObject=null},t.Pointer.NO_BUTTON=0,t.Pointer.LEFT_BUTTON=1,t.Pointer.RIGHT_BUTTON=2,t.Pointer.MIDDLE_BUTTON=4,t.Pointer.BACK_BUTTON=8,t.Pointer.FORWARD_BUTTON=16,t.Pointer.ERASER_BUTTON=32,t.Pointer.prototype={resetButtons:function(){this.isDown=!1,this.isUp=!0,this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(e,n){t.Pointer.LEFT_BUTTON&e&&this.leftButton.start(n),t.Pointer.RIGHT_BUTTON&e&&this.rightButton.start(n),t.Pointer.MIDDLE_BUTTON&e&&this.middleButton.start(n),t.Pointer.BACK_BUTTON&e&&this.backButton.start(n),t.Pointer.FORWARD_BUTTON&e&&this.forwardButton.start(n),t.Pointer.ERASER_BUTTON&e&&this.eraserButton.start(n)},processButtonsUp:function(e,n){e===t.Mouse.LEFT_BUTTON&&this.leftButton.stop(n),e===t.Mouse.RIGHT_BUTTON&&this.rightButton.stop(n),e===t.Mouse.MIDDLE_BUTTON&&this.middleButton.stop(n),e===t.Mouse.BACK_BUTTON&&this.backButton.stop(n),e===t.Mouse.FORWARD_BUTTON&&this.forwardButton.stop(n),e===5&&this.eraserButton.stop(n)},updateButtons:function(e){this.button=e.button;var t=e.type.toLowerCase().substr(-4)==="down";e.buttons!==undefined?t?this.processButtonsDown(e.buttons,e):this.processButtonsUp(e.button,e):t?this.leftButton.start(e):(this.leftButton.stop(e),this.rightButton.stop(e)),e.buttons===1&&e.ctrlKey&&this.leftButton.isDown&&(this.leftButton.stop(e),this.rightButton.start(e)),this.isUp=!0,this.isDown=!1;if(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)this.isUp=!1,this.isDown=!0},start:function(e){var n=this.game.input;e.pointerId&&(this.pointerId=e.pointerId),this.identifier=e.identifier,this.target=e.target,this.isMouse?this.updateButtons(e):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(e,!0),this.positionDown.setTo(this.x,this.y);if(n.multiInputOverride===t.Input.MOUSE_OVERRIDES_TOUCH||n.multiInputOverride===t.Input.MOUSE_TOUCH_COMBINE||n.multiInputOverride===t.Input.TOUCH_OVERRIDES_MOUSE&&n.totalActivePointers===0)n.x=this.x,n.y=this.y,n.position.setTo(this.x,this.y),n.onDown.dispatch(this,e),n.resetSpeed(this.x,this.y);return this._stateReset=!1,this.totalTouches++,this.targetObject!==null&&this.targetObject._touchedHandler(this),this},update:function(){var e=this.game.input;this.active&&(this.dirty&&(e.interactiveItems.total>0&&this.processInteractiveObjects(!1),this.dirty=!1),this._holdSent===!1&&this.duration>=e.holdRate&&((e.multiInputOverride===t.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===t.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===t.Input.TOUCH_OVERRIDES_MOUSE&&e.totalActivePointers===0)&&e.onHold.dispatch(this),this._holdSent=!0),e.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+e.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>e.recordLimit&&this._history.shift()))},move:function(e,n){var r=this.game.input;if(r.pollLocked)return;n===undefined&&(n=!1),e.button!==undefined&&(this.button=e.button),n&&this.isMouse&&this.updateButtons(e),this.clientX=e.clientX,this.clientY=e.clientY,this.pageX=e.pageX,this.pageY=e.pageY,this.screenX=e.screenX,this.screenY=e.screenY,this.isMouse&&r.mouse.locked&&!n&&(this.rawMovementX=e.movementX||e.mozMovementX||e.webkitMovementX||0,this.rawMovementY=e.movementY||e.mozMovementY||e.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*r.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*r.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y;if(r.multiInputOverride===t.Input.MOUSE_OVERRIDES_TOUCH||r.multiInputOverride===t.Input.MOUSE_TOUCH_COMBINE||r.multiInputOverride===t.Input.TOUCH_OVERRIDES_MOUSE&&r.totalActivePointers===0)r.activePointer=this,r.x=this.x,r.y=this.y,r.position.setTo(r.x,r.y),r.circle.x=r.x,r.circle.y=r.y;this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused)return this;var i=r.moveCallbacks.length;while(i--)r.moveCallbacks[i].callback.call(r.moveCallbacks[i].context,this,this.x,this.y,n);return this.targetObject!==null&&this.targetObject.isDragged===!0?this.targetObject.update(this)===!1&&(this.targetObject=null):r.interactiveItems.total>0&&this.processInteractiveObjects(n),this},processInteractiveObjects:function(e){var t=Number.MAX_VALUE,n=-1,r=null,i=this.game.input.interactiveItems.first;while(i){i.checked=!1;if(i.validForInput(n,t,!1)){i.checked=!0;if(e&&i.checkPointerDown(this,!0)||!e&&i.checkPointerOver(this,!0))t=i.sprite.renderOrderID,n=i.priorityID,r=i}i=this.game.input.interactiveItems.next}var i=this.game.input.interactiveItems.first;while(i)!i.checked&&i.validForInput(n,t,!0)&&(e&&i.checkPointerDown(this,!1)||!e&&i.checkPointerOver(this,!1))&&(t=i.sprite.renderOrderID,n=i.priorityID,r=i),i=this.game.input.interactiveItems.next;return r===null?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):this.targetObject===null?(this.targetObject=r,r._pointerOverHandler(this)):this.targetObject===r?r.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=r,this.targetObject._pointerOverHandler(this)),this.targetObject!==null},leave:function(e){this.withinGame=!1,this.move(e,!1)},stop:function(e){var n=this.game.input;if(this._stateReset&&this.withinGame){e.preventDefault();return}this.timeUp=this.game.time.time;if(n.multiInputOverride===t.Input.MOUSE_OVERRIDES_TOUCH||n.multiInputOverride===t.Input.MOUSE_TOUCH_COMBINE||n.multiInputOverride===t.Input.TOUCH_OVERRIDES_MOUSE&&n.totalActivePointers===0)n.onUp.dispatch(this,e),this.duration>=0&&this.duration<=n.tapRate&&(this.timeUp-this.previousTapTime<n.doubleTapRate?n.onTap.dispatch(this,!0):n.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp);return this.isMouse?this.updateButtons(e):(this.isDown=!1,this.isUp=!0),this.id>0&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(e.pageX,e.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),this.isMouse===!1&&n.currentPointers--,n.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this},justPressed:function(e){return e=e||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+e>this.game.time.time},justReleased:function(e){return e=e||this.game.input.justReleasedRate,this.isUp&&this.timeUp+e>this.game.time.time},addClickTrampoline:function(e,t,n,r){if(!this.isDown)return;var i=this._clickTrampolines=this._clickTrampolines||[];for(var s=0;s<i.length;s++)if(i[s].name===e){i.splice(s,1);break}i.push({name:e,targetObject:this.targetObject,callback:t,callbackContext:n,callbackArgs:r})},processClickTrampolines:function(){var e=this._clickTrampolines;if(!e)return;for(var t=0;t<e.length;t++){var n=e[t];n.targetObject===this._trampolineTargetObject&&n.callback.apply(n.callbackContext,n.callbackArgs)}this._clickTrampolines=null,this._trampolineTargetObject=null},reset:function(){this.isMouse===!1&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.resetButtons(),this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},t.Pointer.prototype.constructor=t.Pointer,Object.defineProperty(t.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(t.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(t.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),t.PointerMode={CURSOR:1,CONTACT:2},t.Touch=function(e){this.game=e,this.enabled=!0,this.touchLockCallbacks=[],this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},t.Touch.prototype={start:function(){if(this._onTouchStart!==null)return;var e=this;this.game.device.touch&&(this._onTouchStart=function(t){return e.onTouchStart(t)},this._onTouchMove=function(t){return e.onTouchMove(t)},this._onTouchEnd=function(t){return e.onTouchEnd(t)},this._onTouchEnter=function(t){return e.onTouchEnter(t)},this._onTouchLeave=function(t){return e.onTouchLeave(t)},this._onTouchCancel=function(t){return e.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))},consumeDocumentTouches:function(){this._documentTouchMove=function(e){e.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},addTouchLockCallback:function(e,t,n){n===undefined&&(n=!1),this.touchLockCallbacks.push({callback:e,context:t,onEnd:n})},removeTouchLockCallback:function(e,t){var n=this.touchLockCallbacks.length;while(n--)if(this.touchLockCallbacks[n].callback===e&&this.touchLockCallbacks[n].context===t)return this.touchLockCallbacks.splice(n,1),!0;return!1},onTouchStart:function(e){var t=this.touchLockCallbacks.length;while(t--){var n=this.touchLockCallbacks[t];!n.onEnd&&n.callback.call(n.context,this,e)&&this.touchLockCallbacks.splice(t,1)}this.event=e;if(!this.game.input.enabled||!this.enabled)return;this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.startPointer(e.changedTouches[t])},onTouchCancel:function(e){this.event=e,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,e);if(!this.game.input.enabled||!this.enabled)return;this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.stopPointer(e.changedTouches[t])},onTouchEnter:function(e){this.event=e,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,e);if(!this.game.input.enabled||!this.enabled)return;this.preventDefault&&e.preventDefault()},onTouchLeave:function(e){this.event=e,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault()},onTouchMove:function(e){this.event=e,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.updatePointer(e.changedTouches[t])},onTouchEnd:function(e){var t=this.touchLockCallbacks.length;while(t--){var n=this.touchLockCallbacks[t];n.onEnd&&n.callback.call(n.context,this,e)&&this.touchLockCallbacks.splice(t,1)}this.event=e,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.stopPointer(e.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},t.Touch.prototype.constructor=t.Touch,t.InputHandler=function(e){this.sprite=e,this.game=e.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.scaleLayer=!1,this.dragOffset=new t.Point,this.dragFromCenter=!1,this.dragStartPoint=new t.Point,this.snapPoint=new t.Point,this._dragPoint=new t.Point,this._dragPhase=!1,this._wasEnabled=!1,this._tempPoint=new t.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},t.InputHandler.prototype={start:function(e,n){e=e||0,n===undefined&&(n=!1);if(this.enabled===!1){this.game.input.interactiveItems.add(this),this.useHandCursor=n,this.priorityID=e;for(var r=0;r<10;r++)this._pointerData[r]={id:r,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new t.Point,this.enabled=!0,this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.flagged=!1,this.sprite},addedToGroup:function(){if(this._dragPhase)return;this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){if(this._dragPhase)return;this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1},reset:function(){this.enabled=!1,this.flagged=!1;for(var e=0;e<10;e++)this._pointerData[e]={id:e,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){if(this.enabled===!1)return;this.enabled=!1,this.game.input.interactiveItems.remove(this)},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(e,t,n){return n===undefined&&(n=!0),!this.enabled||this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID?!1:!n&&(this.pixelPerfectClick||this.pixelPerfectOver)?!1:this.priorityID>e||this.priorityID===e&&this.sprite.renderOrderID<t?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(e){return e=e||0,this._pointerData[e].x},pointerY:function(e){return e=e||0,this._pointerData[e].y},pointerDown:function(e){return e=e||0,this._pointerData[e].isDown},pointerUp:function(e){return e=e||0,this._pointerData[e].isUp},pointerTimeDown:function(e){return e=e||0,this._pointerData[e].timeDown},pointerTimeUp:function(e){return e=e||0,this._pointerData[e].timeUp},pointerOver:function(e){if(!this.enabled)return!1;if(e===undefined){for(var t=0;t<10;t++)if(this._pointerData[t].isOver)return!0;return!1}return this._pointerData[e].isOver},pointerOut:function(e){if(!this.enabled)return!1;if(e!==undefined)return this._pointerData[e].isOut;for(var t=0;t<10;t++)if(this._pointerData[t].isOut)return!0},pointerTimeOver:function(e){return e=e||0,this._pointerData[e].timeOver},pointerTimeOut:function(e){return e=e||0,this._pointerData[e].timeOut},pointerDragged:function(e){return e=e||0,this._pointerData[e].isDragged},checkPointerDown:function(e,t){return!e.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible?!1:this.game.input.hitTest(this.sprite,e,this._tempPoint)?(t===undefined&&(t=!1),!t&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(e,t){return!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible?!1:this.game.input.hitTest(this.sprite,e,this._tempPoint)?(t===undefined&&(t=!1),!t&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(e,t,n){if(this.sprite.texture.baseTexture.source){if(e===null&&t===null){this.game.input.getLocalPosition(this.sprite,n,this._tempPoint);var e=this._tempPoint.x,t=this._tempPoint.y}this.sprite.anchor.x!==0&&(e-=-this.sprite.texture.frame.width*this.sprite.anchor.x),this.sprite.anchor.y!==0&&(t-=-this.sprite.texture.frame.height*this.sprite.anchor.y),e+=this.sprite.texture.frame.x,t+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){e-=this.sprite.texture.trim.x,t-=this.sprite.texture.trim.y;if(e<this.sprite.texture.crop.x||e>this.sprite.texture.crop.right||t<this.sprite.texture.crop.y||t>this.sprite.texture.crop.bottom)return this._dx=e,this._dy=t,!1}this._dx=e,this._dy=t,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,e,t,1,1,0,0,1,1);var r=this.game.input.hitContext.getImageData(0,0,1,1);if(r.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(e){if(this.sprite===null||this.sprite.parent===undefined)return;if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible)return this._pointerOutHandler(e),!1;if(this.draggable&&this._draggedPointerID===e.id)return this.updateDrag(e);if(this._pointerData[e.id].isOver)return this.checkPointerOver(e)?(this._pointerData[e.id].x=e.x-this.sprite.x,this._pointerData[e.id].y=e.y-this.sprite.y,!0):(this._pointerOutHandler(e),!1)},_pointerOverHandler:function(e){if(this.sprite===null)return;var t=this._pointerData[e.id];if(t.isOver===!1||e.dirty){var n=t.isOver===!1;t.isOver=!0,t.isOut=!1,t.timeOver=this.game.time.time,t.x=e.x-this.sprite.x,t.y=e.y-this.sprite.y,this.useHandCursor&&t.isDragged===!1&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),n&&this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,e)}},_pointerOutHandler:function(e){if(this.sprite===null)return;var t=this._pointerData[e.id];t.isOver=!1,t.isOut=!0,t.timeOut=this.game.time.time,this.useHandCursor&&t.isDragged===!1&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events&&this.sprite.events.onInputOut$dispatch(this.sprite,e)},_touchedHandler:function(e){if(this.sprite===null)return;var t=this._pointerData[e.id];if(!t.isDown&&t.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,e))return;t.isDown=!0,t.isUp=!1,t.timeDown=this.game.time.time,this.sprite&&this.sprite.events&&this.sprite.events.onInputDown$dispatch(this.sprite,e),e.dirty=!0,this.draggable&&this.isDragged===!1&&this.startDrag(e),this.bringToTop&&this.sprite.bringToTop()}},_releasedHandler:function(e){if(this.sprite===null)return;var t=this._pointerData[e.id];if(t.isDown&&e.isUp){t.isDown=!1,t.isUp=!0,t.timeUp=this.game.time.time,t.downDuration=t.timeUp-t.timeDown;var n=this.checkPointerOver(e);this.sprite&&this.sprite.events&&(this.sprite.events.onInputUp$dispatch(this.sprite,e,n),n&&(n=this.checkPointerOver(e))),t.isOver=n,!n&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),e.dirty=!0,this.draggable&&this.isDragged&&this._draggedPointerID===e.id&&this.stopDrag(e)}},updateDrag:function(e,t){if(e.isUp)return this.stopDrag(e),!1;t===undefined&&(t=!1);var n=this.globalToLocalX(e.x)+this._dragPoint.x+this.dragOffset.x,r=this.globalToLocalY(e.y)+this._dragPoint.y+this.dragOffset.y;return this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=n),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=r),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y))):(this.allowHorizontalDrag&&(this.sprite.x=n),this.allowVerticalDrag&&(this.sprite.y=r),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.x,this.sprite.y))),this.sprite.events.onDragUpdate.dispatch(this.sprite,e,n,r,this.snapPoint,t),!0},justOver:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isOver&&this.overDuration(e)<t},justOut:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isOut&&this.game.time.time-this._pointerData[e].timeOut<t},justPressed:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isDown&&this.downDuration(e)<t},justReleased:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isUp&&this.game.time.time-this._pointerData[e].timeUp<t},overDuration:function(e){return e=e||0,this._pointerData[e].isOver?this.game.time.time-this._pointerData[e].timeOver:-1},downDuration:function(e){return e=e||0,this._pointerData[e].isDown?this.game.time.time-this._pointerData[e].timeDown:-1},enableDrag:function(e,n,r,i,s,o){e===undefined&&(e=!1),n===undefined&&(n=!1),r===undefined&&(r=!1),i===undefined&&(i=255),s===undefined&&(s=null),o===undefined&&(o=null),this._dragPoint=new t.Point,this.draggable=!0,this.bringToTop=n,this.dragOffset=new t.Point,this.dragFromCenter=e,this.pixelPerfectClick=r,this.pixelPerfectAlpha=i,s&&(this.boundsRect=s),o&&(this.boundsSprite=o)},disableDrag:function(){if(this._pointerData)for(var e=0;e<10;e++)this._pointerData[e].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1},startDrag:function(e){var t=this.sprite.x,n=this.sprite.y;this.isDragged=!0,this._draggedPointerID=e.id,this._pointerData[e.id].isDragged=!0;if(this.sprite.fixedToCamera)this.dragFromCenter?(this.sprite.centerOn(e.x,e.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-e.x,this.sprite.cameraOffset.y-e.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-e.x,this.sprite.cameraOffset.y-e.y);else{if(this.dragFromCenter){var r=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(e.x)+(this.sprite.x-r.centerX),this.sprite.y=this.globalToLocalY(e.y)+(this.sprite.y-r.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(e.x),this.sprite.y-this.globalToLocalY(e.y))}this.updateDrag(e,!0),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.dragStartPoint.set(t,n),this.sprite.events.onDragStart$dispatch(this.sprite,e,t,n)},globalToLocalX:function(e){return this.scaleLayer&&(e-=this.game.scale.grid.boundsFluid.x,e*=this.game.scale.grid.scaleFluidInversed.x),e},globalToLocalY:function(e){return this.scaleLayer&&(e-=this.game.scale.grid.boundsFluid.y,e*=this.game.scale.grid.scaleFluidInversed.y),e},stopDrag:function(e){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[e.id].isDragged=!1,this._dragPhase=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop$dispatch(this.sprite,e),this.checkPointerOver(e)===!1&&this._pointerOutHandler(e)},setDragLock:function(e,t){e===undefined&&(e=!0),t===undefined&&(t=!0),this.allowHorizontalDrag=e,this.allowVerticalDrag=t},enableSnap:function(e,t,n,r,i,s){n===undefined&&(n=!0),r===undefined&&(r=!1),i===undefined&&(i=0),s===undefined&&(s=0),this.snapX=e,this.snapY=t,this.snapOffsetX=i,this.snapOffsetY=s,this.snapOnDrag=n,this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},t.InputHandler.prototype.constructor=t.InputHandler,t.Gamepad=function(e){this.game=e,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.enabled=!0,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!=-1||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new t.SinglePad(e,this),new t.SinglePad(e,this),new t.SinglePad(e,this),new t.SinglePad(e,this)]},t.Gamepad.prototype={addCallbacks:function(e,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback,this.callbackContext=e)},start:function(){if(this._active)return;this._active=!0;var e=this;this._onGamepadConnected=function(t){return e.onGamepadConnected(t)},this._onGamepadDisconnected=function(t){return e.onGamepadDisconnected(t)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)},onGamepadConnected:function(e){var t=e.gamepad;this._rawPads.push(t),this._gamepads[t.index].connect(t)},onGamepadDisconnected:function(e){var t=e.gamepad;for(var n in this._rawPads)this._rawPads[n].index===t.index&&this._rawPads.splice(n,1);this._gamepads[t.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads)var e=navigator.getGamepads();else if(navigator.webkitGetGamepads)var e=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)var e=navigator.webkitGamepads();if(e){this._rawPads=[];var t=!1;for(var n=0;n<e.length;n++){typeof e[n]!==this._prevRawGamepadTypes[n]&&(t=!0,this._prevRawGamepadTypes[n]=typeof e[n]),e[n]&&this._rawPads.push(e[n]);if(n===3)break}if(t){var r={rawIndices:{},padIndices:{}},i;for(var s=0;s<this._gamepads.length;s++){i=this._gamepads[s];if(i.connected)for(var o=0;o<this._rawPads.length;o++)this._rawPads[o].index===i.index&&(r.rawIndices[i.index]=!0,r.padIndices[s]=!0)}for(var u=0;u<this._gamepads.length;u++){i=this._gamepads[u];if(r.padIndices[u])continue;this._rawPads.length<1&&i.disconnect();for(var a=0;a<this._rawPads.length;a++){if(r.padIndices[u])break;var f=this._rawPads[a];if(f){if(r.rawIndices[f.index]){i.disconnect();continue}i.connect(f),r.rawIndices[f.index]=!0,r.padIndices[u]=!0}else i.disconnect()}}}}},setDeadZones:function(e){for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].deadZone=e},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].reset()},justPressed:function(e,t){for(var n=0;n<this._gamepads.length;n++)if(this._gamepads[n].justPressed(e,t)===!0)return!0;return!1},justReleased:function(e,t){for(var n=0;n<this._gamepads.length;n++)if(this._gamepads[n].justReleased(e,t)===!0)return!0;return!1},isDown:function(e){for(var t=0;t<this._gamepads.length;t++)if(this._gamepads[t].isDown(e)===!0)return!0;return!1},destroy:function(){this.stop();for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].destroy()}},t.Gamepad.prototype.constructor=t.Gamepad,Object.defineProperty(t.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(t.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(t.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(t.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(t.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(t.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(t.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),t.Gamepad.BUTTON_0=0,t.Gamepad.BUTTON_1=1,t.Gamepad.BUTTON_2=2,t.Gamepad.BUTTON_3=3,t.Gamepad.BUTTON_4=4,t.Gamepad.BUTTON_5=5,t.Gamepad.BUTTON_6=6,t.Gamepad.BUTTON_7=7,t.Gamepad.BUTTON_8=8,t.Gamepad.BUTTON_9=9,t.Gamepad.BUTTON_10=10,t.Gamepad.BUTTON_11=11,t.Gamepad.BUTTON_12=12,t.Gamepad.BUTTON_13=13,t.Gamepad.BUTTON_14=14,t.Gamepad.BUTTON_15=15,t.Gamepad.AXIS_0=0,t.Gamepad.AXIS_1=1,t.Gamepad.AXIS_2=2,t.Gamepad.AXIS_3=3,t.Gamepad.AXIS_4=4,t.Gamepad.AXIS_5=5,t.Gamepad.AXIS_6=6,t.Gamepad.AXIS_7=7,t.Gamepad.AXIS_8=8,t.Gamepad.AXIS_9=9,t.Gamepad.XBOX360_A=0,t.Gamepad.XBOX360_B=1,t.Gamepad.XBOX360_X=2,t.Gamepad.XBOX360_Y=3,t.Gamepad.XBOX360_LEFT_BUMPER=4,t.Gamepad.XBOX360_RIGHT_BUMPER=5,t.Gamepad.XBOX360_LEFT_TRIGGER=6,t.Gamepad.XBOX360_RIGHT_TRIGGER=7,t.Gamepad.XBOX360_BACK=8,t.Gamepad.XBOX360_START=9,t.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,t.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,t.Gamepad.XBOX360_DPAD_LEFT=14,t.Gamepad.XBOX360_DPAD_RIGHT=15,t.Gamepad.XBOX360_DPAD_UP=12,t.Gamepad.XBOX360_DPAD_DOWN=13,t.Gamepad.XBOX360_STICK_LEFT_X=0,t.Gamepad.XBOX360_STICK_LEFT_Y=1,t.Gamepad.XBOX360_STICK_RIGHT_X=2,t.Gamepad.XBOX360_STICK_RIGHT_Y=3,t.Gamepad.PS3XC_X=0,t.Gamepad.PS3XC_CIRCLE=1,t.Gamepad.PS3XC_SQUARE=2,t.Gamepad.PS3XC_TRIANGLE=3,t.Gamepad.PS3XC_L1=4,t.Gamepad.PS3XC_R1=5,t.Gamepad.PS3XC_L2=6,t.Gamepad.PS3XC_R2=7,t.Gamepad.PS3XC_SELECT=8,t.Gamepad.PS3XC_START=9,t.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,t.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,t.Gamepad.PS3XC_DPAD_UP=12,t.Gamepad.PS3XC_DPAD_DOWN=13,t.Gamepad.PS3XC_DPAD_LEFT=14,t.Gamepad.PS3XC_DPAD_RIGHT=15,t.Gamepad.PS3XC_STICK_LEFT_X=0,t.Gamepad.PS3XC_STICK_LEFT_Y=1,t.Gamepad.PS3XC_STICK_RIGHT_X=2,t.Gamepad.PS3XC_STICK_RIGHT_Y=3,t.SinglePad=function(e,t){this.game=e,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=t,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},t.SinglePad.prototype={addCallbacks:function(e,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback,this.callbackContext=e)},getButton:function(e){return this._buttons[e]?this._buttons[e]:null},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||this._rawPad.timestamp&&this._rawPad.timestamp===this._prevTimestamp)return;for(var e=0;e<this._buttonsLen;e++){var t=isNaN(this._rawPad.buttons[e])?this._rawPad.buttons[e].value:this._rawPad.buttons[e];t!==this._buttons[e].value&&(t===1?this.processButtonDown(e,t):t===0?this.processButtonUp(e,t):this.processButtonFloat(e,t))}for(var n=0;n<this._axesLen;n++){var r=this._rawPad.axes[n];r>0&&r>this.deadZone||r<0&&r<-this.deadZone?this.processAxisChange(n,r):this.processAxisChange(n,0)}this._prevTimestamp=this._rawPad.timestamp},connect:function(e){var n=!this.connected;this.connected=!0,this.index=e.index,this._rawPad=e,this._buttons=[],this._buttonsLen=e.buttons.length,this._axes=[],this._axesLen=e.axes.length;for(var r=0;r<this._axesLen;r++)this._axes[r]=e.axes[r];for(var i in e.buttons)i=parseInt(i,10),this._buttons[i]=new t.DeviceButton(this,i);n&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),n&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var e=this.connected,t=this.index;this.connected=!1,this.index=null,this._rawPad=undefined;for(var n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,e&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,t),e&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=undefined;for(var e=0;e<this._buttonsLen;e++)this._buttons[e].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(e,t){if(this._axes[e]===t)return;this._axes[e]=t,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,e,t),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,e,t)},processButtonDown:function(e,t){this._buttons[e]&&this._buttons[e].start(null,t),this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,e,t,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,e,t)},processButtonUp:function(e,t){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,e,t,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,e,t),this._buttons[e]&&this._buttons[e].stop(null,t)},processButtonFloat:function(e,t){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,e,t,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,e,t),this._buttons[e]&&this._buttons[e].padFloat(t)},axis:function(e){return this._axes[e]?this._axes[e]:!1},isDown:function(e){return this._buttons[e]?this._buttons[e].isDown:!1},isUp:function(e){return this._buttons[e]?this._buttons[e].isUp:!1},justReleased:function(e,t){if(this._buttons[e])return this._buttons[e].justReleased(t)},justPressed:function(e,t){if(this._buttons[e])return this._buttons[e].justPressed(t)},buttonValue:function(e){return this._buttons[e]?this._buttons[e].value:null},reset:function(){for(var e=0;e<this._axes.length;e++)this._axes[e]=0}},t.SinglePad.prototype.constructor=t.SinglePad,t.Key=function(e,n){this.game=e,this._enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.repeats=0,this.keyCode=n,this.onDown=new t.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new t.Signal,this._justDown=!1,this._justUp=!1},t.Key.prototype={update:function(){if(!this._enabled)return;this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(e){if(!this._enabled)return;this.event=e;if(this.isDown)return;this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.shiftKey=e.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)},processKeyUp:function(e){if(!this._enabled)return;this.event=e;if(this.isUp)return;this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)},reset:function(e){e===undefined&&(e=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=0,this._enabled=!0,this._justDown=!1,this._justUp=!1,e&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(e){return e===undefined&&(e=50),this.isDown&&this.duration<e},upDuration:function(e){return e===undefined&&(e=50),!this.isDown&&this.game.time.time-this.timeUp<e}},Object.defineProperty(t.Key.prototype,"justDown",{get:function(){var e=this._justDown;return this._justDown=!1,e}}),Object.defineProperty(t.Key.prototype,"justUp",{get:function(){var e=this._justUp;return this._justUp=!1,e}}),Object.defineProperty(t.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e=!!e,e!==this._enabled&&(e||this.reset(!1),this._enabled=e)}}),t.Key.prototype.constructor=t.Key,t.Keyboard=function(e){this.game=e,this.enabled=!0,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},t.Keyboard.prototype={addCallbacks:function(e,t,n,r){this.callbackContext=e,t!==undefined&&t!==null&&(this.onDownCallback=t),n!==undefined&&n!==null&&(this.onUpCallback=n),r!==undefined&&r!==null&&(this.onPressCallback=r)},addKey:function(e){return this._keys[e]||(this._keys[e]=new t.Key(this.game,e),this.addKeyCapture(e)),this._keys[e]},addKeys:function(e){var t={};for(var n in e)t[n]=this.addKey(e[n]);return t},removeKey:function(e){this._keys[e]&&(this._keys[e]=null,this.removeKeyCapture(e))},createCursorKeys:function(){return this.addKeys({up:t.KeyCode.UP,down:t.KeyCode.DOWN,left:t.KeyCode.LEFT,right:t.KeyCode.RIGHT})},start:function(){if(this.game.device.cocoonJS)return;if(this._onKeyDown!==null)return;var e=this;this._onKeyDown=function(t){return e.processKeyDown(t)},this._onKeyUp=function(t){return e.processKeyUp(t)},this._onKeyPress=function(t){return e.processKeyPress(t)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(e){if(typeof e=="object")for(var t in e)this._capture[e[t]]=!0;else this._capture[e]=!0},removeKeyCapture:function(e){delete this._capture[e]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(e){this.event=e;if(!this.game.input.enabled||!this.enabled)return;this._capture[e.keyCode]&&e.preventDefault(),this._keys[e.keyCode]||(this._keys[e.keyCode]=new t.Key(this.game,e.keyCode)),this._keys[e.keyCode].processKeyDown(e),this._k=e.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,e)},processKeyPress:function(e){this.pressEvent=e;if(!this.game.input.enabled||!this.enabled)return;this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(e.charCode),e)},processKeyUp:function(e){this.event=e;if(!this.game.input.enabled||!this.enabled)return;this._capture[e.keyCode]&&e.preventDefault(),this._keys[e.keyCode]||(this._keys[e.keyCode]=new t.Key(this.game,e.keyCode)),this._keys[e.keyCode].processKeyUp(e),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,e)},reset:function(e){e===undefined&&(e=!0),this.event=null;var t=this._keys.length;while(t--)this._keys[t]&&this._keys[t].reset(e)},downDuration:function(e,t){return this._keys[e]?this._keys[e].downDuration(t):null},upDuration:function(e,t){return this._keys[e]?this._keys[e].upDuration(t):null},isDown:function(e){return this._keys[e]?this._keys[e].isDown:null}},Object.defineProperty(t.Keyboard.prototype,"lastChar",{get:function(){return this.event.charCode===32?"":String.fromCharCode(this.pressEvent.charCode)}}),Object.defineProperty(t.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),t.Keyboard.prototype.constructor=t.Keyboard,t.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(var i in t.KeyCode)t.KeyCode.hasOwnProperty(i)&&!i.match(/[a-z]/)&&(t.Keyboard[i]=t.KeyCode[i]);t.Component=function(){},t.Component.Angle=function(){},t.Component.Angle.prototype={angle:{get:function(){return t.Math.wrapAngle(t.Math.radToDeg(this.rotation))},set:function(e){this.rotation=t.Math.degToRad(t.Math.wrapAngle(e))}}},t.Component.Animation=function(){},t.Component.Animation.prototype={play:function(e,t,n,r){if(this.animations)return this.animations.play(e,t,n,r)}},t.Component.AutoCull=function(){},t.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return!this.autoCull&&!this.checkWorldBounds&&(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},t.Component.Bounds=function(){},t.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},left:{get:function(){return this.x-this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX}},top:{get:function(){return this.y-this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY}}},t.Component.BringToTop=function(){},t.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},t.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this},t.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},t.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},t.Component.Core=function(){},t.Component.Core.install=function(e){t.Utils.mixinPrototype(this,t.Component.Core.prototype),this.components={};for(var n=0;n<e.length;n++){var r=e[n],i=!1;r==="Destroy"&&(i=!0),t.Utils.mixinPrototype(this,t.Component[r].prototype,i),this.components[r]=!0}},t.Component.Core.init=function(e,n,r,i,s){this.game=e,this.key=i,this.position.set(n,r),this.world=new t.Point(n,r),this.previousPosition=new t.Point(n,r),this.events=new t.Events(this),this._bounds=new t.Rectangle,this.components.PhysicsBody&&(this.body=this.body),this.components.Animation&&(this.animations=new t.AnimationManager(this)),this.components.LoadTexture&&i!==null&&this.loadTexture(i,s),this.components.FixedToCamera&&(this.cameraOffset=new t.Point(n,r))},t.Component.Core.preUpdate=function(){if(this.pendingDestroy){this.destroy();return}this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.texture&&(this.texture.requiresReTint=!1),this.animations&&this.animations.update(),this.body&&this.body.preUpdate();for(var e=0;e<this.children.length;e++)this.children[e].preUpdate();return!0},t.Component.Core.prototype={game:null,name:"",components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(e){e?(this._exists=!0,this.body&&this.body.type===t.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===t.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.customRender&&this.key.render(),this.components.PhysicsBody&&t.Component.PhysicsBody.postUpdate.call(this),this.components.FixedToCamera&&t.Component.FixedToCamera.postUpdate.call(this);for(var e=0;e<this.children.length;e++)this.children[e].postUpdate()}},t.Component.Crop=function(){},t.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(e,n){n===undefined&&(n=!1),e?(n&&this.cropRect!==null?this.cropRect.setTo(e.x,e.y,e.width,e.height):n&&this.cropRect===null?this.cropRect=new t.Rectangle(e.x,e.y,e.width,e.height):this.cropRect=e,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(!this.cropRect)return;this._crop=t.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var e=Math.max(this._frame.x,this._crop.x),n=Math.max(this._frame.y,this._crop.y),r=Math.min(this._frame.right,this._crop.right)-e,i=Math.min(this._frame.bottom,this._crop.bottom)-n;this.texture.crop.x=e,this.texture.crop.y=n,this.texture.crop.width=r,this.texture.crop.height=i,this.texture.frame.width=Math.min(r,this.cropRect.width),this.texture.frame.height=Math.min(i,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs()}},t.Component.Delta=function(){},t.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},t.Component.Destroy=function(){},t.Component.Destroy.prototype={destroyPhase:!1,destroy:function(e,n){if(this.game===null||this.destroyPhase)return;e===undefined&&(e=!0),n===undefined&&(n=!1),this.destroyPhase=!0,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof t.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy();var r=this.children.length;if(e)while(r--)this.children[r].destroy(e);else while(r--)this.removeChild(this.children[r]);this._crop&&(this._crop=null),this._frame&&(this._frame=null),t.Video&&this.key instanceof t.Video&&this.key.onChangeSource.remove(this.resizeFrame,this),t.BitmapText&&this._glyphs&&(this._glyphs=[]),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this.renderable=!1,this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null),this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite(),n&&this.texture.destroy(!0),this.destroyPhase=!1,this.pendingDestroy=!1}},t.Events=function(e){this.parent=e},t.Events.prototype={destroy:function(){this._parent=null,this._onDestroy&&this._onDestroy.dispose(),this._onAddedToGroup&&this._onAddedToGroup.dispose(),this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose(),this._onRemovedFromWorld&&this._onRemovedFromWorld.dispose(),this._onKilled&&this._onKilled.dispose(),this._onRevived&&this._onRevived.dispose(),this._onEnterBounds&&this._onEnterBounds.dispose(),this._onOutOfBounds&&this._onOutOfBounds.dispose(),this._onInputOver&&this._onInputOver.dispose(),this._onInputOut&&this._onInputOut.dispose(),this._onInputDown&&this._onInputDown.dispose(),this._onInputUp&&this._onInputUp.dispose(),this._onDragStart&&this._onDragStart.dispose(),this._onDragUpdate&&this._onDragUpdate.dispose(),this._onDragStop&&this._onDragStop.dispose(),this._onAnimationStart&&this._onAnimationStart.dispose(),this._onAnimationComplete&&this._onAnimationComplete.dispose(),this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},t.Events.prototype.constructor=t.Events;for(var s in t.Events.prototype){if(!t.Events.prototype.hasOwnProperty(s)||s.indexOf("on")!==0||t.Events.prototype[s]!==null)continue;(function(e,n){Object.defineProperty(t.Events.prototype,e,{get:function(){return this[n]||(this[n]=new t.Signal)}}),t.Events.prototype[e+"$dispatch"]=function(){return this[n]?this[n].dispatch.apply(this[n],arguments):null}})(s,"_"+s)}t.Component.FixedToCamera=function(){},t.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},t.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(e){e?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new t.Point},t.Component.Health=function(){},t.Component.Health.prototype={health:1,maxHealth:100,damage:function(e){return this.alive&&(this.health-=e,this.health<=0&&this.kill()),this},setHealth:function(e){return this.health=e,this.health>this.maxHealth&&(this.health=this.maxHealth),this},heal:function(e){return this.alive&&(this.health+=e,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}},t.Component.InCamera=function(){},t.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}},t.Component.InputEnabled=function(){},t.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(e){e?this.input===null?(this.input=new t.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}},t.Component.InWorld=function(){},t.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull&&(this.game.world.camera.view.intersects(this._bounds)?(this.renderable=!0,this.game.world.camera.totalInView++):this.renderable=!1);if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill)return this.kill(),!1}}return!0},t.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}},t.Component.LifeSpan=function(){},t.Component.LifeSpan.preUpdate=function(){if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0)return this.kill(),!1}return!0},t.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(e){return e===undefined&&(e=100),this.alive=!0,this.exists=!0,this.visible=!0,typeof this.setHealth=="function"&&this.setHealth(e),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}},t.Component.LoadTexture=function(){},t.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(e,n,r){e===t.PENDING_ATLAS?(e=n,n=0):n=n||0,(r||r===undefined)&&this.animations&&this.animations.stop(),this.key=e,this.customRender=!1;var i=this.game.cache,s=!0,o=!this.texture.baseTexture.scaleMode;if(t.RenderTexture&&e instanceof t.RenderTexture)this.key=e.key,this.setTexture(e);else if(t.BitmapData&&e instanceof t.BitmapData)this.customRender=!0,this.setTexture(e.texture),i.hasFrameData(e.key,t.Cache.BITMAPDATA)&&(s=!this.animations.loadFrameData(i.getFrameData(e.key,t.Cache.BITMAPDATA),n));else if(t.Video&&e instanceof t.Video){this.customRender=!0;var u=e.texture.valid;this.setTexture(e.texture),this.setFrame(e.texture.frame.clone()),e.onChangeSource.add(this.resizeFrame,this),this.texture.valid=u}else if(e instanceof PIXI.Texture)this.setTexture(e);else{var a=i.getImage(e,!0);this.key=a.key,this.setTexture(new PIXI.Texture(a.base)),e==="__default"?this.texture.baseTexture.skipRender=!0:this.texture.baseTexture.skipRender=!1,s=!this.animations.loadFrameData(a.frameData,n)}s&&(this._frame=t.Rectangle.clone(this.texture.frame)),o||(this.texture.baseTexture.scaleMode=1)},setFrame:function(e){this._frame=e,this.texture.frame.x=e.x,this.texture.frame.y=e.y,this.texture.frame.width=e.width,this.texture.frame.height=e.height,this.texture.crop.x=e.x,this.texture.crop.y=e.y,this.texture.crop.width=e.width,this.texture.crop.height=e.height,e.trimmed?(this.texture.trim?(this.texture.trim.x=e.spriteSourceSizeX,this.texture.trim.y=e.spriteSourceSizeY,this.texture.trim.width=e.sourceSizeW,this.texture.trim.height=e.sourceSizeH):this.texture.trim={x:e.spriteSourceSizeX,y:e.spriteSourceSizeY,width:e.sourceSizeW,height:e.sourceSizeH},this.texture.width=e.sourceSizeW,this.texture.height=e.sourceSizeH,this.texture.frame.width=e.sourceSizeW,this.texture.frame.height=e.sourceSizeH):!e.trimmed&&this.texture.trim&&(this.texture.trim=null),this.cropRect&&this.updateCrop(),this.texture.requiresReTint=!0,this.texture._updateUvs(),this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(e,t,n){this.texture.frame.resize(t,n),this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(e){this.animations.frame=e}},frameName:{get:function(){return this.animations.frameName},set:function(e){this.animations.frameName=e}}},t.Component.Overlap=function(){},t.Component.Overlap.prototype={overlap:function(e){return t.Rectangle.intersects(this.getBounds(),e.getBounds())}},t.Component.PhysicsBody=function(){},t.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this._exists||!this.parent.exists?(this.renderOrderID=-1,!1):!0)},t.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()},t.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(e){this.position.x=e,this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(e){this.position.y=e,this.body&&!this.body.dirty&&(this.body._reset=!0)}}},t.Component.Reset=function(){},t.Component.Reset.prototype.reset=function(e,t,n){return n===undefined&&(n=1),this.world.set(e,t),this.position.set(e,t),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=n),this.components.PhysicsBody&&this.body&&this.body.reset(e,t,!1,!1),this},t.Component.ScaleMinMax=function(){},t.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(e){this.scaleMin&&(e.a<this.scaleMin.x&&(e.a=this.scaleMin.x),e.d<this.scaleMin.y&&(e.d=this.scaleMin.y)),this.scaleMax&&(e.a>this.scaleMax.x&&(e.a=this.scaleMax.x),e.d>this.scaleMax.y&&(e.d=this.scaleMax.y))},setScaleMinMax:function(e,n,r,i){n===undefined?n=r=i=e:r===undefined&&(r=i=n,n=e),e===null?this.scaleMin=null:this.scaleMin?this.scaleMin.set(e,n):this.scaleMin=new t.Point(e,n),r===null?this.scaleMax=null:this.scaleMax?this.scaleMax.set(r,i):this.scaleMax=new t.Point(r,i),this.scaleMin===null?this.transformCallback=null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}},t.Component.Smoothed=function(){},t.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(e){e?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}},t.GameObjectFactory=function(e){this.game=e,this.world=this.game.world},t.GameObjectFactory.prototype={existing:function(e){return this.world.add(e)},image:function(e,n,r,i,s){return s===undefined&&(s=this.world),s.add(new t.Image(this.game,e,n,r,i))},sprite:function(e,t,n,r,i){return i===undefined&&(i=this.world),i.create(e,t,n,r)},creature:function(e,n,r,i,s){s===undefined&&(s=this.world);var o=new t.Creature(this.game,e,n,r,i);return s.add(o),o},tween:function(e){return this.game.tweens.create(e)},group:function(e,n,r,i,s){return new t.Group(this.game,e,n,r,i,s)},physicsGroup:function(e,n,r,i){return new t.Group(this.game,n,r,i,!0,e)},spriteBatch:function(e,n,r){return e===undefined&&(e=null),n===undefined&&(n="group"),r===undefined&&(r=!1),new t.SpriteBatch(this.game,e,n,r)},audio:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},sound:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},audioSprite:function(e){return this.game.sound.addSprite(e)},tileSprite:function(e,n,r,i,s,o,u){return u===undefined&&(u=this.world),u.add(new t.TileSprite(this.game,e,n,r,i,s,o))},rope:function(e,n,r,i,s,o){return o===undefined&&(o=this.world),o.add(new t.Rope(this.game,e,n,r,i,s))},text:function(e,n,r,i,s){return s===undefined&&(s=this.world),s.add(new t.Text(this.game,e,n,r,i))},button:function(e,n,r,i,s,o,u,a,f,l){return l===undefined&&(l=this.world),l.add(new t.Button(this.game,e,n,r,i,s,o,u,a,f))},graphics:function(e,n,r){return r===undefined&&(r=this.world),r.add(new t.Graphics(this.game,e,n))},emitter:function(e,n,r){return this.game.particles.add(new t.Particles.Arcade.Emitter(this.game,e,n,r))},retroFont:function(e,n,r,i,s,o,u,a,f){return new t.RetroFont(this.game,e,n,r,i,s,o,u,a,f)},bitmapText:function(e,n,r,i,s,o){return o===undefined&&(o=this.world),o.add(new t.BitmapText(this.game,e,n,r,i,s))},tilemap:function(e,n,r,i,s){return new t.Tilemap(this.game,e,n,r,i,s)},renderTexture:function(e,n,r,i){if(r===undefined||r==="")r=this.game.rnd.uuid();i===undefined&&(i=!1);var s=new t.RenderTexture(this.game,e,n,r);return i&&this.game.cache.addRenderTexture(r,s),s},video:function(e,n){return new t.Video(this.game,e,n)},bitmapData:function(e,n,r,i){i===undefined&&(i=!1);if(r===undefined||r==="")r=this.game.rnd.uuid();var s=new t.BitmapData(this.game,r,e,n);return i&&this.game.cache.addBitmapData(r,s),s},filter:function(e){var n=Array.prototype.slice.call(arguments,1),e=new t.Filter[e](this.game);return e.init.apply(e,n),e},plugin:function(e){return this.game.plugins.add(e)}},t.GameObjectFactory.prototype.constructor=t.GameObjectFactory,t.GameObjectCreator=function(e){this.game=e,this.world=this.game.world},t.GameObjectCreator.prototype={image:function(e,n,r,i){return new t.Image(this.game,e,n,r,i)},sprite:function(e,n,r,i){return new t.Sprite(this.game,e,n,r,i)},tween:function(e){return new t.Tween(e,this.game,this.game.tweens)},group:function(e,n,r,i,s){return new t.Group(this.game,e,n,r,i,s)},spriteBatch:function(e,n,r){return n===undefined&&(n="group"),r===undefined&&(r=!1),new t.SpriteBatch(this.game,e,n,r)},audio:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},audioSprite:function(e){return this.game.sound.addSprite(e)},sound:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},tileSprite:function(e,n,r,i,s,o){return new t.TileSprite(this.game,e,n,r,i,s,o)},rope:function(e,n,r,i,s){return new t.Rope(this.game,e,n,r,i,s)},text:function(e,n,r,i){return new t.Text(this.game,e,n,r,i)},button:function(e,n,r,i,s,o,u,a,f){return new t.Button(this.game,e,n,r,i,s,o,u,a,f)},graphics:function(e,n){return new t.Graphics(this.game,e,n)},emitter:function(e,n,r){return new t.Particles.Arcade.Emitter(this.game,e,n,r)},retroFont:function(e,n,r,i,s,o,u,a,f){return new t.RetroFont(this.game,e,n,r,i,s,o,u,a,f)},bitmapText:function(e,n,r,i,s,o){return new t.BitmapText(this.game,e,n,r,i,s,o)},tilemap:function(e,n,r,i,s){return new t.Tilemap(this.game,e,n,r,i,s)},renderTexture:function(e,n,r,i){if(r===undefined||r==="")r=this.game.rnd.uuid();i===undefined&&(i=!1);var s=new t.RenderTexture(this.game,e,n,r);return i&&this.game.cache.addRenderTexture(r,s),s},bitmapData:function(e,n,r,i){i===undefined&&(i=!1);if(r===undefined||r==="")r=this.game.rnd.uuid();var s=new t.BitmapData(this.game,r,e,n);return i&&this.game.cache.addBitmapData(r,s),s},filter:function(e){var n=Array.prototype.slice.call(arguments,1),e=new t.Filter[e](this.game);return e.init.apply(e,n),e}},t.GameObjectCreator.prototype.constructor=t.GameObjectCreator,t.Sprite=function(e,n,r,i,s){n=n||0,r=r||0,i=i||null,s=s||null,this.type=t.SPRITE,this.physicsType=t.SPRITE,PIXI.Sprite.call(this,PIXI.TextureCache.__default),t.Component.Core.init.call(this,e,n,r,i,s)},t.Sprite.prototype=Object.create(PIXI.Sprite.prototype),t.Sprite.prototype.constructor=t.Sprite,t.Component.Core.install.call(t.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),t.Sprite.prototype.preUpdatePhysics=t.Component.PhysicsBody.preUpdate,t.Sprite.prototype.preUpdateLifeSpan=t.Component.LifeSpan.preUpdate,t.Sprite.prototype.preUpdateInWorld=t.Component.InWorld.preUpdate,t.Sprite.prototype.preUpdateCore=t.Component.Core.preUpdate,t.Sprite.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()},t.Image=function(e,n,r,i,s){n=n||0,r=r||0,i=i||null,s=s||null,this.type=t.IMAGE,PIXI.Sprite.call(this,PIXI.TextureCache.__default),t.Component.Core.init.call(this,e,n,r,i,s)},t.Image.prototype=Object.create(PIXI.Sprite.prototype),t.Image.prototype.constructor=t.Image,t.Component.Core.install.call(t.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","Smoothed"]),t.Image.prototype.preUpdateInWorld=t.Component.InWorld.preUpdate,t.Image.prototype.preUpdateCore=t.Component.Core.preUpdate,t.Image.prototype.preUpdate=function(){return this.preUpdateInWorld()?this.preUpdateCore():!1},t.Button=function(e,n,r,i,s,o,u,a,f,l){n=n||0,r=r||0,i=i||null,s=s||null,o=o||this,t.Image.call(this,e,n,r,i,a),this.type=t.BUTTON,this.physicsType=t.SPRITE,this._onOverFrame=null,this._onOutFrame=null,this._onDownFrame=null,this._onUpFrame=null,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new t.Signal,this.onInputOut=new t.Signal,this.onInputDown=new t.Signal,this.onInputUp=new t.Signal,this.onOverMouseOnly=!0,this.justReleasedPreventsOver=t.PointerMode.TOUCH,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.input.useHandCursor=!0,this.setFrames(u,a,f,l),s!==null&&this.onInputUp.add(s,o),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this),this.events.onRemovedFromWorld.add(this.removedFromWorld,this)},t.Button.prototype=Object.create(t.Image.prototype),t.Button.prototype.constructor=t.Button;var o="Over",u="Out",a="Down",f="Up";t.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},t.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1},t.Button.prototype.setStateFrame=function(e,t,n){var r="_on"+e+"Frame";t!==null?(this[r]=t,n&&this.changeStateFrame(e)):this[r]=null},t.Button.prototype.changeStateFrame=function(e){if(this.freezeFrames)return!1;var t="_on"+e+"Frame",n=this[t];return typeof n=="string"?(this.frameName=n,!0):typeof n=="number"?(this.frame=n,!0):!1},t.Button.prototype.setFrames=function(e,t,n,r){this.setStateFrame(o,e,this.input.pointerOver()),this.setStateFrame(u,t,!this.input.pointerOver()),this.setStateFrame(a,n,this.input.pointerDown()),this.setStateFrame(f,r,this.input.pointerUp())},t.Button.prototype.setStateSound=function(e,n,r){var i="on"+e+"Sound",s="on"+e+"SoundMarker";n instanceof t.Sound||n instanceof t.AudioSprite?(this[i]=n,this[s]=typeof r=="string"?r:""):(this[i]=null,this[s]="")},t.Button.prototype.playStateSound=function(e){var t="on"+e+"Sound",n=this[t];if(n){var r="on"+e+"SoundMarker",i=this[r];return n.play(i),!0}return!1},t.Button.prototype.setSounds=function(e,t,n,r,i,s,l,c){this.setStateSound(o,e,t),this.setStateSound(u,i,s),this.setStateSound(a,n,r),this.setStateSound(f,l,c)},t.Button.prototype.setOverSound=function(e,t){this.setStateSound(o,e,t)},t.Button.prototype.setOutSound=function(e,t){this.setStateSound(u,e,t)},t.Button.prototype.setDownSound=function(e,t){this.setStateSound(a,e,t)},t.Button.prototype.setUpSound=function(e,t){this.setStateSound(f,e,t)},t.Button.prototype.onInputOverHandler=function(e,t){if(t.justReleased()&&(this.justReleasedPreventsOver&t.pointerMode)===t.pointerMode)return;this.changeStateFrame(o);if(this.onOverMouseOnly&&!t.isMouse)return;this.playStateSound(o),this.onInputOver&&this.onInputOver.dispatch(this,t)},t.Button.prototype.onInputOutHandler=function(e,t){this.changeStateFrame(u),this.playStateSound(u),this.onInputOut&&this.onInputOut.dispatch(this,t)},t.Button.prototype.onInputDownHandler=function(e,t){this.changeStateFrame(a),this.playStateSound(a),this.onInputDown&&this.onInputDown.dispatch(this,t)},t.Button.prototype.onInputUpHandler=function(e,t,n){this.playStateSound(f),this.onInputUp&&this.onInputUp.dispatch(this,t,n);if(this.freezeFrames)return;if(this.forceOut===!0||(this.forceOut&t.pointerMode)===t.pointerMode)this.changeStateFrame(u);else{var r=this.changeStateFrame(f);r||(n?this.changeStateFrame(o):this.changeStateFrame(u))}},t.SpriteBatch=function(e,n,r,i){if(n===undefined||n===null)n=e.world;PIXI.SpriteBatch.call(this),t.Group.call(this,e,n,r,i),this.type=t.SPRITEBATCH},t.SpriteBatch.prototype=t.Utils.extend(!0,t.SpriteBatch.prototype,PIXI.SpriteBatch.prototype,t.Group.prototype),t.SpriteBatch.prototype.constructor=t.SpriteBatch,t.BitmapData=function(e,n,r,i){if(r===undefined||r===0)r=256;if(i===undefined||i===0)i=256;this.game=e,this.key=n,this.width=r,this.height=i,this.canvas=PIXI.CanvasPool.create(this,r,i),this.context=this.canvas.getContext("2d",{alpha:!0}),this.ctx=this.context,this.imageData=this.context.getImageData(0,0,r,i),this.data=null,this.imageData&&(this.data=this.imageData.data),this.pixels=null,this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new t.Frame(0,0,0,r,i,"bitmapData"),this.texture.frame=this.textureFrame,this.type=t.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new t.Point,this._size=new t.Point,this._scale=new t.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new t.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new t.Circle,this._swapCanvas=undefined},t.BitmapData.prototype={move:function(e,t,n){return e!==0&&this.moveH(e,n),t!==0&&this.moveV(t,n),this},moveH:function(e,t){t===undefined&&(t=!0),this._swapCanvas===undefined&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var n=this._swapCanvas,r=n.getContext("2d"),i=this.height,s=this.canvas;r.clearRect(0,0,this.width,this.height);if(e<0){e=Math.abs(e);var o=this.width-e;t&&r.drawImage(s,0,0,e,i,o,0,e,i),r.drawImage(s,e,0,o,i,0,0,o,i)}else{var o=this.width-e;t&&r.drawImage(s,o,0,e,i,0,0,e,i),r.drawImage(s,0,0,o,i,e,0,o,i)}return this.clear(),this.copy(this._swapCanvas)},moveV:function(e,t){t===undefined&&(t=!0),this._swapCanvas===undefined&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var n=this._swapCanvas,r=n.getContext("2d"),i=this.width,s=this.canvas;r.clearRect(0,0,this.width,this.height);if(e<0){e=Math.abs(e);var o=this.height-e;t&&r.drawImage(s,0,0,i,e,0,o,i,e),r.drawImage(s,0,e,i,o,0,0,i,o)}else{var o=this.height-e;t&&r.drawImage(s,0,o,i,e,0,0,i,e),r.drawImage(s,0,0,i,o,0,e,i,o)}return this.clear(),this.copy(this._swapCanvas)},add:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t].loadTexture&&e[t].loadTexture(this);else e.loadTexture(this);return this},load:function(e){typeof e=="string"&&(e=this.game.cache.getImage(e));if(!e)return;return this.resize(e.width,e.height),this.cls(),this.draw(e),this.update(),this},clear:function(e,t,n,r){return e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=this.width),r===undefined&&(r=this.height),this.context.clearRect(e,t,n,r),this.dirty=!0,this},fill:function(e,t,n,r){return r===undefined&&(r=1),this.context.fillStyle="rgba("+e+","+t+","+n+","+r+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},generateTexture:function(e){var t=new Image;t.src=this.canvas.toDataURL("image/png");var n=this.game.cache.addImage(e,"",t);return new PIXI.Texture(n.base)},resize:function(e,t){if(e!==this.width||t!==this.height)this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this._swapCanvas!==undefined&&(this._swapCanvas.width=e,this._swapCanvas.height=t),this.baseTexture.width=e,this.baseTexture.height=t,this.textureFrame.width=e,this.textureFrame.height=t,this.texture.width=e,this.texture.height=t,this.texture.crop.width=e,this.texture.crop.height=t,this.update(),this.dirty=!0;return this},update:function(e,t,n,r){return e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=Math.max(1,this.width)),r===undefined&&(r=Math.max(1,this.height)),this.imageData=this.context.getImageData(e,t,n,r),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(e,n,r,i,s,o){r===undefined&&(r=0),i===undefined&&(i=0),s===undefined&&(s=this.width),o===undefined&&(o=this.height);var u=r+s,a=i+o,f=t.Color.createColor(),l={r:0,g:0,b:0,a:0},c=!1;for(var h=i;h<a;h++)for(var p=r;p<u;p++)t.Color.unpackPixel(this.getPixel32(p,h),f),l=e.call(n,f,p,h),l!==!1&&l!==null&&l!==undefined&&(this.setPixel32(p,h,l.r,l.g,l.b,l.a,!1),c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(e,t,n,r,i,s){n===undefined&&(n=0),r===undefined&&(r=0),i===undefined&&(i=this.width),s===undefined&&(s=this.height);var o=n+i,u=r+s,a=0,f=0,l=!1;for(var c=r;c<u;c++)for(var h=n;h<o;h++)a=this.getPixel32(h,c),f=e.call(t,a,h,c),f!==a&&(this.pixels[c*this.width+h]=f,l=!0);return l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(e,n,r,i,s,o,u,a,f){var l=0,c=0,h=this.width,p=this.height,d=t.Color.packPixel(e,n,r,i);f!==undefined&&f instanceof t.Rectangle&&(l=f.x,c=f.y,h=f.width,p=f.height);for(var v=0;v<p;v++)for(var m=0;m<h;m++)this.getPixel32(l+m,c+v)===d&&this.setPixel32(l+m,c+v,s,o,u,a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(e,n,r,i){var s=e||e===0,o=n||n===0,u=r||r===0;if(!s&&!o&&!u)return;i===undefined&&(i=new t.Rectangle(0,0,this.width,this.height));var a=t.Color.createColor();for(var f=i.y;f<i.bottom;f++)for(var l=i.x;l<i.right;l++)t.Color.unpackPixel(this.getPixel32(l,f),a,!0),s&&(a.h=e),o&&(a.s=n),u&&(a.l=r),t.Color.HSLtoRGB(a.h,a.s,a.l,a),this.setPixel32(l,f,a.r,a.g,a.b,a.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},shiftHSL:function(e,n,r,i){if(e===undefined||e===null)e=!1;if(n===undefined||n===null)n=!1;if(r===undefined||r===null)r=!1;if(!e&&!n&&!r)return;i===undefined&&(i=new t.Rectangle(0,0,this.width,this.height));var s=t.Color.createColor();for(var o=i.y;o<i.bottom;o++)for(var u=i.x;u<i.right;u++)t.Color.unpackPixel(this.getPixel32(u,o),s,!0),e&&(s.h=this.game.math.wrap(s.h+e,0,1)),n&&(s.s=this.game.math.clamp(s.s+n,0,1)),r&&(s.l=this.game.math.clamp(s.l+r,0,1)),t.Color.HSLtoRGB(s.h,s.s,s.l,s),this.setPixel32(u,o,s.r,s.g,s.b,s.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setPixel32:function(e,n,r,i,s,o,u){return u===undefined&&(u=!0),e>=0&&e<=this.width&&n>=0&&n<=this.height&&(t.Device.LITTLE_ENDIAN?this.pixels[n*this.width+e]=o<<24|s<<16|i<<8|r:this.pixels[n*this.width+e]=r<<24|i<<16|s<<8|o,u&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(e,t,n,r,i,s){return this.setPixel32(e,t,n,r,i,255,s)},getPixel:function(e,n,r){r||(r=t.Color.createColor());var i=~~(e+n*this.width);return i*=4,r.r=this.data[i],r.g=this.data[++i],r.b=this.data[++i],r.a=this.data[++i],r},getPixel32:function(e,t){if(e>=0&&e<=this.width&&t>=0&&t<=this.height)return this.pixels[t*this.width+e]},getPixelRGB:function(e,n,r,i,s){return t.Color.unpackPixel(this.getPixel32(e,n),r,i,s)},getPixels:function(e){return this.context.getImageData(e.x,e.y,e.width,e.height)},getFirstPixel:function(e){e===undefined&&(e=0);var n=t.Color.createColor(),r=0,i=0,s=1,o=!1;e===1?(s=-1,i=this.height):e===3&&(s=-1,r=this.width);do{t.Color.unpackPixel(this.getPixel32(r,i),n);if(e===0||e===1){r++;if(r===this.width){r=0,i+=s;if(i>=this.height||i<=0)o=!0}}else if(e===2||e===3){i++;if(i===this.height){i=0,r+=s;if(r>=this.width||r<=0)o=!0}}}while(n.a===0&&!o);return n.x=r,n.y=i,n},getBounds:function(e){return e===undefined&&(e=new t.Rectangle),e.x=this.getFirstPixel(2).x,e.x===this.width?e.setTo(0,0,0,0):(e.y=this.getFirstPixel(0).y,e.width=this.getFirstPixel(3).x-e.x+1,e.height=this.getFirstPixel(1).y-e.y+1,e)},addToWorld:function(e,t,n,r,i,s){i=i||1,s=s||1;var o=this.game.add.image(e,t,this);return o.anchor.set(n,r),o.scale.set(i,s),o},copy:function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){if(e===undefined||e===null)e=this;this._image=e;if(e instanceof t.Sprite||e instanceof t.Image||e instanceof t.Text||e instanceof PIXI.Sprite){this._pos.set(e.texture.crop.x,e.texture.crop.y),this._size.set(e.texture.crop.width,e.texture.crop.height),this._scale.set(e.scale.x,e.scale.y),this._anchor.set(e.anchor.x,e.anchor.y),this._rotate=e.rotation,this._alpha.current=e.alpha,this._image=e.texture.baseTexture.source;if(o===undefined||o===null)o=e.x;if(u===undefined||u===null)u=e.y;e.texture.trim&&(o+=e.texture.trim.x-e.anchor.x*e.texture.trim.width,u+=e.texture.trim.y-e.anchor.y*e.texture.trim.height),e.tint!==16777215&&(e.cachedTint!==e.tint&&(e.cachedTint=e.tint,e.tintedTexture=PIXI.CanvasTinter.getTintedTexture(e,e.tint)),this._image=e.tintedTexture)}else{this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1;if(e instanceof t.BitmapData)this._image=e.canvas;else if(typeof e=="string"){e=this.game.cache.getImage(e);if(e===null)return;this._image=e}this._size.set(this._image.width,this._image.height)}if(n===undefined||n===null)n=0;if(r===undefined||r===null)r=0;i&&(this._size.x=i),s&&(this._size.y=s);if(o===undefined||o===null)o=n;if(u===undefined||u===null)u=r;if(a===undefined||a===null)a=this._size.x;if(f===undefined||f===null)f=this._size.y;typeof l=="number"&&(this._rotate=l),typeof c=="number"&&(this._anchor.x=c),typeof h=="number"&&(this._anchor.y=h),typeof p=="number"&&(this._scale.x=p),typeof d=="number"&&(this._scale.y=d),typeof v=="number"&&(this._alpha.current=v),m===undefined&&(m=null),g===undefined&&(g=!1);if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0)return;var y=this.context;return this._alpha.prev=y.globalAlpha,y.save(),y.globalAlpha=this._alpha.current,m&&(this.op=m),g&&(o|=0,u|=0),y.translate(o,u),y.scale(this._scale.x,this._scale.y),y.rotate(this._rotate),y.drawImage(this._image,this._pos.x+n,this._pos.y+r,this._size.x,this._size.y,-a*this._anchor.x,-f*this._anchor.y,a,f),y.restore(),y.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(e,t,n,r,i,s,o){return this.copy(e,t.x,t.y,t.width,t.height,n,r,t.width,t.height,0,0,0,1,1,i,s,o)},draw:function(e,t,n,r,i,s,o){return this.copy(e,null,null,null,null,t,n,r,i,null,null,null,null,null,null,s,o)},drawGroup:function(e,t,n){return e.total>0&&e.forEachExists(this.drawGroupProxy,this,t,n),this},drawGroupProxy:function(e,n,r){if(e.type===t.EMITTER||e.type===t.BITMAPTEXT)for(var i=0;i<e.children.length;i++)this.copy(e.children[i],null,null,null,null,null,null,null,null,null,null,null,null,null,null,n,r);else this.copy(e,null,null,null,null,null,null,null,null,null,null,null,null,null,null,n,r)},drawFull:function(e,n,r){if(e.worldVisible===!1||e.worldAlpha===0||e.hasOwnProperty("exists")&&e.exists===!1)return this;if(e.type!==t.GROUP&&e.type!==t.EMITTER&&e.type!==t.BITMAPTEXT)if(e.type===t.GRAPHICS){var i=e.getBounds();this.ctx.save(),this.ctx.translate(i.x,i.y),PIXI.CanvasGraphics.renderGraphics(e,this.ctx),this.ctx.restore()}else this.copy(e,null,null,null,null,e.worldPosition.x,e.worldPosition.y,null,null,e.worldRotation,null,null,e.worldScale.x,e.worldScale.y,e.worldAlpha,n,r);if(e.children)for(var s=0;s<e.children.length;s++)this.drawFull(e.children[s],n,r);return this},shadow:function(e,t,n,r){var i=this.context;e===undefined||e===null?i.shadowColor="rgba(0,0,0,0)":(i.shadowColor=e,i.shadowBlur=t||5,i.shadowOffsetX=n||10,i.shadowOffsetY=r||10)},alphaMask:function(e,t,n,r){return r===undefined||r===null?this.draw(t).blendSourceAtop():this.draw(t,r.x,r.y,r.width,r.height).blendSourceAtop(),n===undefined||n===null?this.draw(e).blendReset():this.draw(e,n.x,n.y,n.width,n.height).blendReset(),this},extract:function(e,t,n,r,i,s,o,u,a){return i===undefined&&(i=255),s===undefined&&(s=!1),o===undefined&&(o=t),u===undefined&&(u=n),a===undefined&&(a=r),s&&e.resize(this.width,this.height),this.processPixelRGB(function(s,f,l){return s.r===t&&s.g===n&&s.b===r&&e.setPixel32(f,l,o,u,a,i,!1),!1},this),e.context.putImageData(e.imageData,0,0),e.dirty=!0,e},rect:function(e,t,n,r,i){return typeof i!="undefined"&&(this.context.fillStyle=i),this.context.fillRect(e,t,n,r),this},text:function(e,t,n,r,i,s){t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r="14px Courier"),i===undefined&&(i="rgb(255,255,255)"),s===undefined&&(s=!0);var o=this.context,u=o.font;o.font=r,s&&(o.fillStyle="rgb(0,0,0)",o.fillText(e,t+1,n+1)),o.fillStyle=i,o.fillText(e,t,n),o.font=u},circle:function(e,t,n,r){var i=this.context;return r!==undefined&&(i.fillStyle=r),i.beginPath(),i.arc(e,t,n,0,Math.PI*2,!1),i.closePath(),i.fill(),this},line:function(e,t,n,r,i,s){i===undefined&&(i="#fff"),s===undefined&&(s=1);var o=this.context;return o.beginPath(),o.moveTo(e,t),o.lineTo(n,r),o.lineWidth=s,o.strokeStyle=i,o.stroke(),o.closePath(),this},textureLine:function(e,n,r){r===undefined&&(r="repeat-x");if(typeof n=="string"){n=this.game.cache.getImage(n);if(!n)return}var i=e.length;r==="no-repeat"&&i>n.width&&(i=n.width);var s=this.context;return s.fillStyle=s.createPattern(n,r),this._circle=new t.Circle(e.start.x,e.start.y,n.height),this._circle.circumferencePoint(e.angle-1.5707963267948966,!1,this._pos),s.save(),s.translate(this._pos.x,this._pos.y),s.rotate(e.angle),s.fillRect(0,0,i,n.height),s.restore(),this.dirty=!0,this},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.texture.destroy(!0),PIXI.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op="destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op="color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op="luminosity",this}},Object.defineProperty(t.BitmapData.prototype,"smoothed",{get:function(){t.Canvas.getSmoothingEnabled(this.context)},set:function(e){t.Canvas.setSmoothingEnabled(this.context,e)}}),Object.defineProperty(t.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(e){this.context.globalCompositeOperation=e}}),t.BitmapData.getTransform=function(e,t,n,r,i,s){return typeof e!="number"&&(e=0),typeof t!="number"&&(t=0),typeof n!="number"&&(n=1),typeof r!="number"&&(r=1),typeof i!="number"&&(i=0),typeof s!="number"&&(s=0),{sx:n,sy:r,scaleX:n,scaleY:r,skewX:i,skewY:s,translateX:e,translateY:t,tx:e,ty:t}},t.BitmapData.prototype.constructor=t.BitmapData,PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new PIXI.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Graphics.prototype.constructor=PIXI.Graphics,PIXI.Graphics.prototype.lineStyle=function(e,t,n){return this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=n===undefined?1:n,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},PIXI.Graphics.prototype.moveTo=function(e,t){return this.drawShape(new PIXI.Polygon([e,t])),this},PIXI.Graphics.prototype.lineTo=function(e,t){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(e,t),this.dirty=!0,this},PIXI.Graphics.prototype.quadraticCurveTo=function(e,t,n,r){this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var i,s,o=20,u=this.currentPath.shape.points;u.length===0&&this.moveTo(0,0);var a=u[u.length-2],f=u[u.length-1],l=0;for(var c=1;c<=o;++c)l=c/o,i=a+(e-a)*l,s=f+(t-f)*l,u.push(i+(e+(n-e)*l-i)*l,s+(t+(r-t)*l-s)*l);return this.dirty=!0,this},PIXI.Graphics.prototype.bezierCurveTo=function(e,t,n,r,i,s){this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var o=20,u,a,f,l,c,h=this.currentPath.shape.points,p=h[h.length-2],d=h[h.length-1],v=0;for(var m=1;m<=o;++m)v=m/o,u=1-v,a=u*u,f=a*u,l=v*v,c=l*v,h.push(f*p+3*a*v*e+3*u*l*n+c*i,f*d+3*a*v*t+3*u*l*r+c*s);return this.dirty=!0,this},PIXI.Graphics.prototype.arcTo=function(e,t,n,r,i){this.currentPath?this.currentPath.shape.points.length===0&&this.currentPath.shape.points.push(e,t):this.moveTo(e,t);var s=this.currentPath.shape.points,o=s[s.length-2],u=s[s.length-1],a=u-t,f=o-e,l=r-t,c=n-e,h=Math.abs(a*c-f*l);if(h<1e-8||i===0)(s[s.length-2]!==e||s[s.length-1]!==t)&&s.push(e,t);else{var p=a*a+f*f,d=l*l+c*c,v=a*l+f*c,m=i*Math.sqrt(p)/h,g=i*Math.sqrt(d)/h,y=m*v/p,b=g*v/d,w=m*c+g*f,E=m*l+g*a,S=f*(g+y),x=a*(g+y),T=c*(m+b),N=l*(m+b),C=Math.atan2(x-E,S-w),k=Math.atan2(N-E,T-w);this.arc(w+e,E+t,i,C,k,f*l>c*a)}return this.dirty=!0,this},PIXI.Graphics.prototype.arc=function(e,t,n,r,i,s,o){if(r===i)return this;s===undefined&&(s=!1),o===undefined&&(o=40),!s&&i<=r?i+=Math.PI*2:s&&r<=i&&(r+=Math.PI*2);var u=s?(r-i)*-1:i-r,a=Math.ceil(Math.abs(u)/(Math.PI*2))*o;if(u===0)return this;var f=e+Math.cos(r)*n,l=t+Math.sin(r)*n;s&&this.filling?this.moveTo(e,t):this.moveTo(f,l);var c=this.currentPath.shape.points,h=u/(a*2),p=h*2,d=Math.cos(h),v=Math.sin(h),m=a-1,g=m%1/m;for(var y=0;y<=m;y++){var b=y+g*y,w=h+r+p*b,E=Math.cos(w),S=-Math.sin(w);c.push((d*E+v*S)*n+e,(d*-S+v*E)*n+t)}return this.dirty=!0,this},PIXI.Graphics.prototype.beginFill=function(e,t){return this.filling=!0,this.fillColor=e||0,this.fillAlpha=t===undefined?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},PIXI.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},PIXI.Graphics.prototype.drawRect=function(e,t,n,r){return this.drawShape(new PIXI.Rectangle(e,t,n,r)),this},PIXI.Graphics.prototype.drawRoundedRect=function(e,t,n,r,i){return this.drawShape(new PIXI.RoundedRectangle(e,t,n,r,i)),this},PIXI.Graphics.prototype.drawCircle=function(e,t,n){return this.drawShape(new PIXI.Circle(e,t,n)),this},PIXI.Graphics.prototype.drawEllipse=function(e,t,n,r){return this.drawShape(new PIXI.Ellipse(e,t,n,r)),this},PIXI.Graphics.prototype.drawPolygon=function(e){if(e instanceof t.Polygon||e instanceof PIXI.Polygon)e=e.points;var n=e;if(!Array.isArray(n)){n=new Array(arguments.length);for(var r=0;r<n.length;++r)n[r]=arguments[r]}return this.drawShape(new t.Polygon(n)),this},PIXI.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},PIXI.Graphics.prototype.generateTexture=function(e,t,n){e===undefined&&(e=1),t===undefined&&(t=PIXI.scaleModes.DEFAULT),n===undefined&&(n=0);var r=this.getBounds();r.width+=n,r.height+=n;var i=new PIXI.CanvasBuffer(r.width*e,r.height*e),s=PIXI.Texture.fromCanvas(i.canvas,t);return s.baseTexture.resolution=e,i.context.scale(e,e),i.context.translate(-r.x,-r.y),PIXI.CanvasGraphics.renderGraphics(this,i.context),s},PIXI.Graphics.prototype._renderWebGL=function(e){if(this.visible===!1||this.alpha===0||this.isMask===!0)return;if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty)this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1;this._cachedSprite.worldAlpha=this.worldAlpha,PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);return}e.spriteBatch.stop(),e.blendModeManager.setBlendMode(this.blendMode),this._mask&&e.maskManager.pushMask(this._mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock);if(this.blendMode!==e.spriteBatch.currentBlendMode){e.spriteBatch.currentBlendMode=this.blendMode;var t=PIXI.blendModesWebGL[e.spriteBatch.currentBlendMode];e.spriteBatch.gl.blendFunc(t[0],t[1])}this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,e);if(this.children.length){e.spriteBatch.start();for(var n=0;n<this.children.length;n++)this.children[n]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this.mask,e),e.drawCount++,e.spriteBatch.start()},PIXI.Graphics.prototype._renderCanvas=function(e){if(this.visible===!1||this.alpha===0||this.isMask===!0)return;this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint);if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty)this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1;this._cachedSprite.alpha=this.alpha,PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,e);return}var t=e.context,n=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,t.globalCompositeOperation=PIXI.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e);var r=e.resolution;t.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*r,n.ty*r),PIXI.CanvasGraphics.renderGraphics(this,t);for(var i=0;i<this.children.length;i++)this.children[i]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)},PIXI.Graphics.prototype.getBounds=function(e){if(!this._currentBounds){if(!this.renderable)return PIXI.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var t=this._localBounds,n=t.x,r=t.width+t.x,i=t.y,s=t.height+t.y,o=e||this.worldTransform,u=o.a,a=o.b,f=o.c,l=o.d,c=o.tx,h=o.ty,p=u*r+f*s+c,d=l*s+a*r+h,v=u*n+f*s+c,m=l*s+a*n+h,g=u*n+f*i+c,y=l*i+a*n+h,b=u*r+f*i+c,w=l*i+a*r+h,E=p,S=d,x=p,T=d;x=v<x?v:x,x=g<x?g:x,x=b<x?b:x,T=m<T?m:T,T=y<T?y:T,T=w<T?w:T,E=v>E?v:E,E=g>E?g:E,E=b>E?b:E,S=m>S?m:S,S=y>S?y:S,S=w>S?w:S,this._bounds.x=x,this._bounds.width=E-x,this._bounds.y=T,this._bounds.height=S-T,this._currentBounds=this._bounds}return this._currentBounds},PIXI.Graphics.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,tempPoint);var t=this.graphicsData;for(var n=0;n<t.length;n++){var r=t[n];if(!r.fill)continue;if(r.shape&&r.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1},PIXI.Graphics.prototype.updateLocalBounds=function(){var e=Infinity,n=-Infinity,r=Infinity,i=-Infinity;if(this.graphicsData.length){var s,o,u,a,f,l;for(var c=0;c<this.graphicsData.length;c++){var h=this.graphicsData[c],p=h.type,d=h.lineWidth;s=h.shape;if(p===PIXI.Graphics.RECT||p===PIXI.Graphics.RREC)u=s.x-d/2,a=s.y-d/2,f=s.width+d,l=s.height+d,e=u<e?u:e,n=u+f>n?u+f:n,r=a<r?a:r,i=a+l>i?a+l:i;else if(p===PIXI.Graphics.CIRC)u=s.x,a=s.y,f=s.radius+d/2,l=s.radius+d/2,e=u-f<e?u-f:e,n=u+f>n?u+f:n,r=a-l<r?a-l:r,i=a+l>i?a+l:i;else if(p===PIXI.Graphics.ELIP)u=s.x,a=s.y,f=s.width+d/2,l=s.height+d/2,e=u-f<e?u-f:e,n=u+f>n?u+f:n,r=a-l<r?a-l:r,i=a+l>i?a+l:i;else{o=s.points;for(var v=0;v<o.length;v++)o[v]instanceof t.Point?(u=o[v].x,a=o[v].y):(u=o[v],a=o[v+1],v<o.length-1&&v++),e=u-d<e?u-d:e,n=u+d>n?u+d:n,r=a-d<r?a-d:r,i=a+d>i?a+d:i}}}else e=0,n=0,r=0,i=0;var m=this.boundsPadding;this._localBounds.x=e-m,this._localBounds.width=n-e+m*2,this._localBounds.y=r-m,this._localBounds.height=i-r+m*2},PIXI.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(!this._cachedSprite){var t=new PIXI.CanvasBuffer(e.width,e.height),n=PIXI.Texture.fromCanvas(t.canvas);this._cachedSprite=new PIXI.Sprite(n),this._cachedSprite.buffer=t,this._cachedSprite.worldTransform=this.worldTransform}else this._cachedSprite.buffer.resize(e.width,e.height);this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._cachedSprite.buffer.context.translate(-e.x,-e.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var e=this._cachedSprite,t=e.texture,n=e.buffer.canvas;t.baseTexture.width=n.width,t.baseTexture.height=n.height,t.crop.width=t.frame.width=n.width,t.crop.height=t.frame.height=n.height,e._width=n.width,e._height=n.height,t.baseTexture.dirty()},PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},PIXI.Graphics.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,e instanceof t.Polygon&&(e=e.clone(),e.flatten());var n=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,e);return this.graphicsData.push(n),n.type===PIXI.Graphics.POLY&&(n.shape.closed=this.filling,this.currentPath=n),this.dirty=!0,n},Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap=e,this._cacheAsBitmap?this._generateCachedSprite():this.destroyCachedSprite(),this.dirty=!0,this.webGLDirty=!0}}),PIXI.GraphicsData=function(e,t,n,r,i,s,o){this.lineWidth=e,this.lineColor=t,this.lineAlpha=n,this._lineTint=t,this.fillColor=r,this.fillAlpha=i,this._fillTint=r,this.fill=s,this.shape=o,this.type=o.type},PIXI.GraphicsData.prototype.constructor=PIXI.GraphicsData,PIXI.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},PIXI.PolyK={},PIXI.PolyK.Triangulate=function(e){var t=!0,n=e.length>>1;if(n<3)return[];var r=[],i=[];for(var s=0;s<n;s++)i.push(s);s=0;var o=n;while(o>3){var u=i[(s+0)%o],a=i[(s+1)%o],f=i[(s+2)%o],l=e[2*u],c=e[2*u+1],h=e[2*a],p=e[2*a+1],d=e[2*f],v=e[2*f+1],m=!1;if(PIXI.PolyK._convex(l,c,h,p,d,v,t)){m=!0;for(var g=0;g<o;g++){var y=i[g];if(y===u||y===a||y===f)continue;if(PIXI.PolyK._PointInTriangle(e[2*y],e[2*y+1],l,c,h,p,d,v)){m=!1;break}}}if(m)r.push(u,a,f),i.splice((s+1)%o,1),o--,s=0;else if(s++>3*o){if(!t)return null;r=[],i=[];for(s=0;s<n;s++)i.push(s);s=0,o=n,t=!1}}return r.push(i[0],i[1],i[2]),r},PIXI.PolyK._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&w+E<1},PIXI.PolyK._convex=function(e,t,n,r,i,s,o){return(t-r)*(i-n)+(n-e)*(s-r)>=0===o},PIXI.EarCut={},PIXI.EarCut.Triangulate=function(e,t,n){n=n||2;var r=t&&t.length,i=r?t[0]*n:e.length,s=PIXI.EarCut.linkedList(e,0,i,n,!0),o=[];if(!s)return o;var u,a,f,l,c,h,p;r&&(s=PIXI.EarCut.eliminateHoles(e,t,s,n));if(e.length>80*n){u=f=e[0],a=l=e[1];for(var d=n;d<i;d+=n)c=e[d],h=e[d+1],c<u&&(u=c),h<a&&(a=h),c>f&&(f=c),h>l&&(l=h);p=Math.max(f-u,l-a)}return PIXI.EarCut.earcutLinked(s,o,n,u,a,p),o},PIXI.EarCut.linkedList=function(e,t,n,r,i){var s=0,o,u,a;for(o=t,u=n-r;o<n;o+=r)s+=(e[u]-e[o])*(e[o+1]+e[u+1]),u=o;if(i===s>0)for(o=t;o<n;o+=r)a=PIXI.EarCut.insertNode(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=PIXI.EarCut.insertNode(o,e[o],e[o+1],a);return a},PIXI.EarCut.filterPoints=function(e,t){if(!e)return e;t||(t=e);var n=e,r;do{r=!1;if(!n.steiner&&(PIXI.EarCut.equals(n,n.next)||PIXI.EarCut.area(n.prev,n,n.next)===0)){PIXI.EarCut.removeNode(n),n=t=n.prev;if(n===n.next)return null;r=!0}else n=n.next}while(r||n!==t);return t},PIXI.EarCut.earcutLinked=function(e,t,n,r,i,s,o){if(!e)return;!o&&s&&PIXI.EarCut.indexCurve(e,r,i,s);var u=e,a,f;while(e.prev!==e.next){a=e.prev,f=e.next;if(s?PIXI.EarCut.isEarHashed(e,r,i,s):PIXI.EarCut.isEar(e)){t.push(a.i/n),t.push(e.i/n),t.push(f.i/n),PIXI.EarCut.removeNode(e),e=f.next,u=f.next;continue}e=f;if(e===u){o?o===1?(e=PIXI.EarCut.cureLocalIntersections(e,t,n),PIXI.EarCut.earcutLinked(e,t,n,r,i,s,2)):o===2&&PIXI.EarCut.splitEarcut(e,t,n,r,i,s):PIXI.EarCut.earcutLinked(PIXI.EarCut.filterPoints(e),t,n,r,i,s,1);break}}},PIXI.EarCut.isEar=function(e){var t=e.prev,n=e,r=e.next;if(PIXI.EarCut.area(t,n,r)>=0)return!1;var i=e.next.next;while(i!==e.prev){if(PIXI.EarCut.pointInTriangle(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&PIXI.EarCut.area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0},PIXI.EarCut.isEarHashed=function(e,t,n,r){var i=e.prev,s=e,o=e.next;if(PIXI.EarCut.area(i,s,o)>=0)return!1;var u=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,a=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,f=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,l=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,c=PIXI.EarCut.zOrder(u,a,t,n,r),h=PIXI.EarCut.zOrder(f,l,t,n,r),p=e.nextZ;while(p&&p.z<=h){if(p!==e.prev&&p!==e.next&&PIXI.EarCut.pointInTriangle(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&PIXI.EarCut.area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}p=e.prevZ;while(p&&p.z>=c){if(p!==e.prev&&p!==e.next&&PIXI.EarCut.pointInTriangle(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&PIXI.EarCut.area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0},PIXI.EarCut.cureLocalIntersections=function(e,t,n){var r=e;do{var i=r.prev,s=r.next.next;PIXI.EarCut.intersects(i,r,r.next,s)&&PIXI.EarCut.locallyInside(i,s)&&PIXI.EarCut.locallyInside(s,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(s.i/n),PIXI.EarCut.removeNode(r),PIXI.EarCut.removeNode(r.next),r=e=s),r=r.next}while(r!==e);return r},PIXI.EarCut.splitEarcut=function(e,t,n,r,i,s){var o=e;do{var u=o.next.next;while(u!==o.prev){if(o.i!==u.i&&PIXI.EarCut.isValidDiagonal(o,u)){var a=PIXI.EarCut.splitPolygon(o,u);o=PIXI.EarCut.filterPoints(o,o.next),a=PIXI.EarCut.filterPoints(a,a.next),PIXI.EarCut.earcutLinked(o,t,n,r,i,s),PIXI.EarCut.earcutLinked(a,t,n,r,i,s);return}u=u.next}o=o.next}while(o!==e)},PIXI.EarCut.eliminateHoles=function(e,t,n,r){var i=[],s,o,u,a,f;for(s=0,o=t.length;s<o;s++)u=t[s]*r,a=s<o-1?t[s+1]*r:e.length,f=PIXI.EarCut.linkedList(e,u,a,r,!1),f===f.next&&(f.steiner=!0),i.push(PIXI.EarCut.getLeftmost(f));i.sort(compareX);for(s=0;s<i.length;s++)PIXI.EarCut.eliminateHole(i[s],n),n=PIXI.EarCut.filterPoints(n,n.next);return n},PIXI.EarCut.compareX=function(e,t){return e.x-t.x},PIXI.EarCut.eliminateHole=function(e,t){t=PIXI.EarCut.findHoleBridge(e,t);if(t){var n=PIXI.EarCut.splitPolygon(t,e);PIXI.EarCut.filterPoints(n,n.next)}},PIXI.EarCut.findHoleBridge=function(e,t){var n=t,r=e.x,i=e.y,s=-Infinity,o;do{if(i<=n.y&&i>=n.next.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);u<=r&&u>s&&(s=u,o=n.x<n.next.x?n:n.next)}n=n.next}while(n!==t);if(!o)return null;if(e.x===o.x)return o.prev;var a=o,f=Infinity,l;n=o.next;while(n!==a)r>=n.x&&n.x>=o.x&&PIXI.EarCut.pointInTriangle(i<o.y?r:s,i,o.x,o.y,i<o.y?s:r,i,n.x,n.y)&&(l=Math.abs(i-n.y)/(r-n.x),(l<f||l===f&&n.x>o.x)&&PIXI.EarCut.locallyInside(n,e)&&(o=n,f=l)),n=n.next;return o},PIXI.EarCut.indexCurve=function(e,t,n,r){var i=e;do i.z===null&&(i.z=PIXI.EarCut.zOrder(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,PIXI.EarCut.sortLinked(i)},PIXI.EarCut.sortLinked=function(e){var t,n,r,i,s,o,u,a,f=1;do{n=e,e=null,s=null,o=0;while(n){o++,r=n,u=0;for(t=0;t<f;t++){u++,r=r.nextZ;if(!r)break}a=f;while(u>0||a>0&&r)u===0?(i=r,r=r.nextZ,a--):a===0||!r?(i=n,n=n.nextZ,u--):n.z<=r.z?(i=n,n=n.nextZ,u--):(i=r,r=r.nextZ,a--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;n=r}s.nextZ=null,f*=2}while(o>1);return e},PIXI.EarCut.zOrder=function(e,t,n,r,i){return e=32767*(e-n)/i,t=32767*(t-r)/i,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1},PIXI.EarCut.getLeftmost=function(e){var t=e,n=e;do t.x<n.x&&(n=t),t=t.next;while(t!==e);return n},PIXI.EarCut.pointInTriangle=function(e,t,n,r,i,s,o,u){return(i-o)*(t-u)-(e-o)*(s-u)>=0&&(e-o)*(r-u)-(n-o)*(t-u)>=0&&(n-o)*(s-u)-(i-o)*(r-u)>=0},PIXI.EarCut.isValidDiagonal=function(e,t){return PIXI.EarCut.equals(e,t)||e.next.i!==t.i&&e.prev.i!==t.i&&!PIXI.EarCut.intersectsPolygon(e,t)&&PIXI.EarCut.locallyInside(e,t)&&PIXI.EarCut.locallyInside(t,e)&&PIXI.EarCut.middleInside(e,t)},PIXI.EarCut.area=function(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)},PIXI.EarCut.equals=function(e,t){return e.x===t.x&&e.y===t.y},PIXI.EarCut.intersects=function(e,t,n,r){return PIXI.EarCut.area(e,t,n)>0!=PIXI.EarCut.area(e,t,r)>0&&PIXI.EarCut.area(n,r,e)>0!=PIXI.EarCut.area(n,r,t)>0},PIXI.EarCut.intersectsPolygon=function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&PIXI.EarCut.intersects(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1},PIXI.EarCut.locallyInside=function(e,t){return PIXI.EarCut.area(e.prev,e,e.next)<0?PIXI.EarCut.area(e,t,e.next)>=0&&PIXI.EarCut.area(e,e.prev,t)>=0:PIXI.EarCut.area(e,t,e.prev)<0||PIXI.EarCut.area(e,e.next,t)<0},PIXI.EarCut.middleInside=function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do n.y>s!=n.next.y>s&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r},PIXI.EarCut.splitPolygon=function(e,t){var n=new PIXI.EarCut.Node(e.i,e.x,e.y),r=new PIXI.EarCut.Node(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r},PIXI.EarCut.insertNode=function(e,t,n,r){var i=new PIXI.EarCut.Node(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i},PIXI.EarCut.removeNode=function(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)},PIXI.EarCut.Node=function(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.stencilBufferLimit=6,PIXI.WebGLGraphics.renderGraphics=function(e,t){var n=t.gl,r=t.projection,i=t.offset,s=t.shaderManager.primitiveShader,o;e.dirty&&PIXI.WebGLGraphics.updateGraphics(e,n);var u=e._webGL[n.id];for(var a=0;a<u.data.length;a++)u.data[a].mode===1?(o=u.data[a],t.stencilManager.pushStencil(e,o,t),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,(o.indices.length-4)*2),t.stencilManager.popStencil(e,o,t)):(o=u.data[a],t.shaderManager.setShader(s),s=t.shaderManager.primitiveShader,n.uniformMatrix3fv(s.translationMatrix,!1,e.worldTransform.toArray(!0)),n.uniform1f(s.flipY,1),n.uniform2f(s.projectionVector,r.x,-r.y),n.uniform2f(s.offsetVector,-i.x,-i.y),n.uniform3fv(s.tintColor,PIXI.hex2rgb(e.tint)),n.uniform1f(s.alpha,e.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,o.buffer),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(s.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,o.indices.length,n.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=function(e,t){var n=e._webGL[t.id];n||(n=e._webGL[t.id]={lastIndex:0,data:[],gl:t}),e.dirty=!1;var r;if(e.clearDirty){e.clearDirty=!1;for(r=0;r<n.data.length;r++){var i=n.data[r];i.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(i)}n.data=[],n.lastIndex=0}var s;for(r=n.lastIndex;r<e.graphicsData.length;r++){var o=e.graphicsData[r];if(o.type===PIXI.Graphics.POLY){o.points=o.shape.points.slice(),o.shape.closed&&(o.points[0]!==o.points[o.points.length-2]||o.points[1]!==o.points[o.points.length-1])&&o.points.push(o.points[0],o.points[1]);if(o.fill&&o.points.length>=PIXI.WebGLGraphics.stencilBufferLimit)if(o.points.length<PIXI.WebGLGraphics.stencilBufferLimit*2){s=PIXI.WebGLGraphics.switchMode(n,0);var u=PIXI.WebGLGraphics.buildPoly(o,s);u||(s=PIXI.WebGLGraphics.switchMode(n,1),PIXI.WebGLGraphics.buildComplexPoly(o,s))}else s=PIXI.WebGLGraphics.switchMode(n,1),PIXI.WebGLGraphics.buildComplexPoly(o,s);o.lineWidth>0&&(s=PIXI.WebGLGraphics.switchMode(n,0),PIXI.WebGLGraphics.buildLine(o,s))}else s=PIXI.WebGLGraphics.switchMode(n,0),o.type===PIXI.Graphics.RECT?PIXI.WebGLGraphics.buildRectangle(o,s):o.type===PIXI.Graphics.CIRC||o.type===PIXI.Graphics.ELIP?PIXI.WebGLGraphics.buildCircle(o,s):o.type===PIXI.Graphics.RREC&&PIXI.WebGLGraphics.buildRoundedRectangle(o,s);n.lastIndex++}for(r=0;r<n.data.length;r++)s=n.data[r],s.dirty&&s.upload()},PIXI.WebGLGraphics.switchMode=function(e,t){var n;if(!e.data.length)n=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(e.gl),n.mode=t,e.data.push(n);else{n=e.data[e.data.length-1];if(n.mode!==t||t===1)n=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(e.gl),n.mode=t,e.data.push(n)}return n.dirty=!0,n},PIXI.WebGLGraphics.buildRectangle=function(e,t){var n=e.shape,r=n.x,i=n.y,s=n.width,o=n.height;if(e.fill){var u=PIXI.hex2rgb(e.fillColor),a=e.fillAlpha,f=u[0]*a,l=u[1]*a,c=u[2]*a,h=t.points,p=t.indices,d=h.length/6;h.push(r,i),h.push(f,l,c,a),h.push(r+s,i),h.push(f,l,c,a),h.push(r,i+o),h.push(f,l,c,a),h.push(r+s,i+o),h.push(f,l,c,a),p.push(d,d,d+1,d+2,d+3,d+3)}if(e.lineWidth){var v=e.points;e.points=[r,i,r+s,i,r+s,i+o,r,i+o,r,i],PIXI.WebGLGraphics.buildLine(e,t),e.points=v}},PIXI.WebGLGraphics.buildRoundedRectangle=function(e,t){var n=e.shape,r=n.x,i=n.y,s=n.width,o=n.height,u=n.radius,a=[];a.push(r,i+u),a=a.concat(PIXI.WebGLGraphics.quadraticBezierCurve(r,i+o-u,r,i+o,r+u,i+o)),a=a.concat(PIXI.WebGLGraphics.quadraticBezierCurve(r+s-u,i+o,r+s,i+o,r+s,i+o-u)),a=a.concat(PIXI.WebGLGraphics.quadraticBezierCurve(r+s,i+u,r+s,i,r+s-u,i)),a=a.concat(PIXI.WebGLGraphics.quadraticBezierCurve(r+u,i,r,i,r,i+u));if(e.fill){var f=PIXI.hex2rgb(e.fillColor),l=e.fillAlpha,c=f[0]*l,h=f[1]*l,p=f[2]*l,d=t.points,v=t.indices,m=d.length/6,g=PIXI.EarCut.Triangulate(a,null,2),y=0;for(y=0;y<g.length;y+=3)v.push(g[y]+m),v.push(g[y]+m),v.push(g[y+1]+m),v.push(g[y+2]+m),v.push(g[y+2]+m);for(y=0;y<a.length;y++)d.push(a[y],a[++y],c,h,p,l)}if(e.lineWidth){var b=e.points;e.points=a,PIXI.WebGLGraphics.buildLine(e,t),e.points=b}},PIXI.WebGLGraphics.quadraticBezierCurve=function(e,t,n,r,i,s){function d(e,t,n){var r=t-e;return e+r*n}var o,u,a,f,l,c,h=20,p=[],v=0;for(var m=0;m<=h;m++)v=m/h,o=d(e,n,v),u=d(t,r,v),a=d(n,i,v),f=d(r,s,v),l=d(o,a,v),c=d(u,f,v),p.push(l,c);return p},PIXI.WebGLGraphics.buildCircle=function(e,t){var n=e.shape,r=n.x,i=n.y,s,o;e.type===PIXI.Graphics.CIRC?(s=n.radius,o=n.radius):(s=n.width,o=n.height);var u=40,a=Math.PI*2/u,f=0;if(e.fill){var l=PIXI.hex2rgb(e.fillColor),c=e.fillAlpha,h=l[0]*c,p=l[1]*c,d=l[2]*c,v=t.points,m=t.indices,g=v.length/6;m.push(g);for(f=0;f<u+1;f++)v.push(r,i,h,p,d,c),v.push(r+Math.sin(a*f)*s,i+Math.cos(a*f)*o,h,p,d,c),m.push(g++,g++);m.push(g-1)}if(e.lineWidth){var y=e.points;e.points=[];for(f=0;f<u+1;f++)e.points.push(r+Math.sin(a*f)*s,i+Math.cos(a*f)*o);PIXI.WebGLGraphics.buildLine(e,t),e.points=y}},PIXI.WebGLGraphics.buildLine=function(e,t){var n=0,r=e.points;if(r.length===0)return;if(e.lineWidth%2)for(n=0;n<r.length;n++)r[n]+=.5;var i=new PIXI.Point(r[0],r[1]),s=new PIXI.Point(r[r.length-2],r[r.length-1]);if(i.x===s.x&&i.y===s.y){r=r.slice(),r.pop(),r.pop(),s=new PIXI.Point(r[r.length-2],r[r.length-1]);var o=s.x+(i.x-s.x)*.5,u=s.y+(i.y-s.y)*.5;r.unshift(o,u),r.push(o,u)}var a=t.points,f=t.indices,l=r.length/2,c=r.length,h=a.length/6,p=e.lineWidth/2,d=PIXI.hex2rgb(e.lineColor),v=e.lineAlpha,m=d[0]*v,g=d[1]*v,y=d[2]*v,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R;E=r[0],S=r[1],x=r[2],T=r[3],k=-(S-T),L=E-x,R=Math.sqrt(k*k+L*L),k/=R,L/=R,k*=p,L*=p,a.push(E-k,S-L,m,g,y,v),a.push(E+k,S+L,m,g,y,v);for(n=1;n<l-1;n++){E=r[(n-1)*2],S=r[(n-1)*2+1],x=r[n*2],T=r[n*2+1],N=r[(n+1)*2],C=r[(n+1)*2+1],k=-(S-T),L=E-x,R=Math.sqrt(k*k+L*L),k/=R,L/=R,k*=p,L*=p,A=-(T-C),O=x-N,R=Math.sqrt(A*A+O*O),A/=R,O/=R,A*=p,O*=p,D=-L+S-(-L+T),P=-k+x-(-k+E),H=(-k+E)*(-L+T)-(-k+x)*(-L+S),B=-O+C-(-O+T),j=-A+x-(-A+N),F=(-A+N)*(-O+T)-(-A+x)*(-O+C),I=D*j-B*P;if(Math.abs(I)<.1){I+=10.1,a.push(x-k,T-L,m,g,y,v),a.push(x+k,T+L,m,g,y,v);continue}b=(P*F-j*H)/I,w=(B*H-D*F)/I,q=(b-x)*(b-x)+(w-T)+(w-T),q>19600?(M=k-A,_=L-O,R=Math.sqrt(M*M+_*_),M/=R,_/=R,M*=p,_*=p,a.push(x-M,T-_),a.push(m,g,y,v),a.push(x+M,T+_),a.push(m,g,y,v),a.push(x-M,T-_),a.push(m,g,y,v),c++):(a.push(b,w),a.push(m,g,y,v),a.push(x-(b-x),T-(w-T)),a.push(m,g,y,v))}E=r[(l-2)*2],S=r[(l-2)*2+1],x=r[(l-1)*2],T=r[(l-1)*2+1],k=-(S-T),L=E-x,R=Math.sqrt(k*k+L*L),k/=R,L/=R,k*=p,L*=p,a.push(x-k,T-L),a.push(m,g,y,v),a.push(x+k,T+L),a.push(m,g,y,v),f.push(h);for(n=0;n<c;n++)f.push(h++);f.push(h-1)},PIXI.WebGLGraphics.buildComplexPoly=function(e,t){var n=e.points.slice();if(n.length<6)return;var r=t.indices;t.points=n,t.alpha=e.fillAlpha,t.color=PIXI.hex2rgb(e.fillColor);var i=Infinity,s=-Infinity,o=Infinity,u=-Infinity,a,f;for(var l=0;l<n.length;l+=2)a=n[l],f=n[l+1],i=a<i?a:i,s=a>s?a:s,o=f<o?f:o,u=f>u?f:u;n.push(i,o,s,o,s,u,i,u);var c=n.length/2;for(l=0;l<c;l++)r.push(l)},PIXI.WebGLGraphics.buildPoly=function(e,t){var n=e.points;if(n.length<6)return;var r=t.points,i=t.indices,s=n.length/2,o=PIXI.hex2rgb(e.fillColor),u=e.fillAlpha,a=o[0]*u,f=o[1]*u,l=o[2]*u,c=PIXI.EarCut.Triangulate(n,null,2);if(!c)return!1;var h=r.length/6,p=0;for(p=0;p<c.length;p+=3)i.push(c[p]+h),i.push(c[p]+h),i.push(c[p+1]+h),i.push(c[p+2]+h),i.push(c[p+2]+h);for(p=0;p<s;p++)r.push(n[p*2],n[p*2+1],a,f,l,u);return!0},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(e){this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var e=this.gl;this.glPoints=new PIXI.Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndicies=new PIXI.Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndicies,e.STATIC_DRAW),this.dirty=!1},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(e,t){var n=e.worldAlpha;e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1);for(var r=0;r<e.graphicsData.length;r++){var i=e.graphicsData[r],s=i.shape,o=i._fillTint,u=i._lineTint;t.lineWidth=i.lineWidth;if(i.type===PIXI.Graphics.POLY){t.beginPath();var a=s.points;t.moveTo(a[0],a[1]);for(var f=1;f<a.length/2;f++)t.lineTo(a[f*2],a[f*2+1]);s.closed&&t.lineTo(a[0],a[1]),a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.stroke())}else if(i.type===PIXI.Graphics.RECT){if(i.fillColor||i.fillColor===0)t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fillRect(s.x,s.y,s.width,s.height);i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.strokeRect(s.x,s.y,s.width,s.height))}else if(i.type===PIXI.Graphics.CIRC)t.beginPath(),t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.stroke());else if(i.type===PIXI.Graphics.ELIP){var l=s.width*2,c=s.height*2,h=s.x-l/2,p=s.y-c/2;t.beginPath();var d=.5522848,v=l/2*d,m=c/2*d,g=h+l,y=p+c,b=h+l/2,w=p+c/2;t.moveTo(h,w),t.bezierCurveTo(h,w-m,b-v,p,b,p),t.bezierCurveTo(b+v,p,g,w-m,g,w),t.bezierCurveTo(g,w+m,b+v,y,b,y),t.bezierCurveTo(b-v,y,h,w+m,h,w),t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.stroke())}else if(i.type===PIXI.Graphics.RREC){var E=s.x,S=s.y,x=s.width,T=s.height,N=s.radius,C=Math.min(x,T)/2|0;N=N>C?C:N,t.beginPath(),t.moveTo(E,S+N),t.lineTo(E,S+T-N),t.quadraticCurveTo(E,S+T,E+N,S+T),t.lineTo(E+x-N,S+T),t.quadraticCurveTo(E+x,S+T,E+x,S+T-N),t.lineTo(E+x,S+N),t.quadraticCurveTo(E+x,S,E+x-N,S),t.lineTo(E+N,S),t.quadraticCurveTo(E,S,E,S+N),t.closePath();if(i.fillColor||i.fillColor===0)t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fill();i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.stroke())}}},PIXI.CanvasGraphics.renderGraphicsMask=function(e,t){var n=e.graphicsData.length;if(n===0)return;t.beginPath();for(var r=0;r<n;r++){var i=e.graphicsData[r],s=i.shape;if(i.type===PIXI.Graphics.POLY){var o=s.points;t.moveTo(o[0],o[1]);for(var u=1;u<o.length/2;u++)t.lineTo(o[u*2],o[u*2+1]);o[0]===o[o.length-2]&&o[1]===o[o.length-1]&&t.closePath()}else if(i.type===PIXI.Graphics.RECT)t.rect(s.x,s.y,s.width,s.height),t.closePath();else if(i.type===PIXI.Graphics.CIRC)t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath();else if(i.type===PIXI.Graphics.ELIP){var a=s.width*2,f=s.height*2,l=s.x-a/2,c=s.y-f/2,h=.5522848,p=a/2*h,d=f/2*h,v=l+a,m=c+f,g=l+a/2,y=c+f/2;t.moveTo(l,y),t.bezierCurveTo(l,y-d,g-p,c,g,c),t.bezierCurveTo(g+p,c,v,y-d,v,y),t.bezierCurveTo(v,y+d,g+p,m,g,m),t.bezierCurveTo(g-p,m,l,y+d,l,y),t.closePath()}else if(i.type===PIXI.Graphics.RREC){var b=s.x,w=s.y,E=s.width,S=s.height,x=s.radius,T=Math.min(E,S)/2|0;x=x>T?T:x,t.moveTo(b,w+x),t.lineTo(b,w+S-x),t.quadraticCurveTo(b,w+S,b+x,w+S),t.lineTo(b+E-x,w+S),t.quadraticCurveTo(b+E,w+S,b+E,w+S-x),t.lineTo(b+E,w+x),t.quadraticCurveTo(b+E,w,b+E-x,w),t.lineTo(b+x,w),t.quadraticCurveTo(b,w,b,w+x),t.closePath()}}},PIXI.CanvasGraphics.updateGraphicsTint=function(e){if(e.tint===16777215)return;var t=(e.tint>>16&255)/255,n=(e.tint>>8&255)/255,r=(e.tint&255)/255;for(var i=0;i<e.graphicsData.length;i++){var s=e.graphicsData[i],o=s.fillColor|0,u=s.lineColor|0;s._fillTint=((o>>16&255)/255*t*255<<16)+((o>>8&255)/255*n*255<<8)+(o&255)/255*r*255,s._lineTint=((u>>16&255)/255*t*255<<16)+((u>>8&255)/255*n*255<<8)+(u&255)/255*r*255}},t.Graphics=function(e,n,r){n===undefined&&(n=0),r===undefined&&(r=0),this.type=t.GRAPHICS,this.physicsType=t.SPRITE,PIXI.Graphics.call(this),t.Component.Core.init.call(this,e,n,r,"",null)},t.Graphics.prototype=Object.create(PIXI.Graphics.prototype),t.Graphics.prototype.constructor=t.Graphics,t.Component.Core.install.call(t.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),t.Graphics.prototype.preUpdatePhysics=t.Component.PhysicsBody.preUpdate,t.Graphics.prototype.preUpdateLifeSpan=t.Component.LifeSpan.preUpdate,t.Graphics.prototype.preUpdateInWorld=t.Component.InWorld.preUpdate,t.Graphics.prototype.preUpdateCore=t.Component.Core.preUpdate,t.Graphics.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()},t.Graphics.prototype.destroy=function(e){this.clear(),t.Component.Destroy.prototype.destroy.call(this,e)},t.Graphics.prototype.drawTriangle=function(e,n){n===undefined&&(n=!1);var r=new t.Polygon(e);if(n){var i=new t.Point(this.game.camera.x-e[0].x,this.game.camera.y-e[0].y),s=new t.Point(e[1].x-e[0].x,e[1].y-e[0].y),o=new t.Point(e[1].x-e[2].x,e[1].y-e[2].y),u=o.cross(s);i.dot(u)>0&&this.drawPolygon(r)}else this.drawPolygon(r)},t.Graphics.prototype.drawTriangles=function(e,n,r){r===undefined&&(r=!1);var i=new t.Point,s=new t.Point,o=new t.Point,u=[],a;if(!n)if(e[0]instanceof t.Point)for(a=0;a<e.length/3;a++)this.drawTriangle([e[a*3],e[a*3+1],e[a*3+2]],r);else for(a=0;a<e.length/6;a++)i.x=e[a*6+0],i.y=e[a*6+1],s.x=e[a*6+2],s.y=e[a*6+3],o.x=e[a*6+4],o.y=e[a*6+5],this.drawTriangle([i,s,o],r);else if(e[0]instanceof t.Point)for(a=0;a<n.length/3;a++)u.push(e[n[a*3]]),u.push(e[n[a*3+1]]),u.push(e[n[a*3+2]]),u.length===3&&(this.drawTriangle(u,r),u=[]);else for(a=0;a<n.length;a++)i.x=e[n[a]*2],i.y=e[n[a]*2+1],u.push(i.copyTo({})),u.length===3&&(this.drawTriangle(u,r),u=[])},t.RenderTexture=function(e,n,r,i,s,o){i===undefined&&(i=""),s===undefined&&(s=t.scaleModes.DEFAULT),o===undefined&&(o=1),this.game=e,this.key=i,this.type=t.RENDERTEXTURE,this._tempMatrix=new PIXI.Matrix,PIXI.RenderTexture.call(this,n,r,this.game.renderer,s,o),this.render=t.RenderTexture.prototype.render},t.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.renderXY=function(e,t,n,r){e.updateTransform(),this._tempMatrix.copyFrom(e.worldTransform),this._tempMatrix.tx=t,this._tempMatrix.ty=n,this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(e,this._tempMatrix,r):this.renderCanvas(e,this._tempMatrix,r)},t.RenderTexture.prototype.renderRawXY=function(e,t,n,r){this._tempMatrix.identity().translate(t,n),this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(e,this._tempMatrix,r):this.renderCanvas(e,this._tempMatrix,r)},t.RenderTexture.prototype.render=function(e,t,n){t===undefined||t===null?this._tempMatrix.copyFrom(e.worldTransform):this._tempMatrix.copyFrom(t),this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(e,this._tempMatrix,n):this.renderCanvas(e,this._tempMatrix,n)},t.Text=function(e,n,r,i,s){n=n||0,r=r||0,i===undefined||i===null?i="":i=i.toString(),s=t.Utils.extend({},s),this.type=t.TEXT,this.physicsType=t.SPRITE,this.padding=new t.Point,this.textBounds=null,this.canvas=PIXI.CanvasPool.create(this),this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this._res=e.renderer.resolution,this._text=i,this._fontComponents=null,this._lineSpacing=0,this._charCount=0,this._width=0,this._height=0,t.Sprite.call(this,e,n,r,PIXI.Texture.fromCanvas(this.canvas)),this.setStyle(s),i!==""&&this.updateText()},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,t.Text.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()},t.Text.prototype.update=function(){},t.Text.prototype.destroy=function(e){this.texture.destroy(!0),PIXI.CanvasPool.remove(this),t.Component.Destroy.prototype.destroy.call(this,e)},t.Text.prototype.setShadow=function(e,t,n,r,i,s){return e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n="rgba(0, 0, 0, 1)"),r===undefined&&(r=0),i===undefined&&(i=!0),s===undefined&&(s=!0),this.style.shadowOffsetX=e,this.style.shadowOffsetY=t,this.style.shadowColor=n,this.style.shadowBlur=r,this.style.shadowStroke=i,this.style.shadowFill=s,this.dirty=!0,this},t.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.backgroundColor=e.backgroundColor||null,e.fill=e.fill||"black",e.align=e.align||"left",e.boundsAlignH=e.boundsAlignH||"left",e.boundsAlignV=e.boundsAlignV||"top",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.shadowOffsetX=e.shadowOffsetX||0,e.shadowOffsetY=e.shadowOffsetY||0,e.shadowColor=e.shadowColor||"rgba(0,0,0,0)",e.shadowBlur=e.shadowBlur||0,e.tabs=e.tabs||0;var t=this.fontToComponents(e.font);return e.fontStyle&&(t.fontStyle=e.fontStyle),e.fontVariant&&(t.fontVariant=e.fontVariant),e.fontWeight&&(t.fontWeight=e.fontWeight),e.fontSize&&(typeof e.fontSize=="number"&&(e.fontSize=e.fontSize+"px"),t.fontSize=e.fontSize),this._fontComponents=t,e.font=this.componentsToFont(this._fontComponents),this.style=e,this.dirty=!0,this},t.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.runWordWrap(this.text));var t=e.split(/(?:\r\n|\r|\n)/),n=this.style.tabs,r=[],i=0,s=this.determineFontProperties(this.style.font);for(var o=0;o<t.length;o++){if(n===0){var u=this.context.measureText(t[o]).width+this.style.strokeThickness+this.padding.x;this.style.wordWrap&&(u-=this.context.measureText(" ").width)}else{var a=t[o].split(/(?:\t)/),u=this.padding.x+this.style.strokeThickness;if(Array.isArray(n)){var f=0;for(var l=0;l<a.length;l++){var c=Math.ceil(this.context.measureText(a[l]).width);l>0&&(f+=n[l-1]),u=f+c}}else for(var l=0;l<a.length;l++){u+=Math.ceil(this.context.measureText(a[l]).width);var h=this.game.math.snapToCeil(u,n)-u;u+=h}}r[o]=Math.ceil(u),i=Math.max(i,r[o])}this.canvas.width=i*this._res;var p=s.fontSize+this.style.strokeThickness+this.padding.y,d=p*t.length,v=this._lineSpacing;v<0&&Math.abs(v)>p&&(v=-p),v!==0&&(d+=v*t.length),this.canvas.height=d*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round";var m,g;this._charCount=0;for(o=0;o<t.length;o++)m=this.style.strokeThickness/2,g=this.style.strokeThickness/2+o*p+s.ascent,o>0&&(g+=v*o),this.style.align==="right"?m+=i-r[o]:this.style.align==="center"&&(m+=(i-r[o])/2),this.autoRound&&(m=Math.round(m),g=Math.round(g)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.updateLine(t[o],m,g):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),n===0?this.context.strokeText(t[o],m,g):this.renderTabLine(t[o],m,g,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),n===0?this.context.fillText(t[o],m,g):this.renderTabLine(t[o],m,g,!0)));this.updateTexture()},t.Text.prototype.renderTabLine=function(e,t,n,r){var i=e.split(/(?:\t)/),s=this.style.tabs,o=0;if(Array.isArray(s)){var u=0;for(var a=0;a<i.length;a++)a>0&&(u+=s[a-1]),o=t+u,r?this.context.fillText(i[a],o,n):this.context.strokeText(i[a],o,n)}else for(var a=0;a<i.length;a++){var f=Math.ceil(this.context.measureText(i[a]).width);o=this.game.math.snapToCeil(t,s),r?this.context.fillText(i[a],o,n):this.context.strokeText(i[a],o,n),t=o+f}},t.Text.prototype.updateShadow=function(e){e?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},t.Text.prototype.updateLine=function(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];if(this.fontWeights.length>0||this.fontStyles.length>0){var s=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(s.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(s.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(s)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(i,t,n)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(i,t,n)),t+=this.context.measureText(i).width,this._charCount++}},t.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},t.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},t.Text.prototype.addColor=function(e,t){return this.colors[t]=e,this.dirty=!0,this},t.Text.prototype.addStrokeColor=function(e,t){return this.strokeColors[t]=e,this.dirty=!0,this},t.Text.prototype.addFontStyle=function(e,t){return this.fontStyles[t]=e,this.dirty=!0,this},t.Text.prototype.addFontWeight=function(e,t){return this.fontWeights[t]=e,this.dirty=!0,this},t.Text.prototype.precalculateWordWrap=function(e){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t=this.runWordWrap(e);return t.split(/(?:\r\n|\r|\n)/)},t.Text.prototype.runWordWrap=function(e){return this.useAdvancedWrap?this.advancedWordWrap(e):this.basicWordWrap(e)},t.Text.prototype.advancedWordWrap=function(e){var t=this.context,n=this.style.wordWrapWidth,r="",i=e.replace(/ +/gi," ").split(/\r?\n/gi),s=i.length;for(var o=0;o<s;o++){var u=i[o],a="";u=u.replace(/^ *|\s*$/gi,"");var f=t.measureText(u).width;if(f<n){r+=u+"\n";continue}var l=n,c=u.split(" ");for(var h=0;h<c.length;h++){var p=c[h],d=p+" ",v=t.measureText(d).width;if(v>l){if(h===0){var m=d;while(m.length){m=m.slice(0,-1),v=t.measureText(m).width;if(v<=l)break}if(!m.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var g=p.substr(m.length);c[h]=g,a+=m}var y=c[h].length?h:h+1,b=c.slice(y).join(" ").replace(/[ \n]*$/gi,"");i[o+1]=b+" "+(i[o+1]||""),s=i.length;break}a+=d,l-=v}r+=a.replace(/[ \n]*$/gi,"")+"\n"}return r=r.replace(/[\s|\n]*$/gi,""),r},t.Text.prototype.basicWordWrap=function(e){var t="",n=e.split("\n");for(var r=0;r<n.length;r++){var i=this.style.wordWrapWidth,s=n[r].split(" ");for(var o=0;o<s.length;o++){var u=this.context.measureText(s[o]).width,a=u+this.context.measureText(" ").width;a>i?(o>0&&(t+="\n"),t+=s[o]+" ",i=this.style.wordWrapWidth-u):(i-=a,t+=s[o]+" ")}r<n.length-1&&(t+="\n")}return t},t.Text.prototype.updateFont=function(e){var t=this.componentsToFont(e);this.style.font!==t&&(this.style.font=t,this.dirty=!0,this.parent&&this.updateTransform())},t.Text.prototype.fontToComponents=function(e){var t=e.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);return t?{font:e,fontStyle:t[1]||"normal",fontVariant:t[2]||"normal",fontWeight:t[3]||"normal",fontSize:t[4]||"medium",fontFamily:t[5]}:(console.warn("Phaser.Text - unparsable CSS font: "+e),{font:e})},t.Text.prototype.componentsToFont=function(e){var t=[],n;return n=e.fontStyle,n&&n!=="normal"&&t.push(n),n=e.fontVariant,n&&n!=="normal"&&t.push(n),n=e.fontWeight,n&&n!=="normal"&&t.push(n),n=e.fontSize,n&&n!=="medium"&&t.push(n),n=e.fontFamily,n&&t.push(n),t.length||t.push(e.font),t.join(" ")},t.Text.prototype.setText=function(e){return this.text=e.toString()||"",this.dirty=!0,this},t.Text.prototype.parseList=function(e){if(!Array.isArray(e))return this;var t="";for(var n=0;n<e.length;n++)Array.isArray(e[n])?(t+=e[n].join("	"),n<e.length-1&&(t+="\n")):(t+=e[n],n<e.length-1&&(t+="	"));return this.text=t,this.dirty=!0,this},t.Text.prototype.setTextBounds=function(e,n,r,i){return e===undefined?this.textBounds=null:(this.textBounds?this.textBounds.setTo(e,n,r,i):this.textBounds=new t.Rectangle(e,n,r,i),this.style.wordWrapWidth>r&&(this.style.wordWrapWidth=r)),this.updateTexture(),this},t.Text.prototype.updateTexture=function(){var e=this.texture.baseTexture,t=this.texture.crop,n=this.texture.frame,r=this.canvas.width,i=this.canvas.height;e.width=r,e.height=i,t.width=r,t.height=i,n.width=r,n.height=i,this.texture.width=r,this.texture.height=i,this._width=r,this._height=i;if(this.textBounds){var s=this.textBounds.x,o=this.textBounds.y;this.style.boundsAlignH==="right"?s+=this.textBounds.width-this.canvas.width:this.style.boundsAlignH==="center"&&(s+=this.textBounds.halfWidth-this.canvas.width/2),this.style.boundsAlignV==="bottom"?o+=this.textBounds.height-this.canvas.height:this.style.boundsAlignV==="middle"&&(o+=this.textBounds.halfHeight-this.canvas.height/2),this.pivot.x=-s,this.pivot.y=-o}this.renderable=r!==0&&i!==0,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},t.Text.prototype._renderWebGL=function(e){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,e)},t.Text.prototype._renderCanvas=function(e){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,e)},t.Text.prototype.determineFontProperties=function(e){var n=t.Text.fontPropertiesCache[e];if(!n){n={};var r=t.Text.fontPropertiesCanvas,i=t.Text.fontPropertiesContext;i.font=e;var s=Math.ceil(i.measureText("|MÃq").width),o=Math.ceil(i.measureText("|MÃq").width),u=2*o;o=o*1.4|0,r.width=s,r.height=u,i.fillStyle="#f00",i.fillRect(0,0,s,u),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText("|MÃq",0,o);if(!i.getImageData(0,0,s,u))return n.ascent=o,n.descent=o+6,n.fontSize=n.ascent+n.descent,t.Text.fontPropertiesCache[e]=n,n;var a=i.getImageData(0,0,s,u).data,f=a.length,l=s*4,c,h,p=0,d=!1;for(c=0;c<o;c++){for(h=0;h<l;h+=4)if(a[p+h]!==255){d=!0;break}if(!!d)break;p+=l}n.ascent=o-c,p=f-l,d=!1;for(c=u;c>o;c--){for(h=0;h<l;h+=4)if(a[p+h]!==255){d=!0;break}if(!!d)break;p-=l}n.descent=c-o,n.descent+=6,n.fontSize=n.ascent+n.descent,t.Text.fontPropertiesCache[e]=n}return n},t.Text.prototype.getBounds=function(e){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,e)},Object.defineProperty(t.Text.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(t.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(e){e=e||"bold 20pt Arial",this._fontComponents=this.fontToComponents(e),this.updateFont(this._fontComponents)}}),Object.defineProperty(t.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(e){e=e||"Arial",e=e.trim(),!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(e)&&!/['",]/.exec(e)&&(e="'"+e+"'"),this._fontComponents.fontFamily=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(t.Text.prototype,"fontSize",{get:function(){var e=this._fontComponents.fontSize;return e&&/(?:^0$|px$)/.exec(e)?parseInt(e,10):e},set:function(e){e=e||"0",typeof e=="number"&&(e+="px"),this._fontComponents.fontSize=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(t.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontWeight=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(t.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontStyle=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(t.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontVariant=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(t.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(e){e!==this.style.fill&&(this.style.fill=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"align",{get:function(){return this.style.align},set:function(e){e!==this.style.align&&(this.style.align=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"resolution",{get:function(){return this._res},set:function(e){e!==this._res&&(this._res=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(e){e!==this.style.tabs&&(this.style.tabs=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(e){e!==this.style.boundsAlignH&&(this.style.boundsAlignH=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(e){e!==this.style.boundsAlignV&&(this.style.boundsAlignV=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(e){e!==this.style.stroke&&(this.style.stroke=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(e){e!==this.style.strokeThickness&&(this.style.strokeThickness=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(e){e!==this.style.wordWrap&&(this.style.wordWrap=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(e){e!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(e){e!==this._lineSpacing&&(this._lineSpacing=parseFloat(e),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(t.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(e){e!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(e){e!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(e){e!==this.style.shadowColor&&(this.style.shadowColor=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(e){e!==this.style.shadowBlur&&(this.style.shadowBlur=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(e){e!==this.style.shadowStroke&&(this.style.shadowStroke=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(e){e!==this.style.shadowFill&&(this.style.shadowFill=e,this.dirty=!0)}}),Object.defineProperty(t.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Text.fontPropertiesCache={},t.Text.fontPropertiesCanvas=PIXI.CanvasPool.create(t.Text.fontPropertiesCanvas),t.Text.fontPropertiesContext=t.Text.fontPropertiesCanvas.getContext("2d"),t.BitmapText=function(e,n,r,i,s,o,u){n=n||0,r=r||0,i=i||"",s=s||"",o=o||32,u=u||"left",PIXI.DisplayObjectContainer.call(this),this.type=t.BITMAPTEXT,this.physicsType=t.SPRITE,this.textWidth=0,this.textHeight=0,this.anchor=new t.Point,this._prevAnchor=new t.Point,this._glyphs=[],this._maxWidth=0,this._text=s,this._data=e.cache.getBitmapFont(i),this._font=i,this._fontSize=o,this._align=u,this._tint=16777215,this.updateText(),this.dirty=!1,t.Component.Core.init.call(this,e,n,r,"",null)},t.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.Component.Core.install.call(t.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),t.BitmapText.prototype.preUpdatePhysics=t.Component.PhysicsBody.preUpdate,t.BitmapText.prototype.preUpdateLifeSpan=t.Component.LifeSpan.preUpdate,t.BitmapText.prototype.preUpdateInWorld=t.Component.InWorld.preUpdate,t.BitmapText.prototype.preUpdateCore=t.Component.Core.preUpdate,t.BitmapText.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()},t.BitmapText.prototype.postUpdate=function(){t.Component.PhysicsBody.postUpdate.call(this),t.Component.FixedToCamera.postUpdate.call(this),this.body&&this.body.type===t.Physics.ARCADE&&(this.textWidth!==this.body.sourceWidth||this.textHeight!==this.body.sourceHeight)&&this.body.setSize(this.textWidth,this.textHeight)},t.BitmapText.prototype.setText=function(e){this.text=e},t.BitmapText.prototype.scanLine=function(e,t,n){var r=0,i=0,s=-1,o=null,u=this._maxWidth>0?this._maxWidth:null,a=[];for(var f=0;f<n.length;f++){var l=f===n.length-1?!0:!1;if(/(?:\r\n|\r|\n)/.test(n.charAt(f)))return{width:i,text:n.substr(0,f),end:l,chars:a};var c=n.charCodeAt(f),h=e.chars[c],p=0;h===undefined&&(c=32,h=e.chars[c]);var d=o&&h.kerning[o]?h.kerning[o]:0;s=/(\s)/.test(n.charAt(f))?f:s,p=(d+h.texture.width+h.xOffset)*t;if(u&&i+p>=u&&s>-1)return{width:i,text:n.substr(0,f-(f-s)),end:l,chars:a};i+=(h.xAdvance+d)*t,a.push(r+(h.xOffset+d)*t),r+=(h.xAdvance+d)*t,o=c}return{width:i,text:n,end:l,chars:a}},t.BitmapText.prototype.cleanText=function(e,t){t===undefined&&(t="");var n=this._data.font;if(!n)return"";var r=/\r\n|\n\r|\n|\r/g,i=e.replace(r,"\n").split("\n");for(var s=0;s<i.length;s++){var o="",u=i[s];for(var a=0;a<u.length;a++)n.chars[u.charCodeAt(a)]?o=o.concat(u[a]):o=o.concat(t);i[s]=o}return i.join("\n")},t.BitmapText.prototype.updateText=function(){var e=this._data.font;if(!e)return;var t=this.text,n=this._fontSize/e.size,r=[],i=0;this.textWidth=0;do{var s=this.scanLine(e,n,t);s.y=i,r.push(s),s.width>this.textWidth&&(this.textWidth=s.width),i+=e.lineHeight*n,t=t.substr(s.text.length+1)}while(s.end===!1);this.textHeight=i;var o=0,u=0,a=this.textWidth*this.anchor.x,f=this.textHeight*this.anchor.y;for(var l=0;l<r.length;l++){var s=r[l];this._align==="right"?u=this.textWidth-s.width:this._align==="center"&&(u=(this.textWidth-s.width)/2);for(var c=0;c<s.text.length;c++){var h=s.text.charCodeAt(c),p=e.chars[h];p===undefined&&(h=32,p=e.chars[h]);var d=this._glyphs[o];d?d.texture=p.texture:(d=new PIXI.Sprite(p.texture),d.name=s.text[c],this._glyphs.push(d)),d.position.x=s.chars[c]+u-a,d.position.y=s.y+p.yOffset*n-f,d.scale.set(n),d.tint=this.tint,d.texture.requiresReTint=!0,d.parent||this.addChild(d),o++}}for(l=o;l<this._glyphs.length;l++)this.removeChild(this._glyphs[l])},t.BitmapText.prototype.purgeGlyphs=function(){var e=this._glyphs.length,t=[];for(var n=0;n<this._glyphs.length;n++)this._glyphs[n].parent!==this?this._glyphs[n].destroy():t.push(this._glyphs[n]);return this._glyphs=[],this._glyphs=t,this.updateText(),e-t.length},t.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor))this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor);PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Object.defineProperty(t.BitmapText.prototype,"align",{get:function(){return this._align},set:function(e){e!==this._align&&(e==="left"||e==="center"||e==="right")&&(this._align=e,this.updateText())}}),Object.defineProperty(t.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(e){e!==this._tint&&(this._tint=e,this.updateText())}}),Object.defineProperty(t.BitmapText.prototype,"font",{get:function(){return this._font},set:function(e){e!==this._font&&(this._font=e.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}}),Object.defineProperty(t.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){e=parseInt(e,10),e!==this._fontSize&&e>0&&(this._fontSize=e,this.updateText())}}),Object.defineProperty(t.BitmapText.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e.toString()||"",this.updateText())}}),Object.defineProperty(t.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(e){e!==this._maxWidth&&(this._maxWidth=e,this.updateText())}}),Object.defineProperty(t.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(e){e?this._data.base.scaleMode=0:this._data.base.scaleMode=1}}),t.RetroFont=function(e,n,r,i,s,o,u,a,f,l){if(!e.cache.checkImageKey(n))return!1;if(o===undefined||o===null)o=e.cache.getImage(n).width/r;this.characterWidth=r,this.characterHeight=i,this.characterSpacingX=u||0,this.characterSpacingY=a||0,this.characterPerRow=o,this.offsetX=f||0,this.offsetY=l||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=e.cache.getImage(n),this._text="",this.grabData=[],this.frameData=new t.FrameData;var c=this.offsetX,h=this.offsetY,p=0;for(var d=0;d<s.length;d++){var v=this.frameData.addFrame(new t.Frame(d,c,h,this.characterWidth,this.characterHeight));this.grabData[s.charCodeAt(d)]=v.index,p++,p===this.characterPerRow?(p=0,c=this.offsetX,h+=this.characterHeight+this.characterSpacingY):c+=this.characterWidth+this.characterSpacingX}e.cache.updateFrameData(n,this.frameData),this.stamp=new t.Image(e,0,0,n,0),t.RenderTexture.call(this,e,100,100,"",t.scaleModes.NEAREST),this.type=t.RETROFONT},t.RetroFont.prototype=Object.create(t.RenderTexture.prototype),t.RetroFont.prototype.constructor=t.RetroFont,t.RetroFont.ALIGN_LEFT="left",t.RetroFont.ALIGN_RIGHT="right",t.RetroFont.ALIGN_CENTER="center",t.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",t.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",t.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",t.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",t.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",t.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",t.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",t.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",t.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",t.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",t.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",t.RetroFont.prototype.setFixedWidth=function(e,t){t===undefined&&(t="left"),this.fixedWidth=e,this.align=t},t.RetroFont.prototype.setText=function(e,t,n,r,i,s){this.multiLine=t||!1,this.customSpacingX=n||0,this.customSpacingY=r||0,this.align=i||"left",s?this.autoUpperCase=!1:this.autoUpperCase=!0,e.length>0&&(this.text=e)},t.RetroFont.prototype.buildRetroFontText=function(){var e=0,n=0;this.clear();if(this.multiLine){var r=this._text.split("\n");this.fixedWidth>0?this.resize(this.fixedWidth,r.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),r.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var i=0;i<r.length;i++)e=0,this.align===t.RetroFont.ALIGN_RIGHT?e=this.width-r[i].length*(this.characterWidth+this.customSpacingX):this.align===t.RetroFont.ALIGN_CENTER&&(e=this.width/2-r[i].length*(this.characterWidth+this.customSpacingX)/2,e+=this.customSpacingX/2),e<0&&(e=0),this.pasteLine(r[i],e,n,this.customSpacingX),n+=this.characterHeight+this.customSpacingY}else this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),e=0,this.align===t.RetroFont.ALIGN_RIGHT?e=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===t.RetroFont.ALIGN_CENTER&&(e=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,e+=this.customSpacingX/2),e<0&&(e=0),this.pasteLine(this._text,e,0,this.customSpacingX);this.requiresReTint=!0},t.RetroFont.prototype.pasteLine=function(e,t,n,r){for(var i=0;i<e.length;i++)if(e.charAt(i)===" ")t+=this.characterWidth+r;else if(this.grabData[e.charCodeAt(i)]>=0){this.stamp.frame=this.grabData[e.charCodeAt(i)],this.renderXY(this.stamp,t,n,!1),t+=this.characterWidth+r;if(t>this.width)break}},t.RetroFont.prototype.getLongestLine=function(){var e=0;if(this._text.length>0){var t=this._text.split("\n");for(var n=0;n<t.length;n++)t[n].length>e&&(e=t[n].length)}return e},t.RetroFont.prototype.removeUnsupportedCharacters=function(e){var t="";for(var n=0;n<this._text.length;n++){var r=this._text[n],i=r.charCodeAt(0);if(this.grabData[i]>=0||!e&&r==="\n")t=t.concat(r)}return t},t.RetroFont.prototype.updateOffset=function(e,t){if(this.offsetX===e&&this.offsetY===t)return;var n=e-this.offsetX,r=t-this.offsetY,i=this.game.cache.getFrameData(this.stamp.key).getFrames(),s=i.length;while(s--)i[s].x+=n,i[s].y+=r;this.buildRetroFontText()},Object.defineProperty(t.RetroFont.prototype,"text",{get:function(){return this._text},set:function(e){var t;this.autoUpperCase?t=e.toUpperCase():t=e,t!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(t.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(e){this.stamp.smoothed=e,this.buildRetroFontText()}}),t.Rope=function(e,n,r,i,s,o){this.points=[],this.points=o,this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,n=n||0,r=r||0,i=i||null,s=s||null,this.type=t.ROPE,PIXI.Rope.call(this,PIXI.TextureCache.__default,this.points),t.Component.Core.init.call(this,e,n,r,i,s)},t.Rope.prototype=Object.create(PIXI.Rope.prototype),t.Rope.prototype.constructor=t.Rope,t.Component.Core.install.call(t.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),t.Rope.prototype.preUpdatePhysics=t.Component.PhysicsBody.preUpdate,t.Rope.prototype.preUpdateLifeSpan=t.Component.LifeSpan.preUpdate,t.Rope.prototype.preUpdateInWorld=t.Component.InWorld.preUpdate,t.Rope.prototype.preUpdateCore=t.Component.Core.preUpdate,t.Rope.prototype.preUpdate=function(){return!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()},t.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},t.Rope.prototype.reset=function(e,n){return t.Component.Reset.prototype.reset.call(this,e,n),this},Object.defineProperty(t.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(e){e&&typeof e=="function"?(this._hasUpdateAnimation=!0,this._updateAnimation=e):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(t.Rope.prototype,"segments",{get:function(){var e=[],n,r,i,s,o,u,a,f;for(var l=0;l<this.points.length;l++)n=l*4,r=this.vertices[n]*this.scale.x,i=this.vertices[n+1]*this.scale.y,s=this.vertices[n+4]*this.scale.x,o=this.vertices[n+3]*this.scale.y,u=t.Math.difference(r,s),a=t.Math.difference(i,o),r+=this.world.x,i+=this.world.y,f=new t.Rectangle(r,i,u,a),e.push(f);return e}}),t.TileSprite=function(e,n,r,i,s,o,u){n=n||0,r=r||0,i=i||256,s=s||256,o=o||null,u=u||null,this.type=t.TILESPRITE,this.physicsType=t.SPRITE,this._scroll=new t.Point;var a=e.cache.getImage("__default",!0);PIXI.TilingSprite.call(this,new PIXI.Texture(a.base),i,s),t.Component.Core.init.call(this,e,n,r,o,u)},t.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype),t.TileSprite.prototype.constructor=t.TileSprite,t.Component.Core.install.call(t.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]),t.TileSprite.prototype.preUpdatePhysics=t.Component.PhysicsBody.preUpdate,t.TileSprite.prototype.preUpdateLifeSpan=t.Component.LifeSpan.preUpdate,t.TileSprite.prototype.preUpdateInWorld=t.Component.InWorld.preUpdate,t.TileSprite.prototype.preUpdateCore=t.Component.Core.preUpdate,t.TileSprite.prototype.preUpdate=function(){return this._scroll.x!==0&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),this._scroll.y!==0&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()?!1:this.preUpdateCore()},t.TileSprite.prototype.autoScroll=function(e,t){this._scroll.set(e,t)},t.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)},t.TileSprite.prototype.destroy=function(e){t.Component.Destroy.prototype.destroy.call(this,e),PIXI.TilingSprite.prototype.destroy.call(this)},t.TileSprite.prototype.reset=function(e,n){return t.Component.Reset.prototype.reset.call(this,e,n),this.tilePosition.x=0,this.tilePosition.y=0,this},t.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.iOSVersion=0,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.edge=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.safariVersion=0,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.dolby=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},t.Device=new t.Device,t.Device.onInitialized=new t.Signal,t.Device.whenReady=function(e,t,n){var r=this._readyCheck;if(this.deviceReadyAt||!r)e.call(t,this);else if(r._monitor||n)r._queue=r._queue||[],r._queue.push([e,t]);else{r._monitor=r.bind(this),r._queue=r._queue||[],r._queue.push([e,t]);var i=typeof window.cordova!="undefined",s=navigator.isCocoonJS;document.readyState==="complete"||document.readyState==="interactive"?window.setTimeout(r._monitor,0):i&&!s?document.addEventListener("deviceready",r._monitor,!1):(document.addEventListener("DOMContentLoaded",r._monitor,!1),window.addEventListener("load",r._monitor,!1))}},t.Device._readyCheck=function(){var e=this._readyCheck;if(!document.body)window.setTimeout(e._monitor,20);else if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",e._monitor),document.removeEventListener("DOMContentLoaded",e._monitor),window.removeEventListener("load",e._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);var t;while(t=e._queue.shift()){var n=t[0],r=t[1];n.call(r,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}},t.Device._initialize=function(){function t(){var t=navigator.userAgent;/Playstation Vita/.test(t)?e.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?e.kindle=!0:/Android/.test(t)?e.android=!0:/CrOS/.test(t)?e.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?(e.iOS=!0,navigator.appVersion.match(/OS (\d+)/),e.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(t)?e.linux=!0:/Mac OS/.test(t)?e.macOS=!0:/Windows/.test(t)&&(e.windows=!0);if(/Windows Phone/i.test(t)||/IEMobile/i.test(t))e.android=!1,e.iOS=!1,e.macOS=!1,e.windows=!0,e.windowsPhone=!0;var n=/Silk/.test(t);if(e.windows||e.macOS||e.linux&&!n||e.chromeOS)e.desktop=!0;if(e.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))e.desktop=!1}function n(){e.canvas=!!window.CanvasRenderingContext2D||e.cocoonJS;try{e.localStorage=!!localStorage.getItem}catch(t){e.localStorage=!1}e.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,e.fileSystem=!!window.requestFileSystem,e.webGL=function(){try{var e=document.createElement("canvas");return e.screencanvas=!1,!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}(),e.webGL=!!e.webGL,e.worker=!!window.Worker,e.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,e.quirksMode=document.compatMode==="CSS1Compat"?!1:!0,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,e.getUserMedia=e.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,e.firefox&&e.firefoxVersion<21&&(e.getUserMedia=!1),!e.iOS&&(e.ie||e.firefox||e.chrome)&&(e.canvasBitBltShift=!0);if(e.safari||e.mobileSafari)e.canvasBitBltShift=!1}function r(){if("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)e.touch=!0;if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)e.mspointer=!0;e.cocoonJS||("onwheel"in window||e.ie&&"WheelEvent"in window?e.wheelEvent="wheel":"onmousewheel"in window?e.wheelEvent="mousewheel":e.firefox&&"MouseScrollEvent"in window&&(e.wheelEvent="DOMMouseScroll"))}function i(){var t=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],n=document.createElement("div");for(var r=0;r<t.length;r++)if(n[t[r]]){e.fullscreen=!0,e.requestFullscreen=t[r];break}var i=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(e.fullscreen)for(var r=0;r<i.length;r++)if(document[i[r]]){e.cancelFullscreen=i[r];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(e.fullscreenKeyboard=!0)}function s(){var t=navigator.userAgent;/Arora/.test(t)?e.arora=!0:/Edge\/\d+/.test(t)?e.edge=!0:/Chrome\/(\d+)/.test(t)&&!e.windowsPhone?(e.chrome=!0,e.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(t)?e.epiphany=!0:/Firefox\D+(\d+)/.test(t)?(e.firefox=!0,e.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(t)&&e.iOS?e.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(t)?(e.ie=!0,e.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(t)?e.midori=!0:/Opera/.test(t)?e.opera=!0:/Safari\/(\d+)/.test(t)&&!e.windowsPhone?(e.safari=!0,/Version\/(\d+)\./.test(t)&&(e.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(t)&&(e.ie=!0,e.trident=!0,e.tridentVersion=parseInt(RegExp.$1,10),e.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(t)&&(e.silk=!0),navigator.standalone&&(e.webApp=!0),typeof window.cordova!="undefined"&&(e.cordova=!0),typeof process!="undefined"&&typeof require!="undefined"&&(e.node=!0),e.node&&typeof process.versions=="object"&&(e.nodeWebkit=!!process.versions["node-webkit"],e.electron=!!process.versions.electron),navigator.isCocoonJS&&(e.cocoonJS=!0);if(e.cocoonJS)try{e.cocoonJSApp=typeof CocoonJS!="undefined"}catch(n){e.cocoonJSApp=!1}typeof window.ejecta!="undefined"&&(e.ejecta=!0),/Crosswalk/.test(t)&&(e.crosswalk=!0)}function o(){var t=document.createElement("video"),n=!1;try{if(n=!!t.canPlayType)t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(e.oggVideo=!0),t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(e.h264Video=!0,e.mp4Video=!0),t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(e.webmVideo=!0),t.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(e.vp9Video=!0),t.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(e.hlsVideo=!0)}catch(r){}}function u(){e.audioData=!!window.Audio,e.webAudio=!!window.AudioContext||!!window.webkitAudioContext;var t=document.createElement("audio"),n=!1;try{if(n=!!t.canPlayType){t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(e.ogg=!0);if(t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||t.canPlayType("audio/opus;").replace(/^no$/,""))e.opus=!0;t.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(e.mp3=!0),t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(e.wav=!0);if(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;").replace(/^no$/,""))e.m4a=!0;t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(e.webm=!0);if(t.canPlayType('audio/mp4;codecs="ec-3"')!=="")if(e.edge)e.dolby=!0;else if(e.safari&&e.safariVersion>=9&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var r=parseInt(RegExp.$1,10),i=parseInt(RegExp.$2,10);if(r===10&&i>=11||r>10)e.dolby=!0}}}catch(s){}}function a(){e.pixelRatio=window.devicePixelRatio||1,e.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1,e.iPhone4=e.pixelRatio==2&&e.iPhone,e.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1,typeof Int8Array!="undefined"?e.typedArray=!0:e.typedArray=!1,typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint32Array!="undefined"&&(e.littleEndian=f(),e.LITTLE_ENDIAN=e.littleEndian),e.support32bit=typeof ArrayBuffer!="undefined"&&typeof Uint8ClampedArray!="undefined"&&typeof Int32Array!="undefined"&&e.littleEndian!==null&&l(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(e.vibration=!0)}function f(){var e=new ArrayBuffer(4),t=new Uint8Array(e),n=new Uint32Array(e);return t[0]=161,t[1]=178,t[2]=195,t[3]=212,n[0]==3569595041?!0:n[0]==2712847316?!1:null}function l(){if(Uint8ClampedArray===undefined)return!1;var e=PIXI.CanvasPool.create(this,1,1),t=e.getContext("2d");if(!t)return!1;var n=t.createImageData(1,1);return PIXI.CanvasPool.remove(this),n.data instanceof Uint8ClampedArray}function c(){var t=document.createElement("p"),n,r={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(t,null);for(var i in r)t.style[i]!==undefined&&(t.style[i]="translate3d(1px,1px,1px)",n=window.getComputedStyle(t).getPropertyValue(r[i]));document.body.removeChild(t),e.css3D=n!==undefined&&n.length>0&&n!=="none"}var e=this;t(),s(),u(),o(),c(),a(),n(),i(),r()},t.Device.canPlayAudio=function(e){return e==="mp3"&&this.mp3?!0:e==="ogg"&&(this.ogg||this.opus)?!0:e==="m4a"&&this.m4a?!0:e==="opus"&&this.opus?!0:e==="wav"&&this.wav?!0:e==="webm"&&this.webm?!0:e==="mp4"&&this.dolby?!0:!1},t.Device.canPlayVideo=function(e){return e==="webm"&&(this.webmVideo||this.vp9Video)?!0:e==="mp4"&&(this.mp4Video||this.h264Video)?!0:e!=="ogg"&&e!=="ogv"||!this.oggVideo?e==="mpeg"&&this.hlsVideo?!0:!1:!0},t.Device.isConsoleOpen=function(){if(window.console&&window.console.firebug)return!0;if(window.console){console.profile(),console.profileEnd(),console.clear&&console.clear();if(console.profiles)return console.profiles.length>0}return!1},t.Device.isAndroidStockBrowser=function(){var e=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return e&&e[1]<537},t.Canvas={create:function(e,t,n,r,i){t=t||256,n=n||256;if(i===undefined)var s=PIXI.CanvasPool.create(e,t,n);else var s=document.createElement("canvas");return typeof r=="string"&&r!==""&&(s.id=r),s.width=t,s.height=n,s.style.display="block",s},setBackgroundColor:function(e,t){return t=t||"rgb(0,0,0)",e.style.backgroundColor=t,e},setTouchAction:function(e,t){return t=t||"none",e.style.msTouchAction=t,e.style["ms-touch-action"]=t,e.style["touch-action"]=t,e},setUserSelect:function(e,t){return t=t||"none",e.style["-webkit-touch-callout"]=t,e.style["-webkit-user-select"]=t,e.style["-khtml-user-select"]=t,e.style["-moz-user-select"]=t,e.style["-ms-user-select"]=t,e.style["user-select"]=t,e.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",e},addToDOM:function(e,t,n){var r;return n===undefined&&(n=!0),t&&(typeof t=="string"?r=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(r=t)),r||(r=document.body),n&&r.style&&(r.style.overflow="hidden"),r.appendChild(e),e},removeFromDOM:function(e){e.parentNode&&e.parentNode.removeChild(e)},setTransform:function(e,t,n,r,i,s,o){return e.setTransform(r,s,o,i,t,n),e},setSmoothingEnabled:function(e,n){var r=t.Canvas.getSmoothingPrefix(e);return r&&(e[r]=n),e},getSmoothingPrefix:function(e){var t=["i","webkitI","msI","mozI","oI"];for(var n in t){var r=t[n]+"mageSmoothingEnabled";if(r in e)return r}return null},getSmoothingEnabled:function(e){var n=t.Canvas.getSmoothingPrefix(e);if(n)return e[n]},setImageRenderingCrisp:function(e){var t=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"];for(var n=0;n<t.length;n++)e.style["image-rendering"]=t[n];return e.style.msInterpolationMode="nearest-neighbor",e},setImageRenderingBicubic:function(e){return e.style["image-rendering"]="auto",e.style.msInterpolationMode="bicubic",e}},t.RequestAnimationFrame=function(e,t){t===undefined&&(t=!1),this.game=e,this.isRunning=!1,this.forceSetTimeOut=t;var n=["ms","moz","webkit","o"];for(var r=0;r<n.length&&!window.requestAnimationFrame;r++)window.requestAnimationFrame=window[n[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[r]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},t.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var e=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return e.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return e.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(e){this.game.update(Math.floor(e)),this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}},t.RequestAnimationFrame.prototype.constructor=t.RequestAnimationFrame,t.Math={PI2:Math.PI*2,fuzzyEqual:function(e,t,n){return n===undefined&&(n=1e-4),Math.abs(e-t)<n},fuzzyLessThan:function(e,t,n){return n===undefined&&(n=1e-4),e<t+n},fuzzyGreaterThan:function(e,t,n){return n===undefined&&(n=1e-4),e>t-n},fuzzyCeil:function(e,t){return t===undefined&&(t=1e-4),Math.ceil(e-t)},fuzzyFloor:function(e,t){return t===undefined&&(t=1e-4),Math.floor(e+t)},average:function(){var e=0,t=arguments.length;for(var n=0;n<t;n++)e+=+arguments[n];return e/t},shear:function(e){return e%1},snapTo:function(e,t,n){return n===undefined&&(n=0),t===0?e:(e-=n,e=t*Math.round(e/t),n+e)},snapToFloor:function(e,t,n){return n===undefined&&(n=0),t===0?e:(e-=n,e=t*Math.floor(e/t),n+e)},snapToCeil:function(e,t,n){return n===undefined&&(n=0),t===0?e:(e-=n,e=t*Math.ceil(e/t),n+e)},roundTo:function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=10);var r=Math.pow(n,-t);return Math.round(e*r)/r},floorTo:function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=10);var r=Math.pow(n,-t);return Math.floor(e*r)/r},ceilTo:function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=10);var r=Math.pow(n,-t);return Math.ceil(e*r)/r},angleBetween:function(e,t,n,r){return Math.atan2(r-t,n-e)},angleBetweenY:function(e,t,n,r){return Math.atan2(n-e,r-t)},angleBetweenPoints:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},angleBetweenPointsY:function(e,t){return Math.atan2(t.x-e.x,t.y-e.y)},reverseAngle:function(e){return this.normalizeAngle(e+Math.PI,!0)},normalizeAngle:function(e){return e%=2*Math.PI,e>=0?e:e+2*Math.PI},maxAdd:function(e,t,n){return Math.min(e+t,n)},minSub:function(e,t,n){return Math.max(e-t,n)},wrap:function(e,t,n){var r=n-t;if(r<=0)return 0;var i=(e-t)%r;return i<0&&(i+=r),i+t},wrapValue:function(e,t,n){var r;return e=Math.abs(e),t=Math.abs(t),n=Math.abs(n),r=(e+t)%n,r},isOdd:function(e){return!!(e&1)},isEven:function(e){return!(e&1)},min:function(){if(arguments.length===1&&typeof arguments[0]=="object")var e=arguments[0];else var e=arguments;for(var t=1,n=0,r=e.length;t<r;t++)e[t]<e[n]&&(n=t);return e[n]},max:function(){if(arguments.length===1&&typeof arguments[0]=="object")var e=arguments[0];else var e=arguments;for(var t=1,n=0,r=e.length;t<r;t++)e[t]>e[n]&&(n=t);return e[n]},minProperty:function(e){if(arguments.length===2&&typeof arguments[1]=="object")var t=arguments[1];else var t=arguments.slice(1);for(var n=1,r=0,i=t.length;n<i;n++)t[n][e]<t[r][e]&&(r=n);return t[r][e]},maxProperty:function(e){if(arguments.length===2&&typeof arguments[1]=="object")var t=arguments[1];else var t=arguments.slice(1);for(var n=1,r=0,i=t.length;n<i;n++)t[n][e]>t[r][e]&&(r=n);return t[r][e]},wrapAngle:function(e,t){return t?this.wrap(e,-Math.PI,Math.PI):this.wrap(e,-180,180)},linearInterpolation:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r);return t<0?this.linear(e[0],e[1],r):t>1?this.linear(e[n],e[n-1],n-r):this.linear(e[i],e[i+1>n?n:i+1],r-i)},bezierInterpolation:function(e,t){var n=0,r=e.length-1;for(var i=0;i<=r;i++)n+=Math.pow(1-t,r-i)*Math.pow(t,i)*e[i]*this.bernstein(r,i);return n},catmullRomInterpolation:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r);return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),this.catmullRom(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(this.catmullRom(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(this.catmullRom(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):this.catmullRom(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},linear:function(e,t,n){return(t-e)*n+e},bernstein:function(e,t){return this.factorial(e)/this.factorial(t)/this.factorial(e-t)},factorial:function(e){if(e===0)return 1;var t=e;while(--e)t*=e;return t},catmullRom:function(e,t,n,r,i){var s=(n-e)*.5,o=(r-t)*.5,u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t},difference:function(e,t){return Math.abs(e-t)},roundAwayFromZero:function(e){return e>0?Math.ceil(e):Math.floor(e)},sinCosGenerator:function(e,t,n,r){t===undefined&&(t=1),n===undefined&&(n=1),r===undefined&&(r=1);var i=t,s=n,o=r*Math.PI/e,u=[],a=[];for(var f=0;f<e;f++)s-=i*o,i+=s*o,u[f]=s,a[f]=i;return{sin:a,cos:u,length:e}},distance:function(e,t,n,r){var i=e-n,s=t-r;return Math.sqrt(i*i+s*s)},distanceSq:function(e,t,n,r){var i=e-n,s=t-r;return i*i+s*s},distancePow:function(e,t,n,r,i){return i===undefined&&(i=2),Math.sqrt(Math.pow(n-e,i)+Math.pow(r-t,i))},clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},within:function(e,t,n){return Math.abs(e-t)<=n},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e=Math.max(0,Math.min(1,(e-t)/(n-t))),e*e*(3-2*e)},smootherstep:function(e,t,n){return e=Math.max(0,Math.min(1,(e-t)/(n-t))),e*e*e*(e*(e*6-15)+10)},sign:function(e){return e<0?-1:e>0?1:0},percent:function(e,t,n){return n===undefined&&(n=0),e>t||n>t?1:e<n||n>e?0:(e-n)/t}};var l=Math.PI/180,c=180/Math.PI;return t.Math.degToRad=function(t){return t*l},t.Math.radToDeg=function(t){return t*c},t.RandomDataGenerator=function(e){e===undefined&&(e=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,typeof e=="string"?this.state(e):this.sow(e)},t.RandomDataGenerator.prototype={rnd:function(){var e=2091639*this.s0+this.c*2.3283064365386963e-10;return this.c=e|0,this.s0=this.s1,this.s1=this.s2,this.s2=e-this.c,this.s2},sow:function(e){this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1;if(!e)return;for(var t=0;t<e.length&&e[t]!=null;t++){var n=e[t];this.s0-=this.hash(n),this.s0+=~~(this.s0<0),this.s1-=this.hash(n),this.s1+=~~(this.s1<0),this.s2-=this.hash(n),this.s2+=~~(this.s2<0)}},hash:function(e){var t,n,r;r=4022871197,e=e.toString();for(n=0;n<e.length;n++)r+=e.charCodeAt(n),t=.02519603282416938*r,r=t>>>0,t-=r,t*=r,r=t>>>0,t-=r,r+=t*4294967296;return(r>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(e,t){return Math.floor(this.realInRange(0,t-e+1)+e)},between:function(e,t){return this.integerInRange(e,t)},realInRange:function(e,t){return this.frac()*(t-e)+e},normal:function(){return 1-2*this.frac()},uuid:function(){var e="",t="";for(t=e="";e++<36;t+=~e%5|e*3&4?(e^15?8^this.frac()*(e^20?16:4):4).toString(16):"-");return t},pick:function(e){return e[this.integerInRange(0,e.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(e){return e[~~(Math.pow(this.frac(),2)*(e.length-1)+.5)]},timestamp:function(e,t){return this.realInRange(e||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(e){return typeof e=="string"&&e.match(/^!rnd/)&&(e=e.split(","),this.c=parseFloat(e[1]),this.s0=parseFloat(e[2]),this.s1=parseFloat(e[3]),this.s2=parseFloat(e[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}},t.RandomDataGenerator.prototype.constructor=t.RandomDataGenerator,t.QuadTree=function(e,t,n,r,i,s,o){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(e,t,n,r,i,s,o)},t.QuadTree.prototype={reset:function(e,t,n,r,i,s,o){this.maxObjects=i||10,this.maxLevels=s||4,this.level=o||0,this.bounds={x:Math.round(e),y:Math.round(t),width:n,height:r,subWidth:Math.floor(n/2),subHeight:Math.floor(r/2),right:Math.round(e)+Math.floor(n/2),bottom:Math.round(t)+Math.floor(r/2)},this.objects.length=0,this.nodes.length=0},populate:function(e){e.forEach(this.populateHandler,this,!0)},populateHandler:function(e){e.body&&e.exists&&this.insert(e.body)},split:function(){this.nodes[0]=new t.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new t.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new t.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new t.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(e){var t=0,n;if(this.nodes[0]!=null){n=this.getIndex(e);if(n!==-1){this.nodes[n].insert(e);return}}this.objects.push(e);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes[0]==null&&this.split();while(t<this.objects.length)n=this.getIndex(this.objects[t]),n!==-1?this.nodes[n].insert(this.objects.splice(t,1)[0]):t++}},getIndex:function(e){var t=-1;return e.x<this.bounds.right&&e.right<this.bounds.right?e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom?t=1:e.y>this.bounds.bottom&&(t=2):e.x>this.bounds.right&&(e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom?t=0:e.y>this.bounds.bottom&&(t=3)),t},retrieve:function(e){if(e instanceof t.Rectangle)var n=this.objects,r=this.getIndex(e);else{if(!e.body)return this._empty;var n=this.objects,r=this.getIndex(e.body)}return this.nodes[0]&&(r!==-1?n=n.concat(this.nodes[r].retrieve(e)):(n=n.concat(this.nodes[0].retrieve(e)),n=n.concat(this.nodes[1].retrieve(e)),n=n.concat(this.nodes[2].retrieve(e)),n=n.concat(this.nodes[3].retrieve(e)))),n},clear:function(){this.objects.length=0;var e=this.nodes.length;while(e--)this.nodes[e].clear(),this.nodes.splice(e,1);this.nodes.length=0}},t.QuadTree.prototype.constructor=t.QuadTree,t.Net=function(e){this.game=e},t.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(e){return window.location.hostname.indexOf(e)!==-1},updateQueryString:function(e,t,n,r){n===undefined&&(n=!1);if(r===undefined||r==="")r=window.location.href;var i="",s=new RegExp("([?|&])"+e+"=.*?(&|#|$)(.*)","gi");if(s.test(r))typeof t!="undefined"&&t!==null?i=r.replace(s,"$1"+e+"="+t+"$2$3"):i=r.replace(s,"$1$3").replace(/(&|\?)$/,"");else if(typeof t!="undefined"&&t!==null){var o=r.indexOf("?")!==-1?"&":"?",u=r.split("#");r=u[0]+o+e+"="+t,u[1]&&(r+="#"+u[1]),i=r}else i=r;if(!n)return i;window.location.href=i},getQueryString:function(e){e===undefined&&(e="");var t={},n=location.search.substring(1).split("&");for(var r in n){var i=n[r].split("=");if(i.length>1){if(e&&e==this.decodeURI(i[0]))return this.decodeURI(i[1]);t[this.decodeURI(i[0])]=this.decodeURI(i[1])}}return t},decodeURI:function(e){return decodeURIComponent(e.replace(/\+/g," "))}},t.Net.prototype.constructor=t.Net,t.TweenManager=function(e){this.game=e,this.frameBased=!1,this._tweens=[],this._add=[],this.easeMap={Power0:t.Easing.Power0,Power1:t.Easing.Power1,Power2:t.Easing.Power2,Power3:t.Easing.Power3,Power4:t.Easing.Power4,Linear:t.Easing.Linear.None,Quad:t.Easing.Quadratic.Out,Cubic:t.Easing.Cubic.Out,Quart:t.Easing.Quartic.Out,Quint:t.Easing.Quintic.Out,Sine:t.Easing.Sinusoidal.Out,Expo:t.Easing.Exponential.Out,Circ:t.Easing.Circular.Out,Elastic:t.Easing.Elastic.Out,Back:t.Easing.Back.Out,Bounce:t.Easing.Bounce.Out,"Quad.easeIn":t.Easing.Quadratic.In,"Cubic.easeIn":t.Easing.Cubic.In,"Quart.easeIn":t.Easing.Quartic.In,"Quint.easeIn":t.Easing.Quintic.In,"Sine.easeIn":t.Easing.Sinusoidal.In,"Expo.easeIn":t.Easing.Exponential.In,"Circ.easeIn":t.Easing.Circular.In,"Elastic.easeIn":t.Easing.Elastic.In,"Back.easeIn":t.Easing.Back.In,"Bounce.easeIn":t.Easing.Bounce.In,"Quad.easeOut":t.Easing.Quadratic.Out,"Cubic.easeOut":t.Easing.Cubic.Out,"Quart.easeOut":t.Easing.Quartic.Out,"Quint.easeOut":t.Easing.Quintic.Out,"Sine.easeOut":t.Easing.Sinusoidal.Out,"Expo.easeOut":t.Easing.Exponential.Out,"Circ.easeOut":t.Easing.Circular.Out,"Elastic.easeOut":t.Easing.Elastic.Out,"Back.easeOut":t.Easing.Back.Out,"Bounce.easeOut":t.Easing.Bounce.Out,"Quad.easeInOut":t.Easing.Quadratic.InOut,"Cubic.easeInOut":t.Easing.Cubic.InOut,"Quart.easeInOut":t.Easing.Quartic.InOut,"Quint.easeInOut":t.Easing.Quintic.InOut,"Sine.easeInOut":t.Easing.Sinusoidal.InOut,"Expo.easeInOut":t.Easing.Exponential.InOut,"Circ.easeInOut":t.Easing.Circular.InOut,"Elastic.easeInOut":t.Easing.Elastic.InOut,"Back.easeInOut":t.Easing.Back.InOut,"Bounce.easeInOut":t.Easing.Bounce.InOut},this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},t.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].pendingDelete=!0;this._add=[]},removeFrom:function(e,n){n===undefined&&(n=!0);var r,i;if(Array.isArray(e))for(r=0,i=e.length;r<i;r++)this.removeFrom(e[r]);else if(e.type===t.GROUP&&n)for(var r=0,i=e.children.length;r<i;r++)this.removeFrom(e.children[r]);else{for(r=0,i=this._tweens.length;r<i;r++)e===this._tweens[r].target&&this.remove(this._tweens[r]);for(r=0,i=this._add.length;r<i;r++)e===this._add[r].target&&this.remove(this._add[r])}},add:function(e){e._manager=this,this._add.push(e)},create:function(e){return new t.Tween(e,this.game,this)},remove:function(e){var t=this._tweens.indexOf(e);t!==-1?this._tweens[t].pendingDelete=!0:(t=this._add.indexOf(e),t!==-1&&(this._add[t].pendingDelete=!0))},update:function(){var e=this._add.length,t=this._tweens.length;if(t===0&&e===0)return!1;var n=0;while(n<t)this._tweens[n].update(this.game.time.time)?n++:(this._tweens.splice(n,1),t--);return e>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(e){return this._tweens.some(function(t){return t.target===e})},_pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e]._pause()},_resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e]._resume()},pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e].pause()},resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e].resume(!0)}},t.TweenManager.prototype.constructor=t.TweenManager,t.Tween=function(e,n,r){this.game=n,this.target=e,this.manager=r,this.timeline=[],this.reverse=!1,this.timeScale=1,this.repeatCounter=0,this.pendingDelete=!1,this.onStart=new t.Signal,this.onLoop=new t.Signal,this.onRepeat=new t.Signal,this.onChildComplete=new t.Signal,this.onComplete=new t.Signal,this.isRunning=!1,this.current=0,this.properties={},this.chainedTween=null,this.isPaused=!1,this.frameBased=r.frameBased,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._pausedTime=0,this._codePaused=!1,this._hasStarted=!1},t.Tween.prototype={to:function(e,n,r,i,s,o,u){if(n===undefined||n<=0)n=1e3;if(r===undefined||r===null)r=t.Easing.Default;return i===undefined&&(i=!1),s===undefined&&(s=0),o===undefined&&(o=0),u===undefined&&(u=!1),typeof r=="string"&&this.manager.easeMap[r]&&(r=this.manager.easeMap[r]),this.isRunning?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push((new t.TweenData(this)).to(e,n,r,s,o,u)),i&&this.start(),this)},from:function(e,n,r,i,s,o,u){n===undefined&&(n=1e3);if(r===undefined||r===null)r=t.Easing.Default;return i===undefined&&(i=!1),s===undefined&&(s=0),o===undefined&&(o=0),u===undefined&&(u=!1),typeof r=="string"&&this.manager.easeMap[r]&&(r=this.manager.easeMap[r]),this.isRunning?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push((new t.TweenData(this)).from(e,n,r,s,o,u)),i&&this.start(),this)},start:function(e){e===undefined&&(e=0);if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning)return this;for(var t=0;t<this.timeline.length;t++)for(var n in this.timeline[t].vEnd)this.properties[n]=this.target[n]||0,Array.isArray(this.properties[n])||(this.properties[n]*=1);for(var t=0;t<this.timeline.length;t++)this.timeline[t].loadValues();this.manager.add(this),this.isRunning=!0;if(e<0||e>this.timeline.length-1)e=0;return this.current=e,this.timeline[this.current].start(),this},stop:function(e){return e===undefined&&(e=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,e&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(e,t,n){if(this.timeline.length===0)return this;n===undefined&&(n=0);if(n===-1)for(var r=0;r<this.timeline.length;r++)this.timeline[r][e]=t;else this.timeline[n][e]=t;return this},delay:function(e,t){return this.updateTweenData("delay",e,t)},repeat:function(e,t,n){return t===undefined&&(t=0),this.updateTweenData("repeatCounter",e,n),this.updateTweenData("repeatDelay",t,n)},repeatDelay:function(e,t){return this.updateTweenData("repeatDelay",e,t)},yoyo:function(e,t,n){return t===undefined&&(t=0),this.updateTweenData("yoyo",e,n),this.updateTweenData("yoyoDelay",t,n)},yoyoDelay:function(e,t){return this.updateTweenData("yoyoDelay",e,t)},easing:function(e,t){return typeof e=="string"&&this.manager.easeMap[e]&&(e=this.manager.easeMap[e]),this.updateTweenData("easingFunction",e,t)},interpolation:function(e,n,r){return n===undefined&&(n=t.Math),this.updateTweenData("interpolationFunction",e,r),this.updateTweenData("interpolationContext",n,r)},repeatAll:function(e){return e===undefined&&(e=0),this.repeatCounter=e,this},chain:function(){var e=arguments.length;while(e--)e>0?arguments[e-1].chainedTween=arguments[e]:this.chainedTween=arguments[e];return this},loop:function(e){return e===undefined&&(e=!0),e?this.repeatAll(-1):this.repeatCounter=0,this},onUpdateCallback:function(e,t){return this._onUpdateCallback=e,this._onUpdateCallbackContext=t,this},pause:function(){this.isPaused=!0,this._codePaused=!0,this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1,this._codePaused=!1;for(var e=0;e<this.timeline.length;e++)this.timeline[e].isRunning||(this.timeline[e].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){if(this._codePaused)return;this.resume()},update:function(e){if(this.pendingDelete)return!1;if(this.isPaused)return!0;var n=this.timeline[this.current].update(e);if(n===t.TweenData.PENDING)return!0;if(n===t.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(n===t.TweenData.LOOPED)return this.repeatCounter===-1?this.onLoop.dispatch(this.target,this):this.onRepeat.dispatch(this.target,this),!0;if(n===t.TweenData.COMPLETE){var r=!1;return this.reverse?(this.current--,this.current<0&&(this.current=this.timeline.length-1,r=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,r=!0)),r?this.repeatCounter===-1?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):this.repeatCounter>0?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)}},generateData:function(e,t){if(this.game===null||this.target===null)return null;e===undefined&&(e=60),t===undefined&&(t=[]);for(var n=0;n<this.timeline.length;n++)for(var r in this.timeline[n].vEnd)this.properties[r]=this.target[r]||0,Array.isArray(this.properties[r])||(this.properties[r]*=1);for(var n=0;n<this.timeline.length;n++)this.timeline[n].loadValues();for(var n=0;n<this.timeline.length;n++)t=t.concat(this.timeline[n].generateData(e));return t}},Object.defineProperty(t.Tween.prototype,"totalDuration",{get:function(){var e=0;for(var t=0;t<this.timeline.length;t++)e+=this.timeline[t].duration;return e}}),t.Tween.prototype.constructor=t.Tween,t.TweenData=function(e){this.parent=e,this.game=e.game,this.vStart={},this.vStartCache={},this.vEnd={},this.vEndCache={},this.duration=1e3,this.percent=0,this.value=0,this.repeatCounter=0,this.repeatDelay=0,this.interpolate=!1,this.yoyo=!1,this.yoyoDelay=0,this.inReverse=!1,this.delay=0,this.dt=0,this.startTime=null,this.easingFunction=t.Easing.Default,this.interpolationFunction=t.Math.linearInterpolation,this.interpolationContext=t.Math,this.isRunning=!1,this.isFrom=!1},t.TweenData.PENDING=0,t.TweenData.RUNNING=1,t.TweenData.LOOPED=2,t.TweenData.COMPLETE=3,t.TweenData.prototype={to:function(e,t,n,r,i,s){return this.vEnd=e,this.duration=t,this.easingFunction=n,this.delay=r,this.repeatCounter=i,this.yoyo=s,this.isFrom=!1,this},from:function(e,t,n,r,i,s){return this.vEnd=e,this.duration=t,this.easingFunction=n,this.delay=r,this.repeatCounter=i,this.yoyo=s,this.isFrom=!0,this},start:function(){this.startTime=this.game.time.time+this.delay,this.parent.reverse?this.dt=this.duration:this.dt=0,this.delay>0?this.isRunning=!1:this.isRunning=!0;if(this.isFrom)for(var e in this.vStartCache)this.vStart[e]=this.vEndCache[e],this.vEnd[e]=this.vStartCache[e],this.parent.target[e]=this.vStart[e];return this.value=0,this.yoyoCounter=0,this},loadValues:function(){for(var e in this.parent.properties){this.vStart[e]=this.parent.properties[e];if(Array.isArray(this.vEnd[e])){if(this.vEnd[e].length===0)continue;this.percent===0&&(this.vEnd[e]=[this.vStart[e]].concat(this.vEnd[e]))}typeof this.vEnd[e]!="undefined"?(typeof this.vEnd[e]=="string"&&(this.vEnd[e]=this.vStart[e]+parseFloat(this.vEnd[e],10)),this.parent.properties[e]=this.vEnd[e]):this.vEnd[e]=this.vStart[e],this.vStartCache[e]=this.vStart[e],this.vEndCache[e]=this.vEnd[e]}return this},update:function(e){if(!this.isRunning){if(!(e>=this.startTime))return t.TweenData.PENDING;this.isRunning=!0}else if(e<this.startTime)return t.TweenData.RUNNING;var n=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;this.parent.reverse?(this.dt-=n*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=n*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);for(var r in this.vEnd){var i=this.vStart[r],s=this.vEnd[r];Array.isArray(s)?this.parent.target[r]=this.interpolationFunction.call(this.interpolationContext,s,this.value):this.parent.target[r]=i+(s-i)*this.value}return!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0?this.repeat():t.TweenData.RUNNING},generateData:function(e){this.parent.reverse?this.dt=this.duration:this.dt=0;var t=[],n=!1,r=1/e*1e3;do{this.parent.reverse?(this.dt-=r,this.dt=Math.max(this.dt,0)):(this.dt+=r,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);var i={};for(var s in this.vEnd){var o=this.vStart[s],u=this.vEnd[s];Array.isArray(u)?i[s]=this.interpolationFunction(u,this.value):i[s]=o+(u-o)*this.value}t.push(i);if(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0)n=!0}while(!n);if(this.yoyo){var a=t.slice();a.reverse(),t=t.concat(a)}return t},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){for(var e in this.vStartCache)this.vStart[e]=this.vStartCache[e],this.vEnd[e]=this.vEndCache[e];return this.inReverse=!1,t.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(this.repeatCounter===0)return t.TweenData.COMPLETE;if(this.inReverse)for(var e in this.vStartCache)this.vStart[e]=this.vEndCache[e],this.vEnd[e]=this.vStartCache[e];else{for(var e in this.vStartCache)this.vStart[e]=this.vStartCache[e],this.vEnd[e]=this.vEndCache[e];this.repeatCounter>0&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.parent.reverse?this.dt=this.duration:this.dt=0,t.TweenData.LOOPED}},t.TweenData.prototype.constructor=t.TweenData,t.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return e===0?0:e===1?1:1-Math.cos(e*Math.PI/2)},Out:function(e){return e===0?0:e===1?1:Math.sin(e*Math.PI/2)},InOut:function(e){return e===0?0:e===1?1:.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)))},Out:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/r)+1)},InOut:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r):n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-t.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?t.Easing.Bounce.In(e*2)*.5:t.Easing.Bounce.Out(e*2-1)*.5+.5}}},t.Easing.Default=t.Easing.Linear.None,t.Easing.Power0=t.Easing.Linear.None,t.Easing.Power1=t.Easing.Quadratic.Out,t.Easing.Power2=t.Easing.Cubic.Out,t.Easing.Power3=t.Easing.Quartic.Out,t.Easing.Power4=t.Easing.Quintic.Out,t.Time=function(e){this.game=e,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.elapsedMS=0,this.physicsElapsed=1/60,this.physicsElapsedMS=1/60*1e3,this.desiredFpsMult=1/60,this._desiredFps=60,this.suggestedFps=this.desiredFps,this.slowMotion=1,this.advancedTiming=!1,this.frames=0,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.pauseDuration=0,this.timeToCall=0,this.timeExpected=0,this.events=new t.Timer(this.game,!1),this._frameCount=0,this._elapsedAccumulator=0,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[]},t.Time.prototype={boot:function(){this._started=Date.now(),this.time=Date.now(),this.events.start(),this.timeExpected=this.time},add:function(e){return this._timers.push(e),e},create:function(e){e===undefined&&(e=!0);var n=new t.Timer(this.game,e);return this._timers.push(n),n},removeAll:function(){for(var e=0;e<this._timers.length;e++)this._timers[e].destroy();this._timers=[],this.events.removeAll()},refresh:function(){var e=this.time;this.time=Date.now(),this.elapsedMS=this.time-e},update:function(e){var t=this.time;this.time=Date.now(),this.elapsedMS=this.time-t,this.prevTime=this.now,this.now=e,this.elapsed=this.now-this.prevTime,this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-e))),this.timeExpected=e+this.timeToCall),this.advancedTiming&&this.updateAdvancedTiming(),this.game.paused||(this.events.update(this.time),this._timers.length&&this.updateTimers())},updateTimers:function(){var e=0,t=this._timers.length;while(e<t)this._timers[e].update(this.time)?e++:(this._timers.splice(e,1),t--)},updateAdvancedTiming:function(){this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=this._desiredFps*2&&(this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5,this._frameCount=0,this._elapsedAccumulator=0),this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)},gamePaused:function(){this._pauseStarted=Date.now(),this.events.pause();var e=this._timers.length;while(e--)this._timers[e]._pause()},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();var e=this._timers.length;while(e--)this._timers[e]._resume()},totalElapsedSeconds:function(){return(this.time-this._started)*.001},elapsedSince:function(e){return this.time-e},elapsedSecondsSince:function(e){return(this.time-e)*.001},reset:function(){this._started=this.time,this.removeAll()}},Object.defineProperty(t.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(e){this._desiredFps=e,this.physicsElapsed=1/e,this.physicsElapsedMS=this.physicsElapsed*1e3,this.desiredFpsMult=1/e}}),t.Time.prototype.constructor=t.Time,t.Timer=function(e,n){n===undefined&&(n=!0),this.game=e,this.running=!1,this.autoDestroy=n,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new t.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},t.Timer.MINUTE=6e4,t.Timer.SECOND=1e3,t.Timer.HALF=500,t.Timer.QUARTER=250,t.Timer.prototype={create:function(e,n,r,i,s,o){e=Math.round(e);var u=e;this._now===0?u+=this.game.time.time:u+=this._now;var a=new t.TimerEvent(this,e,u,r,n,i,s,o);return this.events.push(a),this.order(),this.expired=!1,a},add:function(e,t,n){return this.create(e,!1,0,t,n,Array.prototype.slice.call(arguments,3))},repeat:function(e,t,n,r){return this.create(e,!1,t,n,r,Array.prototype.slice.call(arguments,4))},loop:function(e,t,n){return this.create(e,!0,0,t,n,Array.prototype.slice.call(arguments,3))},start:function(e){if(this.running)return;this._started=this.game.time.time+(e||0),this.running=!0;for(var t=0;t<this.events.length;t++)this.events[t].tick=this.events[t].delay+this._started},stop:function(e){this.running=!1,e===undefined&&(e=!0),e&&(this.events.length=0)},remove:function(e){for(var t=0;t<this.events.length;t++)if(this.events[t]===e)return this.events[t].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(e,t){return e.tick<t.tick?-1:e.tick>t.tick?1:0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(e){if(this.paused)return!0;this.elapsed=e-this._now,this._now=e,this.elapsed>this.timeCap&&this.adjustEvents(e-this.elapsed),this._marked=0,this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(!(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete))break;this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),this.events[this._i].loop===!0?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++}this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){if(!this.running)return;this._codePaused=!0;if(this.paused)return;this._pauseStarted=this.game.time.time,this.paused=!0},_pause:function(){if(this.paused||!this.running)return;this._pauseStarted=this.game.time.time,this.paused=!0},adjustEvents:function(e){for(var t=0;t<this.events.length;t++)if(!this.events[t].pendingDelete){var n=this.events[t].tick-e;n<0&&(n=0),this.events[t].tick=this._now+n}var r=this.nextTick-e;r<0?this.nextTick=this._now:this.nextTick=this._now+r},resume:function(){if(!this.paused)return;var e=this.game.time.time;this._pauseTotal+=e-this._now,this._now=e,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1},_resume:function(){if(this._codePaused)return;this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.events=[],this._len=0,this._i=0}},Object.defineProperty(t.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(t.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(t.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(t.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(t.Timer.prototype,"seconds",{get:function(){return this.running?this.ms*.001:0}}),t.Timer.prototype.constructor=t.Timer,t.TimerEvent=function(e,t,n,r,i,s,o,u){this.timer=e,this.delay=t,this.tick=n,this.repeatCount=r-1,this.loop=i,this.callback=s,this.callbackContext=o,this.args=u,this.pendingDelete=!1},t.TimerEvent.prototype.constructor=t.TimerEvent,t.AnimationManager=function(e){this.sprite=e,this.game=e.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},t.AnimationManager.prototype={loadFrameData:function(e,t){if(e===undefined)return!1;if(this.isLoaded)for(var n in this._anims)this._anims[n].updateFrameData(e);return this._frameData=e,t===undefined||t===null?this.frame=0:typeof t=="string"?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},copyFrameData:function(e,t){this._frameData=e.clone();if(this.isLoaded)for(var n in this._anims)this._anims[n].updateFrameData(this._frameData);return t===undefined||t===null?this.frame=0:typeof t=="string"?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},add:function(e,n,r,i,s){return n=n||[],r=r||60,i===undefined&&(i=!1),s===undefined&&(n&&typeof n[0]=="number"?s=!0:s=!1),this._outputFrames=[],this._frameData.getFrameIndexes(n,s,this._outputFrames),this._anims[e]=new t.Animation(this.game,this.sprite,e,this._frameData,this._outputFrames,r,i),this.currentAnim=this._anims[e],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[e]},validateFrames:function(e,t){t===undefined&&(t=!0);for(var n=0;n<e.length;n++)if(t===!0){if(e[n]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(e[n])===!1)return!1;return!0},play:function(e,t,n,r){if(this._anims[e])return this.currentAnim===this._anims[e]?this.currentAnim.isPlaying===!1?(this.currentAnim.paused=!1,this.currentAnim.play(t,n,r)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[e],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(t,n,r))},stop:function(e,t){t===undefined&&(t=!1),this.currentAnim&&(typeof e!="string"||e===this.currentAnim.name)&&this.currentAnim.stop(t)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(e){this.currentAnim&&(this.currentAnim.next(e),this.currentFrame=this.currentAnim.currentFrame)},previous:function(e){this.currentAnim&&(this.currentAnim.previous(e),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(e){return typeof e=="string"&&this._anims[e]?this._anims[e]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid])},destroy:function(){var e=null;for(var e in this._anims)this._anims.hasOwnProperty(e)&&this._anims[e].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},t.AnimationManager.prototype.constructor=t.AnimationManager,Object.defineProperty(t.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(t.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(t.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(e){this.currentAnim.paused=e}}),Object.defineProperty(t.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),Object.defineProperty(t.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(e){typeof e=="number"&&this._frameData&&this._frameData.getFrame(e)!==null&&(this.currentFrame=this._frameData.getFrame(e),this.currentFrame&&this.sprite.setFrame(this.currentFrame))}}),Object.defineProperty(t.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(e){typeof e=="string"&&this._frameData&&this._frameData.getFrameByName(e)!==null?(this.currentFrame=this._frameData.getFrameByName(e),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame))):console.warn("Cannot set frameName: "+e)}}),t.Animation=function(e,n,r,i,s,o,u){u===undefined&&(u=!1),this.game=e,this._parent=n,this._frameData=i,this.name=r,this._frames=[],this._frames=this._frames.concat(s),this.delay=1e3/o,this.loop=u,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new t.Signal,this.onUpdate=null,this.onComplete=new t.Signal,this.onLoop=new t.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},t.Animation.prototype={play:function(e,t,n){return typeof e=="number"&&(this.delay=1e3/e),typeof t=="boolean"&&(this.loop=t),typeof n!="undefined"&&(this.killOnComplete=n),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1,!0),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},setFrame:function(e,t){var n;t===undefined&&(t=!1);if(typeof e=="string")for(var r=0;r<this._frames.length;r++)this._frameData.getFrame(this._frames[r]).name===e&&(n=r);else if(typeof e=="number")if(t)n=e;else for(var r=0;r<this._frames.length;r++)this._frames[r]===n&&(n=r);n&&(this._frameIndex=n-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(e,t){e===undefined&&(e=!1),t===undefined&&(t=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,e&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),t&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.time>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),this.onUpdate?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0):(this.complete(),!1):this.updateCurrentFrame(!0)):!1},updateCurrentFrame:function(e,t){t===undefined&&(t=!1);if(!this._frameData)return!1;var n=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(t||!t&&n!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),this.onUpdate&&e?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0},next:function(e){e===undefined&&(e=1);var t=this._frameIndex+e;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},previous:function(e){e===undefined&&(e=1);var t=this._frameIndex-e;t<0&&(this.loop?t=this._frames.length+t:t++),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},updateFrameData:function(e){this._frameData=e,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData)return;this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose()},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},t.Animation.prototype.constructor=t.Animation,Object.defineProperty(t.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(e){this.isPaused=e,e?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(t.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(t.Animation.prototype,"frame",{get:function(){return this.currentFrame!==null?this.currentFrame.index:this._frameIndex},set:function(e){this.currentFrame=this._frameData.getFrame(this._frames[e]),this.currentFrame!==null&&(this._frameIndex=e,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(t.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(e){e>=1&&(this.delay=1e3/e)}}),Object.defineProperty(t.Animation.prototype,"enableUpdate",{get:function(){return this.onUpdate!==null},set:function(e){e&&this.onUpdate===null?this.onUpdate=new t.Signal:!e&&this.onUpdate!==null&&(this.onUpdate.dispose(),this.onUpdate=null)}}),t.Animation.generateFrameNames=function(e,n,r,i,s){i===undefined&&(i="");var o=[],u="";if(n<r)for(var a=n;a<=r;a++)typeof s=="number"?u=t.Utils.pad(a.toString(),s,"0",1):u=a.toString(),u=e+u+i,o.push(u);else for(var a=n;a>=r;a--)typeof s=="number"?u=t.Utils.pad(a.toString(),s,"0",1):u=a.toString(),u=e+u+i,o.push(u);return o},t.Frame=function(e,n,r,i,s,o){this.index=e,this.x=n,this.y=r,this.width=i,this.height=s,this.name=o,this.centerX=Math.floor(i/2),this.centerY=Math.floor(s/2),this.distance=t.Math.distance(0,0,i,s),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=i,this.sourceSizeH=s,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},t.Frame.prototype={resize:function(e,n){this.width=e,this.height=n,this.centerX=Math.floor(e/2),this.centerY=Math.floor(n/2),this.distance=t.Math.distance(0,0,e,n),this.sourceSizeW=e,this.sourceSizeH=n,this.right=this.x+e,this.bottom=this.y+n},setTrim:function(e,t,n,r,i,s,o){this.trimmed=e,e&&(this.sourceSizeW=t,this.sourceSizeH=n,this.centerX=Math.floor(t/2),this.centerY=Math.floor(n/2),this.spriteSourceSizeX=r,this.spriteSourceSizeY=i,this.spriteSourceSizeW=s,this.spriteSourceSizeH=o)},clone:function(){var e=new t.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var n in this)this.hasOwnProperty(n)&&(e[n]=this[n]);return e},getRect:function(e){return e===undefined?e=new t.Rectangle(this.x,this.y,this.width,this.height):e.setTo(this.x,this.y,this.width,this.height),e}},t.Frame.prototype.constructor=t.Frame,t.FrameData=function(){this._frames=[],this._frameNames=[]},t.FrameData.prototype={addFrame:function(e){return e.index=this._frames.length,this._frames.push(e),e.name!==""&&(this._frameNames[e.name]=e.index),e},getFrame:function(e){return e>=this._frames.length&&(e=0),this._frames[e]},getFrameByName:function(e){return typeof this._frameNames[e]=="number"?this._frames[this._frameNames[e]]:null},checkFrameName:function(e){return this._frameNames[e]==null?!1:!0},clone:function(){var e=new t.FrameData;for(var n=0;n<this._frames.length;n++)e._frames.push(this._frames[n].clone());for(var r in this._frameNames)this._frameNames.hasOwnProperty(r)&&e._frameNames.push(this._frameNames[r]);return e},getFrameRange:function(e,t,n){n===undefined&&(n=[]);for(var r=e;r<=t;r++)n.push(this._frames[r]);return n},getFrames:function(e,t,n){t===undefined&&(t=!0),n===undefined&&(n=[]);if(e===undefined||e.length===0)for(var r=0;r<this._frames.length;r++)n.push(this._frames[r]);else for(var r=0;r<e.length;r++)t?n.push(this.getFrame(e[r])):n.push(this.getFrameByName(e[r]));return n},getFrameIndexes:function(e,t,n){t===undefined&&(t=!0),n===undefined&&(n=[]);if(e===undefined||e.length===0)for(var r=0;r<this._frames.length;r++)n.push(this._frames[r].index);else for(var r=0;r<e.length;r++)t&&this._frames[e[r]]?n.push(this._frames[e[r]].index):this.getFrameByName(e[r])&&n.push(this.getFrameByName(e[r]).index);return n}},t.FrameData.prototype.constructor=t.FrameData,Object.defineProperty(t.FrameData.prototype,"total",{get:function(){return this._frames.length}}),t.AnimationParser={spriteSheet:function(e,n,r,i,s,o,u){var a=n;typeof n=="string"&&(a=e.cache.getImage(n));if(a===null)return null;var f=a.width,l=a.height;r<=0&&(r=Math.floor(-f/Math.min(-1,r))),i<=0&&(i=Math.floor(-l/Math.min(-1,i)));var c=Math.floor((f-o)/(r+u)),h=Math.floor((l-o)/(i+u)),p=c*h;s!==-1&&(p=s);if(f===0||l===0||f<r||l<i||p===0)return console.warn("Phaser.AnimationParser.spriteSheet: '"+n+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;var d=new t.FrameData,v=o,m=o;for(var g=0;g<p;g++)d.addFrame(new t.Frame(g,v,m,r,i,"")),v+=r+u,v+r>f&&(v=o,m+=i+u);return d},JSONData:function(e,n){if(!n.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),console.log(n);return}var r=new t.FrameData,i=n.frames,s;for(var o=0;o<i.length;o++)s=r.addFrame(new t.Frame(o,i[o].frame.x,i[o].frame.y,i[o].frame.w,i[o].frame.h,i[o].filename)),i[o].trimmed&&s.setTrim(i[o].trimmed,i[o].sourceSize.w,i[o].sourceSize.h,i[o].spriteSourceSize.x,i[o].spriteSourceSize.y,i[o].spriteSourceSize.w,i[o].spriteSourceSize.h);return r},JSONDataPyxel:function(e,n){var r=["layers","tilewidth","tileheight","tileswide","tileshigh"];r.forEach(function(e){if(!n[e]){console.warn("Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing '"+e+"' key."),console.log(n);return}});if(n["layers"].length!=1){console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps."),console.log(n);return}var i=new t.FrameData,s=n.tileheight,o=n.tilewidth,u=n.layers[0].tiles,a;for(var f=0;f<u.length;f++)a=i.addFrame(new t.Frame(f,u[f].x,u[f].y,o,s,"frame_"+f)),a.setTrim(!1);return i},JSONDataHash:function(e,n){if(!n.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),console.log(n);return}var r=new t.FrameData,i=n.frames,s,o=0;for(var u in i)s=r.addFrame(new t.Frame(o,i[u].frame.x,i[u].frame.y,i[u].frame.w,i[u].frame.h,u)),i[u].trimmed&&s.setTrim(i[u].trimmed,i[u].sourceSize.w,i[u].sourceSize.h,i[u].spriteSourceSize.x,i[u].spriteSourceSize.y,i[u].spriteSourceSize.w,i[u].spriteSourceSize.h),o++;return r},XMLData:function(e,n){if(!n.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var r=new t.FrameData,i=n.getElementsByTagName("SubTexture"),s,o,u,a,f,l,c,h,p,d,v;for(var m=0;m<i.length;m++)u=i[m].attributes,o=u.name.value,a=parseInt(u.x.value,10),f=parseInt(u.y.value,10),l=parseInt(u.width.value,10),c=parseInt(u.height.value,10),h=null,p=null,u.frameX&&(h=Math.abs(parseInt(u.frameX.value,10)),p=Math.abs(parseInt(u.frameY.value,10)),d=parseInt(u.frameWidth.value,10),v=parseInt(u.frameHeight.value,10)),s=r.addFrame(new t.Frame(m,a,f,l,c,o)),(h!==null||p!==null)&&s.setTrim(!0,l,c,h,p,d,v);return r}},t.Cache=function(e){this.game=e,this.autoResolveURL=!1,this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{}},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.onSoundUnlock=new t.Signal,this._cacheMap=[],this._cacheMap[t.Cache.CANVAS]=this._cache.canvas,this._cacheMap[t.Cache.IMAGE]=this._cache.image,this._cacheMap[t.Cache.TEXTURE]=this._cache.texture,this._cacheMap[t.Cache.SOUND]=this._cache.sound,this._cacheMap[t.Cache.TEXT]=this._cache.text,this._cacheMap[t.Cache.PHYSICS]=this._cache.physics,this._cacheMap[t.Cache.TILEMAP]=this._cache.tilemap,this._cacheMap[t.Cache.BINARY]=this._cache.binary,this._cacheMap[t.Cache.BITMAPDATA]=this._cache.bitmapData,this._cacheMap[t.Cache.BITMAPFONT]=this._cache.bitmapFont,this._cacheMap[t.Cache.JSON]=this._cache.json,this._cacheMap[t.Cache.XML]=this._cache.xml,this._cacheMap[t.Cache.VIDEO]=this._cache.video,this._cacheMap[t.Cache.SHADER]=this._cache.shader,this._cacheMap[t.Cache.RENDER_TEXTURE]=this._cache.renderTexture,this.addDefaultImage(),this.addMissingImage()},t.Cache.CANVAS=1,t.Cache.IMAGE=2,t.Cache.TEXTURE=3,t.Cache.SOUND=4,t.Cache.TEXT=5,t.Cache.PHYSICS=6,t.Cache.TILEMAP=7,t.Cache.BINARY=8,t.Cache.BITMAPDATA=9,t.Cache.BITMAPFONT=10,t.Cache.JSON=11,t.Cache.XML=12,t.Cache.VIDEO=13,t.Cache.SHADER=14,t.Cache.RENDER_TEXTURE=15,t.Cache.prototype={addCanvas:function(e,t,n){n===undefined&&(n=t.getContext("2d")),this._cache.canvas[e]={canvas:t,context:n}},addImage:function(e,n,r){this.checkImageKey(e)&&this.removeImage(e);var i={key:e,url:n,data:r,base:new PIXI.BaseTexture(r),frame:new t.Frame(0,0,0,r.width,r.height,e),frameData:new t.FrameData};return i.frameData.addFrame(new t.Frame(0,0,0,r.width,r.height,n)),this._cache.image[e]=i,this._resolveURL(n,i),i},addDefaultImage:function(){var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";var t=this.addImage("__default",null,e);t.base.skipRender=!0,PIXI.TextureCache.__default=new PIXI.Texture(t.base)},addMissingImage:function(){var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";var t=this.addImage("__missing",null,e);PIXI.TextureCache.__missing=new PIXI.Texture(t.base)},addSound:function(e,t,n,r,i){r===undefined&&(r=!0,i=!1),i===undefined&&(r=!1,i=!0);var s=!1;i&&(s=!0),this._cache.sound[e]={url:t,data:n,isDecoding:!1,decoded:s,webAudio:r,audioTag:i,locked:this.game.sound.touchLocked},this._resolveURL(t,this._cache.sound[e])},addText:function(e,t,n){this._cache.text[e]={url:t,data:n},this._resolveURL(t,this._cache.text[e])},addPhysicsData:function(e,t,n,r){this._cache.physics[e]={url:t,data:n,format:r},this._resolveURL(t,this._cache.physics[e])},addTilemap:function(e,t,n,r){this._cache.tilemap[e]={url:t,data:n,format:r},this._resolveURL(t,this._cache.tilemap[e])},addBinary:function(e,t){this._cache.binary[e]=t},addBitmapData:function(e,n,r){return n.key=e,r===undefined&&(r=new t.FrameData,r.addFrame(n.textureFrame)),this._cache.bitmapData[e]={data:n,frameData:r},n},addBitmapFont:function(e,n,r,i,s,o,u){var a={url:n,data:r,font:null,base:new PIXI.BaseTexture(r)};o===undefined&&(o=0),u===undefined&&(u=0),s==="json"?a.font=t.LoaderParser.jsonBitmapFont(i,a.base,o,u):a.font=t.LoaderParser.xmlBitmapFont(i,a.base,o,u),this._cache.bitmapFont[e]=a,this._resolveURL(n,a)},addJSON:function(e,t,n){this._cache.json[e]={url:t,data:n},this._resolveURL(t,this._cache.json[e])},addXML:function(e,t,n){this._cache.xml[e]={url:t,data:n},this._resolveURL(t,this._cache.xml[e])},addVideo:function(e,t,n,r){this._cache.video[e]={url:t,data:n,isBlob:r,locked:!0},this._resolveURL(t,this._cache.video[e])},addShader:function(e,t,n){this._cache.shader[e]={url:t,data:n},this._resolveURL(t,this._cache.shader[e])},addRenderTexture:function(e,n){this._cache.renderTexture[e]={texture:n,frame:new t.Frame(0,0,0,n.width,n.height,"","")}},addSpriteSheet:function(e,n,r,i,s,o,u,a){o===undefined&&(o=-1),u===undefined&&(u=0),a===undefined&&(a=0);var f={key:e,url:n,data:r,frameWidth:i,frameHeight:s,margin:u,spacing:a,base:new PIXI.BaseTexture(r),frameData:t.AnimationParser.spriteSheet(this.game,r,i,s,o,u,a)};this._cache.image[e]=f,this._resolveURL(n,f)},addTextureAtlas:function(e,n,r,i,s){var o={key:e,url:n,data:r,base:new PIXI.BaseTexture(r)};s===t.Loader.TEXTURE_ATLAS_XML_STARLING?o.frameData=t.AnimationParser.XMLData(this.game,i,e):s===t.Loader.TEXTURE_ATLAS_JSON_PYXEL?o.frameData=t.AnimationParser.JSONDataPyxel(this.game,i,e):Array.isArray(i.frames)?o.frameData=t.AnimationParser.JSONData(this.game,i,e):o.frameData=t.AnimationParser.JSONDataHash(this.game,i,e),this._cache.image[e]=o,this._resolveURL(n,o)},reloadSound:function(e){var t=this,n=this.getSound(e);n&&(n.data.src=n.url,n.data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(e)},!1),n.data.load())},reloadSoundComplete:function(e){var t=this.getSound(e);t&&(t.locked=!1,this.onSoundUnlock.dispatch(e))},updateSound:function(e,t,n){var r=this.getSound(e);r&&(r[t]=n)},decodedSound:function(e,t){var n=this.getSound(e);n.data=t,n.decoded=!0,n.isDecoding=!1},isSoundDecoded:function(e){var n=this.getItem(e,t.Cache.SOUND,"isSoundDecoded");if(n)return n.decoded},isSoundReady:function(e){var n=this.getItem(e,t.Cache.SOUND,"isSoundDecoded");if(n)return n.decoded&&!this.game.sound.touchLocked},checkKey:function(e,t){return this._cacheMap[e][t]?!0:!1},checkURL:function(e){return this._urlMap[this._resolveURL(e)]?!0:!1},checkCanvasKey:function(e){return this.checkKey(t.Cache.CANVAS,e)},checkImageKey:function(e){return this.checkKey(t.Cache.IMAGE,e)},checkTextureKey:function(e){return this.checkKey(t.Cache.TEXTURE,e)},checkSoundKey:function(e){return this.checkKey(t.Cache.SOUND,e)},checkTextKey:function(e){return this.checkKey(t.Cache.TEXT,e)},checkPhysicsKey:function(e){return this.checkKey(t.Cache.PHYSICS,e)},checkTilemapKey:function(e){return this.checkKey(t.Cache.TILEMAP,e)},checkBinaryKey:function(e){return this.checkKey(t.Cache.BINARY,e)},checkBitmapDataKey:function(e){return this.checkKey(t.Cache.BITMAPDATA,e)},checkBitmapFontKey:function(e){return this.checkKey(t.Cache.BITMAPFONT,e)},checkJSONKey:function(e){return this.checkKey(t.Cache.JSON,e)},checkXMLKey:function(e){return this.checkKey(t.Cache.XML,e)},checkVideoKey:function(e){return this.checkKey(t.Cache.VIDEO,e)},checkShaderKey:function(e){return this.checkKey(t.Cache.SHADER,e)},checkRenderTextureKey:function(e){return this.checkKey(t.Cache.RENDER_TEXTURE,e)},getItem:function(e,t,n,r){return this.checkKey(t,e)?r===undefined?this._cacheMap[t][e]:this._cacheMap[t][e][r]:(n&&console.warn("Phaser.Cache."+n+': Key "'+e+'" not found in Cache.'),null)},getCanvas:function(e){return this.getItem(e,t.Cache.CANVAS,"getCanvas","canvas")},getImage:function(e,n){if(e===undefined||e===null)e="__default";n===undefined&&(n=!1);var r=this.getItem(e,t.Cache.IMAGE,"getImage");return r===null&&(r=this.getItem("__missing",t.Cache.IMAGE,"getImage")),n?r:r.data},getTextureFrame:function(e){return this.getItem(e,t.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(e){return this.getItem(e,t.Cache.SOUND,"getSound")},getSoundData:function(e){return this.getItem(e,t.Cache.SOUND,"getSoundData","data")},getText:function(e){return this.getItem(e,t.Cache.TEXT,"getText","data")},getPhysicsData:function(e,n,r){var i=this.getItem(e,t.Cache.PHYSICS,"getPhysicsData","data");if(i===null||n===undefined||n===null)return i;if(i[n]){var s=i[n];if(!s||!r)return s;for(var o in s){o=s[o];if(o.fixtureKey===r)return o}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+r+" in "+e+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+e+" / "+n+'"');return null},getTilemapData:function(e){return this.getItem(e,t.Cache.TILEMAP,"getTilemapData")},getBinary:function(e){return this.getItem(e,t.Cache.BINARY,"getBinary")},getBitmapData:function(e){return this.getItem(e,t.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(e){return this.getItem(e,t.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(e,n){var r=this.getItem(e,t.Cache.JSON,"getJSON","data");return r?n?t.Utils.extend(!0,r):r:null},getXML:function(e){return this.getItem(e,t.Cache.XML,"getXML","data")},getVideo:function(e){return this.getItem(e,t.Cache.VIDEO,"getVideo")},getShader:function(e){return this.getItem(e,t.Cache.SHADER,"getShader","data")},getRenderTexture:function(e){return this.getItem(e,t.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(e,n){return n===undefined&&(n=t.Cache.IMAGE),this.getItem(e,n,"getBaseTexture","base")},getFrame:function(e,n){return n===undefined&&(n=t.Cache.IMAGE),this.getItem(e,n,"getFrame","frame")},getFrameCount:function(e,t){var n=this.getFrameData(e,t);return n?n.total:0},getFrameData:function(e,n){return n===undefined&&(n=t.Cache.IMAGE),this.getItem(e,n,"getFrameData","frameData")},hasFrameData:function(e,n){return n===undefined&&(n=t.Cache.IMAGE),this.getItem(e,n,"","frameData")!==null},updateFrameData:function(e,n,r){r===undefined&&(r=t.Cache.IMAGE),this._cacheMap[r][e]&&(this._cacheMap[r][e].frameData=n)},getFrameByIndex:function(e,t,n){var r=this.getFrameData(e,n);return r?r.getFrame(t):null},getFrameByName:function(e,t,n){var r=this.getFrameData(e,n);return r?r.getFrameByName(t):null},getPixiTexture:function(e){if(PIXI.TextureCache[e])return PIXI.TextureCache[e];var t=this.getPixiBaseTexture(e);return t?new PIXI.Texture(t):null},getPixiBaseTexture:function(e){if(PIXI.BaseTextureCache[e])return PIXI.BaseTextureCache[e];var n=this.getItem(e,t.Cache.IMAGE,"getPixiBaseTexture");return n!==null?n.base:null},getURL:function(e){var e=this._resolveURL(e);return e?this._urlMap[e]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+e+'" or Cache.autoResolveURL was false'),null)},getKeys:function(e){e===undefined&&(e=t.Cache.IMAGE);var n=[];if(this._cacheMap[e])for(var r in this._cacheMap[e])r!=="__default"&&r!=="__missing"&&n.push(r);return n},removeCanvas:function(e){delete this._cache.canvas[e]},removeImage:function(e,t){t===undefined&&(t=!0);var n=this.getImage(e,!0);t&&n.base&&n.base.destroy(),delete this._cache.image[e]},removeSound:function(e){delete this._cache.sound[e]},removeText:function(e){delete this._cache.text[e]},removePhysics:function(e){delete this._cache.physics[e]},removeTilemap:function(e){delete this._cache.tilemap[e]},removeBinary:function(e){delete this._cache.binary[e]},removeBitmapData:function(e){delete this._cache.bitmapData[e]},removeBitmapFont:function(e){delete this._cache.bitmapFont[e]},removeJSON:function(e){delete this._cache.json[e]},removeXML:function(e){delete this._cache.xml[e]},removeVideo:function(e){delete this._cache.video[e]},removeShader:function(e){delete this._cache.shader[e]},removeRenderTexture:function(e){delete this._cache.renderTexture[e]},removeSpriteSheet:function(e){delete this._cache.spriteSheet[e]},removeTextureAtlas:function(e){delete this._cache.atlas[e]},clearGLTextures:function(){for(var e in this._cache.image)this._cache.image[e].base._glTextures=[]},_resolveURL:function(e,t){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+e,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",t&&(this._urlMap[this._urlTemp]=t),this._urlTemp):null},destroy:function(){for(var e=0;e<this._cacheMap.length;e++){var t=this._cacheMap[e];for(var n in t)n!=="__default"&&n!=="__missing"&&(t[n].destroy&&t[n].destroy(),delete t[n])}this._urlMap=null,this._urlResolver=null,this._urlTemp=null}},t.Cache.prototype.constructor=t.Cache,t.Loader=function(e){this.game=e,this.cache=e.cache,this.resetLocked=!1,this.isLoading=!1,this.hasLoaded=!1,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.path="",this.onLoadStart=new t.Signal,this.onLoadComplete=new t.Signal,this.onPackComplete=new t.Signal,this.onFileStart=new t.Signal,this.onFileComplete=new t.Signal,this.onFileError=new t.Signal,this.useXDomainRequest=!1,this._warnedAboutXDomainRequest=!1,this.enableParallel=!0,this.maxParallelDownloads=4,this._withSyncPointDepth=0,this._fileList=[],this._flightQueue=[],this._processingHead=0,this._fileLoadStarted=!1,this._totalPackCount=0,this._totalFileCount=0,this._loadedPackCount=0,this._loadedFileCount=0},t.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,t.Loader.TEXTURE_ATLAS_JSON_HASH=1,t.Loader.TEXTURE_ATLAS_XML_STARLING=2,t.Loader.PHYSICS_LIME_CORONA_JSON=3,t.Loader.PHYSICS_PHASER_JSON=4,t.Loader.TEXTURE_ATLAS_JSON_PYXEL=5,t.Loader.prototype={setPreloadSprite:function(e,n){n=n||0,this.preloadSprite={sprite:e,direction:n,width:e.width,height:e.height,rect:null},n===0?this.preloadSprite.rect=new t.Rectangle(0,0,1,e.height):this.preloadSprite.rect=new t.Rectangle(0,0,e.width,1),e.crop(this.preloadSprite.rect),e.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(e,t){return this.getAssetIndex(e,t)>-1},getAssetIndex:function(e,t){var n=-1;for(var r=0;r<this._fileList.length;r++){var i=this._fileList[r];if(i.type===e&&i.key===t){n=r;if(!i.loaded&&!i.loading)break}}return n},getAsset:function(e,t){var n=this.getAssetIndex(e,t);return n>-1?{index:n,file:this._fileList[n]}:!1},reset:function(e,t){t===undefined&&(t=!1);if(this.resetLocked)return;e&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,t&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll())},addToFileList:function(e,t,n,r,i,s){i===undefined&&(i=!1);if(t===undefined||t==="")return console.warn("Phaser.Loader: Invalid or no key given of type "+e),this;if(n===undefined||n===null){if(!s)return console.warn("Phaser.Loader: No URL given for file type: "+e+" key: "+t),this;n=t+s}var o={type:e,key:t,path:this.path,url:n,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(r)for(var u in r)o[u]=r[u];var a=this.getAssetIndex(e,t);if(i&&a>-1){var f=this._fileList[a];!f.loading&&!f.loaded?this._fileList[a]=o:(this._fileList.push(o),this._totalFileCount++)}else a===-1&&(this._fileList.push(o),this._totalFileCount++);return this},replaceInFileList:function(e,t,n,r){return this.addToFileList(e,t,n,r,!0)},pack:function(e,t,n,r){t===undefined&&(t=null),n===undefined&&(n=null),r===undefined&&(r=null);if(!t&&!n)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;var i={type:"packfile",key:e,url:t,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:r};n&&(typeof n=="string"&&(n=JSON.parse(n)),i.data=n||{},i.loaded=!0);for(var s=0;s<this._fileList.length+1;s++){var o=this._fileList[s];if(!o||!o.loaded&&!o.loading&&o.type!=="packfile"){this._fileList.splice(s,0,i),this._totalPackCount++;break}}return this},image:function(e,t,n){return this.addToFileList("image",e,t,undefined,n,".png")},images:function(e,t){if(Array.isArray(t))for(var n=0;n<e.length;n++)this.image(e[n],t[n]);else for(var n=0;n<e.length;n++)this.image(e[n]);return this},text:function(e,t,n){return this.addToFileList("text",e,t,undefined,n,".txt")},json:function(e,t,n){return this.addToFileList("json",e,t,undefined,n,".json")},shader:function(e,t,n){return this.addToFileList("shader",e,t,undefined,n,".frag")},xml:function(e,t,n){return this.addToFileList("xml",e,t,undefined,n,".xml")},script:function(e,t,n,r){return n===undefined&&(n=!1),n!==!1&&r===undefined&&(r=this),this.addToFileList("script",e,t,{syncPoint:!0,callback:n,callbackContext:r},!1,".js")},binary:function(e,t,n,r){return n===undefined&&(n=!1),n!==!1&&r===undefined&&(r=n),this.addToFileList("binary",e,t,{callback:n,callbackContext:r},!1,".bin")},spritesheet:function(e,t,n,r,i,s,o){return i===undefined&&(i=-1),s===undefined&&(s=0),o===undefined&&(o=0),this.addToFileList("spritesheet",e,t,{frameWidth:n,frameHeight:r,frameMax:i,margin:s,spacing:o},!1,".png")},audio:function(e,t,n){return this.game.sound.noAudio?this:(n===undefined&&(n=!0),typeof t=="string"&&(t=[t]),this.addToFileList("audio",e,t,{buffer:null,autoDecode:n}))},audioSprite:function(e,t,n,r,i){return this.game.sound.noAudio?this:(n===undefined&&(n=null),r===undefined&&(r=null),i===undefined&&(i=!0),this.audio(e,t,i),n?this.json(e+"-audioatlas",n):r?(typeof r=="string"&&(r=JSON.parse(r)),this.cache.addJSON(e+"-audioatlas","",r)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this)},audiosprite:function(e,t,n,r,i){return this.audioSprite(e,t,n,r,i)},video:function(e,t,n,r){return n===undefined&&(this.game.device.firefox?n="loadeddata":n="canplaythrough"),r===undefined&&(r=!1),typeof t=="string"&&(t=[t]),this.addToFileList("video",e,t,{buffer:null,asBlob:r,loadEvent:n})},tilemap:function(e,n,r,i){n===undefined&&(n=null),r===undefined&&(r=null),i===undefined&&(i=t.Tilemap.CSV),!n&&!r&&(i===t.Tilemap.CSV?n=e+".csv":n=e+".json");if(r){switch(i){case t.Tilemap.CSV:break;case t.Tilemap.TILED_JSON:typeof r=="string"&&(r=JSON.parse(r))}this.cache.addTilemap(e,null,r,i)}else this.addToFileList("tilemap",e,n,{format:i});return this},physics:function(e,n,r,i){return n===undefined&&(n=null),r===undefined&&(r=null),i===undefined&&(i=t.Physics.LIME_CORONA_JSON),!n&&!r&&(n=e+".json"),r?(typeof r=="string"&&(r=JSON.parse(r)),this.cache.addPhysicsData(e,null,r,i)):this.addToFileList("physics",e,n,{format:i}),this},bitmapFont:function(e,t,n,r,i,s){if(t===undefined||t===null)t=e+".png";n===undefined&&(n=null),r===undefined&&(r=null),n===null&&r===null&&(n=e+".xml"),i===undefined&&(i=0),s===undefined&&(s=0);if(n)this.addToFileList("bitmapfont",e,t,{atlasURL:n,xSpacing:i,ySpacing:s});else if(typeof r=="string"){var o,u;try{o=JSON.parse(r)}catch(a){u=this.parseXml(r)}if(!u&&!o)throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",e,t,{atlasURL:null,atlasData:o||u,atlasType:o?"json":"xml",xSpacing:i,ySpacing:s})}return this},atlasJSONArray:function(e,n,r,i){return this.atlas(e,n,r,i,t.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(e,n,r,i){return this.atlas(e,n,r,i,t.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(e,n,r,i){return r===undefined&&(r=null),i===undefined&&(i=null),!r&&!i&&(r=e+".xml"),this.atlas(e,n,r,i,t.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(e,n,r,i,s){if(n===undefined||n===null)n=e+".png";r===undefined&&(r=null),i===undefined&&(i=null),s===undefined&&(s=t.Loader.TEXTURE_ATLAS_JSON_ARRAY),!r&&!i&&(s===t.Loader.TEXTURE_ATLAS_XML_STARLING?r=e+".xml":r=e+".json");if(r)this.addToFileList("textureatlas",e,n,{atlasURL:r,format:s});else{switch(s){case t.Loader.TEXTURE_ATLAS_JSON_ARRAY:typeof i=="string"&&(i=JSON.parse(i));break;case t.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof i=="string"){var o=this.parseXml(i);if(!o)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");i=o}}this.addToFileList("textureatlas",e,n,{atlasURL:null,atlasData:i,format:s})}return this},withSyncPoint:function(e,t){this._withSyncPointDepth++;try{e.call(t||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(e,t){var n=this.getAsset(e,t);return n&&(n.file.syncPoint=!0),this},removeFile:function(e,t){var n=this.getAsset(e,t);n&&!n.loaded&&!n.loading&&this._fileList.splice(n.index,1)},removeAll:function(){this._fileList.length=0,this._flightQueue.length=0},start:function(){if(this.isLoading)return;this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue()},processLoadQueue:function(){if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset"),this.finishedLoading(!0);return}for(var e=0;e<this._flightQueue.length;e++){var n=this._flightQueue[e];if(n.loaded||n.error)this._flightQueue.splice(e,1),e--,n.loading=!1,n.requestUrl=null,n.requestObject=null,n.error&&this.onFileError.dispatch(n.key,n),n.type!=="packfile"?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,n.key,!n.error,this._loadedFileCount,this._totalFileCount)):n.type==="packfile"&&n.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(n.key,!n.error,this._loadedPackCount,this._totalPackCount))}var r=!1,i=this.enableParallel?t.Math.clamp(this.maxParallelDownloads,1,12):1;for(var e=this._processingHead;e<this._fileList.length;e++){var n=this._fileList[e];n.type==="packfile"&&!n.error&&n.loaded&&e===this._processingHead&&(this.processPack(n),this._loadedPackCount++,this.onPackComplete.dispatch(n.key,!n.error,this._loadedPackCount,this._totalPackCount)),n.loaded||n.error?e===this._processingHead&&(this._processingHead=e+1):!n.loading&&this._flightQueue.length<i&&(n.type==="packfile"&&!n.data?(this._flightQueue.push(n),n.loading=!0,this.loadFile(n)):r||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(n),n.loading=!0,this.onFileStart.dispatch(this.progress,n.key,n.url),this.loadFile(n))),!n.loaded&&n.syncPoint&&(r=!0);if(this._flightQueue.length>=i||r&&this._loadedPackCount===this._totalPackCount)break}this.updateProgress();if(this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var s=this;setTimeout(function(){s.finishedLoading(!0)},2e3)}},finishedLoading:function(e){if(this.hasLoaded)return;this.hasLoaded=!0,this.isLoading=!1,!e&&!this._fileLoadStarted&&(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.game.state.loadComplete(),this.reset()},asyncComplete:function(e,t){t===undefined&&(t=""),e.loaded=!0,e.error=!!t,t&&(e.errorMessage=t,console.warn("Phaser.Loader - "+e.type+"["+e.key+"]"+": "+t)),this.processLoadQueue()},processPack:function(e){var n=e.data[e.key];if(!n){console.warn("Phaser.Loader - "+e.key+": pack has data, but not for pack key");return}for(var r=0;r<n.length;r++){var i=n[r];switch(i.type){case"image":this.image(i.key,i.url,i.overwrite);break;case"text":this.text(i.key,i.url,i.overwrite);break;case"json":this.json(i.key,i.url,i.overwrite);break;case"xml":this.xml(i.key,i.url,i.overwrite);break;case"script":this.script(i.key,i.url,i.callback,e.callbackContext||this);break;case"binary":this.binary(i.key,i.url,i.callback,e.callbackContext||this);break;case"spritesheet":this.spritesheet(i.key,i.url,i.frameWidth,i.frameHeight,i.frameMax,i.margin,i.spacing);break;case"video":this.video(i.key,i.urls);break;case"audio":this.audio(i.key,i.urls,i.autoDecode);break;case"audiosprite":this.audiosprite(i.key,i.urls,i.jsonURL,i.jsonData,i.autoDecode);break;case"tilemap":this.tilemap(i.key,i.url,i.data,t.Tilemap[i.format]);break;case"physics":this.physics(i.key,i.url,i.data,t.Loader[i.format]);break;case"bitmapFont":this.bitmapFont(i.key,i.textureURL,i.atlasURL,i.atlasData,i.xSpacing,i.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlasXML":this.atlasXML(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlas":this.atlas(i.key,i.textureURL,i.atlasURL,i.atlasData,t.Loader[i.format]);break;case"shader":this.shader(i.key,i.url,i.overwrite)}}},transformUrl:function(e,t){return e?e.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?e:this.baseURL+t.path+e:!1},loadFile:function(e){switch(e.type){case"packfile":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(e);break;case"audio":e.url=this.getAudioURL(e.url),e.url?this.game.sound.usingWebAudio?this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(e):this.fileError(e,null,"No supported audio URL specified or device does not have audio playback support");break;case"video":e.url=this.getVideoURL(e.url),e.url?e.asBlob?this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete):this.loadVideoTag(e):this.fileError(e,null,"No supported video URL specified or device does not have video playback support");break;case"json":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.xmlLoadComplete);break;case"tilemap":e.format===t.Tilemap.TILED_JSON?this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.jsonLoadComplete):e.format===t.Tilemap.CSV?this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.csvLoadComplete):this.asyncComplete(e,"invalid Tilemap format: "+e.format);break;case"text":case"script":case"shader":case"physics":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.fileComplete);break;case"binary":this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete)}},loadImageTag:function(e){var t=this;e.data=new Image,e.data.name=e.key,this.crossOrigin&&(e.data.crossOrigin=this.crossOrigin),e.data.onload=function(){e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileComplete(e))},e.data.onerror=function(){e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileError(e))},e.data.src=this.transformUrl(e.url,e),e.data.complete&&e.data.width&&e.data.height&&(e.data.onload=null,e.data.onerror=null,this.fileComplete(e))},loadVideoTag:function(e){var n=this;e.data=document.createElement("video"),e.data.name=e.key,e.data.controls=!1,e.data.autoplay=!1;var r=function(){e.data.removeEventListener(e.loadEvent,r,!1),e.data.onerror=null,e.data.canplay=!0,t.GAMES[n.game.id].load.fileComplete(e)};e.data.onerror=function(){e.data.removeEventListener(e.loadEvent,r,!1),e.data.onerror=null,e.data.canplay=!1,n.fileError(e)},e.data.addEventListener(e.loadEvent,r,!1),e.data.src=this.transformUrl(e.url,e),e.data.load()},loadAudioTag:function(e){var n=this;if(this.game.sound.touchLocked)e.data=new Audio,e.data.name=e.key,e.data.preload="auto",e.data.src=this.transformUrl(e.url,e),this.fileComplete(e);else{e.data=new Audio,e.data.name=e.key;var r=function(){e.data.removeEventListener("canplaythrough",r,!1),e.data.onerror=null,t.GAMES[n.game.id].load.fileComplete(e)};e.data.onerror=function(){e.data.removeEventListener("canplaythrough",r,!1),e.data.onerror=null,n.fileError(e)},e.data.preload="auto",e.data.src=this.transformUrl(e.url,e),e.data.addEventListener("canplaythrough",r,!1),e.data.load()}},xhrLoad:function(e,t,n,r,i){if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(e,t,n,r,i);return}var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType=n,i=i||this.fileError;var o=this;s.onload=function(){try{return s.readyState==4&&s.status>=400&&s.status<=599?i.call(o,e,s):r.call(o,e,s)}catch(t){o.hasLoaded?window.console&&console.error(t):o.asyncComplete(e,t.message||"Exception")}},s.onerror=function(){try{return i.call(o,e,s)}catch(t){o.hasLoaded?window.console&&console.error(t):o.asyncComplete(e,t.message||"Exception")}},e.requestObject=s,e.requestUrl=t,s.send()},xhrLoadWithXDR:function(e,t,n,r,i){!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)&&(this._warnedAboutXDomainRequest=!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));var s=new window.XDomainRequest;s.open("GET",t,!0),s.responseType=n,s.timeout=3e3,i=i||this.fileError;var o=this;s.onerror=function(){try{return i.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},s.ontimeout=function(){try{return i.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},s.onprogress=function(){},s.onload=function(){try{return s.readyState==4&&s.status>=400&&s.status<=599?i.call(o,e,s):r.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},e.requestObject=s,e.requestUrl=t,setTimeout(function(){s.send()},0)},getVideoURL:function(e){for(var t=0;t<e.length;t++){var n=e[t],r;if(n.uri){r=n.type,n=n.uri;if(this.game.device.canPlayVideo(r))return n}else{if(n.indexOf("blob:")===0||n.indexOf("data:")===0)return n;n.indexOf("?")>=0&&(n=n.substr(0,n.indexOf("?")));var i=n.substr((Math.max(0,n.lastIndexOf("."))||Infinity)+1);r=i.toLowerCase();if(this.game.device.canPlayVideo(r))return e[t]}}return null},getAudioURL:function(e){if(this.game.sound.noAudio)return null;for(var t=0;t<e.length;t++){var n=e[t],r;if(n.uri){r=n.type,n=n.uri;if(this.game.device.canPlayAudio(r))return n}else{if(n.indexOf("blob:")===0||n.indexOf("data:")===0)return n;n.indexOf("?")>=0&&(n=n.substr(0,n.indexOf("?")));var i=n.substr((Math.max(0,n.lastIndexOf("."))||Infinity)+1);r=i.toLowerCase();if(this.game.device.canPlayAudio(r))return e[t]}}return null},fileError:function(e,t,n){var r=e.requestUrl||this.transformUrl(e.url,e),i="error loading asset from URL "+r;!n&&t&&(n=t.status),n&&(i=i+" ("+n+")"),this.asyncComplete(e,i)},fileComplete:function(e,n){var r=!0;switch(e.type){case"packfile":var i=JSON.parse(n.responseText);e.data=i||{};break;case"image":this.cache.addImage(e.key,e.url,e.data);break;case"spritesheet":this.cache.addSpriteSheet(e.key,e.url,e.data,e.frameWidth,e.frameHeight,e.frameMax,e.margin,e.spacing);break;case"textureatlas":if(e.atlasURL==null)this.cache.addTextureAtlas(e.key,e.url,e.data,e.atlasData,e.format);else{r=!1;if(e.format==t.Loader.TEXTURE_ATLAS_JSON_ARRAY||e.format==t.Loader.TEXTURE_ATLAS_JSON_HASH||e.format==t.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(e,this.transformUrl(e.atlasURL,e),"text",this.jsonLoadComplete);else{if(e.format!=t.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+e.format);this.xhrLoad(e,this.transformUrl(e.atlasURL,e),"text",this.xmlLoadComplete)}}break;case"bitmapfont":e.atlasURL?(r=!1,this.xhrLoad(e,this.transformUrl(e.atlasURL,e),"text",function(e,t){var n;try{n=JSON.parse(t.responseText)}catch(r){}n?(e.atlasType="json",this.jsonLoadComplete(e,t)):(e.atlasType="xml",this.xmlLoadComplete(e,t))})):this.cache.addBitmapFont(e.key,e.url,e.data,e.atlasData,e.atlasType,e.xSpacing,e.ySpacing);break;case"video":if(e.asBlob)try{e.data=new Blob([new Uint8Array(n.response)])}catch(s){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+e.key)}this.cache.addVideo(e.key,e.url,e.data,e.asBlob);break;case"audio":this.game.sound.usingWebAudio?(e.data=n.response,this.cache.addSound(e.key,e.url,e.data,!0,!1),e.autoDecode&&this.game.sound.decode(e.key)):this.cache.addSound(e.key,e.url,e.data,!1,!0);break;case"text":e.data=n.responseText,this.cache.addText(e.key,e.url,e.data);break;case"shader":e.data=n.responseText,this.cache.addShader(e.key,e.url,e.data);break;case"physics":var i=JSON.parse(n.responseText);this.cache.addPhysicsData(e.key,e.url,i,e.format);break;case"script":e.data=document.createElement("script"),e.data.language="javascript",e.data.type="text/javascript",e.data.defer=!1,e.data.text=n.responseText,document.head.appendChild(e.data),e.callback&&(e.data=e.callback.call(e.callbackContext,e.key,n.responseText));break;case"binary":e.callback?e.data=e.callback.call(e.callbackContext,e.key,n.response):e.data=n.response,this.cache.addBinary(e.key,e.data)}r&&this.asyncComplete(e)},jsonLoadComplete:function(e,t){var n=JSON.parse(t.responseText);e.type==="tilemap"?this.cache.addTilemap(e.key,e.url,n,e.format):e.type==="bitmapfont"?this.cache.addBitmapFont(e.key,e.url,e.data,n,e.atlasType,e.xSpacing,e.ySpacing):e.type==="json"?this.cache.addJSON(e.key,e.url,n):this.cache.addTextureAtlas(e.key,e.url,e.data,n,e.format),this.asyncComplete(e)},csvLoadComplete:function(e,t){var n=t.responseText;this.cache.addTilemap(e.key,e.url,n,e.format),this.asyncComplete(e)},xmlLoadComplete:function(e,t){var n=t.responseText,r=this.parseXml(n);if(!r){var i=t.responseType||t.contentType;console.warn("Phaser.Loader - "+e.key+": invalid XML ("+i+")"),this.asyncComplete(e,"invalid XML");return}e.type==="bitmapfont"?this.cache.addBitmapFont(e.key,e.url,e.data,r,e.atlasType,e.xSpacing,e.ySpacing):e.type==="textureatlas"?this.cache.addTextureAtlas(e.key,e.url,e.data,r,e.format):e.type==="xml"&&this.cache.addXML(e.key,e.url,r),this.asyncComplete(e)},parseXml:function(e){var t;try{if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)}catch(r){t=null}return!t||!t.documentElement||t.getElementsByTagName("parsererror").length?null:t},updateProgress:function(){this.preloadSprite&&(this.preloadSprite.direction===0?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}},Object.defineProperty(t.Loader.prototype,"progressFloat",{get:function(){var e=this._loadedFileCount/this._totalFileCount*100;return t.Math.clamp(e||0,0,100)}}),Object.defineProperty(t.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}}),t.Loader.prototype.constructor=t.Loader,t.LoaderParser={bitmapFont:function(e,t,n,r){return this.xmlBitmapFont(e,t,n,r)},xmlBitmapFont:function(e,t,n,r){var i={},s=e.getElementsByTagName("info")[0],o=e.getElementsByTagName("common")[0];i.font=s.getAttribute("face"),i.size=parseInt(s.getAttribute("size"),10),i.lineHeight=parseInt(o.getAttribute("lineHeight"),10)+r,i.chars={};var u=e.getElementsByTagName("char");for(var a=0;a<u.length;a++){var f=parseInt(u[a].getAttribute("id"),10);i.chars[f]={x:parseInt(u[a].getAttribute("x"),10),y:parseInt(u[a].getAttribute("y"),10),width:parseInt(u[a].getAttribute("width"),10),height:parseInt(u[a].getAttribute("height"),10),xOffset:parseInt(u[a].getAttribute("xoffset"),10),yOffset:parseInt(u[a].getAttribute("yoffset"),10),xAdvance:parseInt(u[a].getAttribute("xadvance"),10)+n,kerning:{}}}var l=e.getElementsByTagName("kerning");for(a=0;a<l.length;a++){var c=parseInt(l[a].getAttribute("first"),10),h=parseInt(l[a].getAttribute("second"),10),p=parseInt(l[a].getAttribute("amount"),10);i.chars[h].kerning[c]=p}return this.finalizeBitmapFont(t,i)},jsonBitmapFont:function(e,t,n,r){var i={font:e.font.info._face,size:parseInt(e.font.info._size,10),lineHeight:parseInt(e.font.common._lineHeight,10)+r,chars:{}};return e.font.chars["char"].forEach(function(t){var r=parseInt(t._id,10);i.chars[r]={x:parseInt(t._x,10),y:parseInt(t._y,10),width:parseInt(t._width,10),height:parseInt(t._height,10),xOffset:parseInt(t._xoffset,10),yOffset:parseInt(t._yoffset,10),xAdvance:parseInt(t._xadvance,10)+n,kerning:{}}}),e.font.kernings&&e.font.kernings.kerning&&e.font.kernings.kerning.forEach(function(t){i.chars[t._second].kerning[t._first]=parseInt(t._amount,10)}),this.finalizeBitmapFont(t,i)},finalizeBitmapFont:function(e,n){return Object.keys(n.chars).forEach(function(i){var s=n.chars[i];s.texture=new PIXI.Texture(e,new t.Rectangle(s.x,s.y,s.width,s.height))}),n}},t.AudioSprite=function(e,t){this.game=e,this.key=t,this.config=this.game.cache.getJSON(t+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={};for(var n in this.config.spritemap){var r=this.config.spritemap[n],i=this.game.add.sound(this.key);i.addMarker(n,r.start,r.end-r.start,null,r.loop),this.sounds[n]=i}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},t.AudioSprite.prototype={play:function(e,t){return t===undefined&&(t=1),this.sounds[e].play(e,null,t)},stop:function(e){if(!e)for(var t in this.sounds)this.sounds[t].stop();else this.sounds[e].stop()},get:function(e){return this.sounds[e]}},t.AudioSprite.prototype.constructor=t.AudioSprite,t.Sound=function(e,n,r,i,s){r===undefined&&(r=1),i===undefined&&(i=!1),s===undefined&&(s=e.sound.connectToMaster),this.game=e,this.name=n,this.key=n,this.loop=i,this.volume=r,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.fadeTween=null,this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this._sound=null,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.context.createGain===undefined?this.gainNode=this.context.createGainNode():this.gainNode=this.context.createGain(),this.gainNode.gain.value=r*this.game.sound.volume,s&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(n)&&this.game.cache.isSoundReady(n)?(this._sound=this.game.cache.getSoundData(n),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)),this.onDecoded=new t.Signal,this.onPlay=new t.Signal,this.onPause=new t.Signal,this.onResume=new t.Signal,this.onLoop=new t.Signal,this.onStop=new t.Signal,this.onMute=new t.Signal,this.onMarkerComplete=new t.Signal,this.onFadeComplete=new t.Signal,this._volume=r,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},t.Sound.prototype={soundHasUnlocked:function(e){e===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(e,t,n,r,i){if(r===undefined||r===null)r=1;i===undefined&&(i=!1),this.markers[e]={name:e,start:t,stop:t+n,volume:r,duration:n,durationMS:n*1e3,loop:i}},removeMarker:function(e){delete this.markers[e]},onEndedHandler:function(){this._sound.onended=null,this.isPlaying=!1,this.currentTime=this.durationMS,this.stop()},update:function(){if(!this.game.cache.checkSoundKey(this.key)){this.destroy();return}this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.currentMarker===""?(this.currentTime=0,this.startTime=this.game.time.time):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):this.currentMarker!==""&&this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},loopFull:function(e){this.play(null,0,e,!0)},play:function(e,t,n,r,i){if(e===undefined||e===!1||e===null)e="";i===undefined&&(i=!0);if(this.isPlaying&&!this.allowMultiple&&!i&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||i))if(this.usingWebAudio){if(this._sound.stop===undefined)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(s){}this.externalNode?this._sound.disconnect(this.externalNode):this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(e===""&&Object.keys(this.markers).length>0)return this;if(e!==""){this.currentMarker=e;if(!this.markers[e])return this;this.position=this.markers[e].start,this.volume=this.markers[e].volume,this.loop=this.markers[e].loop,this.duration=this.markers[e].duration,this.durationMS=this.markers[e].durationMS,typeof n!="undefined"&&(this.volume=n),typeof r!="undefined"&&(this.loop=r),this._tempMarker=e,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else t=t||0,n===undefined&&(n=this._volume),r===undefined&&(r=this.loop),this.position=t,this.volume=n,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=e,this._tempPosition=t,this._tempVolume=n,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._sound=this.context.createBufferSource(),this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this._buffer=this.game.cache.getSoundData(this.key),this._sound.buffer=this._buffer,this.loop&&e===""&&(this._sound.loop=!0),!this.loop&&e===""&&(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(this.totalDuration*1e3)),this._sound.start===undefined?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&e===""?this._sound.start(0,0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)?(this._sound.play(),this.totalDuration=this._sound.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=this.totalDuration*1e3),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(e,t,n,r){e=e||"",t=t||0,n=n||1,r===undefined&&(r=!1),this.play(e,t,n,r,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var e=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),!this.loop&&this.currentMarker===""&&(this._sound.onended=this.onEndedHandler.bind(this));var t=this.duration-this.pausedPosition/1e3;this._sound.start===undefined?this._sound.noteGrainOn(0,e,t):this.loop&&this.game.device.chrome?this.game.device.chromeVersion===42?this._sound.start(0):this._sound.start(0,e):this._sound.start(0,e,t)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(this._sound.stop===undefined)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(e){}this.externalNode?this._sound.disconnect(this.externalNode):this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.pendingPlayback=!1,this.isPlaying=!1;if(!this.paused){var t=this.currentMarker;this.currentMarker!==""&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",this.fadeTween!==null&&this.fadeTween.stop(),this.onStop.dispatch(this,t)}},fadeIn:function(e,t,n){t===undefined&&(t=!1),n===undefined&&(n=this.currentMarker);if(this.paused)return;this.play(n,0,0,t),this.fadeTo(e,1)},fadeOut:function(e){this.fadeTo(e,0)},fadeTo:function(e,n){if(!this.isPlaying||this.paused||n===this.volume)return;e===undefined&&(e=1e3);if(n===undefined){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:n},e,t.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),this.volume===0&&this.stop()},destroy:function(e){e===undefined&&(e=!0),this.stop(),e?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},t.Sound.prototype.constructor=t.Sound,Object.defineProperty(t.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(t.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(t.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(e){e=e||!1;if(e===this._muted)return;e?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this)}}),Object.defineProperty(t.Sound.prototype,"volume",{get:function(){return this._volume},set:function(e){this.game.device.firefox&&this.usingAudioTag&&(e=this.game.math.clamp(e,0,1));if(this._muted){this._muteVolume=e;return}this._tempVolume=e,this._volume=e,this.usingWebAudio?this.gainNode.gain.value=e:this.usingAudioTag&&this._sound&&(this._sound.volume=e)}}),t.SoundManager=function(e){this.game=e,this.onSoundDecode=new t.Signal,this.onVolumeChange=new t.Signal,this.onMute=new t.Signal,this.onUnMute=new t.Signal,this.context=null,this.usingWebAudio=!1,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this._watchList=new t.ArraySet,this._watching=!1,this._watchCallback=null,this._watchContext=null},t.SoundManager.prototype={boot:function(){this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1);if(window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0){this.noAudio=!0,this.touchLocked=!1;return}if(window.PhaserGlobal.disableWebAudio===!0){this.usingAudioTag=!0,this.touchLocked=!1;return}}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(!window.AudioContext){if(!!window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(e){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}}else try{this.context=new window.AudioContext}catch(e){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}if(this.context===null){if(window.Audio===undefined){this.noAudio=!0;return}this.usingAudioTag=!0}else this.usingWebAudio=!0,this.context.createGain===undefined?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination);this.noAudio||(!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)&&this.setTouchLock()},setTouchLock:function(){if(this.noAudio||window.PhaserGlobal&&window.PhaserGlobal.disableAudio===!0)return;this.game.device.iOSVersion>8?this.game.input.touch.addTouchLockCallback(this.unlock,this,!0):this.game.input.touch.addTouchLockCallback(this.unlock,this),this.touchLocked=!0},unlock:function(){if(this.noAudio||!this.touchLocked||this._unlockSource!==null)return!0;if(this.usingAudioTag)this.touchLocked=!1,this._unlockSource=null;else if(this.usingWebAudio){var e=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=e,this._unlockSource.connect(this.context.destination),this._unlockSource.start===undefined?this._unlockSource.noteOn(0):this._unlockSource.start(0)}return!0},stopAll:function(){if(this.noAudio)return;for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].stop()},pauseAll:function(){if(this.noAudio)return;for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].pause()},resumeAll:function(){if(this.noAudio)return;for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].resume()},decode:function(e,t){t=t||null;var n=this.game.cache.getSoundData(e);if(n&&this.game.cache.isSoundDecoded(e)===!1){this.game.cache.updateSound(e,"isDecoding",!0);var r=this;try{this.context.decodeAudioData(n,function(n){n&&(r.game.cache.decodedSound(e,n),r.onSoundDecode.dispatch(e,t))})}catch(i){}}},setDecodedCallback:function(e,n,r){typeof e=="string"&&(e=[e]),this._watchList.reset();for(var i=0;i<e.length;i++)e[i]instanceof t.Sound?this.game.cache.isSoundDecoded(e[i].key)||this._watchList.add(e[i].key):this.game.cache.isSoundDecoded(e[i])||this._watchList.add(e[i]);this._watchList.total===0?(this._watching=!1,n.call(r)):(this._watching=!0,this._watchCallback=n,this._watchContext=r)},update:function(){if(this.noAudio)return;this.touchLocked&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null);for(var e=0;e<this._sounds.length;e++)this._sounds[e].update();if(this._watching){var t=this._watchList.first;while(t)this.game.cache.isSoundDecoded(t)&&this._watchList.remove(t),t=this._watchList.next;this._watchList.total===0&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},add:function(e,n,r,i){n===undefined&&(n=1),r===undefined&&(r=!1),i===undefined&&(i=this.connectToMaster);var s=new t.Sound(this.game,e,n,r,i);return this._sounds.push(s),s},addSprite:function(e){var n=new t.AudioSprite(this.game,e);return n},remove:function(e){var t=this._sounds.length;while(t--)if(this._sounds[t]===e)return this._sounds[t].destroy(!1),this._sounds.splice(t,1),!0;return!1},removeByKey:function(e){var t=this._sounds.length,n=0;while(t--)this._sounds[t].key===e&&(this._sounds[t].destroy(!1),this._sounds.splice(t,1),n++);return n},play:function(e,t,n){if(this.noAudio)return;var r=this.add(e,t,n);return r.play(),r},setMute:function(){if(this._muted)return;this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].mute=!0);this.onMute.dispatch()},unsetMute:function(){if(!this._muted||this._codeMuted)return;this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].mute=!1);this.onUnMute.dispatch()},destroy:function(){this.stopAll();for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].destroy();this._sounds=[],this.onSoundDecode.dispose(),this.context.close(),this.context&&window.PhaserGlobal&&(window.PhaserGlobal.audioContext=this.context)}},t.SoundManager.prototype.constructor=t.SoundManager,Object.defineProperty(t.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(e){e=e||!1;if(e){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(t.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(e){e<0?e=0:e>1&&(e=1);if(this._volume!==e){this._volume=e;if(this.usingWebAudio)this.masterGain.gain.value=e;else for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].volume=this._sounds[t].volume*e);this.onVolumeChange.dispatch(e)}}}),t.ScaleManager=function(e,n,r){this.game=e,this.dom=t.DOM,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new t.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this._pageAlignHorizontally=!1,this._pageAlignVertically=!1,this.onOrientationChange=new t.Signal,this.enterIncorrectOrientation=new t.Signal,this.leaveIncorrectOrientation=new t.Signal,this.fullScreenTarget=null,this._createdFullScreenTarget=null,this.onFullScreenInit=new t.Signal,this.onFullScreenChange=new t.Signal,this.onFullScreenError=new t.Signal,this.screenOrientation=this.dom.getScreenOrientation(),this.scaleFactor=new t.Point(1,1),this.scaleFactorInversed=new t.Point(1,1),this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0},this.bounds=new t.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.windowConstraints={right:"layout",bottom:""},this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""},this._scaleMode=t.ScaleManager.NO_SCALE,this._fullScreenScaleMode=t.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new t.Point(1,1),this.trackParentInterval=2e3,this.onSizeChange=new t.Signal,this.onResize=null,this.onResizeContext=null,this._pendingScaleMode=null,this._fullScreenRestore=null,this._gameSize=new t.Rectangle,this._userScaleFactor=new t.Point(1,1),this._userScaleTrim=new t.Point(0,0),this._lastUpdate=0,this._updateThrottle=0,this._updateThrottleReset=100,this._parentBounds=new t.Rectangle,this._tempBounds=new t.Rectangle,this._lastReportedCanvasSize=new t.Rectangle,this._lastReportedGameSize=new t.Rectangle,this._booted=!1,e.config&&this.parseConfig(e.config),this.setupScale(n,r)},t.ScaleManager.EXACT_FIT=0,t.ScaleManager.NO_SCALE=1,t.ScaleManager.SHOW_ALL=2,t.ScaleManager.RESIZE=3,t.ScaleManager.USER_SCALE=4,t.ScaleManager.prototype={boot:function(){var e=this.compatibility;e.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS,!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop&&(this.game.device.android&&!this.game.device.chrome?e.scrollTo=new t.Point(0,1):e.scrollTo=new t.Point(0,0)),this.game.device.desktop?(e.orientationFallback="screen",e.clickTrampoline="when-not-mouse"):(e.orientationFallback="",e.clickTrampoline="");var n=this;this._orientationChange=function(e){return n.orientationChange(e)},this._windowResize=function(e){return n.windowResize(e)},window.addEventListener("orientationchange",this._orientationChange,!1),window.addEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(e){return n.fullScreenChange(e)},this._fullScreenError=function(e){return n.fullScreenError(e)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1)),this.game.onResume.add(this._gameResumed,this),this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.setGameSize(this.game.width,this.game.height),this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),t.FlexGrid&&(this.grid=new t.FlexGrid(this,this.width,this.height)),this._booted=!0,this._pendingScaleMode!==null&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(e){e.scaleMode!==undefined&&(this._booted?this.scaleMode=e.scaleMode:this._pendingScaleMode=e.scaleMode),e.fullScreenScaleMode!==undefined&&(this.fullScreenScaleMode=e.fullScreenScaleMode),e.fullScreenTarget&&(this.fullScreenTarget=e.fullScreenTarget)},setupScale:function(e,n){var r,i=new t.Rectangle;this.game.parent!==""&&(typeof this.game.parent=="string"?r=document.getElementById(this.game.parent):this.game.parent&&this.game.parent.nodeType===1&&(r=this.game.parent)),r?(this.parentNode=r,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),i.width=this._parentBounds.width,i.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,i.width=this.dom.visualBounds.width,i.height=this.dom.visualBounds.height,this.offset.set(0,0));var s=0,o=0;typeof e=="number"?s=e:(this.parentScaleFactor.x=parseInt(e,10)/100,s=i.width*this.parentScaleFactor.x),typeof n=="number"?o=n:(this.parentScaleFactor.y=parseInt(n,10)/100,o=i.height*this.parentScaleFactor.y),s=Math.floor(s),o=Math.floor(o),this._gameSize.setTo(0,0,s,o),this.updateDimensions(s,o,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(e,n){this._gameSize.setTo(0,0,e,n),this.currentScaleMode!==t.ScaleManager.RESIZE&&this.updateDimensions(e,n,!0),this.queueUpdate(!0)},setUserScale:function(e,t,n,r){this._userScaleFactor.setTo(e,t),this._userScaleTrim.setTo(n|0,r|0),this.queueUpdate(!0)},setResizeCallback:function(e,t){this.onResize=e,this.onResizeContext=t},signalSizeChange:function(){if(!t.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!t.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var e=this.width,n=this.height;this._lastReportedCanvasSize.setTo(0,0,e,n),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid&&this.grid.onResize(e,n),this.onSizeChange.dispatch(this,e,n),this.currentScaleMode===t.ScaleManager.RESIZE&&(this.game.state.resize(e,n),this.game.load.resize(e,n))}},setMinMax:function(e,t,n,r){this.minWidth=e,this.minHeight=t,typeof n!="undefined"&&(this.maxWidth=n),typeof r!="undefined"&&(this.maxHeight=r)},preUpdate:function(){if(this.game.time.time<this._lastUpdate+this._updateThrottle)return;var e=this._updateThrottle;this._updateThrottleReset=e>=400?0:100,this.dom.getOffset(this.game.canvas,this.offset);var n=this._parentBounds.width,r=this._parentBounds.height,i=this.getParentBounds(this._parentBounds),s=i.width!==n||i.height!==r,o=this.updateOrientationState();if(s||o)this.onResize&&this.onResize.call(this.onResizeContext,this,i),this.updateLayout(),this.signalSizeChange();var u=this._updateThrottle*2;this._updateThrottle<e&&(u=Math.min(e,this._updateThrottleReset)),this._updateThrottle=t.Math.clamp(u,25,this.trackParentInterval),this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate(),this._updateThrottle=this.trackParentInterval},updateDimensions:function(e,t,n){this.width=e*this.parentScaleFactor.x,this.height=t*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.updateScalingAndBounds(),n&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.aspectRatio=this.width/this.height,this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(e,t){t===undefined&&(t=!1),this.forceLandscape=e,this.forcePortrait=t,this.queueUpdate(!0)},classifyOrientation:function(e){return e==="portrait-primary"||e==="portrait-secondary"?"portrait":e==="landscape-primary"||e==="landscape-secondary"?"landscape":null},updateOrientationState:function(){var e=this.screenOrientation,t=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var n=e!==this.screenOrientation,r=t!==this.incorrectOrientation;return r&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(n||r)&&this.onOrientationChange.dispatch(this,e,t),n||r},orientationChange:function(e){this.event=e,this.queueUpdate(!0)},windowResize:function(e){this.event=e,this.queueUpdate(!0)},scrollTop:function(){var e=this.compatibility.scrollTo;e&&window.scrollTo(e.x,e.y)},refresh:function(){this.scrollTop(),this.queueUpdate(!0)},updateLayout:function(){var e=this.currentScaleMode;if(e===t.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():e===t.ScaleManager.EXACT_FIT?this.setExactFit():e===t.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():e===t.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):e===t.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y);if(!this.compatibility.canExpandParent&&(e===t.ScaleManager.SHOW_ALL||e===t.ScaleManager.USER_SCALE)){var n=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,n.width),this.height=Math.min(this.height,n.height)}this.width=this.width|0,this.height=this.height|0,this.reflowCanvas()},getParentBounds:function(e){var n=e||new t.Rectangle,r=this.boundingParent,i=this.dom.visualBounds,s=this.dom.layoutBounds;if(!r)n.setTo(0,0,i.width,i.height);else{var o=r.getBoundingClientRect(),u=r.offsetParent?r.offsetParent.getBoundingClientRect():r.getBoundingClientRect();n.setTo(o.left-u.left,o.top-u.top,o.width,o.height);var a=this.windowConstraints;if(a.right){var f=a.right==="layout"?s:i;n.right=Math.min(n.right,f.width)}if(a.bottom){var f=a.bottom==="layout"?s:i;n.bottom=Math.min(n.bottom,f.height)}}return n.setTo(Math.round(n.x),Math.round(n.y),Math.round(n.width),Math.round(n.height)),n},alignCanvas:function(e,t){var n=this.getParentBounds(this._tempBounds),r=this.game.canvas,i=this.margin;if(e){i.left=i.right=0;var s=r.getBoundingClientRect();if(this.width<n.width&&!this.incorrectOrientation){var o=s.left-n.x,u=n.width/2-this.width/2;u=Math.max(u,0);var a=u-o;i.left=Math.round(a)}r.style.marginLeft=i.left+"px",i.left!==0&&(i.right=-(n.width-s.width-i.left),r.style.marginRight=i.right+"px")}if(t){i.top=i.bottom=0;var s=r.getBoundingClientRect();if(this.height<n.height&&!this.incorrectOrientation){var o=s.top-n.y,u=n.height/2-this.height/2;u=Math.max(u,0);var a=u-o;i.top=Math.round(a)}r.style.marginTop=i.top+"px",i.top!==0&&(i.bottom=-(n.height-s.height-i.top),r.style.marginBottom=i.bottom+"px")}i.x=i.left,i.y=i.top},reflowGame:function(){this.resetCanvas("","");var e=this.getParentBounds(this._tempBounds);this.updateDimensions(e.width,e.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=t.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=t.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)),this.resetCanvas(),this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)),this.updateScalingAndBounds()},resetCanvas:function(e,t){e===undefined&&(e=this.width+"px"),t===undefined&&(t=this.height+"px");var n=this.game.canvas;this.compatibility.noMargins||(n.style.marginLeft="",n.style.marginTop="",n.style.marginRight="",n.style.marginBottom=""),n.style.width=e,n.style.height=t},queueUpdate:function(e){e&&(this._parentBounds.width=0,this._parentBounds.height=0),this._updateThrottle=this._updateThrottleReset},reset:function(e){e&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width,this.height=this.dom.visualBounds.height},setShowAll:function(e){var t=this.getParentBounds(this._tempBounds),n=t.width,r=t.height,i;e?i=Math.max(r/this.game.height,n/this.game.width):i=Math.min(r/this.game.height,n/this.game.width),this.width=Math.round(this.game.width*i),this.height=Math.round(this.game.height*i)},setExactFit:function(){var e=this.getParentBounds(this._tempBounds);this.width=e.width,this.height=e.height;if(this.isFullScreen)return;this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight))},createFullScreenTarget:function(){var e=document.createElement("div");return e.style.margin="0",e.style.padding="0",e.style.background="#000",e},startFullScreen:function(e,n){if(this.isFullScreen)return!1;if(!this.compatibility.supportsFullScreen){var r=this;setTimeout(function(){r.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"){var i=this.game.input;if(i.activePointer&&i.activePointer!==i.mousePointer&&(n||n!==!1)){i.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[e,!1]);return}}typeof e!="undefined"&&this.game.renderType===t.CANVAS&&(this.game.stage.smoothed=e);var s=this.fullScreenTarget;s||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),s=this._createdFullScreenTarget);var o={targetElement:s};this.onFullScreenInit.dispatch(this,o);if(this._createdFullScreenTarget){var u=this.game.canvas,a=u.parentNode;a.insertBefore(s,u),s.appendChild(u)}return this.game.device.fullscreenKeyboard?s[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):s[this.game.device.requestFullscreen](),!0},stopFullScreen:function(){return!this.isFullScreen||!this.compatibility.supportsFullScreen?!1:(document[this.game.device.cancelFullscreen](),!0)},cleanupCreatedTarget:function(){var e=this._createdFullScreenTarget;if(e&&e.parentNode){var t=e.parentNode;t.insertBefore(this.game.canvas,e),t.removeChild(e)}this._createdFullScreenTarget=null},prepScreenMode:function(e){var n=!!this._createdFullScreenTarget,r=this._createdFullScreenTarget||this.fullScreenTarget;e?(n||this.fullScreenScaleMode===t.ScaleManager.EXACT_FIT)&&r!==this.game.canvas&&(this._fullScreenRestore={targetWidth:r.style.width,targetHeight:r.style.height},r.style.width="100%",r.style.height="100%"):(this._fullScreenRestore&&(r.style.width=this._fullScreenRestore.targetWidth,r.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(e){this.event=e,this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0)),this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(e){this.event=e,this.cleanupCreatedTarget(),console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API"),this.onFullScreenError.dispatch(this)},scaleSprite:function(e,t,n,r){t===undefined&&(t=this.width),n===undefined&&(n=this.height),r===undefined&&(r=!1);if(!e||!e.scale)return e;e.scale.x=1,e.scale.y=1;if(e.width<=0||e.height<=0||t<=0||n<=0)return e;var i=t,s=e.height*t/e.width,o=e.width*n/e.height,u=n,a=o>t;return a?a=r:a=!r,a?(e.width=Math.floor(i),e.height=Math.floor(s)):(e.width=Math.floor(o),e.height=Math.floor(u)),e},destroy:function(){this.game.onResume.remove(this._gameResumed,this),window.removeEventListener("orientationchange",this._orientationChange,!1),window.removeEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},t.ScaleManager.prototype.constructor=t.ScaleManager,Object.defineProperty(t.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&!this._createdFullScreenTarget)return null;var e=this.game.canvas&&this.game.canvas.parentNode;return e||null}}),Object.defineProperty(t.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(e){return e!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=e),this._scaleMode}}),Object.defineProperty(t.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(e){return e!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=e,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=e),this._fullScreenScaleMode}}),Object.defineProperty(t.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(t.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(e){e!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=e,this.queueUpdate(!0))}}),Object.defineProperty(t.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(e){e!==this._pageAlignVertically&&(this._pageAlignVertically=e,this.queueUpdate(!0))}}),Object.defineProperty(t.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(t.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}}),Object.defineProperty(t.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}}),Object.defineProperty(t.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(t.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),t.Utils.Debug=function(e){this.game=e,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1},t.Utils.Debug.prototype={boot:function(){this.game.renderType===t.CANVAS?this.context=this.game.context:(this.bmd=this.game.make.bitmapData(this.game.width,this.game.height),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.canvas=PIXI.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d"))},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(e,t,n,r){typeof e!="number"&&(e=0),typeof t!="number"&&(t=0),n=n||"rgb(255,255,255)",r===undefined&&(r=0),this.currentX=e,this.currentY=t,this.currentColor=n,this.columnWidth=r,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=n,this.context.fillStyle=n,this.context.font=this.font,this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){var e=this.currentX;for(var t=0;t<arguments.length;t++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[t],e+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[t],e,this.currentY),e+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sound: "+e.key+" Locked: "+e.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(e.key)+" Pending Playback: "+e.pendingPlayback),this.line("Decoded: "+e.isDecoded+" Decoding: "+e.isDecoding),this.line("Total Duration: "+e.totalDuration+" Playing: "+e.isPlaying),this.line("Time: "+e.currentTime),this.line("Volume: "+e.volume+" Muted: "+e.mute),this.line("WebAudio: "+e.usingWebAudio+" Audio: "+e.usingAudioTag),e.currentMarker!==""&&(this.line("Marker: "+e.currentMarker+" Duration: "+e.duration+" (ms: "+e.durationMS+")"),this.line("Start: "+e.markers[e.currentMarker].start+" Stop: "+e.markers[e.currentMarker].stop),this.line("Position: "+e.position)),this.stop()},cameraInfo:function(e,t,n,r){this.start(t,n,r),this.line("Camera ("+e.width+" x "+e.height+")"),this.line("X: "+e.x+" Y: "+e.y),e.bounds&&this.line("Bounds x: "+e.bounds.x+" Y: "+e.bounds.y+" w: "+e.bounds.width+" h: "+e.bounds.height),this.line("View x: "+e.view.x+" Y: "+e.view.y+" w: "+e.view.width+" h: "+e.view.height),this.line("Total in view: "+e.totalInView),this.stop()},timer:function(e,t,n,r){this.start(t,n,r),this.line("Timer (running: "+e.running+" expired: "+e.expired+")"),this.line("Next Tick: "+e.next+" Duration: "+e.duration),this.line("Paused: "+e.paused+" Length: "+e.length),this.stop()},pointer:function(e,t,n,r,i){if(e==null)return;t===undefined&&(t=!1),n=n||"rgba(0,255,0,0.5)",r=r||"rgba(255,0,0,0.5)";if(t===!0&&e.isUp===!0)return;this.start(e.x,e.y-100,i),this.context.beginPath(),this.context.arc(e.x,e.y,e.circle.radius,0,Math.PI*2),e.active?this.context.fillStyle=n:this.context.fillStyle=r,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(e.positionDown.x,e.positionDown.y),this.context.lineTo(e.position.x,e.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+e.id+" Active: "+e.active),this.line("World X: "+e.worldX+" World Y: "+e.worldY),this.line("Screen X: "+e.x+" Screen Y: "+e.y+" In: "+e.withinGame),this.line("Duration: "+e.duration+" ms"),this.line("is Down: "+e.isDown+" is Up: "+e.isUp),this.stop()},spriteInputInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sprite Input: ("+e.width+" x "+e.height+")"),this.line("x: "+e.input.pointerX().toFixed(1)+" y: "+e.input.pointerY().toFixed(1)),this.line("over: "+e.input.pointerOver()+" duration: "+e.input.overDuration().toFixed(0)),this.line("down: "+e.input.pointerDown()+" duration: "+e.input.downDuration().toFixed(0)),this.line("just over: "+e.input.justOver()+" just out: "+e.input.justOut()),this.stop()},key:function(e,t,n,r){this.start(t,n,r,150),this.line("Key:",e.keyCode,"isDown:",e.isDown),this.line("justDown:",e.justDown,"justUp:",e.justUp),this.line("Time Down:",e.timeDown.toFixed(0),"duration:",e.duration.toFixed(0)),this.stop()},inputInfo:function(e,t,n){this.start(e,t,n),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(e,t,n){var r=e.getBounds();r.x+=this.game.camera.x,r.y+=this.game.camera.y,this.rectangle(r,t,n)},ropeSegments:function(e,t,n){var r=e.segments,i=this;r.forEach(function(e){i.rectangle(e,t,n)},this)},spriteInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sprite:  ("+e.width+" x "+e.height+") anchor: "+e.anchor.x+" x "+e.anchor.y),this.line("x: "+e.x.toFixed(1)+" y: "+e.y.toFixed(1)),this.line("angle: "+e.angle.toFixed(1)+" rotation: "+e.rotation.toFixed(1)),this.line("visible: "+e.visible+" in camera: "+e.inCamera),this.line("bounds x: "+e._bounds.x.toFixed(1)+" y: "+e._bounds.y.toFixed(1)+" w: "+e._bounds.width.toFixed(1)+" h: "+e._bounds.height.toFixed(1)),this.stop()},spriteCoords:function(e,t,n,r){this.start(t,n,r,100),e.name&&this.line(e.name),this.line("x:",e.x.toFixed(2),"y:",e.y.toFixed(2)),this.line("pos x:",e.position.x.toFixed(2),"pos y:",e.position.y.toFixed(2)),this.line("world x:",e.world.x.toFixed(2),"world y:",e.world.y.toFixed(2)),this.stop()},lineInfo:function(e,t,n,r){this.start(t,n,r,80),this.line("start.x:",e.start.x.toFixed(2),"start.y:",e.start.y.toFixed(2)),this.line("end.x:",e.end.x.toFixed(2),"end.y:",e.end.y.toFixed(2)),this.line("length:",e.length.toFixed(2),"angle:",e.angle),this.stop()},pixel:function(e,t,n,r){r=r||2,this.start(),this.context.fillStyle=n,this.context.fillRect(e,t,r,r),this.stop()},geom:function(e,n,r,i){r===undefined&&(r=!0),i===undefined&&(i=0),n=n||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=n,this.context.strokeStyle=n;if(e instanceof t.Rectangle||i===1)r?this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height):this.context.strokeRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height);else if(e instanceof t.Circle||i===2)this.context.beginPath(),this.context.arc(e.x-this.game.camera.x,e.y-this.game.camera.y,e.radius,0,Math.PI*2,!1),this.context.closePath(),r?this.context.fill():this.context.stroke();else if(e instanceof t.Point||i===3)this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,4,4);else if(e instanceof t.Line||i===4)this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(e.start.x+.5-this.game.camera.x,e.start.y+.5-this.game.camera.y),this.context.lineTo(e.end.x+.5-this.game.camera.x,e.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke();this.stop()},rectangle:function(e,t,n){n===undefined&&(n=!0),t=t||"rgba(0, 255, 0, 0.4)",this.start(),n?(this.context.fillStyle=t,this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)):(this.context.strokeStyle=t,this.context.strokeRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)),this.stop()},text:function(e,t,n,r,i){r=r||"rgb(255,255,255)",i=i||"16px Courier",this.start(),this.context.font=i,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(e,t+1,n+1)),this.context.fillStyle=r,this.context.fillText(e,t,n),this.stop()},quadTree:function(e,t){t=t||"rgba(255,0,0,0.3)",this.start();var n=e.bounds;if(e.nodes.length===0){this.context.strokeStyle=t,this.context.strokeRect(n.x,n.y,n.width,n.height),this.text("size: "+e.objects.length,n.x+4,n.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var r=0;r<e.objects.length;r++)this.context.strokeRect(e.objects[r].x,e.objects[r].y,e.objects[r].width,e.objects[r].height)}else for(var r=0;r<e.nodes.length;r++)this.quadTree(e.nodes[r]);this.stop()},body:function(e,n,r){e.body&&(this.start(),e.body.type===t.Physics.ARCADE?t.Physics.Arcade.Body.render(this.context,e.body,n,r):e.body.type===t.Physics.NINJA?t.Physics.Ninja.Body.render(this.context,e.body,n,r):e.body.type===t.Physics.BOX2D&&t.Physics.Box2D.renderBody(this.context,e.body,n),this.stop())},bodyInfo:function(e,n,r,i){e.body&&(this.start(n,r,i,210),e.body.type===t.Physics.ARCADE?t.Physics.Arcade.Body.renderBodyInfo(this,e.body):e.body.type===t.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,e.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(e,n){this.start(),t.Physics.Box2D.renderBody(this.context,e,n),this.stop()},destroy:function(){PIXI.CanvasPool.remove(this)}},t.Utils.Debug.prototype.constructor=t.Utils.Debug,t.DOM={getOffset:function(e,n){n=n||new t.Point;var r=e.getBoundingClientRect(),i=t.DOM.scrollY,s=t.DOM.scrollX,o=document.documentElement.clientTop,u=document.documentElement.clientLeft;return n.x=r.left+s-u,n.y=r.top+i-o,n},getBounds:function(e,t){return t===undefined&&(t=0),e=e&&!e.nodeType?e[0]:e,!e||e.nodeType!==1?!1:this.calibrate(e.getBoundingClientRect(),t)},calibrate:function(e,t){t=+t||0;var n={width:0,height:0,left:0,right:0,top:0,bottom:0};return n.width=(n.right=e.right+t)-(n.left=e.left-t),n.height=(n.bottom=e.bottom+t)-(n.top=e.top-t),n},getAspectRatio:function(e){e=null==e?this.visualBounds:1===e.nodeType?this.getBounds(e):e;var t=e.width,n=e.height;return typeof t=="function"&&(t=t.call(e)),typeof n=="function"&&(n=n.call(e)),t/n},inLayoutViewport:function(e,t){var n=this.getBounds(e,t);return!!n&&n.bottom>=0&&n.right>=0&&n.top<=this.layoutBounds.width&&n.left<=this.layoutBounds.height},getScreenOrientation:function(e){var t=window.screen,n=t.orientation||t.mozOrientation||t.msOrientation;if(n&&typeof n.type=="string")return n.type;if(typeof n=="string")return n;var r="portrait-primary",i="landscape-primary";if(e==="screen")return t.height>t.width?r:i;if(e==="viewport")return this.visualBounds.height>this.visualBounds.width?r:i;if(e==="window.orientation"&&typeof window.orientation=="number")return window.orientation===0||window.orientation===180?r:i;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return r;if(window.matchMedia("(orientation: landscape)").matches)return i}return this.visualBounds.height>this.visualBounds.width?r:i},visualBounds:new t.Rectangle,layoutBounds:new t.Rectangle,documentBounds:new t.Rectangle},t.Device.whenReady(function(e){var n=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},r=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(t.DOM,"scrollX",{get:n}),Object.defineProperty(t.DOM,"scrollY",{get:r}),Object.defineProperty(t.DOM.visualBounds,"x",{get:n}),Object.defineProperty(t.DOM.visualBounds,"y",{get:r}),Object.defineProperty(t.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(t.DOM.layoutBounds,"y",{value:0});var i=e.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight;if(i){var s=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},o=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(t.DOM.visualBounds,"width",{get:s}),Object.defineProperty(t.DOM.visualBounds,"height",{get:o}),Object.defineProperty(t.DOM.layoutBounds,"width",{get:s}),Object.defineProperty(t.DOM.layoutBounds,"height",{get:o})}else Object.defineProperty(t.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(t.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(t.DOM.layoutBounds,"width",{get:function(){var e=document.documentElement.clientWidth,t=window.innerWidth;return e<t?t:e}}),Object.defineProperty(t.DOM.layoutBounds,"height",{get:function(){var e=document.documentElement.clientHeight,t=window.innerHeight;return e<t?t:e}});Object.defineProperty(t.DOM.documentBounds,"x",{value:0}),Object.defineProperty(t.DOM.documentBounds,"y",{value:0}),Object.defineProperty(t.DOM.documentBounds,"width",{get:function(){var e=document.documentElement;return Math.max(e.clientWidth,e.offsetWidth,e.scrollWidth)}}),Object.defineProperty(t.DOM.documentBounds,"height",{get:function(){var e=document.documentElement;return Math.max(e.clientHeight,e.offsetHeight,e.scrollHeight)}})},null,!0),t.ArraySet=function(e){this.position=0,this.list=e||[]},t.ArraySet.prototype={add:function(e){return this.exists(e)||this.list.push(e),e},getIndex:function(e){return this.list.indexOf(e)},getByKey:function(e,t){var n=this.list.length;while(n--)if(this.list[n][e]===t)return this.list[n];return null},exists:function(e){return this.list.indexOf(e)>-1},reset:function(){this.list.length=0},remove:function(e){var t=this.list.indexOf(e);if(t>-1)return this.list.splice(t,1),e},setAll:function(e,t){var n=this.list.length;while(n--)this.list[n]&&(this.list[n][e]=t)},callAll:function(e){var t=Array.prototype.slice.call(arguments,1),n=this.list.length;while(n--)this.list[n]&&this.list[n][e]&&this.list[n][e].apply(this.list[n],t)},removeAll:function(e){e===undefined&&(e=!1);var t=this.list.length;while(t--)if(this.list[t]){var n=this.remove(this.list[t]);e&&n.destroy()}this.position=0,this.list=[]}},Object.defineProperty(t.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(t.ArraySet.prototype,"first",{get:function(){return this.position=0,this.list.length>0?this.list[0]:null}}),Object.defineProperty(t.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),t.ArraySet.prototype.constructor=t.ArraySet,t.ArrayUtils={getRandomItem:function(e,t,n){if(e===null)return null;t===undefined&&(t=0),n===undefined&&(n=e.length);var r=t+Math.floor(Math.random()*n);return e[r]===undefined?null:e[r]},removeRandomItem:function(e,t,n){if(e==null)return null;t===undefined&&(t=0),n===undefined&&(n=e.length);var r=t+Math.floor(Math.random()*n);if(r<e.length){var i=e.splice(r,1);return i[0]===undefined?null:i[0]}return null},shuffle:function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},transposeMatrix:function(e){var t=e.length,n=e[0].length,r=new Array(n);for(var i=0;i<n;i++){r[i]=new Array(t);for(var s=t-1;s>-1;s--)r[i][s]=e[s][i]}return r},rotateMatrix:function(e,n){typeof n!="string"&&(n=(n%360+360)%360);if(n===90||n===-270||n==="rotateLeft")e=t.ArrayUtils.transposeMatrix(e),e=e.reverse();else if(n===-90||n===270||n==="rotateRight")e=e.reverse(),e=t.ArrayUtils.transposeMatrix(e);else if(Math.abs(n)===180||n==="rotate180"){for(var r=0;r<e.length;r++)e[r].reverse();e=e.reverse()}return e},findClosest:function(e,t){if(!t.length)return NaN;if(t.length===1||e<t[0])return t[0];var n=1;while(t[n]<e)n++;var r=t[n-1],i=n<t.length?t[n]:Number.POSITIVE_INFINITY;return i-e<=e-r?i:r},rotate:function(e){var t=e.shift();return e.push(t),t},numberArray:function(e,t){var n=[];for(var r=e;r<=t;r++)n.push(r);return n},numberArrayStep:function(e,n,r){if(e===undefined||e===null)e=0;if(n===undefined||n===null)n=e,e=0;r===undefined&&(r=1);var i=[],s=Math.max(t.Math.roundAwayFromZero((n-e)/(r||1)),0);for(var o=0;o<s;o++)i.push(e),e+=r;return i}},t.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},t.LinkedList.prototype={add:function(e){return this.total===0&&this.first===null&&this.last===null?(this.first=e,this.last=e,this.next=e,e.prev=this,this.total++,e):(this.last.next=e,e.prev=this.last,this.last=e,this.total++,e)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(e){if(this.total===1){this.reset(),e.next=e.prev=null;return}e===this.first?this.first=this.first.next:e===this.last&&(this.last=this.last.prev),e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.next=e.prev=null,this.first===null&&(this.last=null),this.total--},callAll:function(e){if(!this.first||!this.last)return;var t=this.first;do t&&t[e]&&t[e].call(t),t=t.next;while(t!=this.last.next)}},t.LinkedList.prototype.constructor=t.LinkedList,t.Create=function(e){this.game=e,this.bmd=null,this.canvas=null,this.ctx=null,this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]},t.Create.PALETTE_ARNE=0,t.Create.PALETTE_JMP=1,t.Create.PALETTE_CGA=2,t.Create.PALETTE_C64=3,t.Create.PALETTE_JAPANESE_MACHINE=4,t.Create.prototype={texture:function(e,t,n,r,i){n===undefined&&(n=8),r===undefined&&(r=n),i===undefined&&(i=0);var s=t[0].length*n,o=t.length*r;this.bmd===null&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(s,o),this.bmd.clear();for(var u=0;u<t.length;u++){var a=t[u];for(var f=0;f<a.length;f++){var l=a[f];l!=="."&&l!==" "&&(this.ctx.fillStyle=this.palettes[i][l],this.ctx.fillRect(f*n,u*r,n,r))}}return this.bmd.generateTexture(e)},grid:function(e,t,n,r,i,s){this.bmd===null&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(t,n),this.ctx.fillStyle=s;for(var o=0;o<n;o+=i)this.ctx.fillRect(0,o,t,1);for(var u=0;u<t;u+=r)this.ctx.fillRect(u,0,1,n);return this.bmd.generateTexture(e)}},t.Create.prototype.constructor=t.Create,t.FlexGrid=function(e,n,r){this.game=e.game,this.manager=e,this.width=n,this.height=r,this.boundsCustom=new t.Rectangle(0,0,n,r),this.boundsFluid=new t.Rectangle(0,0,n,r),this.boundsFull=new t.Rectangle(0,0,n,r),this.boundsNone=new t.Rectangle(0,0,n,r),this.positionCustom=new t.Point(0,0),this.positionFluid=new t.Point(0,0),this.positionFull=new t.Point(0,0),this.positionNone=new t.Point(0,0),this.scaleCustom=new t.Point(1,1),this.scaleFluid=new t.Point(1,1),this.scaleFluidInversed=new t.Point(1,1),this.scaleFull=new t.Point(1,1),this.scaleNone=new t.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=n/r,this.ratioV=r/n,this.multiplier=0,this.layers=[]},t.FlexGrid.prototype={setSize:function(e,n){this.width=e,this.height=n,this.ratioH=e/n,this.ratioV=n/e,this.scaleNone=new t.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(e,n,r,i){i===undefined&&(i=!0),this.customWidth=e,this.customHeight=n,this.boundsCustom.width=e,this.boundsCustom.height=n;var s=new t.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return i&&this.game.world.add(s),this.layers.push(s),typeof r!="undefined"&&typeof r!==null&&s.addMultiple(r),s},createFluidLayer:function(e,n){n===undefined&&(n=!0);var r=new t.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return n&&this.game.world.add(r),this.layers.push(r),typeof e!="undefined"&&typeof e!==null&&r.addMultiple(e),r},createFullLayer:function(e){var n=new t.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(n),this.layers.push(n),typeof e!="undefined"&&n.addMultiple(e),n},createFixedLayer:function(e){var n=new t.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(n),this.layers.push(n),typeof e!="undefined"&&n.addMultiple(e),n},reset:function(){var e=this.layers.length;while(e--)this.layers[e].persist||(this.layers[e].position=null,this.layers[e].scale=null,this.layers.slice(e,1))},onResize:function(e,t){this.ratioH=e/t,this.ratioV=t/e,this.refresh(e,t)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=Math.round(this.width*this.multiplier),this.boundsFluid.height=Math.round(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x),this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y),this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(e){this.manager.scaleSprite(e),e.x=this.manager.bounds.centerX,e.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},t.FlexGrid.prototype.constructor=t.FlexGrid,t.FlexLayer=function(e,n,r,i){t.Group.call(this,e.game,null,"__flexLayer"+e.game.rnd.uuid(),!1),this.manager=e.manager,this.grid=e,this.persist=!1,this.position=n,this.bounds=r,this.scale=i,this.topLeft=r.topLeft,this.topMiddle=new t.Point(r.halfWidth,0),this.topRight=r.topRight,this.bottomLeft=r.bottomLeft,this.bottomMiddle=new t.Point(r.halfWidth,r.bottom),this.bottomRight=r.bottomRight},t.FlexLayer.prototype=Object.create(t.Group.prototype),t.FlexLayer.prototype.constructor=t.FlexLayer,t.FlexLayer.prototype.resize=function(){},t.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},t.Color={packPixel:function(e,n,r,i){return t.Device.LITTLE_ENDIAN?(i<<24|r<<16|n<<8|e)>>>0:(e<<24|n<<16|r<<8|i)>>>0},unpackPixel:function(e,n,r,i){if(n===undefined||n===null)n=t.Color.createColor();if(r===undefined||r===null)r=!1;if(i===undefined||i===null)i=!1;return t.Device.LITTLE_ENDIAN?(n.a=(e&4278190080)>>>24,n.b=(e&16711680)>>>16,n.g=(e&65280)>>>8,n.r=e&255):(n.r=(e&4278190080)>>>24,n.g=(e&16711680)>>>16,n.b=(e&65280)>>>8,n.a=e&255),n.color=e,n.rgba="rgba("+n.r+","+n.g+","+n.b+","+n.a/255+")",r&&t.Color.RGBtoHSL(n.r,n.g,n.b,n),i&&t.Color.RGBtoHSV(n.r,n.g,n.b,n),n},fromRGBA:function(e,n){return n||(n=t.Color.createColor()),n.r=(e&4278190080)>>>24,n.g=(e&16711680)>>>16,n.b=(e&65280)>>>8,n.a=e&255,n.rgba="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",n},toRGBA:function(e,t,n,r){return e<<24|t<<16|n<<8|r},RGBtoHSL:function(e,n,r,i){i||(i=t.Color.createColor(e,n,r,1)),e/=255,n/=255,r/=255;var s=Math.min(e,n,r),o=Math.max(e,n,r);i.h=0,i.s=0,i.l=(o+s)/2;if(o!==s){var u=o-s;i.s=i.l>.5?u/(2-o-s):u/(o+s),o===e?i.h=(n-r)/u+(n<r?6:0):o===n?i.h=(r-e)/u+2:o===r&&(i.h=(e-n)/u+4),i.h/=6}return i},HSLtoRGB:function(e,n,r,i){i?(i.r=r,i.g=r,i.b=r):i=t.Color.createColor(r,r,r);if(n!==0){var s=r<.5?r*(1+n):r+n-r*n,o=2*r-s;i.r=t.Color.hueToColor(o,s,e+1/3),i.g=t.Color.hueToColor(o,s,e),i.b=t.Color.hueToColor(o,s,e-1/3)}return i.r=Math.floor(i.r*255|0),i.g=Math.floor(i.g*255|0),i.b=Math.floor(i.b*255|0),t.Color.updateColor(i),i},RGBtoHSV:function(e,n,r,i){i||(i=t.Color.createColor(e,n,r,255)),e/=255,n/=255,r/=255;var s=Math.min(e,n,r),o=Math.max(e,n,r),u=o-s;return i.h=0,i.s=o===0?0:u/o,i.v=o,o!==s&&(o===e?i.h=(n-r)/u+(n<r?6:0):o===n?i.h=(r-e)/u+2:o===r&&(i.h=(e-n)/u+4),i.h/=6),i},HSVtoRGB:function(e,n,r,i){i===undefined&&(i=t.Color.createColor(0,0,0,1,e,n,0,r));var s,o,u,a=Math.floor(e*6),f=e*6-a,l=r*(1-n),c=r*(1-f*n),h=r*(1-(1-f)*n);switch(a%6){case 0:s=r,o=h,u=l;break;case 1:s=c,o=r,u=l;break;case 2:s=l,o=r,u=h;break;case 3:s=l,o=c,u=r;break;case 4:s=h,o=l,u=r;break;case 5:s=r,o=l,u=c}return i.r=Math.floor(s*255),i.g=Math.floor(o*255),i.b=Math.floor(u*255),t.Color.updateColor(i),i},hueToColor:function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e},createColor:function(e,n,r,i,s,o,u,a){var f={r:e||0,g:n||0,b:r||0,a:i||1,h:s||0,s:o||0,l:u||0,v:a||0,color:0,color32:0,rgba:""};return t.Color.updateColor(f)},updateColor:function(e){return e.rgba="rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+e.a.toString()+")",e.color=t.Color.getColor(e.r,e.g,e.b),e.color32=t.Color.getColor32(e.a*255,e.r,e.g,e.b),e},getColor32:function(e,t,n,r){return e<<24|t<<16|n<<8|r},getColor:function(e,t,n){return e<<16|t<<8|n},RGBtoString:function(e,n,r,i,s){return i===undefined&&(i=255),s===undefined&&(s="#"),s==="#"?"#"+((1<<24)+(e<<16)+(n<<8)+r).toString(16).slice(1):"0x"+t.Color.componentToHex(i)+t.Color.componentToHex(e)+t.Color.componentToHex(n)+t.Color.componentToHex(r)},hexToRGB:function(e){var n=t.Color.hexToColor(e);if(n)return t.Color.getColor32(n.a,n.r,n.g,n.b)},hexToColor:function(e,n){e=e.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});var r=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(r){var i=parseInt(r[1],16),s=parseInt(r[2],16),o=parseInt(r[3],16);n?(n.r=i,n.g=s,n.b=o):n=t.Color.createColor(i,s,o)}return n},webToColor:function(e,n){n||(n=t.Color.createColor());var r=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e);return r&&(n.r=parseInt(r[1],10),n.g=parseInt(r[2],10),n.b=parseInt(r[3],10),n.a=r[4]!==undefined?parseFloat(r[4]):1,t.Color.updateColor(n)),n},valueToColor:function(e,n){n||(n=t.Color.createColor());if(typeof e=="string")return e.indexOf("rgb")===0?t.Color.webToColor(e,n):(n.a=1,t.Color.hexToColor(e,n));if(typeof e=="number"){var r=t.Color.getRGB(e);return n.r=r.r,n.g=r.g,n.b=r.b,n.a=r.a/255,n}return n},componentToHex:function(e){var t=e.toString(16);return t.length==1?"0"+t:t},HSVColorWheel:function(e,n){e===undefined&&(e=1),n===undefined&&(n=1);var r=[];for(var i=0;i<=359;i++)r.push(t.Color.HSVtoRGB(i/359,e,n));return r},HSLColorWheel:function(e,n){e===undefined&&(e=.5),n===undefined&&(n=.5);var r=[];for(var i=0;i<=359;i++)r.push(t.Color.HSLtoRGB(i/359,e,n));return r},interpolateColor:function(e,n,r,i,s){s===undefined&&(s=255);var o=t.Color.getRGB(e),u=t.Color.getRGB(n),a=(u.red-o.red)*i/r+o.red,f=(u.green-o.green)*i/r+o.green,l=(u.blue-o.blue)*i/r+o.blue;return t.Color.getColor32(s,a,f,l)},interpolateColorWithRGB:function(e,n,r,i,s,o){var u=t.Color.getRGB(e),a=(n-u.red)*o/s+u.red,f=(r-u.green)*o/s+u.green,l=(i-u.blue)*o/s+u.blue;return t.Color.getColor(a,f,l)},interpolateRGB:function(e,n,r,i,s,o,u,a){var f=(i-e)*a/u+e,l=(s-n)*a/u+n,c=(o-r)*a/u+r;return t.Color.getColor(f,l,c)},getRandomColor:function(e,n,r){e===undefined&&(e=0),n===undefined&&(n=255),r===undefined&&(r=255);if(n>255||e>n)return t.Color.getColor(255,255,255);var i=e+Math.round(Math.random()*(n-e)),s=e+Math.round(Math.random()*(n-e)),o=e+Math.round(Math.random()*(n-e));return t.Color.getColor32(r,i,s,o)},getRGB:function(e){return e>16777215?{alpha:e>>>24,red:e>>16&255,green:e>>8&255,blue:e&255,a:e>>>24,r:e>>16&255,g:e>>8&255,b:e&255}:{alpha:255,red:e>>16&255,green:e>>8&255,blue:e&255,a:255,r:e>>16&255,g:e>>8&255,b:e&255}},getWebRGB:function(e){if(typeof e=="object")return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")";var n=t.Color.getRGB(e);return"rgba("+n.r.toString()+","+n.g.toString()+","+n.b.toString()+","+(n.a/255).toString()+")"},getAlpha:function(e){return e>>>24},getAlphaFloat:function(e){return(e>>>24)/255},getRed:function(e){return e>>16&255},getGreen:function(e){return e>>8&255},getBlue:function(e){return e&255},blendNormal:function(e){return e},blendLighten:function(e,t){return t>e?t:e},blendDarken:function(e,t){return t>e?e:t},blendMultiply:function(e,t){return e*t/255},blendAverage:function(e,t){return(e+t)/2},blendAdd:function(e,t){return Math.min(255,e+t)},blendSubtract:function(e,t){return Math.max(0,e+t-255)},blendDifference:function(e,t){return Math.abs(e-t)},blendNegation:function(e,t){return 255-Math.abs(255-e-t)},blendScreen:function(e,t){return 255-((255-e)*(255-t)>>8)},blendExclusion:function(e,t){return e+t-2*e*t/255},blendOverlay:function(e,t){return t<128?2*e*t/255:255-2*(255-e)*(255-t)/255},blendSoftLight:function(e,t){return t<128?2*((e>>1)+64)*(t/255):255-2*(255-((e>>1)+64))*(255-t)/255},blendHardLight:function(e,n){return t.Color.blendOverlay(n,e)},blendColorDodge:function(e,t){return t===255?t:Math.min(255,(e<<8)/(255-t))},blendColorBurn:function(e,t){return t===0?t:Math.max(0,255-(255-e<<8)/t)},blendLinearDodge:function(e,n){return t.Color.blendAdd(e,n)},blendLinearBurn:function(e,n){return t.Color.blendSubtract(e,n)},blendLinearLight:function(e,n){return n<128?t.Color.blendLinearBurn(e,2*n):t.Color.blendLinearDodge(e,2*(n-128))},blendVividLight:function(e,n){return n<128?t.Color.blendColorBurn(e,2*n):t.Color.blendColorDodge(e,2*(n-128))},blendPinLight:function(e,n){return n<128?t.Color.blendDarken(e,2*n):t.Color.blendLighten(e,2*(n-128))},blendHardMix:function(e,n){return t.Color.blendVividLight(e,n)<128?0:255},blendReflect:function(e,t){return t===255?t:Math.min(255,e*e/(255-t))},blendGlow:function(e,n){return t.Color.blendReflect(n,e)},blendPhoenix:function(e,t){return Math.min(e,t)-Math.max(e,t)+255}},t.Physics=function(e,t){t=t||{},this.game=e,this.config=t,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.matter=null,this.parseConfig()},t.Physics.ARCADE=0,t.Physics.P2JS=1,t.Physics.NINJA=2,t.Physics.BOX2D=3,t.Physics.CHIPMUNK=4,t.Physics.MATTERJS=5,t.Physics.prototype={parseConfig:function(){(!this.config.hasOwnProperty("arcade")||this.config.arcade===!0)&&t.Physics.hasOwnProperty("Arcade")&&(this.arcade=new t.Physics.Arcade(this.game)),this.config.hasOwnProperty("ninja")&&this.config.ninja===!0&&t.Physics.hasOwnProperty("Ninja")&&(this.ninja=new t.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&this.config.p2===!0&&t.Physics.hasOwnProperty("P2")&&(this.p2=new t.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&this.config.box2d===!0&&t.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new t.Physics.BOX2D(this.game,this.config)),this.config.hasOwnProperty("matter")&&this.config.matter===!0&&t.Physics.hasOwnProperty("Matter")&&(this.matter=new t.Physics.Matter(this.game,this.config))},startSystem:function(e){e===t.Physics.ARCADE?this.arcade=new t.Physics.Arcade(this.game):e===t.Physics.P2JS?this.p2===null?this.p2=new t.Physics.P2(this.game,this.config):this.p2.reset():e===t.Physics.NINJA?this.ninja=new t.Physics.Ninja(this.game):e===t.Physics.BOX2D?this.box2d===null?this.box2d=new t.Physics.Box2D(this.game,this.config):this.box2d.reset():e===t.Physics.MATTERJS&&(this.matter===null?this.matter=new t.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(e,n,r){n===undefined&&(n=t.Physics.ARCADE),r===undefined&&(r=!1),n===t.Physics.ARCADE?this.arcade.enable(e):n===t.Physics.P2JS&&this.p2?this.p2.enable(e,r):n===t.Physics.NINJA&&this.ninja?this.ninja.enableAABB(e):n===t.Physics.BOX2D&&this.box2d?this.box2d.enable(e):n===t.Physics.MATTERJS&&this.matter&&this.matter.enable(e)},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate(),this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update(),this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld(),this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear(),this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset(),this.box2d&&this.box2d.reset(),this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.matter&&this.matter.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null,this.matter=null}},t.Physics.prototype.constructor=t.Physics,t.Physics.Arcade=function(e){this.game=e,this.gravity=new t.Point,this.bounds=new t.Rectangle(0,0,e.world.width,e.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceX=!1,this.sortDirection=t.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new t.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()},t.Physics.Arcade.prototype.constructor=t.Physics.Arcade,t.Physics.Arcade.SORT_NONE=0,t.Physics.Arcade.LEFT_RIGHT=1,t.Physics.Arcade.RIGHT_LEFT=2,t.Physics.Arcade.TOP_BOTTOM=3,t.Physics.Arcade.BOTTOM_TOP=4,t.Physics.Arcade.prototype={setBounds:function(e,t,n,r){this.bounds.setTo(e,t,n,r)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(e,n){n===undefined&&(n=!0);var r=1;if(Array.isArray(e)){r=e.length;while(r--)e[r]instanceof t.Group?this.enable(e[r].children,n):(this.enableBody(e[r]),n&&e[r].hasOwnProperty("children")&&e[r].children.length>0&&this.enable(e[r],!0))}else e instanceof t.Group?this.enable(e.children,n):(this.enableBody(e),n&&e.hasOwnProperty("children")&&e.children.length>0&&this.enable(e.children,!0))},enableBody:function(e){e.hasOwnProperty("body")&&e.body===null&&(e.body=new t.Physics.Arcade.Body(e),e.parent&&e.parent instanceof t.Group&&e.parent.addToHash(e))},updateMotion:function(e){var t=this.computeVelocity(0,e,e.angularVelocity,e.angularAcceleration,e.angularDrag,e.maxAngular)-e.angularVelocity;e.angularVelocity+=t,e.rotation+=e.angularVelocity*this.game.time.physicsElapsed,e.velocity.x=this.computeVelocity(1,e,e.velocity.x,e.acceleration.x,e.drag.x,e.maxVelocity.x),e.velocity.y=this.computeVelocity(2,e,e.velocity.y,e.acceleration.y,e.drag.y,e.maxVelocity.y)},computeVelocity:function(e,t,n,r,i,s){return s===undefined&&(s=1e4),e===1&&t.allowGravity?n+=(this.gravity.x+t.gravity.x)*this.game.time.physicsElapsed:e===2&&t.allowGravity&&(n+=(this.gravity.y+t.gravity.y)*this.game.time.physicsElapsed),r?n+=r*this.game.time.physicsElapsed:i&&(i*=this.game.time.physicsElapsed,n-i>0?n-=i:n+i<0?n+=i:n=0),n>s?n=s:n<-s&&(n=-s),n},overlap:function(e,t,n,r,i){n=n||null,r=r||null,i=i||n,this._total=0;if(!Array.isArray(e)&&Array.isArray(t))for(var s=0;s<t.length;s++)this.collideHandler(e,t[s],n,r,i,!0);else if(Array.isArray(e)&&!Array.isArray(t))for(var s=0;s<e.length;s++)this.collideHandler(e[s],t,n,r,i,!0);else if(Array.isArray(e)&&Array.isArray(t))for(var s=0;s<e.length;s++)for(var o=0;o<t.length;o++)this.collideHandler(e[s],t[o],n,r,i,!0);else this.collideHandler(e,t,n,r,i,!0);return this._total>0},collide:function(e,t,n,r,i){n=n||null,r=r||null,i=i||n,this._total=0;if(!Array.isArray(e)&&Array.isArray(t))for(var s=0;s<t.length;s++)this.collideHandler(e,t[s],n,r,i,!1);else if(Array.isArray(e)&&!Array.isArray(t))for(var s=0;s<e.length;s++)this.collideHandler(e[s],t,n,r,i,!1);else if(Array.isArray(e)&&Array.isArray(t))for(var s=0;s<e.length;s++)for(var o=0;o<t.length;o++)this.collideHandler(e[s],t[o],n,r,i,!1);else this.collideHandler(e,t,n,r,i,!1);return this._total>0},sortLeftRight:function(e,t){return!e.body||!t.body?0:e.body.x-t.body.x},sortRightLeft:function(e,t){return!e.body||!t.body?0:t.body.x-e.body.x},sortTopBottom:function(e,t){return!e.body||!t.body?0:e.body.y-t.body.y},sortBottomTop:function(e,t){return!e.body||!t.body?0:t.body.y-e.body.y},sort:function(e,n){e.physicsSortDirection!==null?n=e.physicsSortDirection:n===undefined&&(n=this.sortDirection),n===t.Physics.Arcade.LEFT_RIGHT?e.hash.sort(this.sortLeftRight):n===t.Physics.Arcade.RIGHT_LEFT?e.hash.sort(this.sortRightLeft):n===t.Physics.Arcade.TOP_BOTTOM?e.hash.sort(this.sortTopBottom):n===t.Physics.Arcade.BOTTOM_TOP&&e.hash.sort(this.sortBottomTop)},collideHandler:function(e,n,r,i,s,o){if(n===undefined&&e.physicsType===t.GROUP){this.sort(e),this.collideGroupVsSelf(e,r,i,s,o);return}if(!e||!n||!e.exists||!n.exists)return;this.sortDirection!==t.Physics.Arcade.SORT_NONE&&(e.physicsType===t.GROUP&&this.sort(e),n.physicsType===t.GROUP&&this.sort(n)),e.physicsType===t.SPRITE?n.physicsType===t.SPRITE?this.collideSpriteVsSprite(e,n,r,i,s,o):n.physicsType===t.GROUP?this.collideSpriteVsGroup(e,n,r,i,s,o):n.physicsType===t.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(e,n,r,i,s,o):e.physicsType===t.GROUP?n.physicsType===t.SPRITE?this.collideSpriteVsGroup(n,e,r,i,s,o):n.physicsType===t.GROUP?this.collideGroupVsGroup(e,n,r,i,s,o):n.physicsType===t.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(e,n,r,i,s,o):e.physicsType===t.TILEMAPLAYER&&(n.physicsType===t.SPRITE?this.collideSpriteVsTilemapLayer(n,e,r,i,s,o):n.physicsType===t.GROUP&&this.collideGroupVsTilemapLayer(n,e,r,i,s,o))},collideSpriteVsSprite:function(e,t,n,r,i,s){return!e.body||!t.body?!1:(this.separate(e.body,t.body,r,i,s)&&(n&&n.call(i,e,t),this._total++),!0)},collideSpriteVsGroup:function(e,n,r,i,s,o){if(n.length===0||!e.body)return;var u;if(this.skipQuadTree||e.body.skipQuadTree)for(var a=0;a<n.hash.length;a++){if(!n.hash[a]||!n.hash[a].exists||!n.hash[a].body)continue;u=n.hash[a].body;if(this.sortDirection===t.Physics.Arcade.LEFT_RIGHT){if(e.body.right<u.x)break;if(u.right<e.body.x)continue}else if(this.sortDirection===t.Physics.Arcade.RIGHT_LEFT){if(e.body.x>u.right)break;if(u.x>e.body.right)continue}else if(this.sortDirection===t.Physics.Arcade.TOP_BOTTOM){if(e.body.bottom<u.y)break;if(u.bottom<e.body.y)continue}else if(this.sortDirection===t.Physics.Arcade.BOTTOM_TOP){if(e.body.y>u.bottom)break;if(u.y>e.body.bottom)continue}this.collideSpriteVsSprite(e,n.hash[a],r,i,s,o)}else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(n);var f=this.quadTree.retrieve(e);for(var a=0;a<f.length;a++)this.separate(e.body,f[a],i,s,o)&&(r&&r.call(s,e,f[a].sprite),this._total++)}},collideGroupVsSelf:function(e,n,r,i,s){if(e.length===0)return;for(var o=0;o<e.hash.length;o++){if(!e.hash[o]||!e.hash[o].exists||!e.hash[o].body)continue;var u=e.hash[o];for(var a=o+1;a<e.hash.length;a++){if(!e.hash[a]||!e.hash[a].exists||!e.hash[a].body)continue;var f=e.hash[a];if(this.sortDirection===t.Physics.Arcade.LEFT_RIGHT){if(u.body.right<f.body.x)break;if(f.body.right<u.body.x)continue}else if(this.sortDirection===t.Physics.Arcade.RIGHT_LEFT){if(u.body.x>f.body.right)continue;if(f.body.x>u.body.right)break}else if(this.sortDirection===t.Physics.Arcade.TOP_BOTTOM){if(u.body.bottom<f.body.y)continue;if(f.body.bottom<u.body.y)break}else if(this.sortDirection===t.Physics.Arcade.BOTTOM_TOP){if(u.body.y>f.body.bottom)continue;if(f.body.y>u.body.bottom)break}this.collideSpriteVsSprite(u,f,n,r,i,s)}}},collideGroupVsGroup:function(e,n,r,i,s,o){if(e.length===0||n.length===0)return;for(var u=0;u<e.children.length;u++)e.children[u].exists&&(e.children[u].physicsType===t.GROUP?this.collideGroupVsGroup(e.children[u],n,r,i,s,o):this.collideSpriteVsGroup(e.children[u],n,r,i,s,o))},separate:function(e,t,n,r,i){if(!e.enable||!t.enable||!this.intersects(e,t))return!1;if(n&&n.call(r,e.sprite,t.sprite)===!1)return!1;var s=!1;return this.forceX||Math.abs(this.gravity.y+e.gravity.y)<Math.abs(this.gravity.x+e.gravity.x)?s=this.separateX(e,t,i)||this.separateY(e,t,i):s=this.separateY(e,t,i)||this.separateX(e,t,i),i?!0:s},intersects:function(e,t){return e.right<=t.position.x?!1:e.bottom<=t.position.y?!1:e.position.x>=t.right?!1:e.position.y>=t.bottom?!1:!0},separateX:function(e,t,n){if(e.immovable&&t.immovable)return!1;var r=0;if(this.intersects(e,t)){var i=e.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS;e.deltaX()===0&&t.deltaX()===0?(e.embedded=!0,t.embedded=!0):e.deltaX()>t.deltaX()?(r=e.right-t.x,r>i||e.checkCollision.right===!1||t.checkCollision.left===!1?r=0:(e.touching.none=!1,e.touching.right=!0,t.touching.none=!1,t.touching.left=!0)):e.deltaX()<t.deltaX()&&(r=e.x-t.width-t.x,-r>i||e.checkCollision.left===!1||t.checkCollision.right===!1?r=0:(e.touching.none=!1,e.touching.left=!0,t.touching.none=!1,t.touching.right=!0)),e.overlapX=r,t.overlapX=r;if(r!==0){if(n||e.customSeparateX||t.customSeparateX)return!0;var s=e.velocity.x,o=t.velocity.x;if(!e.immovable&&!t.immovable){r*=.5,e.x=e.x-r,t.x+=r;var u=Math.sqrt(o*o*t.mass/e.mass)*(o>0?1:-1),a=Math.sqrt(s*s*e.mass/t.mass)*(s>0?1:-1),f=(u+a)*.5;u-=f,a-=f,e.velocity.x=f+u*e.bounce.x,t.velocity.x=f+a*t.bounce.x}else e.immovable?t.immovable||(t.x+=r,t.velocity.x=s-o*t.bounce.x,e.moves&&(t.y+=(e.y-e.prev.y)*e.friction.y)):(e.x=e.x-r,e.velocity.x=o-s*e.bounce.x,t.moves&&(e.y+=(t.y-t.prev.y)*t.friction.y));return!0}}return!1},separateY:function(e,t,n){if(e.immovable&&t.immovable)return!1;var r=0;if(this.intersects(e,t)){var i=e.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS;e.deltaY()===0&&t.deltaY()===0?(e.embedded=!0,t.embedded=!0):e.deltaY()>t.deltaY()?(r=e.bottom-t.y,r>i||e.checkCollision.down===!1||t.checkCollision.up===!1?r=0:(e.touching.none=!1,e.touching.down=!0,t.touching.none=!1,t.touching.up=!0)):e.deltaY()<t.deltaY()&&(r=e.y-t.bottom,-r>i||e.checkCollision.up===!1||t.checkCollision.down===!1?r=0:(e.touching.none=!1,e.touching.up=!0,t.touching.none=!1,t.touching.down=!0)),e.overlapY=r,t.overlapY=r;if(r!==0){if(n||e.customSeparateY||t.customSeparateY)return!0;var s=e.velocity.y,o=t.velocity.y;if(!e.immovable&&!t.immovable){r*=.5,e.y=e.y-r,t.y+=r;var u=Math.sqrt(o*o*t.mass/e.mass)*(o>0?1:-1),a=Math.sqrt(s*s*e.mass/t.mass)*(s>0?1:-1),f=(u+a)*.5;u-=f,a-=f,e.velocity.y=f+u*e.bounce.y,t.velocity.y=f+a*t.bounce.y}else e.immovable?t.immovable||(t.y+=r,t.velocity.y=s-o*t.bounce.y,e.moves&&(t.x+=(e.x-e.prev.x)*e.friction.x)):(e.y=e.y-r,e.velocity.y=o-s*e.bounce.y,t.moves&&(e.x+=(t.x-t.prev.x)*t.friction.x));return!0}}return!1},getObjectsUnderPointer:function(e,t,n,r){if(t.length===0||!e.exists)return;return this.getObjectsAtLocation(e.x,e.y,t,n,r,e)},getObjectsAtLocation:function(e,n,r,i,s,o){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(r);var u=new t.Rectangle(e,n,1,1),a=[],f=this.quadTree.retrieve(u);for(var l=0;l<f.length;l++)f[l].hitTest(e,n)&&(i&&i.call(s,o,f[l].sprite),a.push(f[l].sprite));return a},moveToObject:function(e,t,n,r){n===undefined&&(n=60),r===undefined&&(r=0);var i=Math.atan2(t.y-e.y,t.x-e.x);return r>0&&(n=this.distanceBetween(e,t)/(r/1e3)),e.body.velocity.x=Math.cos(i)*n,e.body.velocity.y=Math.sin(i)*n,i},moveToPointer:function(e,t,n,r){t===undefined&&(t=60),n=n||this.game.input.activePointer,r===undefined&&(r=0);var i=this.angleToPointer(e,n);return r>0&&(t=this.distanceToPointer(e,n)/(r/1e3)),e.body.velocity.x=Math.cos(i)*t,e.body.velocity.y=Math.sin(i)*t,i},moveToXY:function(e,t,n,r,i){r===undefined&&(r=60),i===undefined&&(i=0);var s=Math.atan2(n-e.y,t-e.x);return i>0&&(r=this.distanceToXY(e,t,n)/(i/1e3)),e.body.velocity.x=Math.cos(s)*r,e.body.velocity.y=Math.sin(s)*r,s},velocityFromAngle:function(e,n,r){return n===undefined&&(n=60),r=r||new t.Point,r.setTo(Math.cos(this.game.math.degToRad(e))*n,Math.sin(this.game.math.degToRad(e))*n)},velocityFromRotation:function(e,n,r){return n===undefined&&(n=60),r=r||new t.Point,r.setTo(Math.cos(e)*n,Math.sin(e)*n)},accelerationFromRotation:function(e,n,r){return n===undefined&&(n=60),r=r||new t.Point,r.setTo(Math.cos(e)*n,Math.sin(e)*n)},accelerateToObject:function(e,t,n,r,i){n===undefined&&(n=60),r===undefined&&(r=1e3),i===undefined&&(i=1e3);var s=this.angleBetween(e,t);return e.body.acceleration.setTo(Math.cos(s)*n,Math.sin(s)*n),e.body.maxVelocity.setTo(r,i),s},accelerateToPointer:function(e,t,n,r,i){n===undefined&&(n=60),t===undefined&&(t=this.game.input.activePointer),r===undefined&&(r=1e3),i===undefined&&(i=1e3);var s=this.angleToPointer(e,t);return e.body.acceleration.setTo(Math.cos(s)*n,Math.sin(s)*n),e.body.maxVelocity.setTo(r,i),s},accelerateToXY:function(e,t,n,r,i,s){r===undefined&&(r=60),i===undefined&&(i=1e3),s===undefined&&(s=1e3);var o=this.angleToXY(e,t,n);return e.body.acceleration.setTo(Math.cos(o)*r,Math.sin(o)*r),e.body.maxVelocity.setTo(i,s),o},distanceBetween:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},distanceToXY:function(e,t,n){var r=e.x-t,i=e.y-n;return Math.sqrt(r*r+i*i)},distanceToPointer:function(e,t){t=t||this.game.input.activePointer;var n=e.x-t.worldX,r=e.y-t.worldY;return Math.sqrt(n*n+r*r)},angleBetween:function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.atan2(r,n)},angleToXY:function(e,t,n){var r=t-e.x,i=n-e.y;return Math.atan2(i,r)},angleToPointer:function(e,t){t=t||this.game.input.activePointer;var n=t.worldX-e.x,r=t.worldY-e.y;return Math.atan2(r,n)},worldAngleToPointer:function(e,t){t=t||this.game.input.activePointer;var n=t.worldX-e.world.x,r=t.worldY-e.world.y;return Math.atan2(r,n)}},t.Physics.Arcade.Body=function(e){this.sprite=e,this.game=e.game,this.type=t.Physics.ARCADE,this.enable=!0,this.offset=new t.Point,this.position=new t.Point(e.x,e.y),this.prev=new t.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=e.rotation,this.preRotation=e.rotation,this.width=e.width,this.height=e.height,this.sourceWidth=e.width,this.sourceHeight=e.height,e.texture&&(this.sourceWidth=e.texture.frame.width,this.sourceHeight=e.texture.frame.height),this.halfWidth=Math.abs(e.width/2),this.halfHeight=Math.abs(e.height/2),this.center=new t.Point(e.x+this.halfWidth,e.y+this.halfHeight),this.velocity=new t.Point,this.newVelocity=new t.Point(0,0),this.deltaMax=new t.Point(0,0),this.acceleration=new t.Point,this.drag=new t.Point,this.allowGravity=!0,this.gravity=new t.Point(0,0),this.bounce=new t.Point,this.maxVelocity=new t.Point(1e4,1e4),this.friction=new t.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=t.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.tilePadding=new t.Point,this.dirty=!1,this.skipQuadTree=!1,this.syncBounds=!1,this._reset=!0,this._sx=e.scale.x,this._sy=e.scale.y,this._dx=0,this._dy=0},t.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var e=this.sprite.getBounds();e.ceilAll();if(e.width!==this.width||e.height!==this.height)this.width=e.width,this.height=e.height,this._reset=!0}else{var t=Math.abs(this.sprite.scale.x),n=Math.abs(this.sprite.scale.y);if(t!==this._sx||n!==this._sy)this.width=this.sourceWidth*t,this.height=this.sourceHeight*n,this._sx=t,this._sy=n,this._reset=!0}this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight))},preUpdate:function(){if(!this.enable||this.game.physics.arcade.isPaused)return;this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation;if(this._reset||this.sprite.fresh)this.prev.x=this.position.x,this.prev.y=this.position.y;if(this.moves){this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||this.position.y!==this.prev.y)this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x);this.collideWorldBounds&&this.checkWorldBounds()}this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1},postUpdate:function(){if(!this.enable||!this.dirty)return;this.dirty=!1,this.deltaX()<0?this.facing=t.LEFT:this.deltaX()>0&&(this.facing=t.RIGHT),this.deltaY()<0?this.facing=t.UP:this.deltaY()>0&&(this.facing=t.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),this.deltaMax.x!==0&&this._dx!==0&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),this.deltaMax.y!==0&&this._dy!==0&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof t.Group&&this.sprite.parent.removeFromHash(this.sprite),this.sprite.body=null,this.sprite=null},checkWorldBounds:function(){var e=this.position,t=this.game.physics.arcade.bounds,n=this.game.physics.arcade.checkCollision;e.x<t.x&&n.left?(e.x=t.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>t.right&&n.right&&(e.x=t.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0),e.y<t.y&&n.up?(e.y=t.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>t.bottom&&n.down&&(e.y=t.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(e,t,n,r){n===undefined&&(n=this.offset.x),r===undefined&&(r=this.offset.y),this.sourceWidth=e,this.sourceHeight=t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(n,r),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(e,t){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this.position.x=e-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=t-this.sprite.anchor.y*this.height+this.offset.y,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(e,n){return t.Rectangle.contains(this,e,n)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}},Object.defineProperty(t.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(t.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(t.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(t.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),t.Physics.Arcade.Body.render=function(e,t,n,r){r===undefined&&(r=!0),n=n||"rgba(0,255,0,0.4)",r?(e.fillStyle=n,e.fillRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height)):(e.strokeStyle=n,e.strokeRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height))},t.Physics.Arcade.Body.renderBodyInfo=function(e,t){e.line("x: "+t.x.toFixed(2),"y: "+t.y.toFixed(2),"width: "+t.width,"height: "+t.height),e.line("velocity x: "+t.velocity.x.toFixed(2),"y: "+t.velocity.y.toFixed(2),"deltaX: "+t._dx.toFixed(2),"deltaY: "+t._dy.toFixed(2)),e.line("acceleration x: "+t.acceleration.x.toFixed(2),"y: "+t.acceleration.y.toFixed(2),"speed: "+t.speed.toFixed(2),"angle: "+t.angle.toFixed(2)),e.line("gravity x: "+t.gravity.x,"y: "+t.gravity.y,"bounce x: "+t.bounce.x.toFixed(2),"y: "+t.bounce.y.toFixed(2)),e.line("touching left: "+t.touching.left,"right: "+t.touching.right,"up: "+t.touching.up,"down: "+t.touching.down),e.line("blocked left: "+t.blocked.left,"right: "+t.blocked.right,"up: "+t.blocked.up,"down: "+t.blocked.down)},t.Physics.Arcade.Body.prototype.constructor=t.Physics.Arcade.Body,t.Physics.Arcade.TilemapCollision=function(){},t.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(e,t,n,r,i,s){if(!e.body)return;var o=t.getTiles(e.body.position.x-e.body.tilePadding.x,e.body.position.y-e.body.tilePadding.y,e.body.width+e.body.tilePadding.x,e.body.height+e.body.tilePadding.y,!1,!1);if(o.length===0)return;for(var u=0;u<o.length;u++)r?r.call(i,e,o[u])&&this.separateTile(u,e.body,o[u],s)&&(this._total++,n&&n.call(i,e,o[u])):this.separateTile(u,e.body,o[u],s)&&(this._total++,n&&n.call(i,e,o[u]))},collideGroupVsTilemapLayer:function(e,t,n,r,i,s){if(e.length===0)return;for(var o=0;o<e.children.length;o++)e.children[o].exists&&this.collideSpriteVsTilemapLayer(e.children[o],t,n,r,i,s)},separateTile:function(e,t,n,r){if(!t.enable)return!1;if(!n.intersects(t.position.x,t.position.y,t.right,t.bottom))return!1;if(r)return!0;if(n.collisionCallback&&!n.collisionCallback.call(n.collisionCallbackContext,t.sprite,n))return!1;if(n.layer.callbacks[n.index]&&!n.layer.callbacks[n.index].callback.call(n.layer.callbacks[n.index].callbackContext,t.sprite,n))return!1;if(!n.faceLeft&&!n.faceRight&&!n.faceTop&&!n.faceBottom)return!1;var i=0,s=0,o=0,u=1;t.deltaAbsX()>t.deltaAbsY()?o=-1:t.deltaAbsX()<t.deltaAbsY()&&(u=-1),t.deltaX()!==0&&t.deltaY()!==0&&(n.faceLeft||n.faceRight)&&(n.faceTop||n.faceBottom)&&(o=Math.min(Math.abs(t.position.x-n.right),Math.abs(t.right-n.left)),u=Math.min(Math.abs(t.position.y-n.bottom),Math.abs(t.bottom-n.top)));if(o<u){if(n.faceLeft||n.faceRight){i=this.tileCheckX(t,n);if(i!==0&&!n.intersects(t.position.x,t.position.y,t.right,t.bottom))return!0}if(n.faceTop||n.faceBottom)s=this.tileCheckY(t,n)}else{if(n.faceTop||n.faceBottom){s=this.tileCheckY(t,n);if(s!==0&&!n.intersects(t.position.x,t.position.y,t.right,t.bottom))return!0}if(n.faceLeft||n.faceRight)i=this.tileCheckX(t,n)}return i!==0||s!==0},tileCheckX:function(e,t){var n=0;return e.deltaX()<0&&!e.blocked.left&&t.collideRight&&e.checkCollision.left?t.faceRight&&e.x<t.right&&(n=e.x-t.right,n<-this.TILE_BIAS&&(n=0)):e.deltaX()>0&&!e.blocked.right&&t.collideLeft&&e.checkCollision.right&&t.faceLeft&&e.right>t.left&&(n=e.right-t.left,n>this.TILE_BIAS&&(n=0)),n!==0&&(e.customSeparateX?e.overlapX=n:this.processTileSeparationX(e,n)),n},tileCheckY:function(e,t){var n=0;return e.deltaY()<0&&!e.blocked.up&&t.collideDown&&e.checkCollision.up?t.faceBottom&&e.y<t.bottom&&(n=e.y-t.bottom,n<-this.TILE_BIAS&&(n=0)):e.deltaY()>0&&!e.blocked.down&&t.collideUp&&e.checkCollision.down&&t.faceTop&&e.bottom>t.top&&(n=e.bottom-t.top,n>this.TILE_BIAS&&(n=0)),n!==0&&(e.customSeparateY?e.overlapY=n:this.processTileSeparationY(e,n)),n},processTileSeparationX:function(e,t){t<0?e.blocked.left=!0:t>0&&(e.blocked.right=!0),e.position.x-=t,e.bounce.x===0?e.velocity.x=0:e.velocity.x=-e.velocity.x*e.bounce.x},processTileSeparationY:function(e,t){t<0?e.blocked.up=!0:t>0&&(e.blocked.down=!0),e.position.y-=t,e.bounce.y===0?e.velocity.y=0:e.velocity.y=-e.velocity.y*e.bounce.y}},t.Utils.mixinPrototype(t.Physics.Arcade.prototype,t.Physics.Arcade.TilemapCollision.prototype),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,t.Physics.P2=function(e,n){this.game=e,n===undefined?n={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(n.hasOwnProperty("gravity")||(n.gravity=[0,0]),n.hasOwnProperty("broadphase")||(n.broadphase=new p2.SAPBroadphase)),this.config=n,this.world=new p2.World(this.config),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new t.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new t.Signal,this.onBodyRemoved=new t.Signal,this.onSpringAdded=new t.Signal,this.onSpringRemoved=new t.Signal,this.onConstraintAdded=new t.Signal,this.onConstraintRemoved=new t.Signal,this.onContactMaterialAdded=new t.Signal,this.onContactMaterialRemoved=new t.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new t.Signal,this.onEndContact=new t.Signal,n.hasOwnProperty("mpx")&&n.hasOwnProperty("pxm")&&n.hasOwnProperty("mpxi")&&n.hasOwnProperty("pxmi")&&(this.mpx=n.mpx,this.mpxi=n.mpxi,this.pxm=n.pxm,this.pxmi=n.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new t.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new t.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new t.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this._boundsLeft=!0,this._boundsRight=!0,this._boundsTop=!0,this._boundsBottom=!0,this._boundsOwnGroup=!1,this.setBoundsToWorld(!0,!0,!0,!0,!1)},t.Physics.P2.prototype={removeBodyNextStep:function(e){this._toRemove.push(e)},preUpdate:function(){var e=this._toRemove.length;while(e--)this.removeBody(this._toRemove[e]);this._toRemove.length=0},enable:function(e,n,r){n===undefined&&(n=!1),r===undefined&&(r=!0);var i=1;if(Array.isArray(e)){i=e.length;while(i--)e[i]instanceof t.Group?this.enable(e[i].children,n,r):(this.enableBody(e[i],n),r&&e[i].hasOwnProperty("children")&&e[i].children.length>0&&this.enable(e[i],n,!0))}else e instanceof t.Group?this.enable(e.children,n,r):(this.enableBody(e,n),r&&e.hasOwnProperty("children")&&e.children.length>0&&this.enable(e.children,n,!0))},enableBody:function(e,n){e.hasOwnProperty("body")&&e.body===null&&(e.body=new t.Physics.P2.Body(this.game,e,e.x,e.y,1),e.body.debug=n,typeof e.anchor!="undefined"&&e.anchor.set(.5))},setImpactEvents:function(e){e?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(e,t){this.postBroadphaseCallback=e,this.callbackContext=t,e!==null?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(e){if(!this.postBroadphaseCallback||e.pairs.length===0)return;for(var t=e.pairs.length-2;t>=0;t-=2)e.pairs[t].parent&&e.pairs[t+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,e.pairs[t].parent,e.pairs[t+1].parent)&&e.pairs.splice(t,2)},impactHandler:function(e){if(e.bodyA.parent&&e.bodyB.parent){var t=e.bodyA.parent,n=e.bodyB.parent;t._bodyCallbacks[e.bodyB.id]&&t._bodyCallbacks[e.bodyB.id].call(t._bodyCallbackContext[e.bodyB.id],t,n,e.shapeA,e.shapeB),n._bodyCallbacks[e.bodyA.id]&&n._bodyCallbacks[e.bodyA.id].call(n._bodyCallbackContext[e.bodyA.id],n,t,e.shapeB,e.shapeA),t._groupCallbacks[e.shapeB.collisionGroup]&&t._groupCallbacks[e.shapeB.collisionGroup].call(t._groupCallbackContext[e.shapeB.collisionGroup],t,n,e.shapeA,e.shapeB),n._groupCallbacks[e.shapeA.collisionGroup]&&n._groupCallbacks[e.shapeA.collisionGroup].call(n._groupCallbackContext[e.shapeA.collisionGroup],n,t,e.shapeB,e.shapeA)}},beginContactHandler:function(e){e.bodyA&&e.bodyB&&(this.onBeginContact.dispatch(e.bodyA,e.bodyB,e.shapeA,e.shapeB,e.contactEquations),e.bodyA.parent&&e.bodyA.parent.onBeginContact.dispatch(e.bodyB.parent,e.bodyB,e.shapeA,e.shapeB,e.contactEquations),e.bodyB.parent&&e.bodyB.parent.onBeginContact.dispatch(e.bodyA.parent,e.bodyA,e.shapeB,e.shapeA,e.contactEquations))},endContactHandler:function(e){e.bodyA&&e.bodyB&&(this.onEndContact.dispatch(e.bodyA,e.bodyB,e.shapeA,e.shapeB),e.bodyA.parent&&e.bodyA.parent.onEndContact.dispatch(e.bodyB.parent,e.bodyB,e.shapeA,e.shapeB),e.bodyB.parent&&e.bodyB.parent.onEndContact.dispatch(e.bodyA.parent,e.bodyA,e.shapeB,e.shapeA))},setBoundsToWorld:function(e,t,n,r,i){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,e,t,n,r,i)},setWorldMaterial:function(e,t,n,r,i){t===undefined&&(t=!0),n===undefined&&(n=!0),r===undefined&&(r=!0),i===undefined&&(i=!0),t&&this.walls.left&&(this.walls.left.shapes[0].material=e),n&&this.walls.right&&(this.walls.right.shapes[0].material=e),r&&this.walls.top&&(this.walls.top.shapes[0].material=e),i&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=e)},updateBoundsCollisionGroup:function(e){var t=this.everythingCollisionGroup.mask;e===undefined&&(t=this.boundsCollisionGroup.mask),this.walls.left&&(this.walls.left.shapes[0].collisionGroup=t),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=t),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=t),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=t)},setBounds:function(e,t,n,r,i,s,o,u,a){i===undefined&&(i=this._boundsLeft),s===undefined&&(s=this._boundsRight),o===undefined&&(o=this._boundsTop),u===undefined&&(u=this._boundsBottom),a===undefined&&(a=this._boundsOwnGroup),this.walls.left&&this.world.removeBody(this.walls.left),this.walls.right&&this.world.removeBody(this.walls.right),this.walls.top&&this.world.removeBody(this.walls.top),this.walls.bottom&&this.world.removeBody(this.walls.bottom),i&&(this.walls.left=new p2.Body({mass:0,position:[this.pxmi(e),this.pxmi(t)],angle:1.5707963267948966}),this.walls.left.addShape(new p2.Plane),a&&(this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.left)),s&&(this.walls.right=new p2.Body({mass:0,position:[this.pxmi(e+n),this.pxmi(t)],angle:-1.5707963267948966}),this.walls.right.addShape(new p2.Plane),a&&(this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.right)),o&&(this.walls.top=new p2.Body({mass:0,position:[this.pxmi(e),this.pxmi(t)],angle:-3.141592653589793}),this.walls.top.addShape(new p2.Plane),a&&(this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.top)),u&&(this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(e),this.pxmi(t+r)]}),this.walls.bottom.addShape(new p2.Plane),a&&(this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.bottom)),this._boundsLeft=i,this._boundsRight=s,this._boundsTop=o,this._boundsBottom=u,this._boundsOwnGroup=a},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){if(this.paused)return;this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate)},reset:function(){this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.nothingCollisionGroup=new t.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new t.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new t.Physics.P2.CollisionGroup(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();var e=this.world.constraints;for(var t=e.length-1;t>=0;t--)this.world.removeConstraint(e[t]);var n=this.world.bodies;for(var t=n.length-1;t>=0;t--)this.world.removeBody(n[t]);var r=this.world.springs;for(var t=r.length-1;t>=0;t--)this.world.removeSpring(r[t]);var i=this.world.contactMaterials;for(var t=i.length-1;t>=0;t--)this.world.removeContactMaterial(i[t]);this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[]},destroy:function(){this.clear(),this.game=null},addBody:function(e){return e.data.world?!1:(this.world.addBody(e.data),this.onBodyAdded.dispatch(e),!0)},removeBody:function(e){return e.data.world==this.world&&(this.world.removeBody(e.data),this.onBodyRemoved.dispatch(e)),e},addSpring:function(e){return e instanceof t.Physics.P2.Spring||e instanceof t.Physics.P2.RotationalSpring?this.world.addSpring(e.data):this.world.addSpring(e),this.onSpringAdded.dispatch(e),e},removeSpring:function(e){return e instanceof t.Physics.P2.Spring||e instanceof t.Physics.P2.RotationalSpring?this.world.removeSpring(e.data):this.world.removeSpring(e),this.onSpringRemoved.dispatch(e),e},createDistanceConstraint:function(e,n,r,i,s,o){e=this.getBody(e),n=this.getBody(n);if(!!e&&!!n)return this.addConstraint(new t.Physics.P2.DistanceConstraint(this,e,n,r,i,s,o));console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(e,n,r,i){e=this.getBody(e),n=this.getBody(n);if(!!e&&!!n)return this.addConstraint(new t.Physics.P2.GearConstraint(this,e,n,r,i));console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(e,n,r,i,s,o){e=this.getBody(e),r=this.getBody(r);if(!!e&&!!r)return this.addConstraint(new t.Physics.P2.RevoluteConstraint(this,e,n,r,i,s,o));console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(e,n,r,i,s){e=this.getBody(e),n=this.getBody(n);if(!!e&&!!n)return this.addConstraint(new t.Physics.P2.LockConstraint(this,e,n,r,i,s));console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(e,n,r,i,s,o,u){e=this.getBody(e),n=this.getBody(n);if(!!e&&!!n)return this.addConstraint(new t.Physics.P2.PrismaticConstraint(this,e,n,r,i,s,o,u));console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(e){return this.world.addConstraint(e),this.onConstraintAdded.dispatch(e),e},removeConstraint:function(e){return this.world.removeConstraint(e),this.onConstraintRemoved.dispatch(e),e},addContactMaterial:function(e){return this.world.addContactMaterial(e),this.onContactMaterialAdded.dispatch(e),e},removeContactMaterial:function(e){return this.world.removeContactMaterial(e),this.onContactMaterialRemoved.dispatch(e),e},getContactMaterial:function(e,t){return this.world.getContactMaterial(e,t)},setMaterial:function(e,t){var n=t.length;while(n--)t[n].setMaterial(e)},createMaterial:function(e,n){e=e||"";var r=new t.Physics.P2.Material(e);return this.materials.push(r),typeof n!="undefined"&&n.setMaterial(r),r},createContactMaterial:function(e,n,r){e===undefined&&(e=this.createMaterial()),n===undefined&&(n=this.createMaterial());var i=new t.Physics.P2.ContactMaterial(e,n,r);return this.addContactMaterial(i)},getBodies:function(){var e=[],t=this.world.bodies.length;while(t--)e.push(this.world.bodies[t].parent);return e},getBody:function(e){return e instanceof p2.Body?e:e instanceof t.Physics.P2.Body?e.data:e.body&&e.body.type===t.Physics.P2JS?e.body.data:null},getSprings:function(){var e=[],t=this.world.springs.length;while(t--)e.push(this.world.springs[t].parent);return e},getConstraints:function(){var e=[],t=this.world.constraints.length;while(t--)e.push(this.world.constraints[t]);return e},hitTest:function(e,n,r,i){n===undefined&&(n=this.world.bodies),r===undefined&&(r=5),i===undefined&&(i=!1);var s=[this.pxmi(e.x),this.pxmi(e.y)],o=[],u=n.length;while(u--)n[u]instanceof t.Physics.P2.Body&&(!i||n[u].data.type!==p2.Body.STATIC)?o.push(n[u].data):n[u]instanceof p2.Body&&n[u].parent&&(!i||n[u].type!==p2.Body.STATIC)?o.push(n[u]):n[u]instanceof t.Sprite&&n[u].hasOwnProperty("body")&&(!i||n[u].body.data.type!==p2.Body.STATIC)&&o.push(n[u].body.data);return this.world.hitTest(s,o,r)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(e){var n=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|n),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|n),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|n),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|n),this._collisionGroupID++;var r=new t.Physics.P2.CollisionGroup(n);return this.collisionGroups.push(r),e&&this.setCollisionGroup(e,r),r},setCollisionGroup:function(e,n){if(e instanceof t.Group)for(var r=0;r<e.total;r++)e.children[r].body&&e.children[r].body.type===t.Physics.P2JS&&e.children[r].body.setCollisionGroup(n);else e.body.setCollisionGroup(n)},createSpring:function(e,n,r,i,s,o,u,a,f){e=this.getBody(e),n=this.getBody(n);if(!!e&&!!n)return this.addSpring(new t.Physics.P2.Spring(this,e,n,r,i,s,o,u,a,f));console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(e,n,r,i,s){e=this.getBody(e),n=this.getBody(n);if(!!e&&!!n)return this.addSpring(new t.Physics.P2.RotationalSpring(this,e,n,r,i,s));console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(e,n,r,i,s,o){i===undefined&&(i=!1);var u=new t.Physics.P2.Body(this.game,null,e,n,r);if(o){var a=u.addPolygon(s,o);if(!a)return!1}return i&&this.world.addBody(u.data),u},createParticle:function(e,n,r,i,s,o){i===undefined&&(i=!1);var u=new t.Physics.P2.Body(this.game,null,e,n,r);if(o){var a=u.addPolygon(s,o);if(!a)return!1}return i&&this.world.addBody(u.data),u},convertCollisionObjects:function(e,t,n){n===undefined&&(n=!0);var r=[];for(var i=0,s=e.collision[t].length;i<s;i++){var o=e.collision[t][i],u=this.createBody(o.x,o.y,0,n,{},o.polyline);u&&r.push(u)}return r},clearTilemapLayerBodies:function(e,t){t=e.getLayer(t);var n=e.layers[t].bodies.length;while(n--)e.layers[t].bodies[n].destroy();e.layers[t].bodies.length=0},convertTilemap:function(e,t,n,r){t=e.getLayer(t),n===undefined&&(n=!0),r===undefined&&(r=!0),this.clearTilemapLayerBodies(e,t);var i=0,s=0,o=0;for(var u=0,a=e.layers[t].height;u<a;u++){i=0;for(var f=0,l=e.layers[t].width;f<l;f++){var c=e.layers[t].data[u][f];if(c&&c.index>-1&&c.collides)if(r){var h=e.getTileRight(t,f,u);i===0&&(s=c.x*c.width,o=c.y*c.height,i=c.width);if(h&&h.collides)i+=c.width;else{var p=this.createBody(s,o,0,!1);p.addRectangle(i,c.height,i/2,c.height/2,0),n&&this.addBody(p),e.layers[t].bodies.push(p),i=0}}else{var p=this.createBody(c.x*c.width,c.y*c.height,0,!1);p.addRectangle(c.width,c.height,c.width/2,c.height/2,0),n&&this.addBody(p),e.layers[t].bodies.push(p)}}}return e.layers[t].bodies},mpx:function(e){return e*=20},pxm:function(e){return e*.05},mpxi:function(e){return e*=-20},pxmi:function(e){return e*-0.05}},Object.defineProperty(t.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(e){this.world.defaultContactMaterial.friction=e}}),Object.defineProperty(t.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(e){this.world.defaultContactMaterial.restitution=e}}),Object.defineProperty(t.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(e){this.world.defaultContactMaterial=e}}),Object.defineProperty(t.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(e){this.world.applySpringForces=e}}),Object.defineProperty(t.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(e){this.world.applyDamping=e}}),Object.defineProperty(t.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(e){this.world.applyGravity=e}}),Object.defineProperty(t.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(e){this.world.solveConstraints=e}}),Object.defineProperty(t.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(t.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(e){this.world.emitImpactEvent=e}}),Object.defineProperty(t.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(e){this.world.sleepMode=e}}),Object.defineProperty(t.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),t.Physics.P2.FixtureList=function(e){Array.isArray(e)||(e=[e]),this.rawList=e,this.init(),this.parse(this.rawList)},t.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(e,t){var n=function(t){t.collisionGroup=e};this.getFixtures(t).forEach(n)},setMask:function(e,t){var n=function(t){t.collisionMask=e};this.getFixtures(t).forEach(n)},setSensor:function(e,t){var n=function(t){t.sensor=e};this.getFixtures(t).forEach(n)},setMaterial:function(e,t){var n=function(t){t.material=e};this.getFixtures(t).forEach(n)},getFixtures:function(e){var t=[];if(e){e instanceof Array||(e=[e]);var n=this;return e.forEach(function(e){n.namedFixtures[e]&&t.push(n.namedFixtures[e])}),this.flatten(t)}return this.allFixtures},getFixtureByKey:function(e){return this.namedFixtures[e]},getGroup:function(e){return this.groupedFixtures[e]},parse:function(){var e,t,n,r;n=this.rawList,r=[];for(e in n)t=n[e],isNaN(e-0)?this.namedFixtures[e]=this.flatten(t):(this.groupedFixtures[e]=this.groupedFixtures[e]||[],this.groupedFixtures[e]=this.groupedFixtures[e].concat(t)),r.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(e){var t,n;return t=[],n=arguments.callee,e.forEach(function(e){return Array.prototype.push.apply(t,Array.isArray(e)?n(e):[e])}),t}},t.Physics.P2.PointProxy=function(e,t){this.world=e,this.destination=t},t.Physics.P2.PointProxy.prototype.constructor=t.Physics.P2.PointProxy,Object.defineProperty(t.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(e){this.destination[0]=this.world.pxm(e)}}),Object.defineProperty(t.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(e){this.destination[1]=this.world.pxm(e)}}),Object.defineProperty(t.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(e){this.destination[0]=e}}),Object.defineProperty(t.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(e){this.destination[1]=e}}),t.Physics.P2.InversePointProxy=function(e,t){this.world=e,this.destination=t},t.Physics.P2.InversePointProxy.prototype.constructor=t.Physics.P2.InversePointProxy,Object.defineProperty(t.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(e){this.destination[0]=this.world.pxmi(e)}}),Object.defineProperty(t.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(e){this.destination[1]=this.world.pxmi(e)}}),Object.defineProperty(t.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(e){this.destination[0]=-e}}),Object.defineProperty(t.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(e){this.destination[1]=-e}}),t.Physics.P2.Body=function(e,n,r,i,s){n=n||null,r=r||0,i=i||0,s===undefined&&(s=1),this.game=e,this.world=e.physics.p2,this.sprite=n,this.type=t.Physics.P2JS,this.offset=new t.Point,this.data=new p2.Body({position:[this.world.pxmi(r),this.world.pxmi(i)],mass:s}),this.data.parent=this,this.velocity=new t.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new t.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new t.Point,this.onBeginContact=new t.Signal,this.onEndContact=new t.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this.dirty=!1,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this._reset=!1,n&&(this.setRectangleFromSprite(n),n.exists&&this.game.physics.p2.addBody(this))},t.Physics.P2.Body.prototype={createBodyCallback:function(e,t,n){var r=-1;e.id?r=e.id:e.body&&(r=e.body.id),r>-1&&(t===null?(delete this._bodyCallbacks[r],delete this._bodyCallbackContext[r]):(this._bodyCallbacks[r]=t,this._bodyCallbackContext[r]=n))},createGroupCallback:function(e,t,n){t===null?(delete this._groupCallbacks[e.mask],delete this._groupCallbackContext[e.mask]):(this._groupCallbacks[e.mask]=t,this._groupCallbackContext[e.mask]=n)},getCollisionMask:function(){var e=0;this._collideWorldBounds&&(e=this.game.physics.p2.boundsCollisionGroup.mask);for(var t=0;t<this.collidesWith.length;t++)e|=this.collidesWith[t].mask;return e},updateCollisionMask:function(e){var t=this.getCollisionMask();if(e===undefined)for(var n=this.data.shapes.length-1;n>=0;n--)this.data.shapes[n].collisionMask=t;else e.collisionMask=t},setCollisionGroup:function(e,t){var n=this.getCollisionMask();if(t===undefined)for(var r=this.data.shapes.length-1;r>=0;r--)this.data.shapes[r].collisionGroup=e.mask,this.data.shapes[r].collisionMask=n;else t.collisionGroup=e.mask,t.collisionMask=n},clearCollision:function(e,t,n){e===undefined&&(e=!0),t===undefined&&(t=!0);if(n===undefined)for(var r=this.data.shapes.length-1;r>=0;r--)e&&(this.data.shapes[r].collisionGroup=null),t&&(this.data.shapes[r].collisionMask=null);else e&&(n.collisionGroup=null),t&&(n.collisionMask=null);e&&(this.collidesWith.length=0)},removeCollisionGroup:function(e,t,n){t===undefined&&(t=!0);var r;if(Array.isArray(e))for(var i=0;i<e.length;i++)r=this.collidesWith.indexOf(e[i]),r>-1&&(this.collidesWith.splice(r,1),t&&(delete this._groupCallbacks[e.mask],delete this._groupCallbackContext[e.mask]));else r=this.collidesWith.indexOf(e),r>-1&&(this.collidesWith.splice(r,1),t&&(delete this._groupCallbacks[e.mask],delete this._groupCallbackContext[e.mask]));var s=this.getCollisionMask();if(n===undefined)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionMask=s;else n.collisionMask=s},collides:function(e,t,n,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)this.collidesWith.indexOf(e[i])===-1&&(this.collidesWith.push(e[i]),t&&this.createGroupCallback(e[i],t,n));else this.collidesWith.indexOf(e)===-1&&(this.collidesWith.push(e),t&&this.createGroupCallback(e,t,n));var s=this.getCollisionMask();if(r===undefined)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionMask=s;else r.collisionMask=s},adjustCenterOfMass:function(){this.data.adjustCenterOfMass(),this.shapeChanged()},getVelocityAtPoint:function(e,t){return this.data.getVelocityAtPoint(e,t)},applyDamping:function(e){this.data.applyDamping(e)},applyImpulse:function(e,t,n){this.data.applyImpulse(e,[this.world.pxmi(t),this.world.pxmi(n)])},applyImpulseLocal:function(e,t,n){this.data.applyImpulseLocal(e,[this.world.pxmi(t),this.world.pxmi(n)])},applyForce:function(e,t,n){this.data.applyForce(e,[this.world.pxmi(t),this.world.pxmi(n)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(e,t){return this.data.toLocalFrame(e,t)},toWorldFrame:function(e,t){return this.data.toWorldFrame(e,t)},rotateLeft:function(e){this.data.angularVelocity=this.world.pxm(-e)},rotateRight:function(e){this.data.angularVelocity=this.world.pxm(e)},moveForward:function(e){var t=this.world.pxmi(-e),n=this.data.angle+Math.PI/2;this.data.velocity[0]=t*Math.cos(n),this.data.velocity[1]=t*Math.sin(n)},moveBackward:function(e){var t=this.world.pxmi(-e),n=this.data.angle+Math.PI/2;this.data.velocity[0]=-(t*Math.cos(n)),this.data.velocity[1]=-(t*Math.sin(n))},thrust:function(e){var t=this.world.pxmi(-e),n=this.data.angle+Math.PI/2;this.data.force[0]+=t*Math.cos(n),this.data.force[1]+=t*Math.sin(n)},reverse:function(e){var t=this.world.pxmi(-e),n=this.data.angle+Math.PI/2;this.data.force[0]-=t*Math.cos(n),this.data.force[1]-=t*Math.sin(n)},moveLeft:function(e){this.data.velocity[0]=this.world.pxmi(-e)},moveRight:function(e){this.data.velocity[0]=this.world.pxmi(e)},moveUp:function(e){this.data.velocity[1]=this.world.pxmi(-e)},moveDown:function(e){this.data.velocity[1]=this.world.pxmi(e)},preUpdate:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]),this.sprite.y=this.world.mpxi(this.data.position[1]),this.fixedRotation||(this.sprite.rotation=this.data.angle),this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1},reset:function(e,t,n,r){n===undefined&&(n=!1),r===undefined&&(r=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),n&&this.setZeroDamping(),r&&(this.mass=1),this.x=e,this.y=t},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var e=0;e<this.game.physics.p2._toRemove.length;e++)this.game.physics.p2._toRemove[e]===this&&this.game.physics.p2._toRemove.splice(e,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){var e=this.data.shapes.length;while(e--)this.data.removeShape(this.data.shapes[e]);this.shapeChanged()},addShape:function(e,t,n,r){return t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r=0),this.data.addShape(e,[this.world.pxmi(t),this.world.pxmi(n)],r),this.shapeChanged(),e},addCircle:function(e,t,n,r){var i=new p2.Circle({radius:this.world.pxm(e)});return this.addShape(i,t,n,r)},addRectangle:function(e,t,n,r,i){var s=new p2.Box({width:this.world.pxm(e),height:this.world.pxm(t)});return this.addShape(s,n,r,i)},addPlane:function(e,t,n){var r=new p2.Plane;return this.addShape(r,e,t,n)},addParticle:function(e,t,n){var r=new p2.Particle;return this.addShape(r,e,t,n)},addLine:function(e,t,n,r){var i=new p2.Line({length:this.world.pxm(e)});return this.addShape(i,t,n,r)},addCapsule:function(e,t,n,r,i){var s=new p2.Capsule({length:this.world.pxm(e),radius:this.world.pxm(t)});return this.addShape(s,n,r,i)},addPolygon:function(e,t){e=e||{},Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1));var n=[];if(t.length===1&&Array.isArray(t[0]))n=t[0].slice(0);else if(Array.isArray(t[0]))n=t.slice();else if(typeof t[0]=="number")for(var r=0,i=t.length;r<i;r+=2)n.push([t[r],t[r+1]]);var s=n.length-1;n[s][0]===n[0][0]&&n[s][1]===n[0][1]&&n.pop();for(var o=0;o<n.length;o++)n[o][0]=this.world.pxmi(n[o][0]),n[o][1]=this.world.pxmi(n[o][1]);var u=this.data.fromPolygon(n,e);return this.shapeChanged(),u},removeShape:function(e){var t=this.data.removeShape(e);return this.shapeChanged(),t},setCircle:function(e,t,n,r){return this.clearShapes(),this.addCircle(e,t,n,r)},setRectangle:function(e,t,n,r,i){return e===undefined&&(e=16),t===undefined&&(t=16),this.clearShapes(),this.addRectangle(e,t,n,r,i)},setRectangleFromSprite:function(e){return e===undefined&&(e=this.sprite),this.clearShapes(),this.addRectangle(e.width,e.height,0,0,e.rotation)},setMaterial:function(e,t){if(t===undefined)for(var n=this.data.shapes.length-1;n>=0;n--)this.data.shapes[n].material=e;else t.material=e},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(e,t){var n=this.game.cache.getPhysicsData(e,t),r=[];for(var i=0;i<n.length;i++){var s=n[i],o=this.addFixture(s);r[s.filter.group]=r[s.filter.group]||[],r[s.filter.group]=r[s.filter.group].concat(o),s.fixtureKey&&(r[s.fixtureKey]=o)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),r},addFixture:function(e){var t=[];if(e.circle){var n=new p2.Circle({radius:this.world.pxm(e.circle.radius)});n.collisionGroup=e.filter.categoryBits,n.collisionMask=e.filter.maskBits,n.sensor=e.isSensor;var r=p2.vec2.create();r[0]=this.world.pxmi(e.circle.position[0]-this.sprite.width/2),r[1]=this.world.pxmi(e.circle.position[1]-this.sprite.height/2),this.data.addShape(n,r),t.push(n)}else{var i=e.polygons,s=p2.vec2.create();for(var o=0;o<i.length;o++){var u=i[o],a=[];for(var f=0;f<u.length;f+=2)a.push([this.world.pxmi(u[f]),this.world.pxmi(u[f+1])]);var n=new p2.Convex({vertices:a});for(var l=0;l!==n.vertices.length;l++){var c=n.vertices[l];p2.vec2.sub(c,c,n.centerOfMass)}p2.vec2.scale(s,n.centerOfMass,1),s[0]-=this.world.pxmi(this.sprite.width/2),s[1]-=this.world.pxmi(this.sprite.height/2),n.updateTriangles(),n.updateCenterOfMass(),n.updateBoundingRadius(),n.collisionGroup=e.filter.categoryBits,n.collisionMask=e.filter.maskBits,n.sensor=e.isSensor,this.data.addShape(n,s),t.push(n)}}return t},loadPolygon:function(e,t){if(e===null)var n=t;else var n=this.game.cache.getPhysicsData(e,t);var r=p2.vec2.create();for(var i=0;i<n.length;i++){var s=[];for(var o=0;o<n[i].shape.length;o+=2)s.push([this.world.pxmi(n[i].shape[o]),this.world.pxmi(n[i].shape[o+1])]);var u=new p2.Convex({vertices:s});for(var a=0;a!==u.vertices.length;a++){var f=u.vertices[a];p2.vec2.sub(f,f,u.centerOfMass)}p2.vec2.scale(r,u.centerOfMass,1),r[0]-=this.world.pxmi(this.sprite.width/2),r[1]-=this.world.pxmi(this.sprite.height/2),u.updateTriangles(),u.updateCenterOfMass(),u.updateBoundingRadius(),this.data.addShape(u,r)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},t.Physics.P2.Body.prototype.constructor=t.Physics.P2.Body,t.Physics.P2.Body.DYNAMIC=1,t.Physics.P2.Body.STATIC=2,t.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(t.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===t.Physics.P2.Body.STATIC},set:function(e){e&&this.data.type!==t.Physics.P2.Body.STATIC?(this.data.type=t.Physics.P2.Body.STATIC,this.mass=0):!e&&this.data.type===t.Physics.P2.Body.STATIC&&(this.data.type=t.Physics.P2.Body.DYNAMIC,this.mass=1)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===t.Physics.P2.Body.DYNAMIC},set:function(e){e&&this.data.type!==t.Physics.P2.Body.DYNAMIC?(this.data.type=t.Physics.P2.Body.DYNAMIC,this.mass=1):!e&&this.data.type===t.Physics.P2.Body.DYNAMIC&&(this.data.type=t.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===t.Physics.P2.Body.KINEMATIC},set:function(e){e&&this.data.type!==t.Physics.P2.Body.KINEMATIC?(this.data.type=t.Physics.P2.Body.KINEMATIC,this.mass=4):!e&&this.data.type===t.Physics.P2.Body.KINEMATIC&&(this.data.type=t.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(e){e!==this.data.allowSleep&&(this.data.allowSleep=e)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"angle",{get:function(){return t.Math.wrapAngle(t.Math.radToDeg(this.data.angle))},set:function(e){this.data.angle=t.Math.degToRad(t.Math.wrapAngle(e))}}),Object.defineProperty(t.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(e){this.data.angularDamping=e}}),Object.defineProperty(t.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(e){this.data.angularForce=e}}),Object.defineProperty(t.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(e){this.data.angularVelocity=e}}),Object.defineProperty(t.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(e){this.data.damping=e}}),Object.defineProperty(t.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(e){e!==this.data.fixedRotation&&(this.data.fixedRotation=e)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(e){this.data.inertia=e}}),Object.defineProperty(t.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(e){e!==this.data.mass&&(this.data.mass=e,this.data.updateMassProperties())}}),Object.defineProperty(t.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(e){e!==this.data.type&&(this.data.type=e)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(e){this.data.angle=e}}),Object.defineProperty(t.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(e){this.data.sleepSpeedLimit=e}}),Object.defineProperty(t.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(e){this.data.position[0]=this.world.pxmi(e)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(e){this.data.position[1]=this.world.pxmi(e)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(t.Physics.P2.Body.prototype,"debug",{get:function(){return this.debugBody!==null},set:function(e){e&&!this.debugBody?this.debugBody=new t.Physics.P2.BodyDebug(this.game,this.data):!e&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(t.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(e){e&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!e&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),t.Physics.P2.BodyDebug=function(e,n,r){t.Group.call(this,e);var i={pixelsPerLengthUnit:e.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=t.Utils.extend(i,r),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=n,this.canvas=new t.Graphics(e),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw(),this.updateSpriteTransform()},t.Physics.P2.BodyDebug.prototype=Object.create(t.Group.prototype),t.Physics.P2.BodyDebug.prototype.constructor=t.Physics.P2.BodyDebug,t.Utils.extend(t.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d;u=this.body,f=this.canvas,f.clear(),n=parseInt(this.randomPastelHex(),16),s=16711680,o=this.lineWidth;if(u instanceof p2.Body&&u.shapes.length){var v=u.shapes.length;r=0;while(r!==v){t=u.shapes[r],a=t.position||0,e=t.angle||0;if(t instanceof p2.Circle)this.drawCircle(f,a[0]*this.ppu,a[1]*this.ppu,e,t.radius*this.ppu,n,o);else if(t instanceof p2.Capsule)this.drawCapsule(f,a[0]*this.ppu,a[1]*this.ppu,e,t.length*this.ppu,t.radius*this.ppu,s,n,o);else if(t instanceof p2.Plane)this.drawPlane(f,a[0]*this.ppu,-a[1]*this.ppu,n,s,o*5,o*10,o*10,this.ppu*100,e);else if(t instanceof p2.Line)this.drawLine(f,t.length*this.ppu,s,o);else if(t instanceof p2.Box)this.drawRectangle(f,a[0]*this.ppu,a[1]*this.ppu,e,t.width*this.ppu,t.height*this.ppu,s,n,o);else if(t instanceof p2.Convex){c=[],h=p2.vec2.create();for(i=p=0,d=t.vertices.length;0<=d?p<d:p>d;i=0<=d?++p:--p)l=t.vertices[i],p2.vec2.rotate(h,l,e),c.push([(h[0]+a[0])*this.ppu,-(h[1]+a[1])*this.ppu]);this.drawConvex(f,c,t.triangles,s,n,o,this.settings.debugPolygons,[a[0]*this.ppu,-a[1]*this.ppu])}r++}}},drawRectangle:function(e,t,n,r,i,s,o,u,a){a===undefined&&(a=1),o===undefined&&(o=0),e.lineStyle(a,o,1),e.beginFill(u),e.drawRect(t-i/2,n-s/2,i,s)},drawCircle:function(e,t,n,r,i,s,o){o===undefined&&(o=1),s===undefined&&(s=16777215),e.lineStyle(o,0,1),e.beginFill(s,1),e.drawCircle(t,n,-i*2),e.endFill(),e.moveTo(t,n),e.lineTo(t+i*Math.cos(-r),n+i*Math.sin(-r))},drawLine:function(e,t,n,r){r===undefined&&(r=1),n===undefined&&(n=0),e.lineStyle(r*5,n,1),e.moveTo(-t/2,0),e.lineTo(t/2,0)},drawConvex:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y;s===undefined&&(s=1),r===undefined&&(r=0);if(!!o){a=[16711680,65280,255],f=0;while(f!==t.length+1)c=t[f%t.length],h=t[(f+1)%t.length],d=c[0],g=c[1],v=h[0],y=h[1],e.lineStyle(s,a[f%a.length],1),e.moveTo(d,-g),e.lineTo(v,-y),e.drawCircle(d,-g,s*2),f++;return e.lineStyle(s,0,1),e.drawCircle(u[0],u[1],s*2)}e.lineStyle(s,r,1),e.beginFill(i),f=0;while(f!==t.length)l=t[f],p=l[0],m=l[1],f===0?e.moveTo(p,-m):e.lineTo(p,-m),f++;e.endFill();if(t.length>2)return e.moveTo(t[t.length-1][0],-t[t.length-1][1]),e.lineTo(t[0][0],-t[0][1])},drawPath:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g;i===undefined&&(i=1),n===undefined&&(n=0),e.lineStyle(i,n,1),typeof r=="number"&&e.beginFill(r),u=null,a=null,o=0;while(o<t.length){v=t[o],m=v[0],g=v[1];if(m!==u||g!==a)o===0?e.moveTo(m,g):(f=u,l=a,c=m,h=g,p=t[(o+1)%t.length][0],d=t[(o+1)%t.length][1],s=(c-f)*(d-l)-(p-f)*(h-l),s!==0&&e.lineTo(m,g)),u=m,a=g;o++}typeof r=="number"&&e.endFill(),t.length>2&&typeof r=="number"&&(e.moveTo(t[t.length-1][0],t[t.length-1][1]),e.lineTo(t[0][0],t[0][1]))},drawPlane:function(e,t,n,r,i,s,o,u,a,f){var l,c,h;s===undefined&&(s=1),r===undefined&&(r=16777215),e.lineStyle(s,i,11),e.beginFill(r),l=a,e.moveTo(t,-n),c=t+Math.cos(f)*this.game.width,h=n+Math.sin(f)*this.game.height,e.lineTo(c,-h),e.moveTo(t,-n),c=t+Math.cos(f)*-this.game.width,h=n+Math.sin(f)*-this.game.height,e.lineTo(c,-h)},drawCapsule:function(e,t,n,r,i,s,o,u,a){a===undefined&&(a=1),o===undefined&&(o=0),e.lineStyle(a,o,1);var f=Math.cos(r),l=Math.sin(r);e.beginFill(u,1),e.drawCircle(-i/2*f+t,-i/2*l+n,-s*2),e.drawCircle(i/2*f+t,i/2*l+n,-s*2),e.endFill(),e.lineStyle(a,o,0),e.beginFill(u,1),e.moveTo(-i/2*f+s*l+t,-i/2*l+s*f+n),e.lineTo(i/2*f+s*l+t,i/2*l+s*f+n),e.lineTo(i/2*f-s*l+t,i/2*l-s*f+n),e.lineTo(-i/2*f-s*l+t,-i/2*l-s*f+n),e.endFill(),e.lineStyle(a,o,1),e.moveTo(-i/2*f+s*l+t,-i/2*l+s*f+n),e.lineTo(i/2*f+s*l+t,i/2*l+s*f+n),e.moveTo(-i/2*f-s*l+t,-i/2*l-s*f+n),e.lineTo(i/2*f-s*l+t,i/2*l-s*f+n)},randomPastelHex:function(){var e,t,n,r;return n=[255,255,255],r=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),e=Math.floor(Math.random()*256),r=Math.floor((r+3*n[0])/4),t=Math.floor((t+3*n[1])/4),e=Math.floor((e+3*n[2])/4),this.rgbToHex(r,t,e)},rgbToHex:function(e,t,n){return this.componentToHex(e)+this.componentToHex(t)+this.componentToHex(n)},componentToHex:function(e){var t;return t=e.toString(16),t.len===2?t:t+"0"}}),t.Physics.P2.Spring=function(e,t,n,r,i,s,o,u,a,f){this.game=e.game,this.world=e,r===undefined&&(r=1),i===undefined&&(i=100),s===undefined&&(s=1),r=e.pxm(r);var l={restLength:r,stiffness:i,damping:s};typeof o!="undefined"&&o!==null&&(l.worldAnchorA=[e.pxm(o[0]),e.pxm(o[1])]),typeof u!="undefined"&&u!==null&&(l.worldAnchorB=[e.pxm(u[0]),e.pxm(u[1])]),typeof a!="undefined"&&a!==null&&(l.localAnchorA=[e.pxm(a[0]),e.pxm(a[1])]),typeof f!="undefined"&&f!==null&&(l.localAnchorB=[e.pxm(f[0]),e.pxm(f[1])]),this.data=new p2.LinearSpring(t,n,l),this.data.parent=this},t.Physics.P2.Spring.prototype.constructor=t.Physics.P2.Spring,t.Physics.P2.RotationalSpring=function(e,t,n,r,i,s){this.game=e.game,this.world=e,r===undefined&&(r=null),i===undefined&&(i=100),s===undefined&&(s=1),r&&(r=e.pxm(r));var o={restAngle:r,stiffness:i,damping:s};this.data=new p2.RotationalSpring(t,n,o),this.data.parent=this},t.Physics.P2.Spring.prototype.constructor=t.Physics.P2.Spring,t.Physics.P2.Material=function(e){this.name=e,p2.Material.call(this)},t.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),t.Physics.P2.Material.prototype.constructor=t.Physics.P2.Material,t.Physics.P2.ContactMaterial=function(e,t,n){p2.ContactMaterial.call(this,e,t,n)},t.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),t.Physics.P2.ContactMaterial.prototype.constructor=t.Physics.P2.ContactMaterial,t.Physics.P2.CollisionGroup=function(e){this.mask=e},t.Physics.P2.DistanceConstraint=function(e,t,n,r,i,s,o){r===undefined&&(r=100),i===undefined&&(i=[0,0]),s===undefined&&(s=[0,0]),o===undefined&&(o=Number.MAX_VALUE),this.game=e.game,this.world=e,r=e.pxm(r),i=[e.pxmi(i[0]),e.pxmi(i[1])],s=[e.pxmi(s[0]),e.pxmi(s[1])];var u={distance:r,localAnchorA:i,localAnchorB:s,maxForce:o};p2.DistanceConstraint.call(this,t,n,u)},t.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),t.Physics.P2.DistanceConstraint.prototype.constructor=t.Physics.P2.DistanceConstraint,t.Physics.P2.GearConstraint=function(e,t,n,r,i){r===undefined&&(r=0),i===undefined&&(i=1),this.game=e.game,this.world=e;var s={angle:r,ratio:i};p2.GearConstraint.call(this,t,n,s)},t.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),t.Physics.P2.GearConstraint.prototype.constructor=t.Physics.P2.GearConstraint,t.Physics.P2.LockConstraint=function(e,t,n,r,i,s){r===undefined&&(r=[0,0]),i===undefined&&(i=0),s===undefined&&(s=Number.MAX_VALUE),this.game=e.game,this.world=e,r=[e.pxm(r[0]),e.pxm(r[1])];var o={localOffsetB:r,localAngleB:i,maxForce:s};p2.LockConstraint.call(this,t,n,o)},t.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),t.Physics.P2.LockConstraint.prototype.constructor=t.Physics.P2.LockConstraint,t.Physics.P2.PrismaticConstraint=function(e,t,n,r,i,s,o,u){r===undefined&&(r=!0),i===undefined&&(i=[0,0]),s===undefined&&(s=[0,0]),o===undefined&&(o=[0,0]),u===undefined&&(u=Number.MAX_VALUE),this.game=e.game,this.world=e,i=[e.pxmi(i[0]),e.pxmi(i[1])],s=[e.pxmi(s[0]),e.pxmi(s[1])];var a={localAnchorA:i,localAnchorB:s,localAxisA:o,maxForce:u,disableRotationalLock:!r};p2.PrismaticConstraint.call(this,t,n,a)},t.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),t.Physics.P2.PrismaticConstraint.prototype.constructor=t.Physics.P2.PrismaticConstraint,t.Physics.P2.RevoluteConstraint=function(e,t,n,r,i,s,o){s===undefined&&(s=Number.MAX_VALUE),o===undefined&&(o=null),this.game=e.game,this.world=e,n=[e.pxmi(n[0]),e.pxmi(n[1])],i=[e.pxmi(i[0]),e.pxmi(i[1])],o&&(o=[e.pxmi(o[0]),e.pxmi(o[1])]);var u={worldPivot:o,localPivotA:n,localPivotB:i,maxForce:s};p2.RevoluteConstraint.call(this,t,r,u)},t.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),t.Physics.P2.RevoluteConstraint.prototype.constructor=t.Physics.P2.RevoluteConstraint,t.ImageCollection=function(e,t,n,r,i,s,o){if(n===undefined||n<=0)n=32;if(r===undefined||r<=0)r=32;i===undefined&&(i=0),s===undefined&&(s=0),this.name=e,this.firstgid=t|0,this.imageWidth=n|0,this.imageHeight=r|0,this.imageMargin=i|0,this.imageSpacing=s|0,this.properties=o||{},this.images=[],this.total=0},t.ImageCollection.prototype={containsImageIndex:function(e){return e>=this.firstgid&&e<this.firstgid+this.total},addImage:function(e,t){this.images.push({gid:e,image:t}),this.total++}},t.ImageCollection.prototype.constructor=t.ImageCollection,t.Tile=function(e,t,n,r,i,s){this.layer=e,this.index=t,this.x=n,this.y=r,this.rotation=0,this.flipped=!1,this.worldX=n*i,this.worldY=r*s,this.width=i,this.height=s,this.centerX=Math.abs(i/2),this.centerY=Math.abs(s/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},t.Tile.prototype={containsPoint:function(e,t){return!(e<this.worldX||t<this.worldY||e>this.right||t>this.bottom)},intersects:function(e,t,n,r){return n<=this.worldX?!1:r<=this.worldY?!1:e>=this.worldX+this.width?!1:t>=this.worldY+this.height?!1:!0},setCollisionCallback:function(e,t){this.collisionCallback=e,this.collisionCallbackContext=t},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(e,t,n,r){this.collideLeft=e,this.collideRight=t,this.collideUp=n,this.collideDown=r,this.faceLeft=e,this.faceRight=t,this.faceTop=n,this.faceBottom=r},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(e,t){return e&&t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:e?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:t?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(e){this.index=e.index,this.alpha=e.alpha,this.properties=e.properties,this.collideUp=e.collideUp,this.collideDown=e.collideDown,this.collideLeft=e.collideLeft,this.collideRight=e.collideRight,this.collisionCallback=e.collisionCallback,this.collisionCallbackContext=e.collisionCallbackContext}},t.Tile.prototype.constructor=t.Tile,Object.defineProperty(t.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(t.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(t.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(t.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(t.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(t.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),t.Tilemap=function(e,n,r,i,s,o){this.game=e,this.key=n;var u=t.TilemapParser.parse(this.game,n,r,i,s,o);if(u===null)return;this.width=u.width,this.height=u.height,this.tileWidth=u.tileWidth,this.tileHeight=u.tileHeight,this.orientation=u.orientation,this.format=u.format,this.version=u.version,this.properties=u.properties,this.widthInPixels=u.widthInPixels,this.heightInPixels=u.heightInPixels,this.layers=u.layers,this.tilesets=u.tilesets,this.imagecollections=u.imagecollections,this.tiles=u.tiles,this.objects=u.objects,this.collideIndexes=[],this.collision=u.collision,this.images=u.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0},t.Tilemap.CSV=0,t.Tilemap.TILED_JSON=1,t.Tilemap.NORTH=0,t.Tilemap.EAST=1,t.Tilemap.SOUTH=2,t.Tilemap.WEST=3,t.Tilemap.prototype={create:function(e,t,n,r,i,s){return s===undefined&&(s=this.game.world),this.width=t,this.height=n,this.setTileSize(r,i),this.layers.length=0,this.createBlankLayer(e,t,n,r,i,s)},setTileSize:function(e,t){this.tileWidth=e,this.tileHeight=t,this.widthInPixels=this.width*e,this.heightInPixels=this.height*t},addTilesetImage:function(e,n,r,i,s,o,u){if(e===undefined)return null;r===undefined&&(r=this.tileWidth),i===undefined&&(i=this.tileHeight),s===undefined&&(s=0),o===undefined&&(o=0),u===undefined&&(u=0),r===0&&(r=32),i===0&&(i=32);var a=null;if(n===undefined||n===null)n=e;if(n instanceof t.BitmapData)a=n.canvas;else{if(!this.game.cache.checkImageKey(n))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+n+'"'),null;a=this.game.cache.getImage(n)}var f=this.getTilesetIndex(e);if(f===null&&this.format===t.Tilemap.TILED_JSON)return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+e+'"'),null;if(this.tilesets[f])return this.tilesets[f].setImage(a),this.tilesets[f];var l=new t.Tileset(e,u,r,i,s,o,{});l.setImage(a),this.tilesets.push(l);var c=this.tilesets.length-1,h=s,p=s,d=0,v=0,m=0;for(var g=u;g<u+l.total;g++){this.tiles[g]=[h,p,c],h+=r+o,d++;if(d===l.total)break;v++;if(v===l.columns){h=s,p+=i+o,v=0,m++;if(m===l.rows)break}}return l},createFromObjects:function(e,n,r,i,s,o,u,a,f){s===undefined&&(s=!0),o===undefined&&(o=!1),u===undefined&&(u=this.game.world),a===undefined&&(a=t.Sprite),f===undefined&&(f=!0);if(!this.objects[e]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+e);return}for(var l=0;l<this.objects[e].length;l++){var c=!1,h=this.objects[e][l];h.gid!==undefined&&typeof n=="number"&&h.gid===n?c=!0:h.id!==undefined&&typeof n=="number"&&h.id===n?c=!0:h.name!==undefined&&typeof n=="string"&&h.name===n&&(c=!0);if(c){var p=new a(this.game,parseFloat(h.x,10),parseFloat(h.y,10),r,i);p.name=h.name,p.visible=h.visible,p.autoCull=o,p.exists=s,h.width&&(p.width=h.width),h.height&&(p.height=h.height),h.rotation&&(p.angle=h.rotation),f&&(p.y-=p.height),u.add(p);for(var d in h.properties)u.set(p,d,h.properties[d],!1,!1,0,!0)}}},createFromTiles:function(e,n,r,i,s,o){typeof e=="number"&&(e=[e]),n===undefined||n===null?n=[]:typeof n=="number"&&(n=[n]),i=this.getLayer(i),s===undefined&&(s=this.game.world),o===undefined&&(o={}),o.customClass===undefined&&(o.customClass=t.Sprite),o.adjustY===undefined&&(o.adjustY=!0);var u=this.layers[i].width,a=this.layers[i].height;this.copy(0,0,u,a,i);if(this._results.length<2)return 0;var f=0,l;for(var c=1,h=this._results.length;c<h;c++)if(e.indexOf(this._results[c].index)!==-1){l=new o.customClass(this.game,this._results[c].worldX,this._results[c].worldY,r);for(var p in o)l[p]=o[p];s.add(l),f++}if(n.length===1)for(c=0;c<e.length;c++)this.replace(e[c],n[0],0,0,u,a,i);else if(n.length>1)for(c=0;c<e.length;c++)this.replace(e[c],n[c],0,0,u,a,i);return f},createLayer:function(e,n,r,i){n===undefined&&(n=this.game.width),r===undefined&&(r=this.game.height),i===undefined&&(i=this.game.world);var s=e;typeof e=="string"&&(s=this.getLayerIndex(e));if(s===null||s>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+s);return}return i.add(new t.TilemapLayer(this.game,this,s,n,r))},createBlankLayer:function(e,n,r,i,s,o){o===undefined&&(o=this.game.world);if(this.getLayerIndex(e)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");return}var u={name:e,x:0,y:0,width:n,height:r,widthInPixels:n*i,heightInPixels:r*s,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},a,f=[];for(var l=0;l<r;l++){a=[];for(var c=0;c<n;c++)a.push(new t.Tile(u,-1,c,l,i,s));f.push(a)}u.data=f,this.layers.push(u),this.currentLayer=this.layers.length-1;var h=u.widthInPixels,p=u.heightInPixels;h>this.game.width&&(h=this.game.width),p>this.game.height&&(p=this.game.height);var f=new t.TilemapLayer(this.game,this,this.layers.length-1,h,p);return f.name=e,o.add(f)},getIndex:function(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t)return n;return null},getLayerIndex:function(e){return this.getIndex(this.layers,e)},getTilesetIndex:function(e){return this.getIndex(this.tilesets,e)},getImageIndex:function(e){return this.getIndex(this.images,e)},setTileIndexCallback:function(e,t,n,r){r=this.getLayer(r);if(typeof e=="number")this.layers[r].callbacks[e]={callback:t,callbackContext:n};else for(var i=0,s=e.length;i<s;i++)this.layers[r].callbacks[e[i]]={callback:t,callbackContext:n}},setTileLocationCallback:function(e,t,n,r,i,s,o){o=this.getLayer(o),this.copy(e,t,n,r,o);if(this._results.length<2)return;for(var u=1;u<this._results.length;u++)this._results[u].setCollisionCallback(i,s)},setCollision:function(e,t,n,r){t===undefined&&(t=!0),r===undefined&&(r=!0),n=this.getLayer(n);if(typeof e=="number")return this.setCollisionByIndex(e,t,n,!0);if(Array.isArray(e)){for(var i=0;i<e.length;i++)this.setCollisionByIndex(e[i],t,n,!1);r&&this.calculateFaces(n)}},setCollisionBetween:function(e,t,n,r,i){n===undefined&&(n=!0),i===undefined&&(i=!0),r=this.getLayer(r);if(e>t)return;for(var s=e;s<=t;s++)this.setCollisionByIndex(s,n,r,!1);i&&this.calculateFaces(r)},setCollisionByExclusion:function(e,t,n,r){t===undefined&&(t=!0),r===undefined&&(r=!0),n=this.getLayer(n);for(var i=0,s=this.tiles.length;i<s;i++)e.indexOf(i)===-1&&this.setCollisionByIndex(i,t,n,!1);r&&this.calculateFaces(n)},setCollisionByIndex:function(e,t,n,r){t===undefined&&(t=!0),n===undefined&&(n=this.currentLayer),r===undefined&&(r=!0);if(t)this.collideIndexes.push(e);else{var i=this.collideIndexes.indexOf(e);i>-1&&this.collideIndexes.splice(i,1)}for(var s=0;s<this.layers[n].height;s++)for(var o=0;o<this.layers[n].width;o++){var u=this.layers[n].data[s][o];u&&u.index===e&&(t?u.setCollision(!0,!0,!0,!0):u.resetCollision(),u.faceTop=t,u.faceBottom=t,u.faceLeft=t,u.faceRight=t)}return r&&this.calculateFaces(n),n},getLayer:function(e){return e===undefined?e=this.currentLayer:typeof e=="string"?e=this.getLayerIndex(e):e instanceof t.TilemapLayer&&(e=e.index),e},setPreventRecalculate:function(e){e===!0&&this.preventingRecalculate!==!0&&(this.preventingRecalculate=!0,this.needToRecalculate={});if(e===!1&&this.preventingRecalculate===!0){this.preventingRecalculate=!1;for(var t in this.needToRecalculate)this.calculateFaces(t);this.needToRecalculate=!1}},calculateFaces:function(e){if(this.preventingRecalculate){this.needToRecalculate[e]=!0;return}var t=null,n=null,r=null,i=null;for(var s=0,o=this.layers[e].height;s<o;s++)for(var u=0,a=this.layers[e].width;u<a;u++){var f=this.layers[e].data[s][u];f&&(t=this.getTileAbove(e,u,s),n=this.getTileBelow(e,u,s),r=this.getTileLeft(e,u,s),i=this.getTileRight(e,u,s),f.collides&&(f.faceTop=!0,f.faceBottom=!0,f.faceLeft=!0,f.faceRight=!0),t&&t.collides&&(f.faceTop=!1),n&&n.collides&&(f.faceBottom=!1),r&&r.collides&&(f.faceLeft=!1),i&&i.collides&&(f.faceRight=!1))}},getTileAbove:function(e,t,n){return n>0?this.layers[e].data[n-1][t]:null},getTileBelow:function(e,t,n){return n<this.layers[e].height-1?this.layers[e].data[n+1][t]:null},getTileLeft:function(e,t,n){return t>0?this.layers[e].data[n][t-1]:null},getTileRight:function(e,t,n){return t<this.layers[e].width-1?this.layers[e].data[n][t+1]:null},setLayer:function(e){e=this.getLayer(e),this.layers[e]&&(this.currentLayer=e)},hasTile:function(e,t,n){return n=this.getLayer(n),this.layers[n].data[t]===undefined||this.layers[n].data[t][e]===undefined?!1:this.layers[n].data[t][e].index>-1},removeTile:function(e,n,r){r=this.getLayer(r);if(e>=0&&e<this.layers[r].width&&n>=0&&n<this.layers[r].height&&this.hasTile(e,n,r)){var i=this.layers[r].data[n][e];return this.layers[r].data[n][e]=new t.Tile(this.layers[r],-1,e,n,this.tileWidth,this.tileHeight),this.layers[r].dirty=!0,this.calculateFaces(r),i}},removeTileWorldXY:function(e,t,n,r,i){return i=this.getLayer(i),e=this.game.math.snapToFloor(e,n)/n,t=this.game.math.snapToFloor(t,r)/r,this.removeTile(e,t,i)},putTile:function(e,n,r,i){if(e===null)return this.removeTile(n,r,i);i=this.getLayer(i);if(n>=0&&n<this.layers[i].width&&r>=0&&r<this.layers[i].height){var s;return e instanceof t.Tile?(s=e.index,this.hasTile(n,r,i)?this.layers[i].data[r][n].copy(e):this.layers[i].data[r][n]=new t.Tile(i,s,n,r,e.width,e.height)):(s=e,this.hasTile(n,r,i)?this.layers[i].data[r][n].index=s:this.layers[i].data[r][n]=new t.Tile(this.layers[i],s,n,r,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(s)>-1?this.layers[i].data[r][n].setCollision(!0,!0,!0,!0):this.layers[i].data[r][n].resetCollision(),this.layers[i].dirty=!0,this.calculateFaces(i),this.layers[i].data[r][n]}return null},putTileWorldXY:function(e,t,n,r,i,s){return s=this.getLayer(s),t=this.game.math.snapToFloor(t,r)/r,n=this.game.math.snapToFloor(n,i)/i,this.putTile(e,t,n,s)},searchTileIndex:function(e,t,n,r){t===undefined&&(t=0),n===undefined&&(n=!1),r=this.getLayer(r);var i=0;if(n){for(var s=this.layers[r].height-1;s>=0;s--)for(var o=this.layers[r].width-1;o>=0;o--)if(this.layers[r].data[s][o].index===e){if(i===t)return this.layers[r].data[s][o];i++}}else for(var s=0;s<this.layers[r].height;s++)for(var o=0;o<this.layers[r].width;o++)if(this.layers[r].data[s][o].index===e){if(i===t)return this.layers[r].data[s][o];i++}return null},getTile:function(e,t,n,r){return r===undefined&&(r=!1),n=this.getLayer(n),e>=0&&e<this.layers[n].width&&t>=0&&t<this.layers[n].height?this.layers[n].data[t][e].index===-1?r?this.layers[n].data[t][e]:null:this.layers[n].data[t][e]:null},getTileWorldXY:function(e,t,n,r,i,s){return n===undefined&&(n=this.tileWidth),r===undefined&&(r=this.tileHeight),i=this.getLayer(i),e=this.game.math.snapToFloor(e,n)/n,t=this.game.math.snapToFloor(t,r)/r,this.getTile(e,t,i,s)},copy:function(e,t,n,r,i){i=this.getLayer(i);if(!this.layers[i]){this._results.length=0;return}e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=this.layers[i].width),r===undefined&&(r=this.layers[i].height),e<0&&(e=0),t<0&&(t=0),n>this.layers[i].width&&(n=this.layers[i].width),r>this.layers[i].height&&(r=this.layers[i].height),this._results.length=0,this._results.push({x:e,y:t,width:n,height:r,layer:i});for(var s=t;s<t+r;s++)for(var o=e;o<e+n;o++)this._results.push(this.layers[i].data[s][o]);return this._results},paste:function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),r=this.getLayer(r);if(!n||n.length<2)return;var i=e-n[1].x,s=t-n[1].y;for(var o=1;o<n.length;o++)this.layers[r].data[s+n[o].y][i+n[o].x].copy(n[o]);this.layers[r].dirty=!0,this.calculateFaces(r)},swap:function(e,t,n,r,i,s,o){o=this.getLayer(o),this.copy(n,r,i,s,o);if(this._results.length<2)return;this._tempA=e,this._tempB=t,this._results.forEach(this.swapHandler,this),this.paste(n,r,this._results,o)},swapHandler:function(e){e.index===this._tempA?e.index=this._tempB:e.index===this._tempB&&(e.index=this._tempA)},forEach:function(e,t,n,r,i,s,o){o=this.getLayer(o),this.copy(n,r,i,s,o);if(this._results.length<2)return;this._results.forEach(e,t),this.paste(n,r,this._results,o)},replace:function(e,t,n,r,i,s,o){o=this.getLayer(o),this.copy(n,r,i,s,o);if(this._results.length<2)return;for(var u=1;u<this._results.length;u++)this._results[u].index===e&&(this._results[u].index=t);this.paste(n,r,this._results,o)},random:function(e,t,n,r,i){i=this.getLayer(i),this.copy(e,t,n,r,i);if(this._results.length<2)return;var s=[];for(var o=1;o<this._results.length;o++)if(this._results[o].index){var u=this._results[o].index;s.indexOf(u)===-1&&s.push(u)}for(var a=1;a<this._results.length;a++)this._results[a].index=this.game.rnd.pick(s);this.paste(e,t,this._results,i)},shuffle:function(e,n,r,i,s){s=this.getLayer(s),this.copy(e,n,r,i,s);if(this._results.length<2)return;var o=[];for(var u=1;u<this._results.length;u++)this._results[u].index&&o.push(this._results[u].index);t.ArrayUtils.shuffle(o);for(var a=1;a<this._results.length;a++)this._results[a].index=o[a-1];this.paste(e,n,this._results,s)},fill:function(e,t,n,r,i,s){s=this.getLayer(s),this.copy(t,n,r,i,s);if(this._results.length<2)return;for(var o=1;o<this._results.length;o++)this._results[o].index=e;this.paste(t,n,this._results,s)},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){var e="",t=[""];for(var n=0;n<this.layers[this.currentLayer].height;n++){for(var r=0;r<this.layers[this.currentLayer].width;r++)e+="%c  ",this.layers[this.currentLayer].data[n][r]>1?this.debugMap[this.layers[this.currentLayer].data[n][r]]?t.push("background: "+this.debugMap[this.layers[this.currentLayer].data[n][r]]):t.push("background: #ffffff"):t.push("background: rgb(0, 0, 0)");e+="\n"}t[0]=e,console.log.apply(console,t)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},t.Tilemap.prototype.constructor=t.Tilemap,Object.defineProperty(t.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(e){e!==this.currentLayer&&this.setLayer(e)}}),t.TilemapLayer=function(e,n,r,i,s){i|=0,s|=0,t.Sprite.call(this,e,0,0),this.map=n,this.index=r,this.layer=n.layers[r],this.canvas=PIXI.CanvasPool.create(this,i,s),this.context=this.canvas.getContext("2d"),this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas))),this.type=t.TILEMAPLAYER,this.physicsType=t.TILEMAPLAYER,this.renderSettings={enableScrollDelta:!1,overdrawRatio:.2,copyCanvas:null},this.debug=!1,this.exists=!0,this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"},this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this._wrap=!1,this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:n.tileWidth,tileHeight:n.tileHeight,cw:n.tileWidth,ch:n.tileHeight,tilesets:[]},this._scrollX=0,this._scrollY=0,this._results=[],e.device.canvasBitBltShift||(this.renderSettings.copyCanvas=t.TilemapLayer.ensureSharedCopyCanvas()),this.fixedToCamera=!0},t.TilemapLayer.prototype=Object.create(t.Sprite.prototype),t.TilemapLayer.prototype.constructor=t.TilemapLayer,t.TilemapLayer.prototype.preUpdateCore=t.Component.Core.preUpdate,t.TilemapLayer.sharedCopyCanvas=null,t.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=t.Canvas.create(2,2)),this.sharedCopyCanvas},t.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()},t.TilemapLayer.prototype.postUpdate=function(){t.Component.FixedToCamera.postUpdate.call(this);var e=this.game.camera;this.scrollX=e.x*this.scrollFactorX/this.scale.x,this.scrollY=e.y*this.scrollFactorY/this.scale.y,this.render()},t.TilemapLayer.prototype.destroy=function(){PIXI.CanvasPool.remove(this),t.Component.Destroy.prototype.destroy.call(this)},t.TilemapLayer.prototype.resize=function(e,t){this.canvas.width=e,this.canvas.height=t,this.texture.frame.resize(e,t),this.texture.width=e,this.texture.height=t,this.texture.crop.width=e,this.texture.crop.height=t,this.texture.baseTexture.width=e,this.texture.baseTexture.height=t,this.texture.baseTexture.dirty(),this.texture.requiresUpdate=!0,this.texture._updateUvs(),this.dirty=!0},t.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},t.TilemapLayer.prototype._fixX=function(e){return e<0&&(e=0),this.scrollFactorX===1?e:this._scrollX+(e-this._scrollX/this.scrollFactorX)},t.TilemapLayer.prototype._unfixX=function(e){return this.scrollFactorX===1?e:this._scrollX/this.scrollFactorX+(e-this._scrollX)},t.TilemapLayer.prototype._fixY=function(e){return e<0&&(e=0),this.scrollFactorY===1?e:this._scrollY+(e-this._scrollY/this.scrollFactorY)},t.TilemapLayer.prototype._unfixY=function(e){return this.scrollFactorY===1?e:this._scrollY/this.scrollFactorY+(e-this._scrollY)},t.TilemapLayer.prototype.getTileX=function(e){return Math.floor(this._fixX(e)/this._mc.tileWidth)},t.TilemapLayer.prototype.getTileY=function(e){return Math.floor(this._fixY(e)/this._mc.tileHeight)},t.TilemapLayer.prototype.getTileXY=function(e,t,n){return n.x=this.getTileX(e),n.y=this.getTileY(t),n},t.TilemapLayer.prototype.getRayCastTiles=function(e,t,n,r){t||(t=this.rayStepRate),n===undefined&&(n=!1),r===undefined&&(r=!1);var i=this.getTiles(e.x,e.y,e.width,e.height,n,r);if(i.length===0)return[];var s=e.coordinatesOnLine(t),o=[];for(var u=0;u<i.length;u++)for(var a=0;a<s.length;a++){var f=i[u],l=s[a];if(f.containsPoint(l[0],l[1])){o.push(f);break}}return o},t.TilemapLayer.prototype.getTiles=function(e,t,n,r,i,s){i===undefined&&(i=!1),s===undefined&&(s=!1);var o=!i&&!s;e=this._fixX(e),t=this._fixY(t);var u=Math.floor(e/(this._mc.cw*this.scale.x)),a=Math.floor(t/(this._mc.ch*this.scale.y)),f=Math.ceil((e+n)/(this._mc.cw*this.scale.x))-u,l=Math.ceil((t+r)/(this._mc.ch*this.scale.y))-a;while(this._results.length)this._results.pop();for(var c=a;c<a+l;c++)for(var h=u;h<u+f;h++){var p=this.layer.data[c];p&&p[h]&&(o||p[h].isInteresting(i,s))&&this._results.push(p[h])}return this._results.slice()},t.TilemapLayer.prototype.resolveTileset=function(e){var t=this._mc.tilesets;if(e<2e3)while(t.length<e)t.push(undefined);var n=this.map.tiles[e]&&this.map.tiles[e][2];if(n!=null){var r=this.map.tilesets[n];if(r&&r.containsTileIndex(e))return t[e]=r}return t[e]=null},t.TilemapLayer.prototype.resetTilesetCache=function(){var e=this._mc.tilesets;while(e.length)e.pop()},t.TilemapLayer.prototype.setScale=function(e,t){e=e||1,t=t||e;for(var n=0;n<this.layer.data.length;n++){var r=this.layer.data[n];for(var i=0;i<r.length;i++){var s=r[i];s.width=this.map.tileWidth*e,s.height=this.map.tileHeight*t,s.worldX=s.x*s.width,s.worldY=s.y*s.height}}this.scale.setTo(e,t)},t.TilemapLayer.prototype.shiftCanvas=function(e,t,n){var r=e.canvas,i=r.width-Math.abs(t),s=r.height-Math.abs(n),o=0,u=0,a=t,f=n;t<0&&(o=-t,a=0),n<0&&(u=-n,f=0);var l=this.renderSettings.copyCanvas;if(l){if(l.width<i||l.height<s)l.width=i,l.height=s;var c=l.getContext("2d");c.clearRect(0,0,i,s),c.drawImage(r,o,u,i,s,0,0,i,s),e.clearRect(a,f,i,s),e.drawImage(l,0,0,i,s,a,f,i,s)}else e.save(),e.globalCompositeOperation="copy",e.drawImage(r,o,u,i,s,a,f,i,s),e.restore()},t.TilemapLayer.prototype.renderRegion=function(e,t,n,r,i,s){var o=this.context,u=this.layer.width,a=this.layer.height,f=this._mc.tileWidth,l=this._mc.tileHeight,c=this._mc.tilesets,h=NaN;this._wrap||(n<=i&&(n=Math.max(0,n),i=Math.min(u-1,i)),r<=s&&(r=Math.max(0,r),s=Math.min(a-1,s)));var p=n*f-e,d=r*l-t,v=(n+(1<<20)*u)%u,m=(r+(1<<20)*a)%a,g,y,b,w,E,S;o.fillStyle=this.tileColor;for(w=m,S=s-r,y=d;S>=0;w++,S--,y+=l){w>=a&&(w-=a);var x=this.layer.data[w];for(b=v,E=i-n,g=p;E>=0;b++,E--,g+=f){b>=u&&(b-=u);var T=x[b];if(!T||T.index<0)continue;var N=T.index,C=c[N];C===undefined&&(C=this.resolveTileset(N)),T.alpha!==h&&!this.debug&&(o.globalAlpha=T.alpha,h=T.alpha),C?T.rotation||T.flipped?(o.save(),o.translate(g+T.centerX,y+T.centerY),o.rotate(T.rotation),T.flipped&&o.scale(-1,1),C.draw(o,-T.centerX,-T.centerY,N),o.restore()):C.draw(o,g,y,N):this.debugSettings.missingImageFill&&(o.fillStyle=this.debugSettings.missingImageFill,o.fillRect(g,y,f,l)),T.debug&&this.debugSettings.debuggedTileOverfill&&(o.fillStyle=this.debugSettings.debuggedTileOverfill,o.fillRect(g,y,f,l))}}},t.TilemapLayer.prototype.renderDeltaScroll=function(e,t){var n=this._mc.scrollX,r=this._mc.scrollY,i=this.canvas.width,s=this.canvas.height,o=this._mc.tileWidth,u=this._mc.tileHeight,a=0,f=-o,l=0,c=-u;e<0?(a=i+e,f=i-1):e>0&&(f=e),t<0?(l=s+t,c=s-1):t>0&&(c=t),this.shiftCanvas(this.context,e,t),a=Math.floor((a+n)/o),f=Math.floor((f+n)/o),l=Math.floor((l+r)/u),c=Math.floor((c+r)/u);if(a<=f){this.context.clearRect(a*o-n,0,(f-a+1)*o,s);var h=Math.floor((0+r)/u),p=Math.floor((s-1+r)/u);this.renderRegion(n,r,a,h,f,p)}if(l<=c){this.context.clearRect(0,l*u-r,i,(c-l+1)*u);var d=Math.floor((0+n)/o),v=Math.floor((i-1+n)/o);this.renderRegion(n,r,d,l,v,c)}},t.TilemapLayer.prototype.renderFull=function(){var e=this._mc.scrollX,t=this._mc.scrollY,n=this.canvas.width,r=this.canvas.height,i=this._mc.tileWidth,s=this._mc.tileHeight,o=Math.floor(e/i),u=Math.floor((n-1+e)/i),a=Math.floor(t/s),f=Math.floor((r-1+t)/s);this.context.clearRect(0,0,n,r),this.renderRegion(e,t,o,a,u,f)},t.TilemapLayer.prototype.render=function(){var e=!1;if(!this.visible)return;if(this.dirty||this.layer.dirty)this.layer.dirty=!1,e=!0;var t=this.canvas.width,n=this.canvas.height,r=this._scrollX|0,i=this._scrollY|0,s=this._mc,o=s.scrollX-r,u=s.scrollY-i;if(!e&&o===0&&u===0&&s.renderWidth===t&&s.renderHeight===n)return;this.context.save(),s.scrollX=r,s.scrollY=i;if(s.renderWidth!==t||s.renderHeight!==n)s.renderWidth=t,s.renderHeight=n;return this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(e=!0)),!e&&this.renderSettings.enableScrollDelta&&Math.abs(o)+Math.abs(u)<Math.min(t,n)?this.renderDeltaScroll(o,u):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0},t.TilemapLayer.prototype.renderDebug=function(){var e=this._mc.scrollX,t=this._mc.scrollY,n=this.context,r=this.canvas.width,i=this.canvas.height,s=this.layer.width,o=this.layer.height,u=this._mc.tileWidth,a=this._mc.tileHeight,f=Math.floor(e/u),l=Math.floor((r-1+e)/u),c=Math.floor(t/a),h=Math.floor((i-1+t)/a),p=f*u-e,d=c*a-t,v=(f+(1<<20)*s)%s,m=(c+(1<<20)*o)%o,g,y,b,w,E,S;n.strokeStyle=this.debugSettings.facingEdgeStroke;for(w=m,S=h-c,y=d;S>=0;w++,S--,y+=a){w>=o&&(w-=o);var x=this.layer.data[w];for(b=v,E=l-f,g=p;E>=0;b++,E--,g+=u){b>=s&&(b-=s);var T=x[b];if(!T||T.index<0||!T.collides)continue;this.debugSettings.collidingTileOverfill&&(n.fillStyle=this.debugSettings.collidingTileOverfill,n.fillRect(g,y,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(n.beginPath(),T.faceTop&&(n.moveTo(g,y),n.lineTo(g+this._mc.cw,y)),T.faceBottom&&(n.moveTo(g,y+this._mc.ch),n.lineTo(g+this._mc.cw,y+this._mc.ch)),T.faceLeft&&(n.moveTo(g,y),n.lineTo(g,y+this._mc.ch)),T.faceRight&&(n.moveTo(g+this._mc.cw,y),n.lineTo(g+this._mc.cw,y+this._mc.ch)),n.stroke())}}},Object.defineProperty(t.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(e){this._wrap=e,this.dirty=!0}}),Object.defineProperty(t.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(e){this._scrollX=e}}),Object.defineProperty(t.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(e){this._scrollY=e}}),Object.defineProperty(t.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(e){this._mc.cw=e|0,this.dirty=!0}}),Object.defineProperty(t.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(e){this._mc.ch=e|0,this.dirty=!0}}),t.TilemapParser={INSERT_NULL:!1,parse:function(e,n,r,i,s,o){r===undefined&&(r=32),i===undefined&&(i=32),s===undefined&&(s=10),o===undefined&&(o=10);if(n===undefined)return this.getEmptyData();if(n===null)return this.getEmptyData(r,i,s,o);var u=e.cache.getTilemapData(n);if(u){if(u.format===t.Tilemap.CSV)return this.parseCSV(n,u.data,r,i);if(!u.format||u.format===t.Tilemap.TILED_JSON)return this.parseTiledJSON(u.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+n)},parseCSV:function(e,n,r,i){var s=this.getEmptyData();n=n.trim();var o=[],u=n.split("\n"),a=u.length,f=0;for(var l=0;l<u.length;l++){o[l]=[];var c=u[l].split(",");for(var h=0;h<c.length;h++)o[l][h]=new t.Tile(s.layers[0],parseInt(c[h],10),h,l,r,i);f===0&&(f=c.length)}return s.format=t.Tilemap.CSV,s.name=e,s.width=f,s.height=a,s.tileWidth=r,s.tileHeight=i,s.widthInPixels=f*r,s.heightInPixels=a*i,s.layers[0].width=f,s.layers[0].height=a,s.layers[0].widthInPixels=s.widthInPixels,s.layers[0].heightInPixels=s.heightInPixels,s.layers[0].data=o,s},getEmptyData:function(e,t,n,r){var i={};i.width=0,i.height=0,i.tileWidth=0,i.tileHeight=0,typeof e!="undefined"&&e!==null&&(i.tileWidth=e),typeof t!="undefined"&&t!==null&&(i.tileHeight=t),typeof n!="undefined"&&n!==null&&(i.width=n),typeof r!="undefined"&&r!==null&&(i.height=r),i.orientation="orthogonal",i.version="1",i.properties={},i.widthInPixels=0,i.heightInPixels=0;var s=[],o={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]};return s.push(o),i.layers=s,i.images=[],i.objects={},i.collision={},i.tilesets=[],i.tiles=[],i},parseTiledJSON:function(e){function O(e,t){var n={};for(var r in t){var i=t[r];typeof e[i]!="undefined"&&(n[i]=e[i])}return n}if(e.orientation!=="orthogonal")return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;var n={};n.width=e.width,n.height=e.height,n.tileWidth=e.tilewidth,n.tileHeight=e.tileheight,n.orientation=e.orientation,n.format=t.Tilemap.TILED_JSON,n.version=e.version,n.properties=e.properties,n.widthInPixels=n.width*n.tileWidth,n.heightInPixels=n.height*n.tileHeight;var r=[];for(var i=0;i<e.layers.length;i++){if(e.layers[i].type!=="tilelayer")continue;var s=e.layers[i];if(!s.compression&&s.encoding&&s.encoding==="base64"){var o=window.atob(s.data),u=o.length,a=new Array(u);for(var f=0;f<u;f+=4)a[f/4]=(o.charCodeAt(f)|o.charCodeAt(f+1)<<8|o.charCodeAt(f+2)<<16|o.charCodeAt(f+3)<<24)>>>0;s.data=a}var l={name:s.name,x:s.x,y:s.y,width:s.width,height:s.height,widthInPixels:s.width*e.tilewidth,heightInPixels:s.height*e.tileheight,alpha:s.opacity,visible:s.visible,properties:{},indexes:[],callbacks:[],bodies:[]};s.properties&&(l.properties=s.properties);var c=0,h=[],p=[],d,v,m,g;for(var y=0,u=s.data.length;y<u;y++){d=0,v=!1,g=s.data[y];if(g>536870912){m=0,g>2147483648&&(g-=2147483648,m+=4),g>1073741824&&(g-=1073741824,m+=2),g>536870912&&(g-=536870912,m+=1);switch(m){case 5:d=Math.PI/2;break;case 6:d=Math.PI;break;case 3:d=3*Math.PI/2;break;case 4:d=0,v=!0;break;case 7:d=Math.PI/2,v=!0;break;case 2:d=Math.PI,v=!0;break;case 1:d=3*Math.PI/2,v=!0}}g>0?(h.push(new t.Tile(l,g,c,p.length,e.tilewidth,e.tileheight)),h[h.length-1].rotation=d,h[h.length-1].flipped=v):t.TilemapParser.INSERT_NULL?h.push(null):h.push(new t.Tile(l,-1,c,p.length,e.tilewidth,e.tileheight)),c++,c===s.width&&(p.push(h),c=0,h=[])}l.data=p,r.push(l)}n.layers=r;var b=[];for(var i=0;i<e.layers.length;i++){if(e.layers[i].type!=="imagelayer")continue;var w=e.layers[i],E={name:w.name,image:w.image,x:w.x,y:w.y,alpha:w.opacity,visible:w.visible,properties:{}};w.properties&&(E.properties=w.properties),b.push(E)}n.images=b;var S=[],x=[];for(var i=0;i<e.tilesets.length;i++){var T=e.tilesets[i];if(T.image){var N=new t.Tileset(T.name,T.firstgid,T.tilewidth,T.tileheight,T.margin,T.spacing,T.properties);T.tileproperties&&(N.tileProperties=T.tileproperties),N.updateTileData(T.imagewidth,T.imageheight),S.push(N)}else{var C=new t.ImageCollection(T.name,T.firstgid,T.tilewidth,T.tileheight,T.margin,T.spacing,T.properties);for(var k in T.tiles){var E=T.tiles[k].image,g=T.firstgid+parseInt(k,10);C.addImage(g,E)}x.push(C)}}n.tilesets=S,n.imagecollections=x;var L={},A={};for(var i=0;i<e.layers.length;i++){if(e.layers[i].type!=="objectgroup")continue;var M=e.layers[i];L[M.name]=[],A[M.name]=[];for(var _=0,u=M.objects.length;_<u;_++)if(M.objects[_].gid){var D={gid:M.objects[_].gid,name:M.objects[_].name,type:M.objects[_].hasOwnProperty("type")?M.objects[_].type:"",x:M.objects[_].x,y:M.objects[_].y,visible:M.objects[_].visible,properties:M.objects[_].properties};M.objects[_].rotation&&(D.rotation=M.objects[_].rotation),L[M.name].push(D)}else if(M.objects[_].polyline){var D={name:M.objects[_].name,type:M.objects[_].type,x:M.objects[_].x,y:M.objects[_].y,width:M.objects[_].width,height:M.objects[_].height,visible:M.objects[_].visible,properties:M.objects[_].properties};M.objects[_].rotation&&(D.rotation=M.objects[_].rotation),D.polyline=[];for(var P=0;P<M.objects[_].polyline.length;P++)D.polyline.push([M.objects[_].polyline[P].x,M.objects[_].polyline[P].y]);A[M.name].push(D),L[M.name].push(D)}else if(M.objects[_].polygon){var D=O(M.objects[_],["name","type","x","y","visible","rotation","properties"]);D.polygon=[];for(var P=0;P<M.objects[_].polygon.length;P++)D.polygon.push([M.objects[_].polygon[P].x,M.objects[_].polygon[P].y]);L[M.name].push(D)}else if(M.objects[_].ellipse){var D=O(M.objects[_],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);L[M.name].push(D)}else{var D=O(M.objects[_],["name","type","x","y","width","height","visible","rotation","properties"]);D.rectangle=!0,L[M.name].push(D)}}n.objects=L,n.collision=A,n.tiles=[];for(var i=0;i<n.tilesets.length;i++){var T=n.tilesets[i],c=T.tileMargin,H=T.tileMargin,B=0,j=0,F=0;for(var y=T.firstgid;y<T.firstgid+T.total;y++){n.tiles[y]=[c,H,i],c+=T.tileWidth+T.tileSpacing,B++;if(B===T.total)break;j++;if(j===T.columns){c=T.tileMargin,H+=T.tileHeight+T.tileSpacing,j=0,F++;if(F===T.rows)break}}}var l,I,q,T;for(var i=0;i<n.layers.length;i++){l=n.layers[i];for(var f=0;f<l.data.length;f++){h=l.data[f];for(var R=0;R<h.length;R++){I=h[R];if(I===null||I.index<0)continue;q=n.tiles[I.index][2],T=n.tilesets[q],T.tileProperties&&T.tileProperties[I.index-T.firstgid]&&(I.properties=t.Utils.mixin(T.tileProperties[I.index-T.firstgid],I.properties))}}}return n}},t.Tileset=function(e,t,n,r,i,s,o){if(n===undefined||n<=0)n=32;if(r===undefined||r<=0)r=32;i===undefined&&(i=0),s===undefined&&(s=0),this.name=e,this.firstgid=t|0,this.tileWidth=n|0,this.tileHeight=r|0,this.tileMargin=i|0,this.tileSpacing=s|0,this.properties=o||{},this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},t.Tileset.prototype={draw:function(e,t,n,r){var i=r-this.firstgid<<1;i>=0&&i+1<this.drawCoords.length&&e.drawImage(this.image,this.drawCoords[i],this.drawCoords[i+1],this.tileWidth,this.tileHeight,t,n,this.tileWidth,this.tileHeight)},containsTileIndex:function(e){return e>=this.firstgid&&e<this.firstgid+this.total},setImage:function(e){this.image=e,this.updateTileData(e.width,e.height)},setSpacing:function(e,t){this.tileMargin=e|0,this.tileSpacing=t|0,this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(e,t){var n=(t-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing),r=(e-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);(n%1!==0||r%1!==0)&&console.warn("Phaser.Tileset - image tile area is not an even multiple of tile size"),n=Math.floor(n),r=Math.floor(r),(this.rows&&this.rows!==n||this.columns&&this.columns!==r)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=n,this.columns=r,this.total=n*r,this.drawCoords.length=0;var i=this.tileMargin,s=this.tileMargin;for(var o=0;o<this.rows;o++){for(var u=0;u<this.columns;u++)this.drawCoords.push(i),this.drawCoords.push(s),i+=this.tileWidth+this.tileSpacing;i=this.tileMargin,s+=this.tileHeight+this.tileSpacing}}},t.Tileset.prototype.constructor=t.Tileset,t.Particle=function(e,n,r,i,s){t.Sprite.call(this,e,n,r,i,s),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},t.Particle.prototype=Object.create(t.Sprite.prototype),t.Particle.prototype.constructor=t.Particle,t.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},t.Particle.prototype.onEmit=function(){},t.Particle.prototype.setAlphaData=function(e){this.alphaData=e,this._a=e.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},t.Particle.prototype.setScaleData=function(e){this.scaleData=e,this._s=e.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},t.Particle.prototype.reset=function(e,n,r){return t.Component.Reset.prototype.reset.call(this,e,n,r),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},t.Particles=function(e){this.game=e,this.emitters={},this.ID=0},t.Particles.prototype={add:function(e){return this.emitters[e.name]=e,e},remove:function(e){delete this.emitters[e.name]},update:function(){for(var e in this.emitters)this.emitters[e].exists&&this.emitters[e].update()}},t.Particles.prototype.constructor=t.Particles,t.Particles.Arcade={},t.Particles.Arcade.Emitter=function(e,n,r,i){this.maxParticles=i||50,t.Group.call(this,e),this.name="emitter"+this.game.particles.ID++,this.type=t.EMITTER,this.physicsType=t.GROUP,this.area=new t.Rectangle(n,r,1,1),this.minParticleSpeed=new t.Point(-100,-100),this.maxParticleSpeed=new t.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.gravity=100,this.particleClass=t.Particle,this.particleDrag=new t.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new t.Point,this.on=!1,this.particleAnchor=new t.Point(.5,.5),this.blendMode=t.blendModes.NORMAL,this.emitX=n,this.emitY=r,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this._minParticleScale=new t.Point(1,1),this._maxParticleScale=new t.Point(1,1),this._quantity=0,this._timer=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this._explode=!0,this._frames=null},t.Particles.Arcade.Emitter.prototype=Object.create(t.Group.prototype),t.Particles.Arcade.Emitter.prototype.constructor=t.Particles.Arcade.Emitter,t.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer){this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion;if(this._flowTotal!==0)if(this._flowQuantity>0){for(var e=0;e<this._flowQuantity;e++)if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=!1;break}}}else this.emitParticle()&&(this._counter++,this._flowTotal!==-1&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1))}var e=this.children.length;while(e--)this.children[e].exists&&this.children[e].update()},t.Particles.Arcade.Emitter.prototype.makeParticles=function(e,t,n,r,i){t===undefined&&(t=0),n===undefined&&(n=this.maxParticles),r===undefined&&(r=!1),i===undefined&&(i=!1);var s,o=0,u=e,a=t;this._frames=t,n>this.maxParticles&&(this.maxParticles=n);while(o<n)Array.isArray(e)&&(u=this.game.rnd.pick(e)),Array.isArray(t)&&(a=this.game.rnd.pick(t)),s=new this.particleClass(this.game,0,0,u,a),this.game.physics.arcade.enable(s,!1),r?(s.body.checkCollision.any=!0,s.body.checkCollision.none=!1):s.body.checkCollision.none=!0,s.body.collideWorldBounds=i,s.body.skipQuadTree=!0,s.exists=!1,s.visible=!1,s.anchor.copyFrom(this.particleAnchor),this.add(s),o++;return this},t.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this},t.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this},t.Particles.Arcade.Emitter.prototype.explode=function(e,t){return this._flowTotal=0,this.start(!0,e,0,t,!1),this},t.Particles.Arcade.Emitter.prototype.flow=function(e,t,n,r,i){if(n===undefined||n===0)n=1;return r===undefined&&(r=-1),i===undefined&&(i=!0),n>this.maxParticles&&(n=this.maxParticles),this._counter=0,this._flowQuantity=n,this._flowTotal=r,i?(this.start(!0,e,t,n),this._counter+=n,this.on=!0,this._timer=this.game.time.time+t*this.game.time.slowMotion):this.start(!1,e,t,n),this},t.Particles.Arcade.Emitter.prototype.start=function(e,t,n,r,i){e===undefined&&(e=!0),t===undefined&&(t=0);if(n===undefined||n===null)n=250;r===undefined&&(r=0),i===undefined&&(i=!1),r>this.maxParticles&&(r=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=t,this.frequency=n;if(e||i)for(var s=0;s<r;s++)this.emitParticle();else this.on=!0,this._quantity+=r,this._counter=0,this._timer=this.game.time.time+n*this.game.time.slowMotion;return this},t.Particles.Arcade.Emitter.prototype.emitParticle=function(e,t,n,r){e===undefined&&(e=null),t===undefined&&(t=null);var i=this.getFirstExists(!1);if(i===null)return!1;var s=this.game.rnd;n!==undefined&&r!==undefined?i.loadTexture(n,r):n!==undefined&&i.loadTexture(n);var o=this.emitX,u=this.emitY;e!==null?o=e:this.width>1&&(o=s.between(this.left,this.right)),t!==null?u=t:this.height>1&&(u=s.between(this.top,this.bottom)),i.reset(o,u),i.angle=0,i.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(i):this.particleSendToBack&&this.sendToBack(i),this.autoScale?i.setScaleData(this.scaleData):this.minParticleScale!==1||this.maxParticleScale!==1?i.scale.set(s.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&i.scale.set(s.realInRange(this._minParticleScale.x,this._maxParticleScale.x),s.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),r===undefined&&(Array.isArray(this._frames)?i.frame=this.game.rnd.pick(this._frames):i.frame=this._frames),this.autoAlpha?i.setAlphaData(this.alphaData):i.alpha=s.realInRange(this.minParticleAlpha,this.maxParticleAlpha),i.blendMode=this.blendMode;var a=i.body;return a.updateBounds(),a.bounce.copyFrom(this.bounce),a.drag.copyFrom(this.particleDrag),a.velocity.x=s.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),a.velocity.y=s.between(this.minParticleSpeed.y,this.maxParticleSpeed.y),a.angularVelocity=s.between(this.minRotation,this.maxRotation),a.gravity.y=this.gravity,a.angularDrag=this.angularDrag,i.onEmit(),!0},t.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this),t.Group.prototype.destroy.call(this,!0,!1)},t.Particles.Arcade.Emitter.prototype.setSize=function(e,t){return this.area.width=e,this.area.height=t,this},t.Particles.Arcade.Emitter.prototype.setXSpeed=function(e,t){return e=e||0,t=t||0,this.minParticleSpeed.x=e,this.maxParticleSpeed.x=t,this},t.Particles.Arcade.Emitter.prototype.setYSpeed=function(e,t){return e=e||0,t=t||0,this.minParticleSpeed.y=e,this.maxParticleSpeed.y=t,this},t.Particles.Arcade.Emitter.prototype.setRotation=function(e,t){return e=e||0,t=t||0,this.minRotation=e,this.maxRotation=t,this},t.Particles.Arcade.Emitter.prototype.setAlpha=function(e,n,r,i,s){e===undefined&&(e=1),n===undefined&&(n=1),r===undefined&&(r=0),i===undefined&&(i=t.Easing.Linear.None),s===undefined&&(s=!1),this.minParticleAlpha=e,this.maxParticleAlpha=n,this.autoAlpha=!1;if(r>0&&e!==n){var o={v:e},u=this.game.make.tween(o).to({v:n},r,i);u.yoyo(s),this.alphaData=u.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}return this},t.Particles.Arcade.Emitter.prototype.setScale=function(e,n,r,i,s,o,u){e===undefined&&(e=1),n===undefined&&(n=1),r===undefined&&(r=1),i===undefined&&(i=1),s===undefined&&(s=0),o===undefined&&(o=t.Easing.Linear.None),u===undefined&&(u=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(e,r),this._maxParticleScale.set(n,i),this.autoScale=!1;if(s>0&&(e!==n||r!==i)){var a={x:e,y:r},f=this.game.make.tween(a).to({x:n,y:i},s,o);f.yoyo(u),this.scaleData=f.generateData(60),this.scaleData.reverse(),this.autoScale=!0}return this},t.Particles.Arcade.Emitter.prototype.at=function(e){return e.center?(this.emitX=e.center.x,this.emitY=e.center.y):(this.emitX=e.world.x+e.anchor.x*e.width,this.emitY=e.world.y+e.anchor.y*e.height),this},Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(e){this.area.width=e}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(e){this.area.height=e}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(e){this.emitX=e}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(e){this.emitY=e}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(t.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),t.Video=function(e,n,r){n===undefined&&(n=null),r===undefined&&(r=null),this.game=e,this.key=n,this.width=0,this.height=0,this.type=t.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new t.Signal,this.onChangeSource=new t.Signal,this.onComplete=new t.Signal,this.onAccess=new t.Signal,this.onError=new t.Signal,this.onTimeout=new t.Signal,this.timeout=15e3,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null;if(n&&this.game.cache.checkVideoKey(n)){var i=this.game.cache.getVideo(n);i.isBlob?this.createVideoFromBlob(i.data):this.video=i.data,this.width=this.video.videoWidth,this.height=this.video.videoHeight}else r&&this.createVideoFromURL(r,!1);this.video&&!r?(this.baseTexture=new PIXI.BaseTexture(this.video),this.baseTexture.forceLoaded(this.width,this.height)):(this.baseTexture=new PIXI.BaseTexture(PIXI.TextureCache.__default.baseTexture.source),this.baseTexture.forceLoaded(this.width,this.height)),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new t.Frame(0,0,0,this.width,this.height,"video"),this.texture.setFrame(this.textureFrame),this.texture.valid=!1,n!==null&&this.video&&(this.texture.valid=this.video.canplay),this.snapshot=null,t.BitmapData&&(this.snapshot=new t.BitmapData(this.game,"",this.width,this.height)),!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?this.setTouchLock():i&&(i.locked=!1)},t.Video.prototype={connectToMediaStream:function(e,t){return e&&t&&(this.video=e,this.videoStream=t,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(e,t,n){e===undefined&&(e=!1),t===undefined&&(t=null),n===undefined&&(n=null);if(!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;this.videoStream!==null&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.removeVideoElement(),this.video=document.createElement("video"),this.video.setAttribute("autoplay","autoplay"),t!==null&&(this.video.width=t),n!==null&&(this.video.height=n),this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:e,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(r){this.getUserMediaError(r)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID),this.onTimeout.dispatch(this)},getUserMediaError:function(e){clearTimeout(this._timeOutID),this.onError.dispatch(this,e)},getUserMediaSuccess:function(e){clearTimeout(this._timeOutID),this.videoStream=e,this.video.mozSrcObject!==undefined?this.video.mozSrcObject=e:this.video.src=window.URL&&window.URL.createObjectURL(e)||e;var t=this;this.video.onloadeddata=function(){function n(){if(e>0)if(t.video.videoWidth>0){var r=t.video.videoWidth,i=t.video.videoHeight;isNaN(t.video.videoHeight)&&(i=r/(4/3)),t.video.play(),t.isStreaming=!0,t.baseTexture.source=t.video,t.updateTexture(null,r,i),t.onAccess.dispatch(t)}else window.setTimeout(n,500);else console.warn("Unable to connect to video stream. Webcam error?");e--}var e=10;n()}},createVideoFromBlob:function(e){var t=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.addEventListener("loadeddata",function(e){t.updateTexture(e)},!0),this.video.src=window.URL.createObjectURL(e),this.video.canplay=!0,this},createVideoFromURL:function(e,t){return t===undefined&&(t=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,t&&this.video.setAttribute("autoplay","autoplay"),this.video.src=e,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.key=e,this},updateTexture:function(e,t,n){var r=!1;if(t===undefined||t===null)t=this.video.videoWidth,r=!0;if(n===undefined||n===null)n=this.video.videoHeight;this.width=t,this.height=n,this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video),this.baseTexture.forceLoaded(t,n),this.texture.frame.resize(t,n),this.texture.width=t,this.texture.height=n,this.texture.valid=!0,this.snapshot&&this.snapshot.resize(t,n),r&&this.key!==null&&(this.onChangeSource.dispatch(this,t,n),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(e,t){return e===undefined&&(e=!1),t===undefined&&(t=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,!0),e?this.video.loop="loop":this.video.loop="",this.video.playbackRate=t,this.touchLocked?this._pending=!0:(this._pending=!1,this.key!==null&&(this.video.readyState!==4?(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)):(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0))),this.video.play(),this.onPlay.dispatch(this,e,t)),this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0),this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t].loadTexture&&e[t].loadTexture(this);else e.loadTexture(this);return this},addToWorld:function(e,t,n,r,i,s){i=i||1,s=s||1;var o=this.game.add.image(e,t,this);return o.anchor.set(n,r),o.scale.set(i,s),o},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){if(this._muted)return;this._muted=!0,this.video.muted=!0},unsetMute:function(){if(!this._muted||this._codeMuted)return;this._muted=!1,this.video.muted=!1},setPause:function(){if(this._paused||this.touchLocked)return;this._paused=!0,this.video.pause()},setResume:function(){if(!this._paused||this._codePaused||this.touchLocked)return;this._paused=!1,this.video.ended||this.video.play()},changeSource:function(e,t){return t===undefined&&(t=!0),this.texture.valid=!1,this.video.pause(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=e,this.video.load(),this._autoplay=t,t||(this.paused=!0),this},checkVideoProgress:function(){this.video.readyState===4?this.updateTexture():(this.retry--,this.retry>0?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming))},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this),this.touchLocked=!0},unlock:function(){this.touchLocked=!1,this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate);if(this.key){var e=this.game.cache.getVideo(this.key);e&&!e.isBlob&&(e.locked=!1)}return!0},grab:function(e,t,n){e===undefined&&(e=!1),t===undefined&&(t=1),n===undefined&&(n=null);if(this.snapshot===null){console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable");return}return e&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,t,n),this.snapshot},removeVideoElement:function(){if(!this.video)return;this.video.parentNode&&this.video.parentNode.removeChild(this.video);while(this.video.hasChildNodes())this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay"),this.video.removeAttribute("src"),this.video=null},destroy:function(){this.stop(),this.removeVideoElement(),this.touchLocked&&this.game.input.touch.removeTouchLockCallback(this.unlock,this),this._retryID&&window.clearTimeout(this._retryID)}},Object.defineProperty(t.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(e){this.video.currentTime=e}}),Object.defineProperty(t.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}}),Object.defineProperty(t.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}}),Object.defineProperty(t.Video.prototype,"mute",{get:function(){return this._muted},set:function(e){e=e||null;if(e){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(t.Video.prototype,"paused",{get:function(){return this._paused},set:function(e){e=e||null;if(this.touchLocked)return;if(e){if(this._paused)return;this._codePaused=!0,this.setPause()}else{if(!this._paused)return;this._codePaused=!1,this.setResume()}}}),Object.defineProperty(t.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(e){e<0?e=0:e>1&&(e=1),this.video&&(this.video.volume=e)}}),Object.defineProperty(t.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(e){this.video&&(this.video.playbackRate=e)}}),Object.defineProperty(t.Video.prototype,"loop",{get:function(){return this.video?this.video.loop:!1},set:function(e){e&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}}),Object.defineProperty(t.Video.prototype,"playing",{get:function(){return!this.video.paused||!this.video.ended}}),t.Video.prototype.constructor=t.Video,PIXI.blendModes===undefined&&(PIXI.blendModes=t.blendModes),PIXI.scaleModes===undefined&&(PIXI.scaleModes=t.scaleModes),PIXI.Texture.emptyTexture===undefined&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)),PIXI.DisplayObject._tempMatrix===undefined&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix),PIXI.RenderTexture.tempMatrix===undefined&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix),PIXI.Graphics&&PIXI.Graphics.POLY===undefined&&(PIXI.Graphics.POLY=t.POLYGON,PIXI.Graphics.RECT=t.RECTANGLE,PIXI.Graphics.CIRC=t.CIRCLE,PIXI.Graphics.ELIP=t.ELLIPSE,PIXI.Graphics.RREC=t.ROUNDEDRECTANGLE),PIXI.TextureSilentFail=!0,typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=t),exports.Phaser=t):typeof define!="undefined"&&define.amd?define("Phaser",function(){return e.Phaser=t}()):e.Phaser=t,t}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("boot",["Phaser"],function(t){var n,r;return r={},r.BootState=n=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.preload=function(){this.game.load.image("progressBar","assets/progressBar.png")},r.prototype.create=function(){this.game.stage.backgroundColor="#3498db",this.game.physics.startSystem(t.Physics.P2JS),this.game.state.start("load")},r}(t.State),r})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("load",["Phaser"],function(t){var n,r;return r={},r.LoadState=n=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.preload=function(){var e,n,r,i,s,o,u,a;i=this.game.add.text(this.game.world.centerX,150,"loading...",{font:"30px Arial",fill:"#ffffff"}),i.anchor.setTo(.5,.5),o=this.game.add.sprite(game.world.centerX,200,"progressBar"),o.anchor.setTo(.5,.5),this.game.load.setPreloadSprite(o),this.game.load.spritesheet("mute","assets/muteButton.png",28,22),this.game.load.image("circle","assets/circle.png"),this.game.load.image("foe","assets/foe.png"),this.game.load.spritesheet("levelselecticons","assets/levelselecticons.png",96,96),this.game.load.image("tileset","assets/tileset.png"),this.game.load.image("pixel1","assets/pixel.png"),this.game.load.image("pixel2","assets/cPixel.png"),this.game.load.image("pixel3","assets/tPixel.png"),this.game.load.image("coin","assets/coin.png"),this.game.load.image("green","assets/green.png"),this.game.load.json("l10n","l10n.json"),this.game.load.image("swiss","assets/swiss.png"),this.game.sounds={},a=["coin","die","bounce"];for(n=0,r=a.length;n<r;n++)u=a[n],this.game.load.audio(u+"Sound","assets/"+u+".wav");this.game.load.audio("music","assets/music.ogg"),s=12,e=1;while(e<=s)this.game.load.tilemap("level"+e,"levels/"+e+".json",null,t.Tilemap.TILED_JSON),e++},r.prototype.create=function(){this.game.l10n=game.cache.getJSON("l10n"),this.game.state.start("menu")},r}(t.State),r})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("menu",["Phaser"],function(t){var n,r;return r={},r.MenuState=n=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.create=function(){var e,n,r,i,s;this.game.lang="en",this.game.text=this.game.l10n[this.game.lang],e=this.game.add.text(this.game.world.centerX,80,this.game.text.name,{font:"50px Arial",fill:"#ffffff"}),e.anchor.setTo(.5,.5),e.z=1e7,n=this.game.add.text(this.game.world.centerX,this.game.world.height-80,this.game.text.upstart,{font:"25px Arial",fill:"#ffffff"}),i=this.game.add.text(20,this.game.world.height-20,"swissmade",{font:"16px Arial",fill:"#ffffff"}),r=this.game.add.sprite(100,this.game.world.height-20,"swiss"),n.anchor.setTo(.5,.5),this.game.add.tween(n).to({angle:-2},500).to({angle:2},500).loop().start(),this.muteButton=this.game.add.button(20,20,"mute",this.toggleSound,this),this.muteButton.input.useHandCursor=!0,this.game.sound.mute&&(this.muteButton.frame=1),s=this.game.input.keyboard.addKey(t.Keyboard.UP),s.onDown.addOnce(this.start,this)},r.prototype.toggleSound=function(){this.game.sound.mute=!this.game.sound.mute,this.muteButton.frame=this.game.sound.mute?1:0},r.prototype.start=function(){this.game.state.start("levelSelect")},r}(t.State),r})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("Actor",["Phaser"],function(t){var n,r;return r=n=function(t){function n(e,t,r,i,s){n.__super__.constructor.call(this,e,t,r,i,s),this.game=e,this.game.physics.p2.enable(this,this.game.global.debug),this.game.add.existing(this),this.createEvents()}return e(n,t),n.prototype.isActor=!0,n.prototype.createEvents=function(){},n}(t.Sprite)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("player",["Phaser","Actor"],function(n,r){var i,s;return s=i=function(r){function i(t,n,r,s,o){this.update=e(this.update,this),this.whenBeginContact=e(this.whenBeginContact,this),this.game=t,i.__super__.constructor.call(this,t,n,r,"circle"),this.game.add.existing(this),this.body.clearShapes(),this.body.addCircle(15),this.body.onBeginContact.add(this.whenBeginContact),this.body.data.gravityScale=0,this.bounceSpeed=this.defaultBounceSpeed,this.movementSpeed=this.defaultMovementSpeed,this.body.velocity.y=this.bounceSpeed}return t(i,r),i.prototype.defaultBounceSpeed=300,i.prototype.defaultMovementSpeed=200,i.prototype.coinsCollected=0,i.prototype.whenBeginContact=function(e,t,n,r,i){var s;this.body.data.gravityScale=0,this.body.velocity.y<0?this.body.velocity.y=this.bounceSpeed:this.body.velocity.y>0&&(this.body.velocity.y=-this.bounceSpeed);if(!e){this.game.sounds.bounce.play();return}e&&(s=this.game.map.getTileWorldXY(e.x,e.y));if(s)return s.properties.damage>0?this.die():this.game.sounds.bounce.play();if(e.sprite.tileType==="foe")return this.die();if(e.sprite.tileType==="coin")return this.coinsCollected+=1,this.game.add.tween(e.sprite).to({rotation:6},150).start(),this.game.sounds.coin.play(),this.game.time.events.add(150,function(){return e.sprite.kill()});if(e.sprite.tileType==="end")return game.state.states.play.nextLevel()},i.prototype.update=function(){var e,t;e=this.game.input.keyboard,t=n.Keyboard;if(e.isDown(t.RIGHT)&&e.isDown(t.LEFT))return this.body.velocity.x=0;if(e.isDown(t.LEFT))return this.body.velocity.x=-this.movementSpeed,this.scale.setTo(-1,1);if(e.isDown(t.RIGHT))return this.body.velocity.x=this.movementSpeed;if(e.isDown(t.UP&&!1))return this.body.velocity.y=0;if(e.isDown(t.SPACEBAR)&&this.game.global.spacebarReset)return this.body.velocity.x=0;if(this.game.global.autoReset)return this.body.velocity.x=0},i.prototype.die=function(){return this.game.emitter.x=this.x,this.game.emitter.y=this.y,this.game.emitter.start(!0,600,null,15),this.game.sounds.die.play(),this.kill(),this.game.time.events.add(10,this.restart,this)},i.prototype.restart=function(){return this.game.state.states.play.music.stop(),this.game.state.start("play")},i}(r)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("foe",["Phaser","Actor"],function(n,r){var i,s;return s={},s=i=function(n){function r(t,n,i){this.update=e(this.update,this),this.whenBeginContact=e(this.whenBeginContact,this),this.game=t,r.__super__.constructor.call(this,t,n,i,"foe"),this.body.onBeginContact.add(this.whenBeginContact),this.body.fixedRotation=!0,this.speedSet=-200,this.kinematic=!0,this.mass=1e29}return t(r,n),r.prototype.speed=125,r.prototype.tileType="foe",r.prototype.whenBeginContact=function(e,t,n,r,i){var s;if(!e)return;s=Math.atan2(e.x-this.x,e.y-this.y);if(.5<s&&s<2.5)return this.speedSet=this.speed;if(-0.5>s&&s>-2.5)return this.speedSet=-this.speed},r.prototype.update=function(){return this.body.velocity.x=-this.speedSet},r}(r),s})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("Foe",["Phaser","Actor"],function(n,r){var i,s;return s={},s=i=function(n){function r(t,n,i){this.update=e(this.update,this),this.whenBeginContact=e(this.whenBeginContact,this),this.game=t,r.__super__.constructor.call(this,t,n,i,"foe"),this.body.onBeginContact.add(this.whenBeginContact),this.body.fixedRotation=!0,this.speedSet=-200,this.kinematic=!0,this.mass=1e29}return t(r,n),r.prototype.speed=125,r.prototype.tileType="foe",r.prototype.whenBeginContact=function(e,t,n,r,i){var s;if(!e)return;s=Math.atan2(e.x-this.x,e.y-this.y);if(.5<s&&s<2.5)return this.speedSet=this.speed;if(-0.5>s&&s>-2.5)return this.speedSet=-this.speed},r.prototype.update=function(){return this.body.velocity.x=-this.speedSet},r}(r),s})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("actor",["Phaser"],function(t){var n,r;return r=n=function(t){function n(e,t,r,i,s){n.__super__.constructor.call(this,e,t,r,i,s),this.game=e,this.game.physics.p2.enable(this,this.game.global.debug),this.game.add.existing(this),this.createEvents()}return e(n,t),n.prototype.isActor=!0,n.prototype.createEvents=function(){},n}(t.Sprite)})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("coin",["Phaser","actor"],function(t,n){var r,i;return i=r=function(t){function n(e,t,r){this.game=e,n.__super__.constructor.call(this,e,t,r,"coin"),this.body.data.gravityScale=0,e.add.tween(this.body).to({y:"-20"},300).to({y:"+20"},300).loop().start()}return e(n,t),n.prototype.tileType="coin",n}(n)})}.call(this),function(){define("loadLevel",["Phaser","Foe","coin","actor","player"],function(e,t,n,r,i){var s,o,u,a,f,l;return s={},s.load=function(e){var t,n,r;return n="level"+e.level.number,e.cache.checkTilemapKey(n)?(r=e.add.tilemap(n),r.addTilesetImage("tileset"),t=r.createLayer("layer"),t.resizeWorld(),r.setCollisionBetween(1,2),e.physics.p2.convertTilemap(r,t),e.map=r,e.layer=t,f(e,e.map,e.layer),!0):!1},f=function(e,t,n){var r,s,f,c,h,p;c=t.objects.objects,h=[];for(r=0,s=c.length;r<s;r++){f=c[r],p=f.type;switch(f.type){case"text":h.push(l(e,f,t,n));break;case"coin":h.push(o(e,f,t,n));break;case"endMarker":h.push(u(e,f,t,n));break;case"foe":h.push(a(e,f,t,n));break;case"spawn":h.push(e.state.states.play.player=new i(e,f.x,f.y));break;default:h.push(console.warn("Undefined object type: "+f.type))}}return h},a=function(e,n){var r,i;return r=n.x+5,i=n.y+5,new t(e,r,i)},l=function(e,t){return e.add.text(t.x,t.y,t.properties[e.lang],{font:"30px Arial",fill:"#ffffff"})},o=function(e,t){return e.level.totalCoins+=1,new n(e,t.x,t.y)},u=function(e,t){var n,i,s,o,u,a,f,l;return o=t.x+t.width/2,a=t.y+t.height/2,s=e.make.bitmapData(t.width,t.height),s.ctx.fillRect(0,0,t.width,t.length),i=new r(e,o,a,s),i.body.data.gravityScale=0,i.body["static"]=!0,i.tileType="end",l=t.y,u=t.x,f=t.y+t.height,n=e.add.group(),e.add.sprite(u,l,"green",0,n)},s})}.call(this);var Stats=function(){function e(e,t,n){return e=document.createElement(e),e.id=t,e.style.cssText=n,e}function t(t,n,r){var i=e("div",t,"padding:0 0 3px 3px;text-align:left;background:"+r),s=e("div",t+"Text","font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px;color:"+n);s.innerHTML=t.toUpperCase(),i.appendChild(s),t=e("div",t+"Graph","width:74px;height:30px;background:"+n),i.appendChild(t);for(n=0;74>n;n++)t.appendChild(e("span","","width:1px;height:30px;float:left;opacity:0.9;background:"+r));return i}function n(e){for(var t=f.children,n=0;n<t.length;n++)t[n].style.display=n===e?"block":"none";a=e}function r(e,t){e.appendChild(e.firstChild).style.height=Math.min(30,30-30*t)+"px"}var i=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now,s=i(),o=s,u=0,a=0,f=e("div","stats","width:80px;opacity:0.9;cursor:pointer");f.addEventListener("mousedown",function(e){e.preventDefault(),n(++a%f.children.length)},!1);var l=0,c=Infinity,h=0,p=t("fps","#0ff","#002"),d=p.children[0],v=p.children[1];f.appendChild(p);var m=0,g=Infinity,y=0,p=t("ms","#0f0","#020"),b=p.children[0],w=p.children[1];f.appendChild(p);if(self.performance&&self.performance.memory){var E=0,S=Infinity,x=0,p=t("mb","#f08","#201"),T=p.children[0],N=p.children[1];f.appendChild(p)}return n(a),{REVISION:14,domElement:f,setMode:n,begin:function(){s=i()},end:function(){var e=i();m=e-s,g=Math.min(g,m),y=Math.max(y,m),b.textContent=(m|0)+" MS ("+(g|0)+"-"+(y|0)+")",r(w,m/200),u++;if(e>o+1e3&&(l=Math.round(1e3*u/(e-o)),c=Math.min(c,l),h=Math.max(h,l),d.textContent=l+" FPS ("+c+"-"+h+")",r(v,l/100),o=e,u=0,void 0!==E)){var t=performance.memory.usedJSHeapSize,n=performance.memory.jsHeapSizeLimit;E=Math.round(9.54e-7*t),S=Math.min(S,E),x=Math.max(x,E),T.textContent=E+" MB ("+S+"-"+x+")",r(N,t/n)}return e},update:function(){s=this.end()}}};"object"==typeof module&&(module.exports=Stats),define("../stats.min",function(){}),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("play",["Phaser","player","foe","loadLevel","../stats.min"],function(t,n,r,i,s){var o,u;return u={},u.PlayState=o=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.create=function(){return window.p=this,this.game=game,i.load(game)?(this.game.map.setTileIndexCallback(2,this.player.whenHitRed),this.game.input.keyboard.addKey(t.Keyboard.ESC).onDown.add(this.end,this),this.game.physics.p2.gravity.y=500,this.game.coinsCollected=0,this.setupCamera(),this.setupEmitter(),this.setupScoreText(),this.game.global.debug&&this.setupStats(),this.setupSounds()):(this.game.level.number!==13&&alert(this.game.text.loaderror),this.error=!0,this.end())},r.prototype.setupCamera=function(){var e,n,r,i;return i=this.game.global.width,n=this.game.global.height,r=i/8,e=n/3,this.game.camera.follow(this.player),this.game.camera.deadzone=new t.Rectangle(218.75,30,40,n-50)},r.prototype.setupEmitter=function(){var e;return e=game.add.emitter(0,0,0,25),e.makeParticles(["pixel1","pixel2"]),e.setXSpeed(200,-200),e.setYSpeed(500,-500),e.minParticleScale=.7,e.maxParticleScale=1.2,e.minRotation=0,e.maxRotation=100,e.width=69,e.height=42,e.gravity=0,this.game.emitter=e},r.prototype.setupScoreText=function(){return this.game.scoreLabel=game.add.text(375,2,this.game.text.score+": 0",{font:"16px Arial",fill:"#ffffff"}),this.game.scoreLabel.fixedToCamera=!0},r.prototype.setupStats=function(){return s=new Stats,s.setMode(0),s.domElement.style.position="absolute",s.domElement.style.left="0px",s.domElement.style.top="0px",document.getElementById("gameDiv").appendChild(s.domElement),this.stats=s},r.prototype.setupSounds=function(){return this.game.sounds.coin=game.add.audio("coinSound",.375),this.game.sounds.die=game.add.audio("dieSound",.5),this.game.sounds.bounce=game.add.audio("bounceSound",.3),this.music=game.add.audio("music",.25,!0),this.music.play()},r.prototype.update=function(){if(this.error)return;this.game.global.debug&&this.stats.begin(),this.player.update(),this.game.scoreLabel.text=this.game.text.score+": "+this.player.coinsCollected;if(this.game.global.debug)return this.stats.end()},r.prototype.nextLevel=function(){var e;return e=Math.round(this.player.coinsCollected/this.game.level.totalCoins*3),console.log(e),this.game.playerData[this.game.level.number-1]=e,console.log(this.game.playerData),this.game.level.number<this.game.playerData.length&&this.game.playerData[this.game.level.number]<0&&(this.game.playerData[this.game.level.number]=0),window.localStorage.setItem("progress",JSON.stringify(this.game.playerData)),this.game.level.number+=1,this.music&&this.music.stop(),game.state.start("play")},r.prototype.end=function(){return this.music&&this.music.stop(),game.state.start("levelSelect")},r}(t.State),u})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("levelSelect",["Phaser"],function(t){var n,r;return r=n=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.preload=function(){this.initProgressData(),this.holdicons=[]},r.prototype.create=function(){this.game.level={totalCoins:0},this.createLevelIcons(),this.animateLevelIcons(),this.setupCheatCode(),this.game.input.keyboard.addKey(t.Keyboard.ESC).onDown.add(this.end,this)},r.prototype.initProgressData=function(){var e,t;if(!this.game.playerData){t=window.localStorage.getItem("progress");try{this.game.playerData=JSON.parse(t)}catch(n){e=n,this.game.playerData=[]}Object.prototype.toString.call(this.game.playerData)!=="[object Array]"&&(this.game.playerData=[])}},r.prototype.createLevelIcons=function(){var e,t,n,r,i,s,o,u,a;n=0,u=0;while(u<3){s=0;while(s<4)n+=1,typeof this.game.playerData[n-1]!="number"&&(n===1?this.game.playerData[n-1]=0:this.game.playerData[n-1]=-1),r=this.game.playerData[n-1],t=!0,i=0,r>-1&&(t=!1,r<4&&(i=r)),o=0+s*128,a=0+u*128,this.holdicons[n-1]=this.createLevelIcon(o,a,n,t,i),e=this.holdicons[n-1].getAt(0),e.health=n,e.inputEnabled=!0,e.events.onInputDown.add(this.onSpriteDown,this),s++;u++}},r.prototype.createLevelIcon=function(e,t,n,r,i){var s,o,u,a,f;return s=this.game.add.group(),s.x=e,s.y=t,s.xOrg=e,s.yOrg=t,o=0,r===!1&&(o=1),u=this.game.add.sprite(0,0,"levelselecticons",o),s.add(u),r||(f=this.game.add.text(32,10,n,{font:"50px Arial",fill:"#ffffff"}),a=this.game.add.sprite(0,0,"levelselecticons",2+i),s.add(f),s.add(a)),s},r.prototype.onSpriteDown=function(e,n){var r,i,s,o;i=e.health,this.game.playerData[i-1]<0?(r=this.holdicons[i-1],o=r.xOrg,s=this.game.add.tween(r).to({x:o+6},20,t.Easing.Linear.None).to({x:o-5},20,t.Easing.Linear.None).to({x:o+4},20,t.Easing.Linear.None).to({x:o-3},20,t.Easing.Linear.None).to({x:o+2},20,t.Easing.Linear.None).to({x:o},20,t.Easing.Linear.None).start()):(r=this.holdicons[i-1],s=this.game.add.tween(r.scale).to({x:.9,y:.9},100,t.Easing.Linear.None).to({x:1,y:1},100,t.Easing.Linear.None).start(),console.dir(s),s.onComplete.add(function(){this.onLevelSelected(e.health)},this))},r.prototype.animateLevelIcons=function(){var e,n,r;n=0;while(n<this.holdicons.length)e=this.holdicons[n],e.y=e.y+600,r=e.y,this.game.add.tween(e).to({y:r-600},500,t.Easing.Back.Out,!0,n*40),n++},r.prototype.setupCheatCode=function(){var e,n,r,i,s,o;return o=game.input.keyboard.addKey(t.Keyboard.UP),r=game.input.keyboard.addKey(t.Keyboard.DOWN),i=game.input.keyboard.addKey(t.Keyboard.LEFT),s=game.input.keyboard.addKey(t.Keyboard.RIGHT),e=game.input.keyboard.addKey(t.Keyboard.A),n=game.input.keyboard.addKey(t.Keyboard.B),o.onUp.addOnce(function(){return o.onUp.addOnce(function(){return r.onUp.addOnce(function(){return r.onUp.addOnce(function(){return i.onUp.addOnce(function(){return s.onUp.addOnce(function(){return i.onUp.addOnce(function(){return s.onUp.addOnce(function(){return n.onUp.addOnce(function(){return e.onUp.addOnce(function(){return console.log("CHEATER"),game.playerData=[3,3,3,3,3,3,3,3,3,3,3,3],window.localStorage.setItem("progress",JSON.stringify(game.playerData)),game.state.start("play")})})})})})})})})})})},r.prototype.onLevelSelected=function(e){this.game.level.number=e,this.state.start("play")},r.prototype.end=function(){return game.state.start("menu")},r}(t.State)})}.call(this),function(){requirejs.config({baseUrl:"js",paths:{Phaser:"../phaser"}}),require(["Phaser","boot","load","menu","play","levelSelect"],function(e,t,n,r,i,s){var o;return o={score:0,debug:!1,width:500,height:360,spacebarReset:!1,autoReset:!1},window.game=new e.Game(o.width,o.height,e.AUTO,"gameDiv"),game.global=o,game.state.add("boot",new t.BootState),game.state.add("load",new n.LoadState),game.state.add("menu",new r.MenuState),game.state.add("play",new i.PlayState),game.state.add("levelSelect",new s),game.state.start("boot")})}.call(this),define("game",function(){});